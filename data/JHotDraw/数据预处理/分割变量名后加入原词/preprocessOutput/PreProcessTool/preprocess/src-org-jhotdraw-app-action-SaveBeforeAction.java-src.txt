SaveBeforeAction save before action java 2 2 0 0 2006 2006 06 06 15 15 Copyright copyright c c 2005 2005 2006 2006 Werner wern Randelshofer randelshof Staldenmattweg staldenmattweg 2 2 Immensee immensee CH c h 6405 6405 Switzerland switzerland All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of Werner wern Randelshofer randelshof Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with Werner wern Randelshofer randelshof package org org jhotdraw jhotdraw app app action action import org org jhotdraw jhotdraw io io import org org jhotdraw jhotdraw gui gui import org org jhotdraw jhotdraw gui gui event event import org org jhotdraw jhotdraw util util import java awt awt import java awt awt event event import javax javax swing swing import java io io import org org jhotdraw jhotdraw app app Application application import org org jhotdraw jhotdraw app app Project project Base base class for actions action that that can can only only be be safely safely performed perform when when the the project project has ha no no unsaved unsav changes change p p If the the project project has ha no no unsaved unsav changes change method doIt it is is invoked immediately immediately If unsaved unsav changes change are are present present a a dialog dialog is is shown show asking asking whether wheth the the user user wants want to to discard discard the the changes change cancel cancel or or save save the the changes change before before doing it it If the the user user chooses choos to to discard discard the the chanegs chaneg toIt to it is is invoked immediately immediately If the the user user chooses choos to to cancel cancel the the action action is is aborted abort If the the user user chooses choos to to save save the the changes change the the project project is is saved save and and doIt it is is only only invoked after after the the project project was wa successfully successfully saved save author author Werner wern Randelshofer randelshof version 2 2 0 0 2006 2006 06 06 15 15 Reworked rework br 1 1 2 2 2006 2006 05 05 19 19 Make make filename filename acceptable acceptable by by ExtensionFileFilter extension filter br 1 1 1 1 2006 2006 05 05 03 03 Localized localize messages message br 1 1 0 0 27 27 September september 2005 2005 Created create public abstract class SaveBeforeAction save before action extends AbstractProjectAction project action private Component component oldFocusOwner old focus owner Creates create a a new instance instance public SaveBeforeAction save before action Application application app app super app app public void actionPerformed action perform ActionEvent action event evt evt final Project project p p getCurrentProject get current project if p p isEnabled is enable final ResourceBundleUtil resource bundle util labels label ResourceBundleUtil resource bundle util getLAFBundle get l a f bundle org org jhotdraw jhotdraw app app Labels label Window window wAncestor w ancestor SwingUtilities swing utility getWindowAncestor get window ancestor p p getComponent get component oldFocusOwner old focus owner wAncestor w ancestor null ? ? null wAncestor w ancestor getFocusOwner get focus owner p p setEnabled set enable false if p p hasUnsavedChanges ha unsav change JOptionPane j option pane pane pane new JOptionPane j option pane html html +UIManager + u i manager getString get OptionPane option pane css cs + + labels label getString get saveBeforeMessage save before message JOptionPane j option pane WARNING w a r n i n g MESSAGE m e s s a g e Object options option labels label getString get save save labels label getString get cancel cancel labels label getString get dontSave dont save pane pane setOptions set option options option pane pane setInitialValue set initial value options option 0 0 pane pane putClientProperty put client property Quaqua quaqua OptionPane option pane destructiveOption destructive option new Integer 2 2 JSheet j sheet showSheet show sheet pane pane p p getComponent get component new SheetListener sheet listener public void optionSelected option select SheetEvent sheet event evt evt Object value value evt evt getValue get value if value value null || || value value equals equal labels label getString get cancel cancel p p setEnabled set enable true else if value value equals equal labels label getString get dontSave dont save doIt it p p p p setEnabled set enable true else if value value equals equal labels label getString get save save saveChanges save change p p else doIt it p p p p setEnabled set enable true if oldFocusOwner old focus owner null oldFocusOwner old focus owner requestFocus request focus protected void saveChanges save change final Project project p p if p p getFile get null JFileChooser j chooser fileChooser chooser p p getSaveChooser get save chooser int option option fileChooser chooser showSaveDialog show save dialog this JSheet j sheet showSaveSheet show save sheet fileChooser chooser p p getComponent get component new SheetListener sheet listener public void optionSelected option select final SheetEvent sheet event evt evt if evt evt getOption get option JFileChooser j chooser APPROVE a p p r o v e OPTION o p t i o n final File file if evt evt getFileChooser get chooser getFileFilter get filter instanceof ExtensionFileFilter extension filter file ExtensionFileFilter extension filter evt evt getFileChooser get chooser getFileFilter get filter makeAcceptable make acceptable evt evt getFileChooser get chooser getSelectedFile get select else file evt evt getFileChooser get chooser getSelectedFile get select saveToFile save to p p file else p p setEnabled set enable true if oldFocusOwner old focus owner null oldFocusOwner old focus owner requestFocus request focus else saveToFile save to p p p p getFile get protected void saveToFile save to final Project project p p final File file p p execute execute new Worker worker public Object construct construct try p p write write file return null catch IOException i o e e return e e public void finished finish Object value value fileSaved save p p file value value protected void fileSaved save Project project p p File file Object value value if value value null p p setFile set file p p markChangesAsSaved mark change a save doIt it p p else ResourceBundleUtil resource bundle util labels label ResourceBundleUtil resource bundle util getLAFBundle get l a f bundle org org jhotdraw jhotdraw app app Labels label JSheet j sheet showMessageSheet show message sheet p p getComponent get component html html +UIManager + u i manager getString get OptionPane option pane css cs + + labels label getFormatted get format couldntSave couldnt save file value value JOptionPane j option pane ERROR e r r o r MESSAGE m e s s a g e p p setEnabled set enable true if oldFocusOwner old focus owner null oldFocusOwner old focus owner requestFocus request focus protected abstract void doIt it Project project p p 