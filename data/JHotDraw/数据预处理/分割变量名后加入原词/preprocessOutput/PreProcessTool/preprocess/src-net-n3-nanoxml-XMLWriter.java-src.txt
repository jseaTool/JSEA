XMLWriter xml writer java NanoXML nano xml Java $Revision $ revision 1 1 4 4 $ $ $Date $ date 2002 2002 03 03 24 24 11 11 37 37 51 51 $ $ $Name $ name RELEASE r e l e a s e 2 2 2 2 1 1 $ $ This file is is part part of of NanoXML nano xml 2 2 for Java Copyright copyright C c 2000 2000 2002 2002 Marc marc De de Scheemaecker scheemaeck All all Rights right Reserved reserve This software software is is provided provide as a is is without without any any express express or or implied imply warranty warranty In in no no event event will will the the authors author be be held hold liable liable for any any damages damage arising arise from from the the use use of of this software software Permission permission is is granted grant to to anyone anyone to to use use this software software for any any purpose purpose including include commercial commercial applications application and and to to alter alter it it and and redistribute redistribute it it freely freely subject subject to to the the following following restrictions restriction 1 1 The the origin origin of of this software software must must not not be be misrepresented misrepresent you you must must not not claim claim that that you you wrote write the the original original software software If you you use use this software software in in a a product product an an acknowledgment acknowledgment in in the the product product documentation documentation would would be be appreciated appreciate but but is is not not required require 2 2 Altered alter source source versions must must be be plainly plainly marked mark as a such such and and must must not not be be misrepresented misrepresent as a being being the the original original software software 3 3 This notice notice may may not not be be removed remove or or altered alter from from any any source source distribution distribution package net net n3 n3 nanoxml nanoxml import java io io IOException i o import java io io OutputStream output stream import java io io PrintWriter print writer import java io io Writer writer import java util util Iterator iterator import java util util Vector vector An an XMLWriter xml writer writes write XML xml data data to to a a stream stream see see net net n3 n3 nanoxml nanoxml IXMLElement i xml element see see java io io Writer writer author author Marc marc De de Scheemaecker scheemaeck version $Name $ name RELEASE r e l e a s e 2 2 2 2 1 1 $ $ $Revision $ revision 1 1 4 4 $ $ public class XMLWriter xml writer Where where to to write write the the output output to to private PrintWriter print writer writer writer Creates create a a new XML xml writer writer param writer writer where where to to write write the the output output to to public XMLWriter xml writer Writer writer writer writer if writer writer instanceof PrintWriter print writer this writer writer PrintWriter print writer writer writer else this writer writer new PrintWriter print writer writer writer Creates create a a new XML xml writer writer param stream stream where where to to write write the the output output to to public XMLWriter xml writer OutputStream output stream stream stream this writer writer new PrintWriter print writer stream stream Cleans clean up up the the object when when it it s s destroyed destroy protected void finalize finalize throws Throwable throwable this writer writer null super finalize finalize Writes write an an XML xml element element param xml xml the the non non null XML xml element element to to write write public void write write IXMLElement i xml element xml xml throws IOException i o this write write xml xml false 0 0 true Writes write an an XML xml element element param xml xml the the non non null XML xml element element to to write write param prettyPrint pretty print if spaces space need need to to be be inserted insert to to make make the the output output more more readable readable public void write write IXMLElement i xml element xml xml boolean prettyPrint pretty print throws IOException i o this write write xml xml prettyPrint pretty print 0 0 true Writes write an an XML xml element element param xml xml the the non non null XML xml element element to to write write param prettyPrint pretty print if spaces space need need to to be be inserted insert to to make make the the output output more more readable readable param indent indent how how many many spaces space to to indent indent the the element element public void write write IXMLElement i xml element xml xml boolean prettyPrint pretty print int indent indent throws IOException i o this write write xml xml prettyPrint pretty print indent indent true Writes write an an XML xml element element param xml xml the the non non null XML xml element element to to write write param prettyPrint pretty print if spaces space need need to to be be inserted insert to to make make the the output output more more readable readable param indent indent how how many many spaces space to to indent indent the the element element public void write write IXMLElement i xml element xml xml boolean prettyPrint pretty print int indent indent boolean collapseEmptyElements collapse empty element throws IOException i o if prettyPrint pretty print for int i i 0 0 i i indent indent i++ i++ this writer writer print print if xml xml getName get name null if xml xml getContent get content null if prettyPrint pretty print this writeEncoded write encode xml xml getContent get content trim trim writer writer println else this writeEncoded write encode xml xml getContent get content else this writer writer print print this writer writer print print xml xml getFullName get full name Vector vector nsprefixes nsprefix new Vector vector if xml xml getNamespace get namespace null if xml xml getName get name equals equal xml xml getFullName get full name this writer writer print print xmlns xmln \ \ + + xml xml getNamespace get namespace + + else String prefix prefix xml xml getFullName get full name prefix prefix prefix prefix substring substring 0 0 prefix prefix indexOf index of nsprefixes nsprefix addElement add element prefix prefix this writer writer print print xmlns xmln + + prefix prefix this writer writer print print \ \ + + xml xml getNamespace get namespace + + \ \ Iterator iterator enm enm xml xml iterateAttributeNames iterate attribute name while enm enm hasNext ha next String key key String enm enm next next int index index key key indexOf index of if index index 0 0 String namespace namespace xml xml getAttributeNamespace get attribute namespace key key if namespace namespace null String prefix prefix key key substring substring 0 0 index index if nsprefixes nsprefix contains contain prefix prefix this writer writer print print xmlns xmln + + prefix prefix this writer writer print print \ \ + + namespace namespace + + nsprefixes nsprefix addElement add element prefix prefix enm enm xml xml iterateAttributeNames iterate attribute name while enm enm hasNext ha next String key key String enm enm next next String value value xml xml getAttribute get attribute key key null this writer writer print print + + key key + + \ \ this writeEncoded write encode value value this writer writer print print if xml xml getContent get content null xml xml getContent get content length length 0 0 writer writer print print this writeEncoded write encode xml xml getContent get content writer writer print print + + xml xml getFullName get full name + + if prettyPrint pretty print writer writer println else if xml xml hasChildren ha child || || collapseEmptyElements collapse empty element writer writer print print if prettyPrint pretty print writer writer println enm enm xml xml iterateChildren iterate child while enm enm hasNext ha next IXMLElement i xml element child child IXMLElement i xml element enm enm next next this write write child child prettyPrint pretty print indent indent + + 4 4 collapseEmptyElements collapse empty element if prettyPrint pretty print for int i i 0 0 i i indent indent i++ i++ this writer writer print print this writer writer print print + + xml xml getFullName get full name + + if prettyPrint pretty print writer writer println else this writer writer print print if prettyPrint pretty print writer writer println this writer writer flush flush Writes write a a string encoding encoding reserved reserve characters character param str str the the string to to write write private void writeEncoded write encode String str str for int i i 0 0 i i str str length length i++ i++ char c c str str charAt at i i switch c c case 0x0A 0x0 a this writer writer print print c c break case this writer writer print print lt lt break case this writer writer print print gt break case this writer writer print print amp amp break case \ \ this writer writer print print apos apo break case this writer writer print print quot break default if c c || || c c 0x7E 0x7 e this writer writer print print x x this writer writer print print Integer toString to c c 16 16 this writer writer print print else this writer writer print print c c 