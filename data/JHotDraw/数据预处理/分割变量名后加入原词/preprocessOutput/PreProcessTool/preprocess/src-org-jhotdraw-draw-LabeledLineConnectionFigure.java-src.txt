LabeledLineConnection label line connection java 1 1 1 1 2006 2006 02 02 14 14 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org package org org jhotdraw jhotdraw draw draw import org org jhotdraw jhotdraw util util import java util util import java awt awt import java awt awt geom geom import javax javax swing swing event event import javax javax swing swing undo undo A a LineConnection line connection with with labels label author author Werner wern Randelshofer randelshof version 1 1 1 1 2006 2006 02 02 14 14 Do not not include include labels label in in logical logical bounds bound br 1 1 0 0 23 23 Januar januar 2006 2006 Created create public class LabeledLineConnectionFigure label line connection figure extends LineConnectionFigure line connection figure implements CompositeFigure composite figure private Layouter layout layouter layout private ArrayList list Figure figure children child new ArrayList list private Rectangle2D rectangle2 d Double bounds bound private Rectangle2D rectangle2 d Double drawBounds draw bound Handles handle figure figure changes change in in the the children child private ChildHandler child handler childHandler child handler new ChildHandler child handler this private static class ChildHandler child handler implements FigureListener figure listener UndoableEditListener undoable edit listener private LabeledLineConnectionFigure label line connection figure owner owner private ChildHandler child handler LabeledLineConnectionFigure label line connection figure owner owner this owner owner owner owner public void figureRequestRemove figure request remove FigureEvent figure event e e owner owner remove remove e e getFigure get figure public void figureRemoved figure remove FigureEvent figure event evt evt public void figureChanged figure change FigureEvent figure event e e if owner owner isChanging is change owner owner willChange will change owner owner fireFigureChanged fire figure change e e owner owner changed change public void figureAdded figure add FigureEvent figure event e e public void figureAttributeChanged figure attribute change FigureEvent figure event e e public void figureAreaInvalidated figure area invalidate FigureEvent figure event e e if owner owner isChanging is change owner owner fireAreaInvalidated fire area invalidate e e getInvalidatedArea get invalidate area public void undoableEditHappened undoable edit happen UndoableEditEvent undoable edit event e e owner owner fireUndoableEditHappened fire undoable edit happen e e getEdit get edit Creates create a a new instance instance public LabeledLineConnectionFigure label line connection figure DRAWING d r a w i n g Draw draw the the figure figure This method is is delegated delegate to to the the encapsulated encapsulate presentation presentation figure figure public void drawFigure draw figure Graphics2D graphics2 d g g super drawFigure draw figure g g for Figure figure child child children child if child child isVisible is visible child child draw draw g g SHAPE s h a p e AND a n d BOUNDS b o u n d s Transforms transform the the figure figure public void basicTransform basic transform AffineTransform affine transform tx tx super basicTransform basic transform tx tx for Figure figure f f children child f f basicTransform basic transform tx tx invalidateBounds invalidate bound public void basicSetBounds basic set bound Point2D point2 d Double anchor anchor Point2D point2 d Double lead super basicSetBounds basic set bound anchor anchor lead invalidate invalidate public Rectangle2D rectangle2 d Double getBounds get bound return super getBounds get bound if bounds bound null bounds bound super getBounds get bound for Figure figure child child getChildrenFrontToBack get child front to back if child child isVisible is visible bounds bound add add child child getBounds get bound return Rectangle2D rectangle2 d Double bounds bound clone clone public Rectangle2D rectangle2 d Double getFigureDrawBounds get figure draw bound if drawBounds draw bound null drawBounds draw bound super getFigureDrawBounds get figure draw bound for Figure figure child child getChildrenFrontToBack get child front to back if child child isVisible is visible Rectangle2D rectangle2 d Double childBounds child bound child child getDrawBounds get draw bound if childBounds child bound isEmpty is empty drawBounds draw bound add add childBounds child bound return Rectangle2D rectangle2 d Double drawBounds draw bound clone clone public boolean contains contain Point2D point2 d Double p p if getDrawBounds get draw bound contains contain p p for Figure figure child child getChildrenFrontToBack get child front to back if child child isVisible is visible child child contains contain p p return true return super contains contain p p return false protected void invalidateBounds invalidate bound bounds bound null drawBounds draw bound null ATTRIBUTES a t t r i b u t e s Sets set an an attribute attribute of of the the figure figure AttributeKey attribute key name name and and semantics semantics are are defined define by by the the class implementing implement the the figure figure interface public void setAttribute set attribute AttributeKey attribute key key key Object newValue value willChange will change super setAttribute set attribute key key newValue value if isAttributeEnabled is attribute enable key key if children child null for Figure figure child child children child child child setAttribute set attribute key key newValue value changed change EDITING e d i t i n g public Figure figure findFigureInside find figure inside Point2D point2 d Double p p if getDrawBounds get draw bound contains contain p p Figure figure found found null for Figure figure child child getChildrenFrontToBack get child front to back if child child isVisible is visible found found child child findFigureInside find figure inside p p if found found null return found found return null CONNECTING c o n n e c t i n g public void updateConnection update connection super updateConnection update connection layout layout COMPOSITE c o m p o s i t e FIGURES f i g u r e s public java util util List list Figure figure getChildren get child return Collections collection unmodifiableList unmodifiable list children child public int getChildCount get child count return children child size size public Figure figure getChild get child int index index return children child get get index index public void set set int index index Figure figure child child children child set set index index child child Returns an an iterator iterator to to iterate iterate in in Z z order order front front to to back back over over the the children child public java util util List list Figure figure getChildrenFrontToBack get child front to back return children child null ? ? new LinkedList link list Figure figure new ReversedList reverse list Figure figure children child public void add add Figure figure figure figure basicAdd basic add figure figure if getDrawing get drawing null figure figure addNotify add notify getDrawing get drawing public void add add int index index Figure figure figure figure basicAdd basic add index index figure figure if getDrawing get drawing null figure figure addNotify add notify getDrawing get drawing public void basicAdd basic add Figure figure figure figure basicAdd basic add children child size size figure figure public void basicAdd basic add int index index Figure figure figure figure children child add add index index figure figure figure figure addFigureListener add figure listener childHandler child handler figure figure addUndoableEditListener add undoable edit listener childHandler child handler invalidate invalidate public boolean remove remove final Figure figure figure figure int index index children child indexOf index of figure figure if index index 1 1 return false else willChange will change basicRemoveChild basic remove child index index if getDrawing get drawing null figure figure removeNotify remove notify getDrawing get drawing changed change return true public Figure figure removeChild remove child int index index willChange will change Figure figure figure figure basicRemoveChild basic remove child index index if getDrawing get drawing null figure figure removeNotify remove notify getDrawing get drawing changed change return figure figure public boolean basicRemove basic remove final Figure figure figure figure int index index children child indexOf index of figure figure if index index 1 1 return false else basicRemoveChild basic remove child index index return true public Figure figure basicRemoveChild basic remove child int index index Figure figure figure figure children child remove remove index index figure figure removeFigureListener remove figure listener childHandler child handler figure figure removeUndoableEditListener remove undoable edit listener childHandler child handler return figure figure public void removeAllChildren remove all child willChange will change while children child size size 0 0 Figure figure figure figure basicRemoveChild basic remove child children child size size 1 1 if getDrawing get drawing null figure figure removeNotify remove notify getDrawing get drawing changed change public void basicRemoveAllChildren basic remove all child while children child size size 0 0 basicRemoveChild basic remove child children child size size 1 1 LAYOUT l a y o u t Get get a a Layouter layout object which which encapsulated encapsulate a a layout layout algorithm algorithm for this figure figure Typically typically a a Layouter layout accesses access the the child child components component of of this figure figure and and arranges arrange their their graphical graphical presentation presentation return layout layout strategy strategy used use by by this figure figure public Layouter layout getLayouter get layout return layouter layout public void setLayouter set layout Layouter layout newLayouter layout this layouter layout newLayouter layout A a layout layout algorithm algorithm is is used use to to define define how how the the child child components component should should be be laid lay out out in in relation relation to to each each other other The the task task for layouting layout the the child child components component for presentation presentation is is delegated delegate to to a a Layouter layout which which can can be be plugged plug in in at at runtime runtime public void layout layout if getLayouter get layout null Rectangle2D rectangle2 d Double bounds bound getBounds get bound Point2D point2 d Double p p new Point2D point2 d Double bounds bound x x bounds bound y y Rectangle2D rectangle2 d Double r r getLayouter get layout layout layout this p p p p invalidateBounds invalidate bound EVENT e v e n t HANDLING h a n d l i n g public void invalidate invalidate super invalidate invalidate invalidateBounds invalidate bound public void validate validate super validate validate layout layout public void addNotify add notify Drawing drawing drawing drawing for Figure figure child child new LinkedList link list Figure figure children child child child addNotify add notify drawing drawing super addNotify add notify drawing drawing public void removeNotify remove notify Drawing drawing drawing drawing for Figure figure child child new LinkedList link list Figure figure children child child child removeNotify remove notify drawing drawing super removeNotify remove notify drawing drawing Informs inform that that a a figure figure changed change the the area area of of its it display display box box public void changed change if isChangingCount is change count 1 1 super changed change layout layout fireFigureChanged fire figure change getDrawBounds get draw bound else invalidateBounds invalidate bound isChangingCount is change count public LabeledLineConnectionFigure label line connection figure clone clone LabeledLineConnectionFigure label line connection figure that that LabeledLineConnectionFigure label line connection figure super clone clone that that childHandler child handler new ChildHandler child handler that that that that children child new ArrayList list Figure figure for Figure figure thisChild child this children child Figure figure thatChild that child Figure figure thisChild child clone clone that that children child add add thatChild that child thatChild that child addFigureListener add figure listener that that childHandler child handler thatChild that child addUndoableEditListener add undoable edit listener that that childHandler child handler return that that public void remap remap HashMap hash map Figure figure Figure figure oldToNew old to super remap remap oldToNew old to for Figure figure child child children child child child remap remap oldToNew old to Informs inform that that a a figure figure changed change the the area area of of its it display display box box public void changed change FIXME f i x m e May may break super implementation if isChangingCount is change count 1 1 layout layout fireFigureChanged fire figure change getDrawBounds get draw bound else invalidateBounds invalidate bound isChangingCount is change count 