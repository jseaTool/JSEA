ChangeConnectionHandle change connection handle java 2 2 1 1 2006 2006 02 02 16 16 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org ??? ??? package org org jhotdraw jhotdraw draw draw import org org jhotdraw jhotdraw util util import java awt awt import java awt awt geom geom import java util util ChangeConnectionHandle change connection handle factors factor the the common common code for handles handle that that can can be be used use to to reconnect reconnect connections connection see see ChangeConnectionEndHandle change connection end handle see see ChangeConnectionStartHandle change connection start handle author author Werner wern Randelshofer randelshof version 2 2 1 1 2006 2006 02 02 16 16 Remove remove liner liner from from connection connection while tracking tracking br 2 2 0 0 2006 2006 01 01 14 14 Changed change to to support support double coordinates coordinate br 1 1 0 0 2003 2003 12 12 01 01 Derived derive from from JHotDraw jhotdraw 5 5 4b1 4b1 public abstract class ChangeConnectionHandle change connection handle extends AbstractHandle handle private Connector connector originalTarget original target private Figure figure targetFigure target figure private ConnectionFigure connection figure connection connection private Point point start start We we temporarily temporarily remove remove the the liner liner from from the the connection connection figure figure while the the handle handle is is being being moved move We we store store the the liner liner here here and and add add it it back back when when the the user user has ha finished finish the the interaction interaction private Liner liner liner liner Initializes initializ the the change change connection connection handle handle protected ChangeConnectionHandle change connection handle Figure figure owner owner super owner owner setConnection set connection ConnectionFigure connection figure owner owner setTargetFigure set target figure null public boolean isCombinableWith is combinable with Handle handle handle handle return false Returns the the target target connector connector of of the the change change protected abstract Connector connector getTarget get target Disconnects disconnect the the connection connection protected abstract void disconnect disconnect Connect connect the the connection connection with with the the given given figure figure protected abstract void connect connect Connector connector c c Sets set the the location location of of the the target target point point protected abstract void setLocation set location Point2D point2 d Double p p Returns the the start start point point of of the the connection connection protected abstract Point2D point2 d Double getLocation get location Gets get the the side side of of the the connection connection that that is is unaffected unaffect by by the the change change protected Connector connector getSource get source if getTarget get target getConnection get connection getStartConnector get start connector return getConnection get connection getEndConnector get end connector return getConnection get connection getStartConnector get start connector Disconnects disconnect the the connection connection public void trackStart track start Point point anchor anchor int modifiersEx modifier ex originalTarget original target getTarget get target start start anchor anchor liner liner connection connection getLiner get liner connection connection setLiner set liner null disconnect disconnect Finds find a a new target target of of the the connection connection public void trackStep track step Point point anchor anchor Point point lead int modifiersEx modifier ex Point2D point2 d Double p p view view viewToDrawing view to drawing lead Figure figure f f findConnectableFigure find connectable figure p p view view getDrawing get drawing track track the the figure figure containing contain the the mouse mouse if f f getTargetFigure get target figure if getTargetFigure get target figure null getTargetFigure get target figure setConnectorsVisible set connector visible false null setTargetFigure set target figure f f if getSource get source null if getTargetFigure get target figure null getTargetFigure get target figure setConnectorsVisible set connector visible true getConnection get connection else if getTargetFigure get target figure null canConnect can connect getSource get source getOwner get owner getTargetFigure get target figure getTargetFigure get target figure setConnectorsVisible set connector visible true getConnection get connection Connector connector target target findConnectionTarget find connection target p p view view getDrawing get drawing if target target null p p target target getAnchor get anchor setLocation set location p p Connects connect the the figure figure to to the the new target target If there there is is no no new target target the the connection connection reverts revert to to its it original original one one public void trackEnd track end Point point anchor anchor Point point lead int modifiersEx modifier ex Point2D point2 d Double p p view view viewToDrawing view to drawing lead Connector connector target target findConnectionTarget find connection target p p view view getDrawing get drawing if target target null target target originalTarget original target setLocation set location p p if target target originalTarget original target disconnect disconnect connect connect target target connection connection setLiner set liner liner liner getConnection get connection updateConnection update connection if getTargetFigure get target figure null getTargetFigure get target figure setConnectorsVisible set connector visible false null setTargetFigure set target figure null private Connector connector findConnectionTarget find connection target Point2D point2 d Double p p Drawing drawing drawing drawing Figure figure targetFigure target figure findConnectableFigure find connectable figure p p drawing drawing if getSource get source null targetFigure target figure null return findConnector find connector p p targetFigure target figure getConnection get connection else if targetFigure target figure null targetFigure target figure canConnect can connect targetFigure target figure originalTarget original target targetFigure target figure includes include getOwner get owner getConnection get connection canConnect can connect getSource get source getOwner get owner targetFigure target figure canConnect can connect getSource get source getOwner get owner targetFigure target figure return findConnector find connector p p targetFigure target figure getConnection get connection return null protected abstract boolean canConnect can connect Figure figure existingEnd end Figure figure targetEnd target end protected Connector connector findConnector find connector Point2D point2 d Double p p Figure figure f f ConnectionFigure connection figure prototype prototype return f f findConnector find connector p p prototype prototype Draws draw this handle handle public void draw draw Graphics2D graphics2 d g g drawCircle draw circle g g getTarget get target null ? ? Color color red red Color color green green Color color black black private Figure figure findConnectableFigure find connectable figure Point2D point2 d Double p p Drawing drawing drawing drawing for Figure figure f f drawing drawing getFiguresFrontToBack get figure front to back if f f includes include getConnection get connection f f canConnect can connect f f contains contain p p return f f return null protected void setConnection set connection ConnectionFigure connection figure newConnection connection connection connection newConnection connection protected ConnectionFigure connection figure getConnection get connection return connection connection protected void setTargetFigure set target figure Figure figure newTarget target targetFigure target figure newTarget target protected Figure figure getTargetFigure get target figure return targetFigure target figure protected Rectangle rectangle basicGetBounds basic get bound if connection connection getPointCount get point count 0 0 return new Rectangle rectangle 0 0 0 0 getHandlesize get handlesize getHandlesize get handlesize Point point center center view view drawingToView drawing to view getLocation get location return new Rectangle rectangle center center x x getHandlesize get handlesize 2 2 center center y y getHandlesize get handlesize 2 2 getHandlesize get handlesize getHandlesize get handlesize 