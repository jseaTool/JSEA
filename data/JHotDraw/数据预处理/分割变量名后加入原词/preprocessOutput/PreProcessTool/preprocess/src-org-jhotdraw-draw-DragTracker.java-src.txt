DragTracker drag tracker java 2 2 0 0 2006 2006 01 01 14 14 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org ??? ??? package org org jhotdraw jhotdraw draw draw import java awt awt import java awt awt geom geom import java awt awt event event import java util util DragTracker drag tracker author author Werner wern Randelshofer randelshof version 2 2 0 0 2006 2006 01 01 14 14 Changed change to to support support double precision precision coordinates coordinate br 1 1 0 0 2003 2003 12 12 01 01 Derived derive from from JHotDraw jhotdraw 5 5 4b1 4b1 public class DragTracker drag tracker extends AbstractTool tool Figure figure anchorFigure anchor figure Point2D point2 d Double oldPoint old point Point2D point2 d Double anchorPoint anchor point private boolean isDragging is drag Creates create a a new instance instance public DragTracker drag tracker Figure figure figure figure anchorFigure anchor figure figure figure public void mouseMoved mouse move MouseEvent mouse event evt evt updateCursor update cursor editor editor findView find view Container container evt evt getSource get source new Point point evt evt getX get x evt evt getY get y public void mousePressed mouse press MouseEvent mouse event evt evt super mousePressed mouse press evt evt DrawingView drawing view view view getView get view if evt evt isShiftDown is shift down view view setHandleDetailLevel set handle detail level 0 0 view view toggleSelection toggle selection anchorFigure anchor figure if view view isFigureSelected is figure select anchorFigure anchor figure anchorFigure anchor figure null else if view view isFigureSelected is figure select anchorFigure anchor figure view view setHandleDetailLevel set handle detail level 0 0 view view clearSelection clear selection view view addToSelection add to selection anchorFigure anchor figure Point2D point2 d Double origin origin new Point2D point2 d Double Double MAX m a x VALUE v a l u e Double MAX m a x VALUE v a l u e for Figure figure f f view view getSelectedFigures get select figure Rectangle2D rectangle2 d Double b b f f getBounds get bound origin origin x x Math math min min origin origin x x b b x x origin origin y y Math math min min origin origin y y b b y y Point2D point2 d Double constrainedOrigin constrain origin view view getConstrainer get constrain constrainPoint constrain point new Point2D point2 d Double origin origin x x origin origin y y oldPoint old point view view getConstrainer get constrain constrainPoint constrain point view view viewToDrawing view to drawing new Point point evt evt getX get x evt evt getY get y oldPoint old point x x + + origin origin x x constrainedOrigin constrain origin x x oldPoint old point y y + + origin origin y y constrainedOrigin constrain origin y y anchorPoint anchor point oldPoint old point public void mouseDragged mouse drag MouseEvent mouse event evt evt DrawingView drawing view view view getView get view if isDragging is drag false isDragging is drag true updateCursor update cursor editor editor findView find view Container container evt evt getSource get source new Point point evt evt getX get x evt evt getY get y Point2D point2 d Double newPoint point view view getConstrainer get constrain constrainPoint constrain point view view viewToDrawing view to drawing new Point point evt evt getX get x evt evt getY get y AffineTransform affine transform tx tx new AffineTransform affine transform tx tx translate translate newPoint point x x oldPoint old point x x newPoint point y y oldPoint old point y y for Figure figure f f view view getSelectedFigures get select figure f f willChange will change f f basicTransform basic transform tx tx f f changed change oldPoint old point newPoint point public void mouseReleased mouse release MouseEvent mouse event evt evt super mouseReleased mouse release evt evt isDragging is drag false int x x evt evt getX get x int y y evt evt getY get y updateCursor update cursor editor editor findView find view Container container evt evt getSource get source new Point point evt evt getX get x evt evt getY get y Point2D point2 d Double p p getView get view getConstrainer get constrain constrainPoint constrain point getView get view viewToDrawing view to drawing new Point point x x y y Collection collection Figure figure draggedFigures drag figure new LinkedList link list getView get view getSelectedFigures get select figure Figure figure dropTarget drop target getDrawing get drawing findFigureExcept find figure except p p draggedFigures drag figure if dropTarget drop target null boolean snapBack snap back dropTarget drop target handleDrop handle drop p p draggedFigures drag figure getView get view if snapBack snap back AffineTransform affine transform tx tx new AffineTransform affine transform tx tx translate translate anchorPoint anchor point x x oldPoint old point x x anchorPoint anchor point y y oldPoint old point y y for Figure figure f f draggedFigures drag figure f f willChange will change f f basicTransform basic transform tx tx f f changed change else AffineTransform affine transform tx tx new AffineTransform affine transform tx tx translate translate anchorPoint anchor point x x + + oldPoint old point x x anchorPoint anchor point y y + + oldPoint old point y y if tx tx isIdentity is identity getDrawing get drawing fireUndoableEditHappened fire undoable edit happen new TransformEdit transform edit draggedFigures drag figure tx tx else AffineTransform affine transform tx tx new AffineTransform affine transform tx tx translate translate anchorPoint anchor point x x + + oldPoint old point x x anchorPoint anchor point y y + + oldPoint old point y y if tx tx isIdentity is identity getDrawing get drawing fireUndoableEditHappened fire undoable edit happen new TransformEdit transform edit draggedFigures drag figure tx tx fireToolDone fire tool 