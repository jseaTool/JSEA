DefaultDrawingView drawing view java 3 3 0 0 2 2 2006 2006 07 07 03 03 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org ??? ??? package org org jhotdraw jhotdraw draw draw import org org jhotdraw jhotdraw gui gui datatransfer datatransf CompositeTransferable composite transferable import org org jhotdraw jhotdraw util util import org org jhotdraw jhotdraw undo undo import java awt awt import java awt awt datatransfer datatransf import java awt awt geom geom import java awt awt color color import java awt awt event event import java io io import java util util import javax javax swing swing import org org jhotdraw jhotdraw app app EditableComponent editable component import org org jhotdraw jhotdraw geom geom import org org jhotdraw jhotdraw xml xml import org org jhotdraw jhotdraw xml xml XMLTransferable xml transferable DefaultDrawingView drawing view author author Werner wern Randelshofer randelshof version 3 3 0 0 2 2 2006 2006 07 07 03 03 Constrainer constrain must must be be a a bound bound property property br 3 3 0 0 1 1 2006 2006 06 06 11 11 Draw draw handles handle when when this DrawingView drawing view is is the the focused focus drawing drawing view view of of the the DrawingEditor drawing editor br 3 3 0 0 2006 2006 02 02 17 17 Reworked rework to to support support multiple multiple drawing drawing views view in in a a DrawingEditor drawing editor br 2 2 0 0 2006 2006 01 01 14 14 Changed change to to support support double precision precision coordinates coordinate br 1 1 0 0 2003 2003 12 12 01 01 Derived derive from from JHotDraw jhotdraw 5 5 4b1 4b1 public class DefaultDrawingView drawing view extends JComponent j component implements DrawingView drawing view DrawingListener drawing listener HandleListener handle listener EditableComponent editable component private Drawing drawing drawing drawing private Set set Figure figure dirtyFigures dirty figure new HashSet hash set Figure figure private Set set Figure figure selectedFigures select figure new HashSet hash set Figure figure private int rainbow rainbow 0 0 private LinkedList link list Handle handle selectionHandles selection handle new LinkedList link list Handle handle private Handle handle secondaryHandleOwner secondary handle owner private LinkedList link list Handle handle secondaryHandles secondary handle new LinkedList link list Handle handle private boolean handlesAreValid handle are valid true private Dimension dimension preferredSize prefer size private double scaleFactor scale factor 1 1 private Point2D point2 d Double translate translate new Point2D point2 d Double 0 0 0 0 private int detailLevel detail level private DOMFactory dom factory domFactory dom factory private DrawingEditor drawing editor editor editor private Constrainer constrain constrainer constrain new GridConstrainer grid constrain 1 1 1 1 private JLabel j label emptyDrawingLabel empty drawing label private boolean hasPermanentFocus ha permanent focus Creates create new instance instance public DefaultDrawingView drawing view initComponents init component setFocusable set focusable true addFocusListener add focus listener new FocusListener focus listener public void focusGained focus gain FocusEvent focus event e e repaint repaint public void focusLost focus lost FocusEvent focus event e e repaint repaint This method is is called call from from within within the the constructor constructor to to initialize initialize the the form form WARNING w a r n i n g Do NOT n o t modify modify this code The the content content of of this method is is always alway regenerated regenerate by by the the Form form Editor editor private void initComponents init component GEN g e n BEGIN b e g i n initComponents init component buttonGroup1 button group1 new javax javax swing swing ButtonGroup button group setLayout set layout null setBackground set background new java awt awt Color color 255 255 255 255 255 255 GEN g e n END e n d initComponents init component public Drawing drawing getDrawing get drawing return drawing drawing public java util util Set set getTools get tool return null public void setEmptyDrawingMessage set empty drawing message String newValue value String oldValue old value emptyDrawingLabel empty drawing label null ? ? null emptyDrawingLabel empty drawing label getText get text if newValue value null emptyDrawingLabel empty drawing label null else emptyDrawingLabel empty drawing label new JLabel j label newValue value emptyDrawingLabel empty drawing label setHorizontalAlignment set horizontal alignment JLabel j label CENTER c e n t e r firePropertyChange fire property change emptyDrawingMessage empty drawing message oldValue old value newValue value repaint repaint public String getEmptyDrawingMessage get empty drawing message return emptyDrawingLabel empty drawing label null ? ? null emptyDrawingLabel empty drawing label getText get text public void paintComponent paint component Graphics graphic gr gr Graphics2D graphics2 d g g Graphics2D graphics2 d gr gr g g setRenderingHint set rendering hint RenderingHints rendering hint KEY k e y ALPHA a l p h a INTERPOLATION i n t e r p o l a t i o n RenderingHints rendering hint VALUE v a l u e ALPHA a l p h a INTERPOLATION i n t e r p o l a t i o n QUALITY q u a l i t y g g setRenderingHint set rendering hint RenderingHints rendering hint KEY k e y ANTIALIASING a n t i a l i a s i n g RenderingHints rendering hint VALUE v a l u e ANTIALIAS a n t i a l i a s ON o n g g setRenderingHint set rendering hint RenderingHints rendering hint KEY k e y ANTIALIASING a n t i a l i a s i n g RenderingHints rendering hint VALUE v a l u e ANTIALIAS a n t i a l i a s OFF o f f g g setRenderingHint set rendering hint RenderingHints rendering hint KEY k e y STROKE s t r o k e CONTROL c o n t r o l RenderingHints rendering hint VALUE v a l u e STROKE s t r o k e NORMALIZE n o r m a l i z e g g setRenderingHint set rendering hint RenderingHints rendering hint KEY k e y STROKE s t r o k e CONTROL c o n t r o l RenderingHints rendering hint VALUE v a l u e STROKE s t r o k e PURE p u r e g g setRenderingHint set rendering hint RenderingHints rendering hint KEY k e y FRACTIONALMETRICS f r a c t i o n a l m e t r i c s Options option isFractionalMetrics is fractional metric ? ? RenderingHints rendering hint VALUE v a l u e FRACTIONALMETRICS f r a c t i o n a l m e t r i c s ON o n RenderingHints rendering hint VALUE v a l u e FRACTIONALMETRICS f r a c t i o n a l m e t r i c s OFF o f f g g setRenderingHint set rendering hint RenderingHints rendering hint KEY k e y FRACTIONALMETRICS f r a c t i o n a l m e t r i c s RenderingHints rendering hint VALUE v a l u e FRACTIONALMETRICS f r a c t i o n a l m e t r i c s OFF o f f g g setRenderingHint set rendering hint RenderingHints rendering hint KEY k e y INTERPOLATION i n t e r p o l a t i o n RenderingHints rendering hint VALUE v a l u e INTERPOLATION i n t e r p o l a t i o n BICUBIC b i c u b i c g g setRenderingHint set rendering hint RenderingHints rendering hint KEY k e y RENDERING r e n d e r i n g RenderingHints rendering hint VALUE v a l u e RENDER r e n d e r QUALITY q u a l i t y g g setRenderingHint set rendering hint RenderingHints rendering hint KEY k e y TEXT t e x t ANTIALIASING a n t i a l i a s i n g Options option isTextAntialiased is text antialias ? ? RenderingHints rendering hint VALUE v a l u e TEXT t e x t ANTIALIAS a n t i a l i a s ON o n RenderingHints rendering hint VALUE v a l u e TEXT t e x t ANTIALIAS a n t i a l i a s OFF o f f drawBackground draw background g g drawGrid draw grid g g drawDrawing draw drawing g g drawHandles draw handle g g drawTool draw tool g g protected void drawBackground draw background Graphics2D graphics2 d g g rainbow rainbow rainbow rainbow + + 10 10 % % 360 360 g g setColor set color new Color color Color color HSBtoRGB h s bto r g b float rainbow rainbow 360f 360f 0 0 3f 3f 1 1 0f 0f Position position of of the the zero zero coordinate coordinate point point on on the the view view int x x int translate translate x x scaleFactor scale factor int y y int translate translate y y scaleFactor scale factor int w w getWidth get width int h h getHeight get height g g setColor set color getBackground get background g g fillRect fill rect x x y y w w x x h h y y Draw draw a a gray gray background background for the the area area which which is is at at negative negative view view coordinates coordinate if y y 0 0 g g setColor set color new Color color 0xf0f0f0 0xf0f0f0 g g fillRect fill rect 0 0 0 0 w w y y if x x 0 0 g g setColor set color new Color color 0xf0f0f0 0xf0f0f0 g g fillRect fill rect 0 0 0 0 x x h h protected void drawGrid draw grid Graphics2D graphics2 d g g constrainer constrain draw draw g g this protected void drawDrawing draw drawing Graphics2D graphics2 d gr gr if drawing drawing null if drawing drawing getFigureCount get figure count 0 0 emptyDrawingLabel empty drawing label null emptyDrawingLabel empty drawing label setBounds set bound 0 0 0 0 getWidth get width getHeight get height emptyDrawingLabel empty drawing label paint paint gr gr else Graphics2D graphics2 d g g Graphics2D graphics2 d gr gr create create AffineTransform affine transform tx tx g g getTransform get transform tx tx translate translate translate translate x x scaleFactor scale factor translate translate y y scaleFactor scale factor tx tx scale scale scaleFactor scale factor scaleFactor scale factor g g setTransform set transform tx tx drawing drawing setFontRenderContext set font render context g g getFontRenderContext get font render context drawing drawing draw draw g g g g dispose dispose protected void drawHandles draw handle java awt awt Graphics2D graphics2 d g g if editor editor null editor editor getFocusedView get focus view this validateHandles validate handle for Handle handle h h getSelectionHandles get selection handle h h draw draw g g for Handle handle h h getSecondaryHandles get secondary handle h h draw draw g g protected void drawTool draw tool Graphics2D graphics2 d g g if editor editor null editor editor getView get view this editor editor getTool get tool null editor editor getTool get tool draw draw g g public void setDrawing set drawing Drawing drawing d d if this drawing drawing null this drawing drawing removeDrawingListener remove drawing listener this clearSelection clear selection this drawing drawing d d if this drawing drawing null this drawing drawing addDrawingListener add drawing listener this invalidateDimension invalidate dimension invalidate invalidate if getParent get parent null getParent get parent validate validate repaint repaint protected void repaint repaint Rectangle2D rectangle2 d Double r r Rectangle rectangle vr vr drawingToView drawing to view r r vr vr grow grow 1 1 1 1 repaint repaint vr vr public void areaInvalidated area invalidate DrawingEvent drawing event evt evt repaint repaint evt evt getInvalidatedArea get invalidate area invalidateDimension invalidate dimension public void areaInvalidated area invalidate HandleEvent handle event evt evt repaint repaint evt evt getInvalidatedArea get invalidate area invalidateDimension invalidate dimension public void figureAdded figure add DrawingEvent drawing event evt evt Repaint repaint the the whole whole drawing drawing to to remove remove the the message message label label if evt evt getDrawing get drawing getFigureCount get figure count 1 1 repaint repaint else repaint repaint evt evt getInvalidatedArea get invalidate area invalidateDimension invalidate dimension public void figureRemoved figure remove DrawingEvent drawing event evt evt Repaint repaint the the whole whole drawing drawing to to draw draw the the message message label label if evt evt getDrawing get drawing getFigureCount get figure count 0 0 repaint repaint else repaint repaint evt evt getInvalidatedArea get invalidate area removeFromSelection remove from selection evt evt getFigure get figure invalidateDimension invalidate dimension public void invalidate invalidate invalidateDimension invalidate dimension super invalidate invalidate Adds add a a figure figure to to the the current current selection selection public void addToSelection add to selection Figure figure figure figure selectedFigures select figure add add figure figure invalidateHandles invalidate handle fireSelectionChanged fire selection change repaint repaint Adds add a a collection collection of of figures figure to to the the current current selection selection public void addToSelection add to selection Collection collection Figure figure figures figure selectedFigures select figure addAll add all figures figure invalidateHandles invalidate handle fireSelectionChanged fire selection change repaint repaint Removes remove a a figure figure from from the the selection selection public void removeFromSelection remove from selection Figure figure figure figure if selectedFigures select figure remove remove figure figure invalidateHandles invalidate handle fireSelectionChanged fire selection change repaint repaint If a a figure figure isn isn t t selected select it it is is added add to to the the selection selection Otherwise otherwise it it is is removed remove from from the the selection selection public void toggleSelection toggle selection Figure figure figure figure if selectedFigures select figure contains contain figure figure selectedFigures select figure remove remove figure figure else selectedFigures select figure add add figure figure fireSelectionChanged fire selection change invalidateHandles invalidate handle repaint repaint Selects select all all figures figure public void selectAll select all selectedFigures select figure clear clear selectedFigures select figure addAll add all drawing drawing getFigures get figure invalidateHandles invalidate handle fireSelectionChanged fire selection change repaint repaint Clears clear the the current current selection selection public void clearSelection clear selection if getSelectionCount get selection count 0 0 selectedFigures select figure clear clear invalidateHandles invalidate handle fireSelectionChanged fire selection change repaint repaint Test test whether wheth a a given given figure figure is is selected select public boolean isFigureSelected is figure select Figure figure checkFigure check figure return selectedFigures select figure contains contain checkFigure check figure Gets get the the current current selection selection as a a a FigureSelection figure selection A a FigureSelection figure selection can can be be cut cut copied copy pasted paste public Collection collection Figure figure getSelectedFigures get select figure return Collections collection unmodifiableSet unmodifiable set selectedFigures select figure Gets get the the number number of of selected select figures figure public int getSelectionCount get selection count return selectedFigures select figure size size Gets get the the currently currently active active selection selection handles handle private java util util List list Handle handle getSelectionHandles get selection handle validateHandles validate handle return Collections collection unmodifiableList unmodifiable list selectionHandles selection handle Gets get the the currently currently active active secondary secondary handles handle private java util util List list Handle handle getSecondaryHandles get secondary handle validateHandles validate handle return Collections collection unmodifiableList unmodifiable list secondaryHandles secondary handle Invalidates invalidate the the handles handle private void invalidateHandles invalidate handle if handlesAreValid handle are valid handlesAreValid handle are valid false Rectangle rectangle invalidatedArea invalidate area null for Handle handle handle handle selectionHandles selection handle handle handle removeHandleListener remove handle listener this if invalidatedArea invalidate area null invalidatedArea invalidate area handle handle getDrawBounds get draw bound else invalidatedArea invalidate area add add handle handle getDrawBounds get draw bound handle handle dispose dispose selectionHandles selection handle clear clear secondaryHandles secondary handle clear clear switch selectedFigures select figure size size case 0 0 if invalidatedArea invalidate area null repaint repaint invalidatedArea invalidate area break case 1 1 if invalidatedArea invalidate area null repaint repaint invalidatedArea invalidate area validateHandles validate handle break default repaint repaint break Validates validate the the handles handle private void validateHandles validate handle if handlesAreValid handle are valid handlesAreValid handle are valid true Rectangle rectangle invalidatedArea invalidate area null int level level detailLevel detail level do for Figure figure figure figure getSelectedFigures get select figure for Handle handle handle handle figure figure createHandles create handle level level handle handle setView set view this selectionHandles selection handle add add handle handle handle handle addHandleListener add handle listener this if invalidatedArea invalidate area null invalidatedArea invalidate area handle handle getBounds get bound else invalidatedArea invalidate area add add handle handle getBounds get bound while level level 0 0 selectionHandles selection handle size size 0 0 detailLevel detail level level level + + 1 1 if invalidatedArea invalidate area null repaint repaint invalidatedArea invalidate area Finds find a a handle handle at at a a given given coordinates coordinate return A a handle handle null if no no handle handle is is found found public Handle handle findHandle find handle Point point p p validateHandles validate handle for Handle handle handle handle new ReversedList reverse list Handle handle getSecondaryHandles get secondary handle if handle handle contains contain p p return handle handle for Handle handle handle handle new ReversedList reverse list Handle handle getSelectionHandles get selection handle if handle handle contains contain p p return handle handle return null Gets get compatible compatible handles handle return A a collection collection containing contain the the handle handle and and all all compatible compatible handles handle public Collection collection Handle handle getCompatibleHandles get compatible handle Handle handle master master validateHandles validate handle HashSet hash set Figure figure owners owner new HashSet hash set Figure figure LinkedList link list Handle handle compatibleHandles compatible handle new LinkedList link list Handle handle owners owner add add master master getOwner get owner compatibleHandles compatible handle add add master master for Handle handle handle handle getSelectionHandles get selection handle if owners owner contains contain handle handle getOwner get owner handle handle isCombinableWith is combinable with master master owners owner add add handle handle getOwner get owner compatibleHandles compatible handle add add handle handle return compatibleHandles compatible handle Finds find a a figure figure at at a a given given coordinates coordinate return A a figure figure null if no no figure figure is is found found public Figure figure findFigure find figure Point point p p return getDrawing get drawing findFigure find figure viewToDrawing view to drawing p p public Collection collection Figure figure findFigures find figure Rectangle rectangle r r return getDrawing get drawing findFigures find figure viewToDrawing view to drawing r r public Collection collection Figure figure findFiguresWithin find figure within Rectangle rectangle r r return getDrawing get drawing findFiguresWithin find figure within viewToDrawing view to drawing r r public void addFigureSelectionListener add figure selection listener FigureSelectionListener figure selection listener fsl fsl listenerList listener list add add FigureSelectionListener figure selection listener class fsl fsl public void removeFigureSelectionListener remove figure selection listener FigureSelectionListener figure selection listener fsl fsl listenerList listener list remove remove FigureSelectionListener figure selection listener class fsl fsl Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type protected void fireSelectionChanged fire selection change if listenerList listener list getListenerCount get listener count 0 0 FigureSelectionEvent figure selection event event event null Notify notify all all listeners listener that that have have registered register interest interest for Guaranteed guarantee to to return a a non non null array Object listeners listener listenerList listener list getListenerList get listener list Process process the the listeners listener last last to to first first notifying notify those those that that are are interested interest in in this event event for int i i listeners listener length length 2 2 i i 0 0 i i 2 2 if listeners listener i i FigureSelectionListener figure selection listener class Lazily lazily create create the the event event if event event null event event new FigureSelectionEvent figure selection event this FigureSelectionListener figure selection listener listeners listener i+1 i+1 selectionChanged selection change event event public void handleRequestRemove handle request remove HandleEvent handle event e e selectionHandles selection handle remove remove e e getHandle get handle e e getHandle get handle dispose dispose invalidateHandles invalidate handle validateHandles validate handle repaint repaint e e getInvalidatedArea get invalidate area protected void invalidateDimension invalidate dimension preferredSize prefer size null public Constrainer constrain getConstrainer get constrain return constrainer constrain public void setConstrainer set constrain Constrainer constrain newValue value Constrainer constrain oldValue old value constrainer constrain constrainer constrain newValue value repaint repaint firePropertyChange fire property change constrainer constrain oldValue old value newValue value Side side effect effect Changes change view view Translation translation public Dimension dimension getPreferredSize get prefer size if preferredSize prefer size null Dimension2DDouble dimension2 d d d new Dimension2DDouble dimension2 d if drawing drawing null translate translate x x 0 0 translate translate y y 0 0 for Figure figure f f drawing drawing getFigures get figure Rectangle2D rectangle2 d Double r r f f getDrawBounds get draw bound d d width width Math math max max d d width width r r x x + + r r width width d d height height Math math max max d d height height r r y y + + r r height height translate translate x x Math math min min translate translate x x r r x x translate translate y y Math math min min translate translate y y r r y y preferredSize prefer size new Dimension dimension int d d width width + + 10 10 translate translate x x scaleFactor scale factor int d d height height + + 10 10 translate translate y y scaleFactor scale factor fireViewTransformChanged fire view transform change repaint repaint return preferredSize prefer size Converts convert drawing drawing coordinates coordinate to to view view coordinates coordinate public Point point drawingToView drawing to view Point2D point2 d Double p p return new Point point int p p x x translate translate x x scaleFactor scale factor int p p y y translate translate y y scaleFactor scale factor Converts convert view view coordinates coordinate to to drawing drawing coordinates coordinate public Point2D point2 d Double viewToDrawing view to drawing Point point p p return new Point2D point2 d Double p p x x scaleFactor scale factor + + translate translate x x p p y y scaleFactor scale factor + + translate translate y y public Rectangle rectangle drawingToView drawing to view Rectangle2D rectangle2 d Double r r return new Rectangle rectangle int r r x x translate translate x x scaleFactor scale factor int r r y y translate translate y y scaleFactor scale factor int r r width width scaleFactor scale factor int r r height height scaleFactor scale factor public Rectangle2D rectangle2 d Double viewToDrawing view to drawing Rectangle rectangle r r return new Rectangle2D rectangle2 d Double r r x x scaleFactor scale factor + + translate translate x x r r y y scaleFactor scale factor + + translate translate y y r r width width scaleFactor scale factor r r height height scaleFactor scale factor public Container container getContainer get container return this public double getScaleFactor get scale factor return scaleFactor scale factor public void setScaleFactor set scale factor double newValue value double oldValue old value scaleFactor scale factor scaleFactor scale factor newValue value fireViewTransformChanged fire view transform change firePropertyChange fire property change scaleFactor scale factor oldValue old value newValue value invalidateDimension invalidate dimension invalidate invalidate if getParent get parent null getParent get parent validate validate repaint repaint protected void fireViewTransformChanged fire view transform change for Handle handle handle handle selectionHandles selection handle handle handle viewTransformChanged view transform change for Handle handle handle handle secondaryHandles secondary handle handle handle viewTransformChanged view transform change public void setHandleDetailLevel set handle detail level int newValue value detailLevel detail level newValue value invalidateHandles invalidate handle repaint repaint public int getHandleDetailLevel get handle detail level return detailLevel detail level public void handleRequestSecondaryHandles handle request secondary handle HandleEvent handle event e e if e e getHandle get handle secondaryHandleOwner secondary handle owner secondaryHandleOwner secondary handle owner e e getHandle get handle secondaryHandles secondary handle clear clear secondaryHandles secondary handle addAll add all secondaryHandleOwner secondary handle owner createSecondaryHandles create secondary handle for Handle handle h h secondaryHandles secondary handle h h setView set view this h h addHandleListener add handle listener this repaint repaint public AffineTransform affine transform getDrawingToViewTransform get drawing to view transform AffineTransform affine transform t t new AffineTransform affine transform t t scale scale scaleFactor scale factor scaleFactor scale factor t t translate translate translate translate x x translate translate y y return t t public void setDOMFactory set dom factory DOMFactory dom factory newValue value DOMFactory dom factory oldValue old value domFactory dom factory this domFactory dom factory newValue value firePropertyChange fire property change DOMFactory dom factory oldValue old value newValue value public DOMFactory dom factory getDOMFactory get dom factory return domFactory dom factory public void copy copy if domFactory dom factory null getToolkit get toolkit beep beep return HashSet hash set Figure figure toBeCopied to be copy new HashSet hash set Figure figure getSelectedFigures get select figure if toBeCopied to be copy size size 0 0 return ByteArrayOutputStream output stream out out new ByteArrayOutputStream output stream try NanoXMLLiteDOMOutput nano xml lite dom output domo domo new NanoXMLLiteDOMOutput nano xml lite dom output domFactory dom factory domo domo openElement open element DrawingClip drawing clip for Figure figure f f getDrawing get drawing getFigures get figure if toBeCopied to be copy contains contain f f domo domo writeObject write f f domo domo closeElement close element domo domo save save out out byte data data out out toByteArray to CompositeTransferable composite transferable transfer transfer new CompositeTransferable composite transferable transfer transfer add add new XMLTransferable xml transferable data data application application x x drawing drawing clip clip DrawingClip drawing clip transfer transfer add add new XMLTransferable xml transferable data data text text xml xml DrawingClip drawing clip Toolkit toolkit getDefaultToolkit get toolkit getSystemClipboard get clipboard setContents set content transfer transfer transfer transfer catch IOException i o e e e e printStackTrace print stack trace getToolkit get toolkit beep beep public void cut cut if domFactory dom factory null getToolkit get toolkit beep beep return copy copy delete delete public void delete delete ArrayList list Figure figure toBeDeleted to be delete new ArrayList list Figure figure getSelectedFigures get select figure clearSelection clear selection getDrawing get drawing removeAll remove all toBeDeleted to be delete public void paste paste if domFactory dom factory null getToolkit get toolkit beep beep return try ArrayList list Figure figure toBeSelected to be select new ArrayList list Figure figure DataFlavor data flavor flavor flavor new DataFlavor data flavor application application x x drawing drawing clip clip Drawing drawing Clip clip Transferable transferable transfer transfer Toolkit toolkit getDefaultToolkit get toolkit getSystemClipboard get clipboard getContents get content this if transfer transfer isDataFlavorSupported is data flavor support flavor flavor CompositeEdit composite edit ce ce new CompositeEdit composite edit Paste paste getDrawing get drawing fireUndoableEditHappened fire undoable edit happen ce ce for Figure figure f f new LinkedList link list Figure figure getSelectedFigures get select figure getDrawing get drawing remove remove f f InputStream input stream in in null try in in InputStream input stream transfer transfer getTransferData get transfer data flavor flavor NanoXMLLiteDOMInput nano xml lite dom input domi domi new NanoXMLLiteDOMInput nano xml lite dom input domFactory dom factory in in domi domi openElement open element DrawingClip drawing clip for int i i 0 0 n n domi domi getElementCount get element count i i n n i++ i++ Figure figure f f Figure figure domi domi readObject read i i getDrawing get drawing add add f f toBeSelected to be select add add f f finally if in in null in in close close clearSelection clear selection addToSelection add to selection toBeSelected to be select getDrawing get drawing fireUndoableEditHappened fire undoable edit happen ce ce else Toolkit toolkit getDefaultToolkit get toolkit beep beep catch Throwable throwable e e e e printStackTrace print stack trace public void duplicate duplicate Collection collection Figure figure sorted sort getDrawing get drawing sort sort getSelectedFigures get select figure HashMap hash map Figure figure Figure figure originalToDuplicateMap original to duplicate map new HashMap hash map Figure figure Figure figure sorted sort size size clearSelection clear selection Drawing drawing drawing drawing getDrawing get drawing ArrayList list Figure figure duplicates duplicate new ArrayList list Figure figure sorted sort size size AffineTransform affine transform tx tx new AffineTransform affine transform tx tx translate translate 5 5 5 5 for Figure figure f f sorted sort Figure figure d d Figure figure f f clone clone d d basicTransform basic transform tx tx duplicates duplicate add add d d originalToDuplicateMap original to duplicate map put put f f d d drawing drawing add add d d for Figure figure f f duplicates duplicate f f remap remap originalToDuplicateMap original to duplicate map addToSelection add to selection duplicates duplicate public void removeNotify remove notify DrawingEditor drawing editor editor editor this editor editor null repaint repaint public void addNotify add notify DrawingEditor drawing editor editor editor this editor editor editor editor repaint repaint Variables variable declaration declaration do not not modify modify GEN g e n BEGIN b e g i n variables variable private javax javax swing swing ButtonGroup button group buttonGroup1 button group1 End end of of variables variable declaration declaration GEN g e n END e n d variables variable 