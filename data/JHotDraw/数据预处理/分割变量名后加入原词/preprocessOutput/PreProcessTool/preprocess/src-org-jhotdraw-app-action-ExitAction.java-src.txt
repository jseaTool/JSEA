ExitAction exit action java 1 1 0 0 04 04 January january 2005 2005 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org package org org jhotdraw jhotdraw app app action action import org org jhotdraw jhotdraw gui gui import org org jhotdraw jhotdraw gui gui event event import org org jhotdraw jhotdraw util util import java awt awt import java awt awt event event import java util util import javax javax swing swing import java io io import org org jhotdraw jhotdraw app app Application application import org org jhotdraw jhotdraw app app Project project Exits exit the the application application after after letting letting the the user user save save or or close close unsaved unsav projects project author author Werner wern Randelshofer randelshof version 1 1 0 0 04 04 January january 2005 2005 Created create public class ExitAction exit action extends AbstractApplicationAction application action public final static String ID exit exit private Component component oldFocusOwner old focus owner private Project project unsavedProject unsav project Creates create a a new instance instance public ExitAction exit action Application application app app super app app ResourceBundleUtil resource bundle util labels label ResourceBundleUtil resource bundle util getLAFBundle get l a f bundle org org jhotdraw jhotdraw app app Labels label labels label configureAction configure action this ID public void actionPerformed action perform ActionEvent action event evt evt final Application application app app getApplication get application if app app isEnabled is enable app app setEnabled set enable false int unsavedProjectsCount unsav project count 0 0 Project project documentToBeReviewed document to be review null for Project project p p app app projects project if p p hasUnsavedChanges ha unsav change if p p isEnabled is enable documentToBeReviewed document to be review p p unsavedProjectsCount++ unsav project count++ if unsavedProjectsCount unsav project count 0 0 documentToBeReviewed document to be review null Silently silently abort abort if no no project project can can be be reviewed review app app setEnabled set enable true return switch unsavedProjectsCount unsav project count case 0 0 doExit exit break case 1 1 unsavedProject unsav project documentToBeReviewed document to be review oldFocusOwner old focus owner SwingUtilities swing utility getWindowAncestor get window ancestor unsavedProject unsav project getComponent get component getFocusOwner get focus owner unsavedProject unsav project setEnabled set enable false JOptionPane j option pane pane pane new JOptionPane j option pane html html +UIManager + u i manager getString get OptionPane option pane css cs + + b b Do you you want want to to save save changes change to to this document document + + before before exiting? exiting? b b p p + + If you you don t t save save your your changes change will will be be lost lost JOptionPane j option pane WARNING w a r n i n g MESSAGE m e s s a g e Object options option Save save Cancel cancel Don t t Save save pane pane setOptions set option options option pane pane setInitialValue set initial value options option 0 0 pane pane putClientProperty put client property Quaqua quaqua OptionPane option pane destructiveOption destructive option new Integer 2 2 JSheet j sheet showSheet show sheet pane pane unsavedProject unsav project getComponent get component new SheetListener sheet listener public void optionSelected option select SheetEvent sheet event evt evt Object value value evt evt getValue get value if value value null || || value value equals equal Cancel cancel unsavedProject unsav project setEnabled set enable true app app setEnabled set enable true else if value value equals equal Don t t Save save doExit exit unsavedProject unsav project setEnabled set enable true else if value value equals equal Save save saveChanges save change break default JOptionPane j option pane pane pane new JOptionPane j option pane html html +UIManager + u i manager get get OptionPane option pane css cs + + b b You you have have +unsavedProjectsCount+ +unsav project count+ documents document with with unsaved unsav changes change + + Do you you want want to to + + review review these these changes change before before quitting? quitting? b b p p + + If you you don t t review review your your documents document + + all all your your changes change will will be be lost lost JOptionPane j option pane QUESTION q u e s t i o n MESSAGE m e s s a g e Object options option Review review Changes change Cancel cancel Discard discard Changes change pane pane setOptions set option options option pane pane setInitialValue set initial value options option 0 0 pane pane putClientProperty put client property Quaqua quaqua OptionPane option pane destructiveOption destructive option new Integer 2 2 JDialog j dialog dialog dialog pane pane createDialog create dialog app app getComponent get component null dialog dialog setVisible set visible true Object value value pane pane getValue get value if value value null || || value value equals equal Cancel cancel app app setEnabled set enable true else if value value equals equal Discard discard Changes change doExit exit app app setEnabled set enable true else if value value equals equal Review review Changes change unsavedProject unsav project documentToBeReviewed document to be review reviewChanges review change protected void saveChanges save change if unsavedProject unsav project getFile get null JFileChooser j chooser fileChooser chooser unsavedProject unsav project getSaveChooser get save chooser int option option fileChooser chooser showSaveDialog show save dialog this JSheet j sheet showSaveSheet show save sheet fileChooser chooser unsavedProject unsav project getComponent get component new SheetListener sheet listener public void optionSelected option select final SheetEvent sheet event evt evt if evt evt getOption get option JFileChooser j chooser APPROVE a p p r o v e OPTION o p t i o n final File file evt evt getFileChooser get chooser getSelectedFile get select saveToFile save to file else unsavedProject unsav project setEnabled set enable true if oldFocusOwner old focus owner null oldFocusOwner old focus owner requestFocus request focus getApplication get application setEnabled set enable true else saveToFile save to unsavedProject unsav project getFile get protected void reviewChanges review change if unsavedProject unsav project isEnabled is enable oldFocusOwner old focus owner SwingUtilities swing utility getWindowAncestor get window ancestor unsavedProject unsav project getComponent get component getFocusOwner get focus owner unsavedProject unsav project setEnabled set enable false JOptionPane j option pane pane pane new JOptionPane j option pane html html +UIManager + u i manager getString get OptionPane option pane css cs + + b b Do you you want want to to save save changes change to to this document document + + before before exiting? exiting? b b p p + + If you you don t t save save your your changes change will will be be lost lost JOptionPane j option pane WARNING w a r n i n g MESSAGE m e s s a g e Object options option Save save Cancel cancel Don t t Save save pane pane setOptions set option options option pane pane setInitialValue set initial value options option 0 0 pane pane putClientProperty put client property Quaqua quaqua OptionPane option pane destructiveOption destructive option new Integer 2 2 JSheet j sheet showSheet show sheet pane pane unsavedProject unsav project getComponent get component new SheetListener sheet listener public void optionSelected option select SheetEvent sheet event evt evt Object value value evt evt getValue get value if value value null || || value value equals equal Cancel cancel unsavedProject unsav project setEnabled set enable true getApplication get application setEnabled set enable true else if value value equals equal Don t t Save save getApplication get application dispose dispose unsavedProject unsav project reviewNext review next else if value value equals equal Save save saveChangesAndReviewNext save change and review next else getApplication get application setEnabled set enable true System out out println review review silently silently aborted abort protected void saveChangesAndReviewNext save change and review next if unsavedProject unsav project getFile get null JFileChooser j chooser fileChooser chooser unsavedProject unsav project getSaveChooser get save chooser int option option fileChooser chooser showSaveDialog show save dialog this JSheet j sheet showSaveSheet show save sheet fileChooser chooser unsavedProject unsav project getComponent get component new SheetListener sheet listener public void optionSelected option select final SheetEvent sheet event evt evt if evt evt getOption get option JFileChooser j chooser APPROVE a p p r o v e OPTION o p t i o n final File file evt evt getFileChooser get chooser getSelectedFile get select saveToFileAndReviewNext save to and review next file else unsavedProject unsav project setEnabled set enable true if oldFocusOwner old focus owner null oldFocusOwner old focus owner requestFocus request focus getApplication get application setEnabled set enable true else saveToFileAndReviewNext save to and review next unsavedProject unsav project getFile get protected void reviewNext review next int unsavedProjectsCount unsav project count 0 0 Project project documentToBeReviewed document to be review null for Project project p p getApplication get application projects project if p p hasUnsavedChanges ha unsav change if p p isEnabled is enable documentToBeReviewed document to be review p p unsavedProjectsCount++ unsav project count++ if unsavedProjectsCount unsav project count 0 0 doExit exit else if documentToBeReviewed document to be review null unsavedProject unsav project documentToBeReviewed document to be review reviewChanges review change else getApplication get application setEnabled set enable true System out out println exit exit silently silently aborted abort protected void saveToFile save to final File file unsavedProject unsav project execute execute new Worker worker public Object construct construct try unsavedProject unsav project write write file return null catch IOException i o e e return e e public void finished finish Object value value fileSaved save unsavedProject unsav project file value value protected void saveToFileAndReviewNext save to and review next final File file unsavedProject unsav project execute execute new Worker worker public Object construct construct try unsavedProject unsav project write write file return null catch IOException i o e e return e e public void finished finish Object value value fileSavedAndReviewNext save and review next unsavedProject unsav project file value value protected void fileSaved save Project project unsavedProject unsav project File file Object value value if value value null unsavedProject unsav project setFile set file doExit exit else JSheet j sheet showMessageSheet show message sheet unsavedProject unsav project getComponent get component html html +UIManager + u i manager getString get OptionPane option pane css cs + + b b Couldn couldn t t save save to to the the file \ \ +file+ +file+ \ \ p p + + Reason reason +value +value JOptionPane j option pane ERROR e r r o r MESSAGE m e s s a g e unsavedProject unsav project setEnabled set enable true if oldFocusOwner old focus owner null oldFocusOwner old focus owner requestFocus request focus getApplication get application setEnabled set enable true protected void fileSavedAndReviewNext save and review next Project project unsavedProject unsav project File file Object value value if value value null unsavedProject unsav project setFile set file getApplication get application dispose dispose unsavedProject unsav project reviewNext review next return else JSheet j sheet showMessageSheet show message sheet unsavedProject unsav project getComponent get component html html +UIManager + u i manager getString get OptionPane option pane css cs + + b b Couldn couldn t t save save to to the the file \ \ +file+ +file+ \ \ p p + + Reason reason +value +value JOptionPane j option pane ERROR e r r o r MESSAGE m e s s a g e unsavedProject unsav project setEnabled set enable true if oldFocusOwner old focus owner null oldFocusOwner old focus owner requestFocus request focus getApplication get application setEnabled set enable true protected void doExit exit getApplication get application stop stop System exit exit 0 0 