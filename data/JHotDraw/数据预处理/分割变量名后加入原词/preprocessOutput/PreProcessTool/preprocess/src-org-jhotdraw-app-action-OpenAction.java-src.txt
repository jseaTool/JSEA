OpenAction open action java 2 2 0 0 1 1 2006 2006 05 05 18 18 Copyright copyright c c 2005 2005 2006 2006 Werner wern Randelshofer randelshof Staldenmattweg staldenmattweg 2 2 Immensee immensee CH c h 6405 6405 Switzerland switzerland All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of Werner wern Randelshofer randelshof Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with Werner wern Randelshofer randelshof package org org jhotdraw jhotdraw app app action action import org org jhotdraw jhotdraw util util import org org jhotdraw jhotdraw gui gui import org org jhotdraw jhotdraw gui gui event event import java awt awt import java awt awt event event import java util util import java util util prefs pref import javax javax swing swing import java io io import org org jhotdraw jhotdraw app app Application application import org org jhotdraw jhotdraw app app Project project Opens open a a file in in new project project or or in in the the current current project project if it it is is empty empty author author Werner wern Randelshofer randelshof version 2 2 0 0 1 1 2006 2006 05 05 18 18 Print print stack stack trace trace added add br 2 2 0 0 2006 2006 02 02 16 16 Support support for preferences preference added add br 1 1 0 0 1 1 2005 2005 07 07 14 14 Make make project project explicitly explicitly visible visible after after creating create it it br 1 1 0 0 04 04 January january 2005 2005 Created create public class OpenAction open action extends AbstractApplicationAction application action public final static String ID open open Creates create a a new instance instance public OpenAction open action Application application app app super app app ResourceBundleUtil resource bundle util labels label ResourceBundleUtil resource bundle util getLAFBundle get l a f bundle org org jhotdraw jhotdraw app app Labels label labels label configureAction configure action this ID public void actionPerformed action perform ActionEvent action event evt evt final Application application app app getApplication get application if app app isEnabled is enable app app setEnabled set enable false Search search for an an empty empty project project Project project emptyProject empty project app app getCurrentProject get current project if emptyProject empty project null || || emptyProject empty project getFile get null || || emptyProject empty project hasUnsavedChanges ha unsav change emptyProject empty project null for Project project aProject a project app app projects project if aProject a project getFile get null aProject a project hasUnsavedChanges ha unsav change emptyProject empty project aProject a project break final Project project p p if emptyProject empty project null p p app app createProject create project app app add add p p else p p emptyProject empty project JFileChooser j chooser fileChooser chooser p p getOpenChooser get open chooser if fileChooser chooser showOpenDialog show open dialog app app getComponent get component JFileChooser j chooser APPROVE a p p r o v e OPTION o p t i o n app app show show p p openFile open fileChooser chooser p p else app app setEnabled set enable true protected void openFile open JFileChooser j chooser fileChooser chooser final Project project project project final Application application app app getApplication get application final File file fileChooser chooser getSelectedFile get select app app setEnabled set enable true If there there is is another another project project with with we we set set the the multiple multiple open open id of of our our project project to to max max multiple multiple open open id + + 1 1 int multipleOpenId multiple open 1 1 for Project project aProject a project app app projects project if aProject a project project project aProject a project getFile get null aProject a project getFile get equals equal file multipleOpenId multiple open Math math max max multipleOpenId multiple open aProject a project getMultipleOpenId get multiple open + + 1 1 project project setMultipleOpenId set multiple open multipleOpenId multiple open Open open the the file project project execute execute new Worker worker public Object construct construct try project project read read file return null catch Throwable throwable e e return e e public void finished finish Object value value fileOpened open project project file value value protected void fileOpened open final Project project project project File file Object value value final Application application app app getApplication get application if value value null project project setFile set file project project setEnabled set enable true Frame frame w w Frame frame SwingUtilities swing utility getWindowAncestor get window ancestor project project getComponent get component if w w null w w setExtendedState set extend state w w getExtendedState get extend state Frame frame ICONIFIED i c o n i f i e d w w toFront to front project project getComponent get component requestFocus request focus app app addRecentFile add recent file app app setEnabled set enable true else if value value instanceof Throwable throwable Throwable throwable value value printStackTrace print stack trace JSheet j sheet showMessageSheet show message sheet project project getComponent get component html html +UIManager + u i manager getString get OptionPane option pane css cs + + b b Couldn couldn t t open open the the file \ \ +file+ +file+ \ \ b b br + + value value JOptionPane j option pane ERROR e r r o r MESSAGE m e s s a g e new SheetListener sheet listener public void optionSelected option select SheetEvent sheet event evt evt app app dispose dispose project project 