GraphicalCompositeFigure graphical composite figure java 2 2 0 0 2006 2006 01 01 14 14 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org ??? ??? package org org jhotdraw jhotdraw draw draw import java io io IOException i o import org org jhotdraw jhotdraw util util import java awt awt import java awt awt geom geom import java util util import javax javax swing swing undo undo import javax javax swing swing event event import static org org jhotdraw jhotdraw draw draw AttributeKeys attribute key import org org jhotdraw jhotdraw geom geom import org org jhotdraw jhotdraw xml xml DOMInput dom input import org org jhotdraw jhotdraw xml xml DOMOutput dom output The the GraphicalCompositeFigure graphical composite figure fills fill in in the the gap gap between between a a AbstractCompositeFigure composite figure and and other other figures figure which which mainly mainly have have a a presentation presentation purpose purpose The the GraphicalCompositeFigure graphical composite figure can can be be configured configure with with any any Figure figure which which takes take over over the the task task for rendering rendering the the graphical graphical presentation presentation for a a AbstractCompositeFigure composite figure Therefore therefore the the GraphicalCompositeFigure graphical composite figure manages manage contained contain figures figure like like the the AbstractCompositeFigure composite figure does doe but but delegates delegate its it graphical graphical presentation presentation to to another another graphical graphical figure figure which which purpose purpose it it is is to to draw draw the the container container for all all contained contain figures figure The the GraphicalCompositeFigure graphical composite figure adds add to to the the link link AbstractCompositeFigure composite figure AbstractCompositeFigure composite figure by by containing contain a a presentation presentation figure figure by by default which which can can not not be be removed remove Normally normally the the link link AbstractCompositeFigure composite figure AbstractCompositeFigure composite figure can can not not be be seen see without without containing contain a a figure figure because because it it has ha no no mechanism mechanism to to draw draw itself itself It it instead instead relies relie on on its it contained contain figures figure to to draw draw themselves themselve thereby thereby giving giving the the link link AbstractCompositeFigure composite figure AbstractCompositeFigure composite figure its it appearance appearance However howev the the b b GraphicalCompositeFigure graphical composite figure b b s s presentation presentation figure figure can can draw draw itself itself even even when when the the b b GraphicalCompositeFigure graphical composite figure b b contains contain no no other other figures figure The the b b GraphicalCompositeFigure graphical composite figure b b also also uses us a a link link Layouter layout Layouter layout or or layout layout its it contained contain figures figure author author Wolfram wolfram Kaiser kaiser original original code Werner wern Randelshofer randelshof this derived derive version version 2 2 0 0 2006 2006 01 01 14 14 Changed change to to support support double precision precision coordinates coordinate br 1 1 0 0 1 1 Dezember dezemb 2003 2003 Derived derive from from JHotDraw jhotdraw 5 5 4b1 4b1 public class GraphicalCompositeFigure graphical composite figure extends AbstractCompositeFigure composite figure protected HashMap hash map AttributeKey attribute key Object attributes attribute new HashMap hash map AttributeKey attribute key Object private HashSet hash set AttributeKey attribute key forbiddenAttributes forbid attribute Figure figure which which performs perform all all presentation presentation tasks task for this AbstractCompositeFigure composite figure as a CompositeFigures composite figure usually usually don t t have have an an own own presentation presentation but but present present only only the the sum sum of of all all its it children child private Figure figure presentationFigure presentation figure Handles handle figure figure changes change in in the the children child private PresentationFigureHandler presentation figure handler presentationFigureHandler presentation figure handler new PresentationFigureHandler presentation figure handler this private static class PresentationFigureHandler presentation figure handler implements FigureListener figure listener UndoableEditListener undoable edit listener private GraphicalCompositeFigure graphical composite figure owner owner private PresentationFigureHandler presentation figure handler GraphicalCompositeFigure graphical composite figure owner owner this owner owner owner owner public void figureRequestRemove figure request remove FigureEvent figure event e e owner owner remove remove e e getFigure get figure public void figureRemoved figure remove FigureEvent figure event evt evt public void figureChanged figure change FigureEvent figure event e e if owner owner isChanging is change owner owner willChange will change owner owner fireFigureChanged fire figure change e e owner owner changed change public void figureAdded figure add FigureEvent figure event e e public void figureAttributeChanged figure attribute change FigureEvent figure event e e public void figureAreaInvalidated figure area invalidate FigureEvent figure event e e if owner owner isChanging is change owner owner fireAreaInvalidated fire area invalidate e e getInvalidatedArea get invalidate area public void undoableEditHappened undoable edit happen UndoableEditEvent undoable edit event e e owner owner fireUndoableEditHappened fire undoable edit happen e e getEdit get edit Default constructor constructor which which uses us nothing nothing as a presentation presentation figure figure This constructor constructor is is needed need by by the the Storable storable mechanism mechanism public GraphicalCompositeFigure graphical composite figure this null Constructor constructor which which creates create a a GraphicalCompositeFigure graphical composite figure with with a a given given graphical graphical figure figure for presenting present it it param newPresentationFigure presentation figure figure figure which which renders render the the container container public GraphicalCompositeFigure graphical composite figure Figure figure newPresentationFigure presentation figure super setPresentationFigure set presentation figure newPresentationFigure presentation figure Return the the logcal logcal display display area area This method is is delegated delegate to to the the encapsulated encapsulate presentation presentation figure figure public Rectangle2D rectangle2 d Double getBounds get bound if getPresentationFigure get presentation figure null return super getBounds get bound return getPresentationFigure get presentation figure getBounds get bound public boolean contains contain Point2D point2 d Double p p if getPresentationFigure get presentation figure null return getPresentationFigure get presentation figure contains contain p p else return super contains contain p p public void addNotify add notify Drawing drawing drawing drawing super addNotify add notify drawing drawing if getPresentationFigure get presentation figure null getPresentationFigure get presentation figure addNotify add notify drawing drawing public void removeNotify remove notify Drawing drawing drawing drawing super removeNotify remove notify drawing drawing if getPresentationFigure get presentation figure null getPresentationFigure get presentation figure removeNotify remove notify drawing drawing Return the the draw draw area area This method is is delegated delegate to to the the encapsulated encapsulate presentation presentation figure figure public Rectangle2D rectangle2 d Double getFigureDrawBounds get figure draw bound Rectangle2D rectangle2 d Double r r if getPresentationFigure get presentation figure null Rectangle2D rectangle2 d Double presentationBounds presentation bound getPresentationFigure get presentation figure getDrawBounds get draw bound r r super getFigureDrawBounds get figure draw bound if r r isEmpty is empty r r presentationBounds presentation bound else r r add add presentationBounds presentation bound else r r super getFigureDrawBounds get figure draw bound return r r Moves move the the figure figure This is is the the method that that subclassers subclasser override override Clients client usually usually call call displayBox display box public void basicSetBounds basic set bound Point2D point2 d Double anchor anchor Point2D point2 d Double lead if getLayouter get layout null super basicSetBounds basic set bound anchor anchor lead basicSetPresentationFigureBounds basic set presentation figure bound anchor anchor lead else Rectangle2D rectangle2 d Double r r getLayouter get layout layout layout this anchor anchor lead basicSetPresentationFigureBounds basic set presentation figure bound new Point2D point2 d Double r r getX get x r r getY get y new Point2D point2 d Double Math math max max lead x x int r r getMaxX get max x Math math max max lead y y int r r getMaxY get max y invalidate invalidate protected void superBasicSetBounds basic set bound Point2D point2 d Double anchor anchor Point2D point2 d Double lead super basicSetBounds basic set bound anchor anchor lead protected void basicSetPresentationFigureBounds basic set presentation figure bound Point2D point2 d Double anchor anchor Point2D point2 d Double lead if getPresentationFigure get presentation figure null getPresentationFigure get presentation figure basicSetBounds basic set bound anchor anchor lead Standard standard presentation presentation method which which is is delegated delegate to to the the encapsulated encapsulate presentation presentation figure figure The the presentation presentation figure figure is is moved move as a well well as a all all contained contain figures figure public void basicTransform basic transform AffineTransform affine transform tx tx super basicTransform basic transform tx tx if getPresentationFigure get presentation figure null getPresentationFigure get presentation figure basicTransform basic transform tx tx Draw draw the the figure figure This method is is delegated delegate to to the the encapsulated encapsulate presentation presentation figure figure public void drawFigure draw figure Graphics2D graphics2 d g g drawPresentationFigure draw presentation figure g g super drawFigure draw figure g g protected void drawPresentationFigure draw presentation figure Graphics2D graphics2 d g g if getPresentationFigure get presentation figure null getPresentationFigure get presentation figure draw draw g g Return default handles handle from from the the presentation presentation figure figure public Collection collection Handle handle createHandles create handle int detailLevel detail level LinkedList link list Handle handle handles handle new LinkedList link list Handle handle if detailLevel detail level 0 0 MoveHandle move handle addMoveHandles add move handle this handles handle return handles handle return getPresentationFigure get presentation figure getHandles get handle Set set a a figure figure which which renders render this AbstractCompositeFigure composite figure The the presentation presentation tasks task for the the AbstractCompositeFigure composite figure are are delegated delegate to to this presentation presentation figure figure param newPresentationFigure presentation figure figure figure takes take over over the the presentation presentation tasks task public void setPresentationFigure set presentation figure Figure figure newPresentationFigure presentation figure if this presentationFigure presentation figure null this presentationFigure presentation figure removeFigureListener remove figure listener presentationFigureHandler presentation figure handler this presentationFigure presentation figure removeUndoableEditListener remove undoable edit listener presentationFigureHandler presentation figure handler if getDrawing get drawing null this presentationFigure presentation figure removeNotify remove notify getDrawing get drawing this presentationFigure presentation figure newPresentationFigure presentation figure if this presentationFigure presentation figure null this presentationFigure presentation figure addFigureListener add figure listener presentationFigureHandler presentation figure handler this presentationFigure presentation figure addUndoableEditListener add undoable edit listener presentationFigureHandler presentation figure handler if getDrawing get drawing null this presentationFigure presentation figure addNotify add notify getDrawing get drawing FIXME f i x m e We we should should calculate calculate the the layout layout here here Get get a a figure figure which which renders render this AbstractCompositeFigure composite figure The the presentation presentation tasks task for the the AbstractCompositeFigure composite figure are are delegated delegate to to this presentation presentation figure figure return figure figure takes take over over the the presentation presentation tasks task public Figure figure getPresentationFigure get presentation figure return presentationFigure presentation figure public GraphicalCompositeFigure graphical composite figure clone clone GraphicalCompositeFigure graphical composite figure that that GraphicalCompositeFigure graphical composite figure super clone clone that that presentationFigure presentation figure this presentationFigure presentation figure null ? ? null Figure figure this presentationFigure presentation figure clone clone if that that presentationFigure presentation figure null that that presentationFigure presentation figure addFigureListener add figure listener that that presentationFigureHandler presentation figure handler that that presentationFigure presentation figure addUndoableEditListener add undoable edit listener that that presentationFigureHandler presentation figure handler return that that public void remap remap HashMap hash map Figure figure Figure figure oldToNew old to super remap remap oldToNew old to if presentationFigure presentation figure null presentationFigure presentation figure remap remap oldToNew old to Sets set an an attribute attribute of of the the figure figure AttributeKey attribute key name name and and semantics semantics are are defined define by by the the class implementing implement the the figure figure interface public void setAttribute set attribute AttributeKey attribute key key key Object newValue value if forbiddenAttributes forbid attribute null || || forbiddenAttributes forbid attribute contains contain key key willChange will change if getPresentationFigure get presentation figure null getPresentationFigure get presentation figure setAttribute set attribute key key newValue value super setAttribute set attribute key key newValue value Object oldValue old value attributes attribute put put key key newValue value fireAttributeChanged fire attribute change key key oldValue old value newValue value fireUndoableEditHappened fire undoable edit happen new AttributeChangeEdit attribute change edit this key key oldValue old value newValue value changed change Sets set an an attribute attribute of of the the figure figure AttributeKey attribute key name name and and semantics semantics are are defined define by by the the class implementing implement the the figure figure interface public void basicSetAttribute basic set attribute AttributeKey attribute key key key Object newValue value if forbiddenAttributes forbid attribute null || || forbiddenAttributes forbid attribute contains contain key key if getPresentationFigure get presentation figure null getPresentationFigure get presentation figure basicSetAttribute basic set attribute key key newValue value super basicSetAttribute basic set attribute key key newValue value Object oldValue old value attributes attribute put put key key newValue value public void setAttributeEnabled set attribute enable AttributeKey attribute key key key boolean b b if forbiddenAttributes forbid attribute null forbiddenAttributes forbid attribute new HashSet hash set AttributeKey attribute key if b b forbiddenAttributes forbid attribute remove remove key key else forbiddenAttributes forbid attribute add add key key Gets get an an attribute attribute from from the the figure figure public Object getAttribute get attribute AttributeKey attribute key key key if getPresentationFigure get presentation figure null return getPresentationFigure get presentation figure getAttribute get attribute key key else return attributes attribute containsKey contain key key key ? ? key key getDefaultValue get value attributes attribute get get key key Applies applie all all attributes attribute of of this figure figure to to that that figure figure protected void applyAttributesTo apply attribute to Figure figure that that for Map map Entry entry AttributeKey attribute key Object entry entry attributes attribute entrySet entry set that that setAttribute set attribute entry entry getKey get key entry entry getValue get value protected void writeAttributes write attribute DOMOutput dom output out out throws IOException i o Figure figure prototype prototype Figure figure out out getPrototype get prototype boolean isElementOpen is element open false for Map map Entry entry AttributeKey attribute key Object entry entry attributes attribute entrySet entry set AttributeKey attribute key key key entry entry getKey get key if forbiddenAttributes forbid attribute null || || forbiddenAttributes forbid attribute contains contain key key Object prototypeValue prototype value key key get get prototype prototype Object attributeValue attribute value key key get get this if prototypeValue prototype value attributeValue attribute value || || prototypeValue prototype value null attributeValue attribute value null prototypeValue prototype value equals equal attributeValue attribute value if isElementOpen is element open out out openElement open element a a isElementOpen is element open true out out openElement open element key key getKey get key out out writeObject write entry entry getValue get value out out closeElement close element if isElementOpen is element open out out closeElement close element protected void readAttributes read attribute DOMInput dom input in in throws IOException i o if in in getElementCount get element count a a 0 0 in in openElement open element a a for int i i in in getElementCount get element count 1 1 i i 0 0 i i in in openElement open element i i String name name in in getTagName get tag name Object value value in in readObject read AttributeKey attribute key key key getAttributeKey get attribute key name name if key key null key key isAssignable is assignable value value if forbiddenAttributes forbid attribute null || || forbiddenAttributes forbid attribute contains contain key key setAttribute set attribute key key value value in in closeElement close element in in closeElement close element protected AttributeKey attribute key getAttributeKey get attribute key String name name return AttributeKeys attribute key supportedAttributeMap support attribute map get get name name public Map map AttributeKey attribute key Object getAttributes get attribute return new HashMap hash map AttributeKey attribute key Object attributes attribute This is is a a default implementation that that chops chop the the point point at at the the rectangle rectangle returned by by getBounds get bound of of the the figure figure p p Figures figure which which have have a a non non rectangular rectangular shape shape need need to to override override this method p p This method takes take the the following following attributes attribute into into account account AttributeKeys attribute key STROKE s t r o k e COLOR c o l o r AttributeKeys attribute key STROKE s t r o k e PLACEMENT p l a c e m e n t and and AttributeKeys attribute key StrokeTotalWidth stroke total width public Point2D point2 d Double chop chop Point2D point2 d Double from from Rectangle2D rectangle2 d Double r r getBounds get bound if STROKE s t r o k e COLOR c o l o r get get this null double grow grow switch STROKE s t r o k e PLACEMENT p l a c e m e n t get get this case CENTER c e n t e r default grow grow AttributeKeys attribute key getStrokeTotalWidth get stroke total width this break case OUTSIDE o u t s e grow grow AttributeKeys attribute key getStrokeTotalWidth get stroke total width this break case INSIDE i n s e grow grow 0d 0d break Geom geom grow grow r r grow grow grow grow return Geom geom angleToPoint angle to point r r Geom geom pointToAngle point to angle r r from from 