AbstractFigure figure java 3 3 3 3 2006 2006 06 06 17 17 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org package org org jhotdraw jhotdraw draw draw import org org jhotdraw jhotdraw util util import javax javax swing swing event event import java awt awt import java awt awt event event import java awt awt font font import java awt awt geom geom import java util util import javax javax swing swing import javax javax swing swing undo undo import java io io import org org jhotdraw jhotdraw geom geom AbstractFigure figure provides provide the the functionality functionality for managing manage listeners listener for a a Figure figure author author Werner wern Randelshofer randelshof version 3 3 3 3 Reworked rework br 3 3 2 2 2006 2006 01 01 05 05 Added add method getChangingDepth get change depth br 3 3 0 0 2006 2006 01 01 20 20 Reworked rework for J2SE j2 s e 1 1 5 5 br 1 1 0 0 2003 2003 12 12 01 01 Derived derive from from JHotDraw jhotdraw 5 5 4b1 4b1 public abstract class AbstractFigure figure implements Figure figure protected EventListenerList event listener list listenerList listener list new EventListenerList event listener list private boolean isConnectorsVisible is connector visible private ConnectionFigure connection figure courtingConnection courting connection private Drawing drawing drawing drawing private boolean isInteractive is interactive private boolean isVisible is visible true protected Figure figure decorator decorator private boolean isDrawDecoratorFirst is draw decorator first false We we increase increase this number number on on each each invocation invocation of of willChange will change and and decrease decrease it it on on each each invocation invocation of of changed change protected int changingDepth change depth 0 0 Creates create a a new instance instance public AbstractFigure figure DRAWING d r a w i n g SHAPE s h a p e AND a n d BOUNDS b o u n d s ATTRIBUTES a t t r i b u t e s EDITING e d i t i n g CONNECTING c o n n e c t i n g COMPOSITE c o m p o s i t e FIGURES f i g u r e s CLONING c l o n i n g EVENT e v e n t HANDLING h a n d l i n g public void addFigureListener add figure listener FigureListener figure listener l l listenerList listener list add add FigureListener figure listener class l l public void removeFigureListener remove figure listener FigureListener figure listener l l listenerList listener list remove remove FigureListener figure listener class l l public void addUndoableEditListener add undoable edit listener UndoableEditListener undoable edit listener l l listenerList listener list add add UndoableEditListener undoable edit listener class l l public void removeUndoableEditListener remove undoable edit listener UndoableEditListener undoable edit listener l l listenerList listener list remove remove UndoableEditListener undoable edit listener class l l public void addNotify add notify Drawing drawing d d this drawing drawing d d fireFigureAdded fire figure add public void removeNotify remove notify Drawing drawing d d fireFigureRemoved fire figure remove this drawing drawing null protected Drawing drawing getDrawing get drawing return drawing drawing protected Object getLock get lock return getDrawing get drawing null ? ? this getDrawing get drawing getLock get lock public void setDrawDecoratorFirst set draw decorator first boolean newValue value isDrawDecoratorFirst is draw decorator first newValue value public boolean isDrawDecoratorFirst is draw decorator first return isDrawDecoratorFirst is draw decorator first Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type public void fireAreaInvalidated fire area invalidate fireAreaInvalidated fire area invalidate getDrawBounds get draw bound Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type protected void fireAreaInvalidated fire area invalidate Rectangle2D rectangle2 d Double invalidatedArea invalidate area if listenerList listener list getListenerCount get listener count 0 0 FigureEvent figure event event event null Notify notify all all listeners listener that that have have registered register interest interest for Guaranteed guarantee to to return a a non non null array Object listeners listener listenerList listener list getListenerList get listener list Process process the the listeners listener last last to to first first notifying notify those those that that are are interested interest in in this event event for int i i listeners listener length length 2 2 i i 0 0 i i 2 2 if listeners listener i i FigureListener figure listener class Lazily lazily create create the the event event if event event null event event new FigureEvent figure event this invalidatedArea invalidate area FigureListener figure listener listeners listener i+1 i+1 figureAreaInvalidated figure area invalidate event event Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type protected void fireFigureRequestRemove fire figure request remove if listenerList listener list getListenerCount get listener count 0 0 FigureEvent figure event event event null Notify notify all all listeners listener that that have have registered register interest interest for Guaranteed guarantee to to return a a non non null array Object listeners listener listenerList listener list getListenerList get listener list Process process the the listeners listener last last to to first first notifying notify those those that that are are interested interest in in this event event for int i i listeners listener length length 2 2 i i 0 0 i i 2 2 if listeners listener i i FigureListener figure listener class Lazily lazily create create the the event event if event event null event event new FigureEvent figure event this getBounds get bound FigureListener figure listener listeners listener i+1 i+1 figureRequestRemove figure request remove event event Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type protected void fireFigureAdded fire figure add if listenerList listener list getListenerCount get listener count 0 0 FigureEvent figure event event event null Notify notify all all listeners listener that that have have registered register interest interest for Guaranteed guarantee to to return a a non non null array Object listeners listener listenerList listener list getListenerList get listener list Process process the the listeners listener last last to to first first notifying notify those those that that are are interested interest in in this event event for int i i listeners listener length length 2 2 i i 0 0 i i 2 2 if listeners listener i i FigureListener figure listener class Lazily lazily create create the the event event if event event null event event new FigureEvent figure event this getBounds get bound FigureListener figure listener listeners listener i+1 i+1 figureAdded figure add event event Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type protected void fireFigureRemoved fire figure remove if listenerList listener list getListenerCount get listener count 0 0 FigureEvent figure event event event null Notify notify all all listeners listener that that have have registered register interest interest for Guaranteed guarantee to to return a a non non null array Object listeners listener listenerList listener list getListenerList get listener list Process process the the listeners listener last last to to first first notifying notify those those that that are are interested interest in in this event event for int i i listeners listener length length 2 2 i i 0 0 i i 2 2 if listeners listener i i FigureListener figure listener class Lazily lazily create create the the event event if event event null event event new FigureEvent figure event this getBounds get bound FigureListener figure listener listeners listener i+1 i+1 figureRemoved figure remove event event public void fireFigureChanged fire figure change fireFigureChanged fire figure change getBounds get bound Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type protected void fireFigureChanged fire figure change Rectangle2D rectangle2 d Double changedArea change area if listenerList listener list getListenerCount get listener count 0 0 FigureEvent figure event event event null Notify notify all all listeners listener that that have have registered register interest interest for Guaranteed guarantee to to return a a non non null array Object listeners listener listenerList listener list getListenerList get listener list Process process the the listeners listener last last to to first first notifying notify those those that that are are interested interest in in this event event for int i i listeners listener length length 2 2 i i 0 0 i i 2 2 if listeners listener i i FigureListener figure listener class Lazily lazily create create the the event event if event event null event event new FigureEvent figure event this changedArea change area FigureListener figure listener listeners listener i+1 i+1 figureChanged figure change event event protected void fireFigureChanged fire figure change FigureEvent figure event event event if listenerList listener list getListenerCount get listener count 0 0 Notify notify all all listeners listener that that have have registered register interest interest for Guaranteed guarantee to to return a a non non null array Object listeners listener listenerList listener list getListenerList get listener list Process process the the listeners listener last last to to first first notifying notify those those that that are are interested interest in in this event event for int i i listeners listener length length 2 2 i i 0 0 i i 2 2 if listeners listener i i FigureListener figure listener class Lazily lazily create create the the event event FigureListener figure listener listeners listener i+1 i+1 figureChanged figure change event event Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type protected void fireAttributeChanged fire attribute change AttributeKey attribute key attribute attribute Object oldValue old value Object newValue value if listenerList listener list getListenerCount get listener count 0 0 FigureEvent figure event event event null Notify notify all all listeners listener that that have have registered register interest interest for Guaranteed guarantee to to return a a non non null array Object listeners listener listenerList listener list getListenerList get listener list Process process the the listeners listener last last to to first first notifying notify those those that that are are interested interest in in this event event for int i i listeners listener length length 2 2 i i 0 0 i i 2 2 if listeners listener i i FigureListener figure listener class Lazily lazily create create the the event event if event event null event event new FigureEvent figure event this attribute attribute oldValue old value newValue value FigureListener figure listener listeners listener i+1 i+1 figureAttributeChanged figure attribute change event event Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type protected void fireUndoableEditHappened fire undoable edit happen UndoableEdit undoable edit edit edit UndoableEditEvent undoable edit event event event null if listenerList listener list getListenerCount get listener count 0 0 Notify notify all all listeners listener that that have have registered register interest interest for Guaranteed guarantee to to return a a non non null array Object listeners listener listenerList listener list getListenerList get listener list Process process the the listeners listener last last to to first first notifying notify those those that that are are interested interest in in this event event for int i i listeners listener length length 2 2 i i 0 0 i i 2 2 if event event null event event new UndoableEditEvent undoable edit event this edit edit if listeners listener i i UndoableEditListener undoable edit listener class UndoableEditListener undoable edit listener listeners listener i+1 i+1 undoableEditHappened undoable edit happen event event public Set set createHandles create handle return new HashSet hash set public AbstractFigure figure clone clone try AbstractFigure figure that that AbstractFigure figure super clone clone that that listenerList listener list new EventListenerList event listener list that that isConnectorsVisible is connector visible false that that courtingConnection courting connection null if this decorator decorator null that that decorator decorator Figure figure this decorator decorator clone clone return that that catch CloneNotSupportedException clone not support e e InternalError internal error new InternalError internal e e getMessage get message error initCause init cause e e throw error public final AbstractFigure figure basicClone basic clone HashMap hash map Figure figure Figure figure oldToNew old to XXX x x x Delete delete me me return null public void remap remap HashMap hash map Figure figure Figure figure oldToNew old to public Collection collection Handle handle createHandles create handle int detailLevel detail level LinkedList link list Handle handle handles handle new LinkedList link list Handle handle if detailLevel detail level 0 0 BoxHandleKit box handle kit addBoxHandles add box handle this handles handle return handles handle public Cursor cursor getCursor get cursor Point2D point2 d Double p p if contains contain p p return Cursor cursor getPredefinedCursor get predefin cursor Cursor cursor HAND h a n d CURSOR c u r s o r else return Cursor cursor getDefaultCursor get cursor public final void setBounds set bound Rectangle2D rectangle2 d Double bounds bound setBounds set bound new Point2D point2 d Double bounds bound x x bounds bound y y new Point2D point2 d Double bounds bound x x + + bounds bound width width bounds bound y y + + bounds bound height height public void setBounds set bound Point2D point2 d Double anchor anchor Point2D point2 d Double lead Point2D point2 d Double oldAnchor old anchor getStartPoint get start point Point2D point2 d Double oldLead old getEndPoint get end point if oldAnchor old anchor equals equal anchor anchor || || oldLead old equals equal lead willChange will change basicSetBounds basic set bound anchor anchor lead changed change fireUndoableEditHappened fire undoable edit happen new SetBoundsEdit set bound edit this oldAnchor old anchor oldLead old anchor anchor lead Checks check if this figure figure can can be be connected connect By by default AbstractFigures figure can can be be connected connect public boolean canConnect can connect return true Informs inform that that a a figure figure needs need to to be be redrawn redrawn public void invalidate invalidate fireAreaInvalidated fire area invalidate getDrawBounds get draw bound protected boolean isChanging is change return changingDepth change depth 0 0 protected int getChangingDepth get change depth return changingDepth change depth Informs inform that that a a figure figure is is about about to to change change something someth that that affects affect the the contents content of of its it display display box box public void willChange will change changingDepth++ change depth++ invalidate invalidate protected void validate validate Informs inform that that a a figure figure changed change the the area area of of its it display display box box public void changed change if changingDepth change depth 1 1 validate validate fireFigureChanged fire figure change getDrawBounds get draw bound changingDepth change depth 0 0 else changingDepth change depth Transforms transform the the geometry geometry of of the the figure figure public void transform transform AffineTransform affine transform tx tx willChange will change basicTransform basic transform tx tx fireUndoableEditHappened fire undoable edit happen new TransformEdit transform edit this tx tx changed change Moves move the the figure figure This is is the the method that that subclasses subclass override override p p This is is a a basic basic operation operation for which which no no events event are are fired fire public abstract void basicTransform basic transform AffineTransform affine transform ty ty Returns the the Figures figure connector connector for the the specified specify location location By by default a a ChopBoxConnector chop box connector is is returned see see ChopBoxConnector chop box connector public Connector connector findConnector find connector Point2D point2 d Double p p ConnectionFigure connection figure prototype prototype return new ChopBoxConnector chop box connector this public boolean includes include Figure figure figure figure return figure figure this public Figure figure findFigureInside find figure inside Point2D point2 d Double p p return contains contain p p ? ? this null public Connector connector findCompatibleConnector find compatible connector Connector connector c c boolean isStart is start return new ChopBoxConnector chop box connector this Returns a a collection collection of of actions action which which are are presented present to to the the user user in in a a popup popup menu menu p p The the collection collection may may contain contain null entries entry These these entries entry are are used use interpreted interpret as a separators separator in in the the popup popup menu menu public Collection collection Action action getActions get action Point2D point2 d Double p p return Collections collection emptyList empty list Returns a a specialized specialize tool tool for the the given given coordinate coordinate p p Returns null if no no specialized specialize tool tool is is available available public Tool tool getTool get tool Point2D point2 d Double p p return null Handles handle a a mouse mouse click click public boolean handleMouseClick handle mouse click Point2D point2 d Double p p MouseEvent mouse event evt evt DrawingView drawing view view view return false public boolean handleDrop handle drop Point2D point2 d Double p p Collection collection Figure figure droppedFigures drop figure DrawingView drawing view view view return false public Point2D point2 d Double getEndPoint get end point Rectangle2D rectangle2 d Double r r getBounds get bound return new Point2D point2 d Double r r x x + + r r width width r r y y + + r r height height public Point2D point2 d Double getStartPoint get start point Rectangle2D rectangle2 d Double r r getBounds get bound return new Point2D point2 d Double r r x x r r y y public Rectangle2D rectangle2 d Double getHitBounds get hit bound return getBounds get bound public Dimension2DDouble dimension2 d getPreferredSize get prefer size Rectangle2D rectangle2 d Double r r getBounds get bound return new Dimension2DDouble dimension2 d r r width width r r height height public void remap remap Map map oldToNew old to public boolean isInteractive is interactive return isInteractive is interactive public void setInteractive set interactive boolean b b isInteractive is interactive b b public boolean isVisible is visible return isVisible is visible public void setVisible set visible boolean newValue value if newValue value isVisible is visible willChange will change isVisible is visible newValue value changed change public void setConnectorsVisible set connector visible boolean isVisible is visible ConnectionFigure connection figure connection connection willChange will change isConnectorsVisible is connector visible isVisible is visible courtingConnection courting connection connection connection changed change public boolean isConnectorsVisible is connector visible return isConnectorsVisible is connector visible protected ConnectionFigure connection figure getCourtingConnection get courting connection return courtingConnection courting connection public Collection collection Figure figure getDecomposition get decomposition LinkedList link list Figure figure list list new LinkedList link list Figure figure list list add add this return list list protected FontRenderContext font render context getFontRenderContext get font render context FontRenderContext font render context frc frc null if frc frc null frc frc new FontRenderContext font render context new AffineTransform affine transform Options option isTextAntialiased is text antialias Options option isFractionalMetrics is fractional metric return frc frc public void requestRemove request remove fireFigureRequestRemove fire figure request remove public int getLayer get layer return 0 0 public String getTooltip get tooltip Point2D point2 d Double p p return null public void setDecorator set decorator Figure figure newValue value willChange will change decorator decorator newValue value if decorator decorator null decorator decorator basicSetBounds basic set bound getStartPoint get start point getEndPoint get end point changed change public Figure figure getDecorator get decorator return decorator decorator public final void draw draw Graphics2D graphics2 d g g if isDrawDecoratorFirst is draw decorator first drawDecorator draw decorator g g drawFigure draw figure g g else drawFigure draw figure g g drawDecorator draw decorator g g protected abstract void drawFigure draw figure Graphics2D graphics2 d g g protected void drawDecorator draw decorator Graphics2D graphics2 d g g if decorator decorator null updateDecoratorBounds update decorator bound decorator decorator draw draw g g protected void updateDecoratorBounds update decorator bound if decorator decorator null Point2D point2 d Double sp sp getStartPoint get start point Point2D point2 d Double ep ep getEndPoint get end point Insets2DDouble insets2 d decoratorInsets decorator inset AttributeKeys attribute key DECORATOR d e c o r a t o r INSETS i n s e t s get get this sp sp x x decoratorInsets decorator inset left left sp sp y y decoratorInsets decorator inset top top ep ep x x + + decoratorInsets decorator inset right right ep ep y y + + decoratorInsets decorator inset bottom bottom decorator decorator basicSetBounds basic set bound sp sp ep ep public final Rectangle2D rectangle2 d Double getDrawBounds get draw bound Rectangle2D rectangle2 d Double figureDrawBounds figure draw bound getFigureDrawBounds get figure draw bound if decorator decorator null updateDecoratorBounds update decorator bound figureDrawBounds figure draw bound add add decorator decorator getDrawBounds get draw bound return figureDrawBounds figure draw bound protected abstract Rectangle2D rectangle2 d Double getFigureDrawBounds get figure draw bound public String toString to StringBuilder builder buf buf new StringBuilder builder buf buf append append getClass get getName get name substring substring getClass get getName get name lastIndexOf last index of +1 +1 buf buf append append buf buf append append hashCode hash return buf buf toString to 