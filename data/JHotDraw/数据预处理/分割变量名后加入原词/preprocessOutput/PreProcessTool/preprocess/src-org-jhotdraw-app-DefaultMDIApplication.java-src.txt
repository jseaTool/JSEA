DefaultMDIApplication m d i application java 1 1 0 0 June june 5 5 2006 2006 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org package org org jhotdraw jhotdraw app app import org org jhotdraw jhotdraw gui gui import org org jhotdraw jhotdraw util util import org org jhotdraw jhotdraw util util prefs pref import java awt awt import java awt awt event event import java beans bean import java io io import java util util import java util util prefs pref import javax javax swing swing import javax javax swing swing event event import org org jhotdraw jhotdraw app app action action A a DefaultMDIApplication m d i application can can handle handle the the life life cycle cycle of of multiple multiple document document windows window each each being being presented present in in a a JInternalFrame j internal frame of of its it own own A a parent parent JFrame j frame provides provide all all the the functionality functionality needed need to to work work with with documents document such such as a a a menu menu bar bar tool tool bars bar and and palette palette windows window author author Werner wern Randelshofer randelshof version 1 1 0 0 June june 5 5 2006 2006 Created create public class DefaultMDIApplication m d i application extends AbstractApplication application private JFrame j frame parentFrame parent frame private JScrollPane j scroll pane scrollPane scroll pane private MDIDesktopPane m d idesktop pane desktopPane desktop pane private Preferences preference prefs pref private Project project currentProject current project private LinkedList link list Action action toolBarActions tool bar action Creates create a a new instance instance public DefaultMDIApplication m d i application protected void initApplicationActions init application action ApplicationModel application model mo mo getModel get model mo mo putAction put action AboutAction about action ID new AboutAction about action this mo mo putAction put action ExitAction exit action ID new ExitAction exit action this mo mo putAction put action OSXDropOnDockAction o s x drop on dock action ID new OSXDropOnDockAction o s x drop on dock action this mo mo putAction put action NewAction action ID new NewAction action this mo mo putAction put action OpenAction open action ID new OpenAction open action this mo mo putAction put action ClearRecentFilesAction clear recent action ID new ClearRecentFilesAction clear recent action this mo mo putAction put action SaveAction save action ID new SaveAction save action this mo mo putAction put action SaveAsAction save a action ID new SaveAsAction save a action this mo mo putAction put action CloseAction close action ID new CloseAction close action this mo mo putAction put action UndoAction undo action ID new UndoAction undo action this mo mo putAction put action RedoAction redo action ID new RedoAction redo action this mo mo putAction put action CutAction cut action ID new CutAction cut action mo mo putAction put action CopyAction copy action ID new CopyAction copy action mo mo putAction put action PasteAction paste action ID new PasteAction paste action mo mo putAction put action DeleteAction delete action ID new DeleteAction delete action mo mo putAction put action DuplicateAction duplicate action ID new DuplicateAction duplicate action mo mo putAction put action SelectAllAction select all action ID new SelectAllAction select all action mo mo putAction put action MaximizeAction maximize action ID new MaximizeAction maximize action this mo mo putAction put action MinimizeAction minimize action ID new MinimizeAction minimize action this mo mo putAction put action ArrangeAction arrange action VERTICAL v e r t i c a l ID new ArrangeAction arrange action desktopPane desktop pane Arrangeable arrangeable Arrangement arrangement VERTICAL v e r t i c a l mo mo putAction put action ArrangeAction arrange action HORIZONTAL h o r i z o n t a l ID new ArrangeAction arrange action desktopPane desktop pane Arrangeable arrangeable Arrangement arrangement HORIZONTAL h o r i z o n t a l mo mo putAction put action ArrangeAction arrange action CASCADE c a s c a d e ID new ArrangeAction arrange action desktopPane desktop pane Arrangeable arrangeable Arrangement arrangement CASCADE c a s c a d e protected void initProjectActions init project action Project project p p p p putAction put action FocusAction focus action ID new FocusAction focus action p p public void launch launch String args System setProperty set property apple apple awt awt graphics graphic UseQuartz use quartz false super launch launch args public void init init super init init prefs pref Preferences preference userNodeForPackage user node getModel get model null ? ? getClass get getModel get model getClass get initLookAndFeel init look and feel initLabels init label parentFrame parent frame new JFrame j frame getName get name parentFrame parent frame setDefaultCloseOperation set close operation JFrame j frame DO d o NOTHING n o t h i n g ON o n CLOSE c l o s e desktopPane desktop pane new MDIDesktopPane m d idesktop pane scrollPane scroll pane new JScrollPane j scroll pane scrollPane scroll pane setViewportView set viewport view desktopPane desktop pane toolBarActions tool bar action new LinkedList link list Action action initApplicationActions init application action parentFrame parent frame getContentPane get content pane add add wrapDesktopPane wrap desktop pane scrollPane scroll pane toolBarActions tool bar action parentFrame parent frame addWindowListener add window listener new WindowAdapter window adapter public void windowClosing window closing final WindowEvent window event evt evt getModel get model getAction get action ExitAction exit action ID actionPerformed action perform new ActionEvent action event parentFrame parent frame ActionEvent action event ACTION a c t i o n PERFORMED p e r f o r m e d windowClosing window closing parentFrame parent frame setJMenuBar set j menu bar createMenuBar create menu bar PreferencesUtil preference util installFramePrefsHandler install frame pref handler prefs pref parentFrame parent frame parentFrame parent frame parentFrame parent frame setVisible set visible true protected void initLookAndFeel init look and feel if true return System setProperty set property apple apple laf laf useScreenMenuBar use screen menu bar false System setProperty set property com com apple apple macos maco useScreenMenuBar use screen menu bar false System setProperty set property apple apple awt awt graphics graphic UseQuartz use quartz false try String lafName laf name UIManager u i manager getSystemLookAndFeelClassName get look and feel name UIManager u i manager setLookAndFeel set look and feel lafName laf name catch Exception e e e e printStackTrace print stack trace if UIManager u i manager getString get OptionPane option pane css cs null UIManager u i manager put put OptionPane option pane css cs public void show show final Project project p p if p p isShowing is showing p p setShowing set showing true File file p p getFile get final JInternalFrame j internal frame f f new JInternalFrame j internal frame String title title if file null title title labels label getString get unnamedFile unnam else title title file getName get name f f setTitle set title labels label getFormatted get format internalFrameTitle internal frame title title title getName get name p p getMultipleOpenId get multiple open f f setDefaultCloseOperation set close operation JInternalFrame j internal frame DO d o NOTHING n o t h i n g ON o n CLOSE c l o s e f f setClosable set closable true f f setMaximizable set maximizable true f f setResizable set resizable true f f setIconifiable set iconifiable false PreferencesUtil preference util installInternalFramePrefsHandler install internal frame pref handler prefs pref project project f f desktopPane desktop pane Point point loc loc f f getLocation get location boolean moved move do moved move false for Iterator iterator i i projects project iterator iterator i i hasNext ha next Project project aProject a project Project project i i next next if aProject a project p p aProject a project isShowing is showing SwingUtilities swing utility getRootPane get root pane aProject a project getComponent get component getParent get parent getLocation get location equals equal loc loc loc loc x x + + 22 22 loc loc y y + + 22 22 moved move true break while moved move f f setLocation set location loc loc paletteHandler palette handler add add f f p p f f addInternalFrameListener add internal frame listener new InternalFrameAdapter internal frame adapter Override override public void internalFrameClosing internal frame closing final InternalFrameEvent internal frame event evt evt setCurrentProject set current project p p getModel get model getAction get action CloseAction close action ID actionPerformed action perform new ActionEvent action event f f ActionEvent action event ACTION a c t i o n PERFORMED p e r f o r m e d windowClosing window closing p p addPropertyChangeListener add property change listener new PropertyChangeListener property change listener public void propertyChange property change PropertyChangeEvent property change event evt evt String name name evt evt getPropertyName get property name if name name equals equal hasUnsavedChanges ha unsav change JInternalFrame j internal frame f f getRootPane get root pane getParent get parent putClientProperty put client property windowModified window modify new Boolean p p hasUnsavedChanges ha unsav change else if name name equals equal file f f setTitle set title p p getFile get null ? ? Unnamed unnam p p getFile get getName get name f f addPropertyChangeListener add property change listener new PropertyChangeListener property change listener public void propertyChange property change PropertyChangeEvent property change event evt evt String name name evt evt getPropertyName get property name if name name equals equal selected select if evt evt getNewValue get value equals equal Boolean TRUE t r u e setCurrentProject set current project p p f f setJMenuBar set j menu bar createMenuBar create menu bar p p f f getContentPane get content pane add add p p getComponent get component f f setVisible set visible true desktopPane desktop pane add add f f f f toFront to front try f f setSelected set select true catch PropertyVetoException property veto e e Don t t care care p p getComponent get component requestFocusInWindow request focus in window public void hide hide Project project p p if p p isShowing is showing JInternalFrame j internal frame f f JInternalFrame j internal frame SwingUtilities swing utility getRootPane get root pane p p getComponent get component getParent get parent f f setVisible set visible false f f remove remove p p getComponent get component desktopPane desktop pane remove remove f f f f dispose dispose public Project project getCurrentProject get current project return currentProject current project public void setCurrentProject set current project Project project newValue value Project project oldValue old value currentProject current project currentProject current project newValue value firePropertyChange fire property change currentProject current project oldValue old value newValue value public boolean isSharingToolsAmongProjects is sharing tool among project return true public Component component getComponent get component return parentFrame parent frame Returns the the wrapped wrap desktop desktop pane pane protected Component component wrapDesktopPane wrap desktop pane Component component c c LinkedList link list Action action toolBarActions tool bar action if getModel get model null int id 0 0 for JToolBar j tool bar tb tb new ReversedList reverse list JToolBar j tool bar getModel get model createToolBars create tool bar this null id++ id++ JPanel j panel panel panel new JPanel j panel new BorderLayout border layout panel panel add add tb tb BorderLayout border layout NORTH n o r t h panel panel add add c c BorderLayout border layout CENTER c e n t e r c c panel panel PreferencesUtil preference util installToolBarPrefsHandler install tool bar pref handler prefs pref toolbar toolbar +id +id tb tb toolBarActions tool bar action addFirst add first new ToggleToolBarAction toggle tool bar action tb tb tb tb getName get name JToolBar j tool bar tb tb new JToolBar j tool bar tb tb setName set name labels label getString get standardToolBarTitle standard tool bar title addStandardActionsTo add standard action to tb tb id++ id++ JPanel j panel panel panel new JPanel j panel new BorderLayout border layout panel panel add add tb tb BorderLayout border layout NORTH n o r t h panel panel add add c c BorderLayout border layout CENTER c e n t e r c c panel panel PreferencesUtil preference util installToolBarPrefsHandler install tool bar pref handler prefs pref toolbar toolbar +id +id tb tb toolBarActions tool bar action addFirst add first new ToggleToolBarAction toggle tool bar action tb tb tb tb getName get name panel panel putClientProperty put client property toolBarActions tool bar action toolBarActions tool bar action return c c protected void addStandardActionsTo add standard action to JToolBar j tool bar tb tb JButton j button b b ApplicationModel application model mo mo getModel get model b b tb tb add add mo mo getAction get action NewAction action ID b b setFocusable set focusable false b b tb tb add add mo mo getAction get action OpenAction open action ID b b setFocusable set focusable false b b tb tb add add mo mo getAction get action SaveAction save action ID tb tb addSeparator add separator b b tb tb add add mo mo getAction get action UndoAction undo action ID b b setFocusable set focusable false b b tb tb add add mo mo getAction get action RedoAction redo action ID b b setFocusable set focusable false tb tb addSeparator add separator b b tb tb add add mo mo getAction get action CutAction cut action ID b b setFocusable set focusable false b b tb tb add add mo mo getAction get action CopyAction copy action ID b b setFocusable set focusable false b b tb tb add add mo mo getAction get action PasteAction paste action ID b b setFocusable set focusable false Creates create a a menu menu bar bar protected JMenuBar j menu bar createMenuBar create menu bar ResourceBundleUtil resource bundle util labels label ResourceBundleUtil resource bundle util getLAFBundle get l a f bundle org org jhotdraw jhotdraw app app Labels label ApplicationModel application model mo mo getModel get model JMenuBar j menu bar mb mb new JMenuBar j menu bar JMenu j menu m m JMenuItem j menu item mi mi final JMenu j menu openRecentMenu open recent menu m m new JMenu j menu labels label configureMenu configure menu m m file m m add add mo mo getAction get action NewAction action ID m m add add mo mo getAction get action OpenAction open action ID openRecentMenu open recent menu new JMenu j menu labels label configureMenu configure menu openRecentMenu open recent menu openRecent open recent openRecentMenu open recent menu add add mo mo getAction get action ClearRecentFilesAction clear recent action ID updateOpenRecentMenu update open recent menu openRecentMenu open recent menu m m add add openRecentMenu open recent menu m m addSeparator add separator m m add add mo mo getAction get action CloseAction close action ID m m add add mo mo getAction get action SaveAction save action ID m m add add mo mo getAction get action SaveAsAction save a action ID if mo mo getAction get action ExportAction export action ID null mi mi m m add add mo mo getAction get action ExportAction export action ID m m addSeparator add separator m m add add mo mo getAction get action ExitAction exit action ID mb mb add add m m m m new JMenu j menu labels label configureMenu configure menu m m edit edit m m add add mo mo getAction get action UndoAction undo action ID m m add add mo mo getAction get action RedoAction redo action ID m m addSeparator add separator m m add add mo mo getAction get action CutAction cut action ID m m add add mo mo getAction get action CopyAction copy action ID m m add add mo mo getAction get action PasteAction paste action ID m m add add mo mo getAction get action DuplicateAction duplicate action ID m m add add mo mo getAction get action DeleteAction delete action ID m m addSeparator add separator m m add add mo mo getAction get action SelectAllAction select all action ID mb mb add add m m for JMenu j menu mm mm mo mo createMenus create menu this null mb mb add add mm mm m m new JMenu j menu final JMenu j menu windowMenu window menu m m labels label configureMenu configure menu m m window window m m add add mo mo getAction get action ArrangeAction arrange action CASCADE c a s c a d e ID m m add add mo mo getAction get action ArrangeAction arrange action VERTICAL v e r t i c a l ID m m add add mo mo getAction get action ArrangeAction arrange action HORIZONTAL h o r i z o n t a l ID m m addSeparator add separator for Project project pr pr projects project if pr pr getAction get action FocusAction focus action ID null windowMenu window menu add add pr pr getAction get action FocusAction focus action ID if toolBarActions tool bar action size size 0 0 m m addSeparator add separator for Action action a a toolBarActions tool bar action JCheckBoxMenuItem j check box menu item cbmi cbmi new JCheckBoxMenuItem j check box menu item a a Actions action configureJCheckBoxMenuItem configure j check box menu item cbmi cbmi a a m m add add cbmi cbmi mb mb add add m m m m new JMenu j menu labels label configureMenu configure menu m m labels label getString get help help m m add add mo mo getAction get action AboutAction about action ID mb mb add add m m addPropertyChangeListener add property change listener new PropertyChangeListener property change listener public void propertyChange property change PropertyChangeEvent property change event evt evt String name name evt evt getPropertyName get property name ApplicationModel application model mo mo getModel get model if name name projectCount project count JMenu j menu m m windowMenu window menu m m removeAll remove all m m add add mo mo getAction get action ArrangeAction arrange action CASCADE c a s c a d e ID m m add add mo mo getAction get action ArrangeAction arrange action VERTICAL v e r t i c a l ID m m add add mo mo getAction get action ArrangeAction arrange action HORIZONTAL h o r i z o n t a l ID m m addSeparator add separator for Iterator iterator i i projects project iterator iterator i i hasNext ha next Project project pr pr Project project i i next next if pr pr getAction get action FocusAction focus action ID null m m add add pr pr getAction get action FocusAction focus action ID if toolBarActions tool bar action size size 0 0 m m addSeparator add separator for Action action a a toolBarActions tool bar action JCheckBoxMenuItem j check box menu item cbmi cbmi new JCheckBoxMenuItem j check box menu item a a Actions action configureJCheckBoxMenuItem configure j check box menu item cbmi cbmi a a m m add add cbmi cbmi else if name name recentFiles recent updateOpenRecentMenu update open recent menu openRecentMenu open recent menu return mb mb private void updateOpenRecentMenu update open recent menu JMenu j menu openRecentMenu open recent menu if openRecentMenu open recent menu getItemCount get item count 0 0 JMenuItem j menu item clearRecentFilesItem clear recent item JMenuItem j menu item openRecentMenu open recent menu getItem get item openRecentMenu open recent menu getItemCount get item count 1 1 openRecentMenu open recent menu removeAll remove all for File f f recentFiles recent openRecentMenu open recent menu add add new OpenRecentAction open recent action DefaultMDIApplication m d i application this f f if recentFiles recent size size 0 0 openRecentMenu open recent menu addSeparator add separator openRecentMenu open recent menu add add clearRecentFilesItem clear recent item 