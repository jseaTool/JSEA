AbstractDrawing drawing java 2 2 1 1 2006 2006 07 07 08 08 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org ??? ??? package org org jhotdraw jhotdraw draw draw import org org jhotdraw jhotdraw beans bean import org org jhotdraw jhotdraw undo undo import org org jhotdraw jhotdraw xml xml import java awt awt import java awt awt geom geom import java awt awt font font import javax javax swing swing import javax javax swing swing event event import javax javax swing swing undo undo import org org jhotdraw jhotdraw util util import java util util import java io io AbstractDrawing drawing author author Werner wern Randelshofer randelshof version 2 2 1 1 2006 2006 07 07 08 08 Extend extend AbstractBean bean br 2 2 0 0 1 1 2006 2006 02 02 06 06 Did ugly ugly dirty dirty fix fix for IndexOutOfBoundsException index out of bound when when undoing undoing removal removal of of Figures figure br 2 2 0 0 2006 2006 01 01 14 14 Changed change to to support support double precision precision coordinates coordinate br 1 1 0 0 2003 2003 12 12 01 01 Derived derive from from JHotDraw jhotdraw 5 5 4b1 4b1 public abstract class AbstractDrawing drawing extends AbstractBean bean implements Drawing drawing private final static Object lock lock new JPanel j panel getTreeLock get tree lock protected EventListenerList event listener list listenerList listener list new EventListenerList event listener list private FontRenderContext font render context fontRenderContext font render context Creates create a a new instance instance public AbstractDrawing drawing public void addDrawingListener add drawing listener DrawingListener drawing listener listener listener listenerList listener list add add DrawingListener drawing listener class listener listener public void removeDrawingListener remove drawing listener DrawingListener drawing listener listener listener listenerList listener list remove remove DrawingListener drawing listener class listener listener public void addUndoableEditListener add undoable edit listener UndoableEditListener undoable edit listener l l listenerList listener list add add UndoableEditListener undoable edit listener class l l public void removeUndoableEditListener remove undoable edit listener UndoableEditListener undoable edit listener l l listenerList listener list remove remove UndoableEditListener undoable edit listener class l l public void addAll add all Collection collection Figure figure figures figure CompositeEdit composite edit edit edit new CompositeEdit composite edit Figuren figuren hinzuf\u00fcgen hinzuf\u00fcgen fireUndoableEditHappened fire undoable edit happen edit edit for Figure figure f f figures figure add add f f fireUndoableEditHappened fire undoable edit happen edit edit Removes remove all all figures figure public void clear clear removeAll remove all getFigures get figure Gets get the the number number of of figures figure public int getFigureCount get figure count return getFigures get figure size size public void removeAll remove all Collection collection Figure figure toBeRemoved to be remove CompositeEdit composite edit edit edit new CompositeEdit composite edit Figuren figuren entfernen entfernen fireUndoableEditHappened fire undoable edit happen edit edit for Figure figure f f new ArrayList list Figure figure toBeRemoved to be remove remove remove f f fireUndoableEditHappened fire undoable edit happen edit edit public void basicAddAll basic add all Collection collection Figure figure figures figure for Figure figure f f figures figure basicAdd basic add f f public void basicRemoveAll basic remove all Collection collection Figure figure toBeOrphaned to be orphan Implementation note note We we create create a a new collection collection to to avoid avoid problems problem that that may may be be caused cause if the the collection collection is is somehow somehow connected connect to to our our figures figure connection connection for Figure figure f f new ArrayList list Figure figure toBeOrphaned to be orphan basicRemove basic remove f f Calls call basicAdd basic add and and then then calls call figure figure addNotify add notify and and firesFigureAdded fire figure add public final void add add final Figure figure figure figure final int index index getFigureCount get figure count basicAdd basic add index index figure figure figure figure addNotify add notify this fireFigureAdded fire figure add figure figure fireUndoableEditHappened fire undoable edit happen new AbstractUndoableEdit undoable edit public String getPresentationName get presentation name return Figur figur einf\u00fcgen einf\u00fcgen public void undo undo throws CannotUndoException cannot undo super undo undo basicRemove basic remove figure figure figure figure removeNotify remove notify AbstractDrawing drawing this fireFigureRemoved fire figure remove figure figure public void redo redo throws CannotUndoException cannot undo super redo redo basicAdd basic add index index figure figure figure figure addNotify add notify AbstractDrawing drawing this fireFigureAdded fire figure add figure figure public void basicAdd basic add Figure figure figure figure basicAdd basic add getFigureCount get figure count figure figure Calls call basicRemove basic remove and and then then calls call figure figure addNotify add notify and and firesFigureAdded fire figure add public final void remove remove final Figure figure figure figure if contains contain figure figure final int index index indexOf index of figure figure basicRemove basic remove figure figure figure figure removeNotify remove notify this fireFigureRemoved fire figure remove figure figure fireUndoableEditHappened fire undoable edit happen new AbstractUndoableEdit undoable edit public String getPresentationName get presentation name return Figur figur entfernen entfernen public void redo redo throws CannotUndoException cannot undo super redo redo basicRemove basic remove figure figure figure figure removeNotify remove notify AbstractDrawing drawing this fireFigureRemoved fire figure remove figure figure public void undo undo throws CannotUndoException cannot undo super undo undo basicAdd basic add index index figure figure figure figure addNotify add notify AbstractDrawing drawing this fireFigureAdded fire figure add figure figure else fireAreaInvalidated fire area invalidate figure figure getDrawBounds get draw bound protected abstract int indexOf index of Figure figure figure figure Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type protected void fireAreaInvalidated fire area invalidate Rectangle2D rectangle2 d Double dirtyRegion dirty region DrawingEvent drawing event event event null Notify notify all all listeners listener that that have have registered register interest interest for Guaranteed guarantee to to return a a non non null array Object listeners listener listenerList listener list getListenerList get listener list Process process the the listeners listener last last to to first first notifying notify those those that that are are interested interest in in this event event for int i i listeners listener length length 2 2 i i 0 0 i i 2 2 if listeners listener i i DrawingListener drawing listener class Lazily lazily create create the the event event if event event null event event new DrawingEvent drawing event this null dirtyRegion dirty region DrawingListener drawing listener listeners listener i+1 i+1 areaInvalidated area invalidate event event Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type public void fireUndoableEditHappened fire undoable edit happen UndoableEdit undoable edit edit edit UndoableEditEvent undoable edit event event event null if listenerList listener list getListenerCount get listener count 0 0 Notify notify all all listeners listener that that have have registered register interest interest for Guaranteed guarantee to to return a a non non null array Object listeners listener listenerList listener list getListenerList get listener list Process process the the listeners listener last last to to first first notifying notify those those that that are are interested interest in in this event event for int i i listeners listener length length 2 2 i i 0 0 i i 2 2 if event event null event event new UndoableEditEvent undoable edit event this edit edit if listeners listener i i UndoableEditListener undoable edit listener class UndoableEditListener undoable edit listener listeners listener i+1 i+1 undoableEditHappened undoable edit happen event event Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type protected void fireFigureAdded fire figure add Figure figure f f DrawingEvent drawing event event event null Notify notify all all listeners listener that that have have registered register interest interest for Guaranteed guarantee to to return a a non non null array Object listeners listener listenerList listener list getListenerList get listener list Process process the the listeners listener last last to to first first notifying notify those those that that are are interested interest in in this event event for int i i listeners listener length length 2 2 i i 0 0 i i 2 2 if listeners listener i i DrawingListener drawing listener class Lazily lazily create create the the event event if event event null event event new DrawingEvent drawing event this f f f f getDrawBounds get draw bound DrawingListener drawing listener listeners listener i+1 i+1 figureAdded figure add event event Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type protected void fireFigureRemoved fire figure remove Figure figure f f DrawingEvent drawing event event event null Notify notify all all listeners listener that that have have registered register interest interest for Guaranteed guarantee to to return a a non non null array Object listeners listener listenerList listener list getListenerList get listener list Process process the the listeners listener last last to to first first notifying notify those those that that are are interested interest in in this event event for int i i listeners listener length length 2 2 i i 0 0 i i 2 2 if listeners listener i i DrawingListener drawing listener class Lazily lazily create create the the event event if event event null event event new DrawingEvent drawing event this f f f f getDrawBounds get draw bound DrawingListener drawing listener listeners listener i+1 i+1 figureRemoved figure remove event event public FontRenderContext font render context getFontRenderContext get font render context return fontRenderContext font render context public void setFontRenderContext set font render context FontRenderContext font render context frc frc fontRenderContext font render context frc frc public void read read DOMInput dom input in in throws IOException i o in in openElement open element figures figure for int i i 0 0 i i in in getElementCount get element count i++ i++ Figure figure f f add add f f Figure figure in in readObject read i i in in closeElement close element public void write write DOMOutput dom output out out throws IOException i o out out openElement open element figures figure for Figure figure f f getFigures get figure out out writeObject write f f out out closeElement close element The the drawing drawing view view synchronizes synchroniz on on the the lock lock when when drawing drawing a a drawing drawing public Object getLock get lock return lock lock 