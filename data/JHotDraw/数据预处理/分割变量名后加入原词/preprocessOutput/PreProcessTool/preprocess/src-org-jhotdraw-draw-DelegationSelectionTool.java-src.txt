DelegationSelectionTool delegation selection tool java 2 2 0 0 2006 2006 02 02 21 21 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org ??? ??? package org org jhotdraw jhotdraw draw draw import java awt awt import java awt awt geom geom import java awt awt event event import javax javax swing swing import java util util import org org jhotdraw jhotdraw app app action action Actions action A a SelectionTool selection tool which which recognizes recogniz double clicks click and and popup popup menu menu triggers trigger If a a double click click or or popup popup trigger trigger is is encountered encounter a a hook hook method is is called call which which handles handle the the event event This methods can can be be overriden overriden in in subclasse subclasse to to provide provide customized customize behaviour behaviour p p By by default this Tool tool delegates delegate mouse mouse events event to to a a specific specific Tool tool if the the figure figure which which has ha been be double clicked click provides provide a a specialized specialize tool tool author author Werner wern Randelshofer randelshof version 2 2 0 0 2006 2006 01 01 18 18 Changed change to to support support double precision precision coordinates coordinate Popup popup timer timer added add Support support for radio radio button button menu menu items item added add br 1 1 0 0 2003 2003 12 12 01 01 Derived derive from from JHotDraw jhotdraw 5 5 4b1 4b1 public class DelegationSelectionTool delegation selection tool extends SelectionTool selection tool A a set set of of actions action which which is is applied apply to to the the drawing drawing private Collection collection Action action drawingActions drawing action A a set set of of actions action which which is is applied apply to to a a selection selection of of figures figure private Collection collection Action action selectionActions selection action We we use use this timer timer to to show show a a popup popup menu menu when when the the user user presses press the the mouse mouse key key for a a second second without without moving move the the mouse mouse private javax javax swing swing Timer timer popupTimer popup timer When when the the popup popup menu menu is is visible visible we we do not not track track mouse mouse movements movement private JPopupMenu j popup menu popupMenu popup menu Creates create a a new instance instance public DelegationSelectionTool delegation selection tool this new LinkedList link list Action action new LinkedList link list Action action Creates create a a new instance instance public DelegationSelectionTool delegation selection tool Collection collection Action action drawingActions drawing action Collection collection Action action selectionActions selection action this drawingActions drawing action drawingActions drawing action this selectionActions selection action selectionActions selection action public void setDrawingActions set drawing action Collection collection Action action drawingActions drawing action this drawingActions drawing action drawingActions drawing action public void setFigureActions set figure action Collection collection Action action selectionActions selection action this selectionActions selection action selectionActions selection action MouseListener mouse listener method for mousePressed mouse press events event If the the popup popup trigger trigger has ha been be activated activate then then the the appropriate appropriate hook hook method is is called call public void mousePressed mouse press final MouseEvent mouse event evt evt if popupTimer popup timer null popupTimer popup timer stop stop popupTimer popup timer null XXX x x x When when we we want want to to support support multiple multiple views view we we have have to to implement implement this setView set view DrawingView drawing view e e getSource get source if evt evt isPopupTrigger is popup trigger handlePopupMenu handle popup menu evt evt else super mousePressed mouse press evt evt popupTimer popup timer new javax javax swing swing Timer timer 1000 1000 new ActionListener action listener public void actionPerformed action perform ActionEvent action event aevt aevt handlePopupMenu handle popup menu evt evt popupTimer popup timer null popupTimer popup timer setRepeats set repeat false popupTimer popup timer start start MouseListener mouse listener method for mouseReleased mouse release events event If the the popup popup trigger trigger has ha been be activated activate then then the the appropriate appropriate hook hook method is is called call public void mouseReleased mouse release MouseEvent mouse event evt evt if popupTimer popup timer null popupTimer popup timer stop stop popupTimer popup timer null super mouseReleased mouse release evt evt if evt evt isPopupTrigger is popup trigger handlePopupMenu handle popup menu evt evt public void mouseDragged mouse drag MouseEvent mouse event evt evt if popupTimer popup timer null popupTimer popup timer stop stop popupTimer popup timer null if popupMenu popup menu null || || popupMenu popup menu isVisible is visible super mouseDragged mouse drag evt evt public void mouseClicked mouse click MouseEvent mouse event evt evt super mouseClicked mouse click evt evt if evt evt getClickCount get click count 2 2 handleDoubleClick handle click evt evt Hook hook method which which can can be be overriden overriden by by subclasses subclass to to provide provide specialised specialise behaviour behaviour in in the the event event of of a a popup popup trigger trigger protected void handlePopupMenu handle popup menu MouseEvent mouse event evt evt Point point p p new Point point evt evt getX get x evt evt getY get y Figure figure figure figure getView get view findFigure find figure p p if figure figure null || || drawingActions drawing action size size 0 0 showPopupMenu show popup menu figure figure p p evt evt getComponent get component else popupMenu popup menu null protected void showPopupMenu show popup menu Figure figure figure figure Point point p p Component component c c JPopupMenu j popup menu menu menu new JPopupMenu j popup menu popupMenu popup menu menu menu JMenu j menu submenu submenu null String submenuName submenu name null LinkedList link list Action action popupActions popup action new LinkedList link list Action action if figure figure null LinkedList link list Action action figureActions figure action new LinkedList link list Action action figure figure getActions get action viewToDrawing view to drawing p p if popupActions popup action size size 0 0 figureActions figure action size size 0 0 popupActions popup action add add null popupActions popup action addAll add all figureActions figure action if popupActions popup action size size 0 0 selectionActions selection action size size 0 0 popupActions popup action add add null popupActions popup action addAll add all selectionActions selection action if popupActions popup action size size 0 0 drawingActions drawing action size size 0 0 popupActions popup action add add null popupActions popup action addAll add all drawingActions drawing action HashMap hash map Object ButtonGroup button group buttonGroups button group new HashMap hash map Object ButtonGroup button group for Action action a a popupActions popup action if a a null a a getValue get value Actions action SUBMENU s u b m e n u KEY k e y null if submenuName submenu name null || || submenuName submenu name equals equal a a getValue get value Actions action SUBMENU s u b m e n u KEY k e y submenuName submenu name String a a getValue get value Actions action SUBMENU s u b m e n u KEY k e y submenu submenu new JMenu j menu submenuName submenu name menu menu add add submenu submenu else submenuName submenu name null submenu submenu null if a a null if submenu submenu null submenu submenu addSeparator add separator else menu menu addSeparator add separator else AbstractButton button button button if a a getValue get value Actions action BUTTON b u t t o n GROUP g r o u p KEY k e y null ButtonGroup button group bg bg buttonGroups button group get get a a getValue get value Actions action BUTTON b u t t o n GROUP g r o u p KEY k e y if bg bg null bg bg new ButtonGroup button group buttonGroups button group put put a a getValue get value Actions action BUTTON b u t t o n GROUP g r o u p KEY k e y bg bg button button new JRadioButtonMenuItem j radio button menu item a a bg bg add add button button button button setSelected set select a a getValue get value Actions action SELECTED s e l e c t e d KEY k e y Boolean TRUE t r u e else if a a getValue get value Actions action SELECTED s e l e c t e d KEY k e y null button button new JCheckBoxMenuItem j check box menu item a a button button setSelected set select a a getValue get value Actions action SELECTED s e l e c t e d KEY k e y Boolean TRUE t r u e else button button new JMenuItem j menu item a a if submenu submenu null submenu submenu add add button button else menu menu add add button button menu menu show show c c p p x x p p y y Hook hook method which which can can be be overriden overriden by by subclasses subclass to to provide provide specialised specialise behaviour behaviour in in the the event event of of a a double click click protected void handleDoubleClick handle click MouseEvent mouse event evt evt DrawingView drawing view v v getView get view Point point pos po new Point point evt evt getX get x evt evt getY get y Handle handle handle handle v v findHandle find handle pos po if handle handle null handle handle trackDoubleClick track click pos po evt evt getModifiersEx get modifier ex else Point2D point2 d Double p p viewToDrawing view to drawing pos po Figure figure outerFigure out figure getView get view findFigure find figure pos po Figure figure figure figure outerFigure out figure if figure figure null Tool tool figureTool figure tool figure figure getTool get tool p p if figureTool figure tool null figure figure getDrawing get drawing findFigureInside find figure inside p p if figure figure null figureTool figure tool figure figure getTool get tool p p if figureTool figure tool null setTracker set tracker figureTool figure tool figureTool figure tool mousePressed mouse press evt evt else if outerFigure out figure handleMouseClick handle mouse click p p evt evt getView get view v v clearSelection clear selection v v addToSelection add to selection outerFigure out figure else v v clearSelection clear selection v v addToSelection add to selection outerFigure out figure v v setHandleDetailLevel set handle detail level v v getHandleDetailLevel get handle detail level 1 1 ? ? 0 0 1 1 v v setHandleDetailLevel set handle detail level v v getHandleDetailLevel get handle detail level + + 1 1 