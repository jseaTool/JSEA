CreationTool creation tool java 2 2 1 1 1 1 2006 2006 07 07 20 20 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org ??? ??? package org org jhotdraw jhotdraw draw draw import org org jhotdraw jhotdraw undo undo CompositeEdit composite edit import java awt awt import java awt awt geom geom import java awt awt event event import java util util A a tool tool to to create create new figures figure The the figure figure to to be be created create is is specified specify by by a a prototype prototype author author Werner wern Randelshofer randelshof version 2 2 1 1 1 1 2006 2006 07 07 20 20 Minimal minimal size size treshold treshold was wa enforced enforce too too eagerly eagerly br 2 2 1 1 2006 2006 07 07 15 15 Changed change to to create create prototype prototype creation creation from from class name name br 2 2 0 0 2006 2006 01 01 14 14 Changed change to to support support double precision precision coordinates coordinate br 1 1 0 0 2003 2003 12 12 01 01 Derived derive from from JHotDraw jhotdraw 5 5 4b1 4b1 public class CreationTool creation tool extends AbstractTool tool private Map map AttributeKey attribute key Object attributes attribute private String name name private Dimension dimension minimalSizeTreshold minimal size treshold new Dimension dimension 10 10 10 10 We we set set the the figure figure to to the the minimal minimal size size if it it is is smaller small than than the the minimal minimal size size treshold treshold private Dimension dimension minimalSize minimal size new Dimension dimension 40 40 40 40 The the prototype prototype for new figures figure private Figure figure prototype prototype The the created create figure figure protected Figure figure createdFigure create figure protected CompositeEdit composite edit creationEdit creation edit Creates create a a new instance instance public CreationTool creation tool String prototypeClassName prototype name this prototypeClassName prototype name null null public CreationTool creation tool String prototypeClassName prototype name Map map AttributeKey attribute key Object attributes attribute this prototypeClassName prototype name attributes attribute null public CreationTool creation tool String prototypeClassName prototype name Map map AttributeKey attribute key Object attributes attribute String name name try this prototype prototype Figure figure Class forName name prototypeClassName prototype name newInstance instance catch Exception e e InternalError internal error new InternalError internal Unable unable to to create create Figure figure from from +prototypeClassName +prototype name error initCause init cause e e throw error this attributes attribute attributes attribute this name name name name public CreationTool creation tool Figure figure prototype prototype this prototype prototype null null Creates create a a new instance instance public CreationTool creation tool Figure figure prototype prototype Map map AttributeKey attribute key Object attributes attribute this prototype prototype attributes attribute null Creates create a a new instance instance public CreationTool creation tool Figure figure prototype prototype Map map AttributeKey attribute key Object attributes attribute String name name this prototype prototype prototype prototype this attributes attribute attributes attribute this name name name name public Figure figure getPrototype get prototype return prototype prototype public void activate activate DrawingEditor drawing editor editor editor super activate activate editor editor getView get view clearSelection clear selection getView get view setCursor set cursor Cursor cursor getPredefinedCursor get predefin cursor Cursor cursor CROSSHAIR c r o s s h a i r CURSOR c u r s o r public void deactivate deactivate DrawingEditor drawing editor editor editor super deactivate deactivate editor editor if getView get view null getView get view setCursor set cursor Cursor cursor getDefaultCursor get cursor if createdFigure create figure null if createdFigure create figure instanceof CompositeFigure composite figure CompositeFigure composite figure createdFigure create figure layout layout createdFigure create figure null public void mousePressed mouse press MouseEvent mouse event evt evt super mousePressed mouse press evt evt getView get view clearSelection clear selection FIXME f i x m e Localize localize this label label creationEdit creation edit new CompositeEdit composite edit Figur figur erstellen erstellen getDrawing get drawing fireUndoableEditHappened fire undoable edit happen creationEdit creation edit createdFigure create figure createFigure create figure Point2D point2 d Double p p constrainPoint constrain point viewToDrawing view to drawing anchor anchor anchor anchor x x evt evt getX get x anchor anchor y y evt evt getY get y createdFigure create figure willChange will change createdFigure create figure basicSetBounds basic set bound p p p p createdFigure create figure changed change getDrawing get drawing add add createdFigure create figure protected Figure figure createFigure create figure Figure figure f f Figure figure prototype prototype clone clone getEditor get editor applyDefaultAttributesTo apply attribute to f f if attributes attribute null for Map map Entry entry AttributeKey attribute key Object entry entry attributes attribute entrySet entry set f f setAttribute set attribute entry entry getKey get key entry entry getValue get value return f f protected Figure figure getCreatedFigure get create figure return createdFigure create figure protected Figure figure getAddedFigure get add figure return createdFigure create figure public void mouseDragged mouse drag MouseEvent mouse event evt evt if createdFigure create figure null Point2D point2 d Double p p constrainPoint constrain point new Point point evt evt getX get x evt evt getY get y createdFigure create figure willChange will change createdFigure create figure basicSetBounds basic set bound constrainPoint constrain point new Point point anchor anchor x x anchor anchor y y p p createdFigure create figure changed change public void mouseReleased mouse release MouseEvent mouse event evt evt if createdFigure create figure null Rectangle2D rectangle2 d Double bounds bound createdFigure create figure getBounds get bound if bounds bound width width 0 0 bounds bound height height 0 0 getDrawing get drawing remove remove createdFigure create figure else if Math math abs ab anchor anchor x x evt evt getX get x minimalSizeTreshold minimal size treshold width width Math math abs ab anchor anchor y y evt evt getY get y minimalSizeTreshold minimal size treshold height height createdFigure create figure basicSetBounds basic set bound constrainPoint constrain point new Point point anchor anchor x x anchor anchor y y constrainPoint constrain point new Point point anchor anchor x x + + int Math math max max bounds bound width width minimalSize minimal size width width anchor anchor y y + + int Math math max max bounds bound height height minimalSize minimal size height height getView get view addToSelection add to selection createdFigure create figure if createdFigure create figure instanceof CompositeFigure composite figure CompositeFigure composite figure createdFigure create figure layout layout createdFigure create figure null getDrawing get drawing fireUndoableEditHappened fire undoable edit happen creationEdit creation edit fireToolDone fire tool 