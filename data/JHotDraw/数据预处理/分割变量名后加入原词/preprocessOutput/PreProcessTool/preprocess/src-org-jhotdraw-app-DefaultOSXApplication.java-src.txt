DefaultOSXApplication o s x application java 1 1 0 0 October october 4 4 2005 2005 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org package org org jhotdraw jhotdraw app app import org org jhotdraw jhotdraw app app action action OSXDropOnDockAction o s x drop on dock action import ch ch randelshofer randelshof quaqua quaqua import org org jhotdraw jhotdraw util util import org org jhotdraw jhotdraw util util prefs pref import java util util import java util util prefs pref import java awt awt event event import java beans bean import java awt awt import javax javax swing swing import java io io import org org jhotdraw jhotdraw app app action action AboutAction about action import org org jhotdraw jhotdraw app app action action Actions action import org org jhotdraw jhotdraw app app action action ClearRecentFilesAction clear recent action import org org jhotdraw jhotdraw app app action action CloseAction close action import org org jhotdraw jhotdraw app app action action CopyAction copy action import org org jhotdraw jhotdraw app app action action CutAction cut action import org org jhotdraw jhotdraw app app action action DeleteAction delete action import org org jhotdraw jhotdraw app app action action DuplicateAction duplicate action import org org jhotdraw jhotdraw app app action action ExitAction exit action import org org jhotdraw jhotdraw app app action action ExportAction export action import org org jhotdraw jhotdraw app app action action FocusAction focus action import org org jhotdraw jhotdraw app app action action MaximizeAction maximize action import org org jhotdraw jhotdraw app app action action MinimizeAction minimize action import org org jhotdraw jhotdraw app app action action NewAction action import org org jhotdraw jhotdraw app app action action OSXTogglePaletteAction o s x toggle palette action import org org jhotdraw jhotdraw app app action action OpenAction open action import org org jhotdraw jhotdraw app app action action OpenRecentAction open recent action import org org jhotdraw jhotdraw app app action action PasteAction paste action import org org jhotdraw jhotdraw app app action action RedoAction redo action import org org jhotdraw jhotdraw app app action action SaveAction save action import org org jhotdraw jhotdraw app app action action SaveAsAction save a action import org org jhotdraw jhotdraw app app action action SelectAllAction select all action import org org jhotdraw jhotdraw app app action action UndoAction undo action A a DefaultOSXApplication o s x application can can handle handle the the life life cycle cycle of of multiple multiple document document windows window each each being being presented present in in a a JFrame j frame of of its it own own The the application application provides provide all all the the functionality functionality needed need to to work work with with the the document document such such as a a a menu menu bar bar tool tool bars bar and and palette palette windows window p p OSX o s x stands stand for Mac mac OS o s X x Application application Document document Interface An an OSX o s x application application can can handle handle multiple multiple Project project s s at at the the same same time time Each each project project gets get a a JFrame j frame of of its it own own An an OSX o s x application application has ha one one menu menu bar bar attached attach to to the the top top of of the the screen screen This screen screen menu menu bar bar is is shared share by by all all Project project s s p p DefaultOSXApplication o s x application is is designed design for Mac mac OS o s X x It it will will not not work work on on other other platforms platform p p The the screen screen menu menu bar bar has ha the the following following standard standard menus menu pre pre Application application Name name File Edit edit Window window Help help pre pre The the first first menu menu is is the the b b application application menu menu b b It it has ha the the following following standard standard menu menu items item DefaultOSXApplication o s x application wires wire the the menu menu items item to to the the action action objects specified specify in in brackets bracket The the preferences preference menu menu item item is is only only displayed display if the the application application has ha an an action action with with PreferencesAction preference action ID The the other other menu menu items item are are always alway displayed display Menu menu items item without without action action wiring wiring are are generated generate by by Mac mac OS o s X x and and can can not not be be changed change pre pre About about Application application Name name AboutAction about action ID Preferences preference PreferencesAction preference action ID Services service Hide hide Application application Name name Hide hide Others other Show show All all Quit quit Application application Name name ExitAction exit action ID pre pre The the b b file menu menu b b has ha the the following following standard standard menu menu items item DefaultOSXApplication o s x application wires wire the the menu menu items item to to the the action action objects specified specify in in brackets bracket If the the application application hasn hasn t t an an action action with with the the specified specify ID the the menu menu item item is is not not displayed display Menu menu items item without without action action wiring wiring are are generated generate by by this class and and can can be be changed change by by subclasses subclass pre pre New NewAction action ID Open open OpenAction open action ID Open open Recent recent Close close CloseAction close action ID Save save SaveAction save action ID Save save As a SaveAsAction save a action ID Save save All all Revert revert to to Saved save RevertToSavedAction revert to save action ID Page page Setup setup PrintPageSetupAction print page setup action ID Print print PrintAction print action ID pre pre The the b b edit edit menu menu b b has ha the the following following standard standard menu menu items item DefaultOSXApplication o s x application wires wire the the menu menu items item to to the the action action objects specified specify in in brackets bracket If the the application application hasn hasn t t an an action action with with the the specified specify ID the the menu menu item item is is not not displayed display Menu menu items item without without action action wiring wiring are are generated generate by by this class and and can can be be changed change by by subclasses subclass pre pre Undo undo UndoAction undo action ID Redo redo RedoAction redo action ID Cut cut CutAction cut action ID Copy copy CopyAction copy action ID Paste paste PasteAction paste action ID Delete delete DeleteAction delete action ID Select select All all SelectAllAction select all action ID pre pre author author Werner wern Randelshofer randelshof version 1 1 0 0 October october 4 4 2005 2005 Created create public class DefaultOSXApplication o s x application extends AbstractApplication application private OSXPaletteHandler o s x palette handler paletteHandler palette handler private Project project currentProject current project private Preferences preference prefs pref private LinkedList link list Action action paletteActions palette action Creates create a a new instance instance public DefaultOSXApplication o s x application public void init init super init init prefs pref Preferences preference userNodeForPackage user node getModel get model null ? ? getClass get getModel get model getClass get initLookAndFeel init look and feel paletteHandler palette handler new OSXPaletteHandler o s x palette handler this initLabels init label initApplicationActions init application action paletteActions palette action new LinkedList link list Action action initPalettes init palette paletteActions palette action initScreenMenuBar init screen menu bar public void launch launch String args System setProperty set property apple apple awt awt graphics graphic UseQuartz use quartz false super launch launch args protected void initLookAndFeel init look and feel System setProperty set property apple apple laf laf useScreenMenuBar use screen menu bar true System setProperty set property com com apple apple macos maco useScreenMenuBar use screen menu bar true try UIManager u i manager setLookAndFeel set look and feel QuaquaManager quaqua manager getLookAndFeelClassName get look and feel name catch Exception e e e e printStackTrace print stack trace protected void initApplicationActions init application action ApplicationModel application model mo mo getModel get model mo mo putAction put action AboutAction about action ID new AboutAction about action this mo mo putAction put action ExitAction exit action ID new ExitAction exit action this mo mo putAction put action OSXDropOnDockAction o s x drop on dock action ID new OSXDropOnDockAction o s x drop on dock action this mo mo putAction put action NewAction action ID new NewAction action this mo mo putAction put action OpenAction open action ID new OpenAction open action this mo mo putAction put action ClearRecentFilesAction clear recent action ID new ClearRecentFilesAction clear recent action this mo mo putAction put action SaveAction save action ID new SaveAction save action this mo mo putAction put action SaveAsAction save a action ID new SaveAsAction save a action this mo mo putAction put action CloseAction close action ID new CloseAction close action this mo mo putAction put action UndoAction undo action ID new UndoAction undo action this mo mo putAction put action RedoAction redo action ID new RedoAction redo action this mo mo putAction put action CutAction cut action ID new CutAction cut action mo mo putAction put action CopyAction copy action ID new CopyAction copy action mo mo putAction put action PasteAction paste action ID new PasteAction paste action mo mo putAction put action DeleteAction delete action ID new DeleteAction delete action mo mo putAction put action DuplicateAction duplicate action ID new DuplicateAction duplicate action mo mo putAction put action SelectAllAction select all action ID new SelectAllAction select all action mo mo putAction put action MaximizeAction maximize action ID new MaximizeAction maximize action this mo mo putAction put action MinimizeAction minimize action ID new MinimizeAction minimize action this protected void initProjectActions init project action Project project p p p p putAction put action FocusAction focus action ID new FocusAction focus action p p public void addPalette add palette Window window palette palette paletteHandler palette handler addPalette add palette palette palette public void removePalette remove palette Window window palette palette paletteHandler palette handler removePalette remove palette palette palette public void show show final Project project p p if p p isShowing is showing p p setShowing set showing true File file p p getFile get final JFrame j frame f f new JFrame j frame String title title if file null title title labels label getString get unnamedFile unnam else title title file getName get name f f setTitle set title labels label getFormatted get format frameTitle frame title title title getName get name p p getMultipleOpenId get multiple open f f setDefaultCloseOperation set close operation JFrame j frame DO d o NOTHING n o t h i n g ON o n CLOSE c l o s e f f setPreferredSize set prefer size new Dimension dimension 400 400 400 400 PreferencesUtil preference util installFramePrefsHandler install frame pref handler prefs pref project project f f Point point loc loc f f getLocation get location boolean moved move do moved move false for Iterator iterator i i projects project iterator iterator i i hasNext ha next Project project aProject a project Project project i i next next if aProject a project p p aProject a project isShowing is showing SwingUtilities swing utility getWindowAncestor get window ancestor aProject a project getComponent get component getLocation get location equals equal loc loc loc loc x x + + 22 22 loc loc y y + + 22 22 moved move true break while moved move f f setLocation set location loc loc paletteHandler palette handler add add f f p p f f addWindowListener add window listener new WindowAdapter window adapter public void windowClosing window closing final WindowEvent window event evt evt setCurrentProject set current project p p getModel get model getAction get action CloseAction close action ID actionPerformed action perform new ActionEvent action event f f ActionEvent action event ACTION a c t i o n PERFORMED p e r f o r m e d windowClosing window closing p p addPropertyChangeListener add property change listener new PropertyChangeListener property change listener public void propertyChange property change PropertyChangeEvent property change event evt evt String name name evt evt getPropertyName get property name if name name equals equal hasUnsavedChanges ha unsav change f f getRootPane get root pane putClientProperty put client property windowModified window modify new Boolean p p hasUnsavedChanges ha unsav change else if name name equals equal file f f setTitle set title p p getFile get null ? ? Unnamed unnam p p getFile get getName get name f f setJMenuBar set j menu bar createMenuBar create menu bar p p f f getContentPane get content pane add add p p getComponent get component f f setVisible set visible true public void hide hide Project project p p if p p isShowing is showing JFrame j frame f f JFrame j frame SwingUtilities swing utility getWindowAncestor get window ancestor p p getComponent get component f f setVisible set visible false f f remove remove p p getComponent get component paletteHandler palette handler remove remove f f p p f f dispose dispose Creates create a a menu menu bar bar param p p The the project project for which which the the menu menu bar bar is is created create This may may be be code null code if the the menu menu bar bar is is attached attach to to an an application application component component such such as a the the screen screen menu menu bar bar or or a a floating floating palette palette window window protected JMenuBar j menu bar createMenuBar create menu bar final Project project p p ResourceBundleUtil resource bundle util labels label ResourceBundleUtil resource bundle util getLAFBundle get l a f bundle org org jhotdraw jhotdraw app app Labels label ApplicationModel application model model model getModel get model JMenuBar j menu bar mb mb new JMenuBar j menu bar JMenu j menu m m JMenuItem j menu item mi mi final JMenu j menu openRecentMenu open recent menu m m new JMenu j menu labels label configureMenu configure menu m m file mi mi m m add add model model getAction get action NewAction action ID mi mi setIcon set icon null mi mi m m add add model model getAction get action OpenAction open action ID mi mi setIcon set icon null openRecentMenu open recent menu new JMenu j menu labels label configureMenu configure menu openRecentMenu open recent menu openRecent open recent openRecentMenu open recent menu add add model model getAction get action ClearRecentFilesAction clear recent action ID updateOpenRecentMenu update open recent menu openRecentMenu open recent menu m m add add openRecentMenu open recent menu m m addSeparator add separator mi mi m m add add model model getAction get action CloseAction close action ID mi mi setIcon set icon null mi mi m m add add model model getAction get action SaveAction save action ID mi mi setIcon set icon null mi mi m m add add model model getAction get action SaveAsAction save a action ID mi mi setIcon set icon null if model model getAction get action ExportAction export action ID null mi mi m m add add model model getAction get action ExportAction export action ID mi mi setIcon set icon null mb mb add add m m m m new JMenu j menu labels label configureMenu configure menu m m edit edit mi mi m m add add model model getAction get action UndoAction undo action ID mi mi setIcon set icon null mi mi m m add add model model getAction get action RedoAction redo action ID mi mi setIcon set icon null m m addSeparator add separator mi mi m m add add model model getAction get action CutAction cut action ID mi mi setIcon set icon null mi mi m m add add model model getAction get action CopyAction copy action ID mi mi setIcon set icon null mi mi m m add add model model getAction get action PasteAction paste action ID mi mi setIcon set icon null mi mi m m add add model model getAction get action DuplicateAction duplicate action ID mi mi setIcon set icon null mi mi m m add add model model getAction get action DeleteAction delete action ID mi mi setIcon set icon null m m addSeparator add separator mi mi m m add add model model getAction get action SelectAllAction select all action ID mi mi setIcon set icon null mb mb add add m m for JMenu j menu mm mm model model createMenus create menu this p p mb mb add add mm mm m m new JMenu j menu final JMenu j menu windowMenu window menu m m labels label configureMenu configure menu m m window window mi mi m m add add model model getAction get action MinimizeAction minimize action ID mi mi setIcon set icon null mi mi m m add add model model getAction get action MaximizeAction maximize action ID mi mi setIcon set icon null m m addSeparator add separator for Project project pr pr projects project if pr pr getAction get action FocusAction focus action ID null windowMenu window menu add add pr pr getAction get action FocusAction focus action ID if paletteActions palette action size size 0 0 m m addSeparator add separator for Action action a a paletteActions palette action JCheckBoxMenuItem j check box menu item cbmi cbmi new JCheckBoxMenuItem j check box menu item a a Actions action configureJCheckBoxMenuItem configure j check box menu item cbmi cbmi a a cbmi cbmi setIcon set icon null m m add add cbmi cbmi mb mb add add m m addPropertyChangeListener add property change listener new PropertyChangeListener property change listener public void propertyChange property change PropertyChangeEvent property change event evt evt String name name evt evt getPropertyName get property name if name name projectCount project count if p p null || || projects project contains contain p p JMenu j menu m m windowMenu window menu m m removeAll remove all m m add add getModel get model getAction get action MinimizeAction minimize action ID m m add add getModel get model getAction get action MaximizeAction maximize action ID m m addSeparator add separator for Iterator iterator i i projects project iterator iterator i i hasNext ha next Project project pr pr Project project i i next next if pr pr getAction get action FocusAction focus action ID null m m add add pr pr getAction get action FocusAction focus action ID if paletteActions palette action size size 0 0 m m addSeparator add separator for Action action a a paletteActions palette action JCheckBoxMenuItem j check box menu item cbmi cbmi new JCheckBoxMenuItem j check box menu item a a Actions action configureJCheckBoxMenuItem configure j check box menu item cbmi cbmi a a cbmi cbmi setIcon set icon null m m add add cbmi cbmi else removePropertyChangeListener remove property change listener this else if name name recentFiles recent updateOpenRecentMenu update open recent menu openRecentMenu open recent menu return mb mb private void updateOpenRecentMenu update open recent menu JMenu j menu openRecentMenu open recent menu if openRecentMenu open recent menu getItemCount get item count 0 0 JMenuItem j menu item clearRecentFilesItem clear recent item JMenuItem j menu item openRecentMenu open recent menu getItem get item openRecentMenu open recent menu getItemCount get item count 1 1 openRecentMenu open recent menu removeAll remove all for File f f recentFiles recent openRecentMenu open recent menu add add new OpenRecentAction open recent action DefaultOSXApplication o s x application this f f if recentFiles recent size size 0 0 openRecentMenu open recent menu addSeparator add separator openRecentMenu open recent menu add add clearRecentFilesItem clear recent item public Project project getCurrentProject get current project return currentProject current project public void setCurrentProject set current project Project project newValue value Project project oldValue old value currentProject current project currentProject current project newValue value firePropertyChange fire property change currentProject current project oldValue old value newValue value protected void initScreenMenuBar init screen menu bar ApplicationModel application model model model getModel get model net net roydesign roydesign app app Application application mrjapp mrjapp net net roydesign roydesign app app Application application getInstance get instance mrjapp mrjapp setFramelessJMenuBar set frameles j menu bar createMenuBar create menu bar null mrjapp mrjapp getAboutJMenuItem get about j menu item setAction set action model model getAction get action AboutAction about action ID mrjapp mrjapp getQuitJMenuItem get quit j menu item setAction set action model model getAction get action ExitAction exit action ID mrjapp mrjapp addOpenDocumentListener add open document listener model model getAction get action OSXDropOnDockAction o s x drop on dock action ID protected void initPalettes init palette LinkedList link list Action action paletteActions palette action LinkedList link list JToolBar j tool bar toolBars tool bar new LinkedList link list JToolBar j tool bar getModel get model createToolBars create tool bar this null JToolBar j tool bar stb stb new JToolBar j tool bar stb stb setName set name labels label getString get standardToolBarTitle standard tool bar title addStandardActionsTo add standard action to stb stb toolBars tool bar addFirst add first stb stb int i i 0 0 int x x 0 0 for JToolBar j tool bar tb tb toolBars tool bar i++ i++ tb tb setFloatable set floatable false tb tb setOrientation set orientation JToolBar j tool bar VERTICAL v e r t i c a l tb tb setFocusable set focusable false JFrame j frame d d new JFrame j frame JDialog j dialog d d new JDialog j dialog palettes palette add add d d d d setFocusable set focusable false d d setResizable set resizable false d d getContentPane get content pane setLayout set layout new BorderLayout border layout d d getContentPane get content pane add add tb tb BorderLayout border layout CENTER c e n t e r d d setTitle set title tb tb getName get name d d setAlwaysOnTop set alway on top true d d setUndecorated set undecorat true d d getRootPane get root pane setWindowDecorationStyle set window decoration style JRootPane j root pane FRAME f r a m e d d getRootPane get root pane setFont set font new Font font Lucida lucida Grande grande Font font PLAIN p l a i n 11 11 d d getRootPane get root pane putClientProperty put client property Quaqua quaqua RootPane root pane isVertical is vertical Boolean FALSE f a l s e d d getRootPane get root pane putClientProperty put client property Quaqua quaqua RootPane root pane isPalette is palette Boolean TRUE t r u e d d setJMenuBar set j menu bar createMenuBar create menu bar null d d pack pack d d setFocusableWindowState set focusable window state false PreferencesUtil preference util installPalettePrefsHandler install palette pref handler prefs pref toolbar toolbar +i +i d d x x x x + + d d getWidth get width paletteActions palette action add add new OSXTogglePaletteAction o s x toggle palette action this d d tb tb getName get name addPalette add palette d d protected void addStandardActionsTo add standard action to JToolBar j tool bar tb tb JButton j button b b ApplicationModel application model mo mo getModel get model b b tb tb add add mo mo getAction get action NewAction action ID b b setFocusable set focusable false b b tb tb add add mo mo getAction get action OpenAction open action ID b b setFocusable set focusable false b b tb tb add add mo mo getAction get action SaveAction save action ID tb tb addSeparator add separator b b tb tb add add mo mo getAction get action UndoAction undo action ID b b setFocusable set focusable false b b tb tb add add mo mo getAction get action RedoAction redo action ID b b setFocusable set focusable false tb tb addSeparator add separator b b tb tb add add mo mo getAction get action CutAction cut action ID b b setFocusable set focusable false b b tb tb add add mo mo getAction get action CopyAction copy action ID b b setFocusable set focusable false b b tb tb add add mo mo getAction get action PasteAction paste action ID b b setFocusable set focusable false public boolean isSharingToolsAmongProjects is sharing tool among project return true public Component component getComponent get component return null 