TextTool text tool java 1 1 0 0 19 19 November november 2003 2003 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org ??? ??? package org org jhotdraw jhotdraw draw draw import java awt awt import java awt awt event event import javax javax swing swing event event import java util util Tool tool to to create create new or or edit edit existing text text figures figure The the editing editing behavior behavior is is implemented by by overlaying overlay the the Figure figure providing provide the the text text with with a a FloatingTextField floating text field p p A a tool tool interaction interaction is is done once once a a Figure figure that that is is not not a a TextHolder text holder is is clicked click see see TextHolder text holder see see FloatingTextField floating text field author author Werner wern Randelshofer randelshof version 2 2 0 0 2006 2006 01 01 14 14 Changed change to to support support double precison coordinates coordinate br 1 1 0 0 2003 2003 12 12 01 01 Derived derive from from JHotDraw jhotdraw 5 5 4b1 4b1 public class TextTool text tool extends CreationTool creation tool implements ActionListener action listener private FloatingTextField floating text field textField text field private TextHolder text holder typingTarget typing target Creates create a a new instance instance public TextTool text tool TextHolder text holder prototype prototype super prototype prototype Creates create a a new instance instance public TextTool text tool Figure figure prototype prototype Map map attributes attribute super prototype prototype attributes attribute public void deactivate deactivate DrawingEditor drawing editor editor editor endEdit end edit super deactivate deactivate editor editor If the the pressed press figure figure is is a a TextHolder text holder it it can can be be edited edit otherwise otherwise a a new text text figure figure is is created create public void mousePressed mouse press MouseEvent mouse event e e TextHolder text holder textHolder text holder null Figure figure pressedFigure press figure getDrawing get drawing findFigureInside find figure inside getView get view viewToDrawing view to drawing new Point point e e getX get x e e getY get y if pressedFigure press figure instanceof TextHolder text holder textHolder text holder TextHolder text holder pressedFigure press figure getLabelFor get label if textHolder text holder isEditable is editable textHolder text holder null if textHolder text holder null beginEdit begin edit textHolder text holder return if typingTarget typing target null endEdit end edit fireToolDone fire tool else super mousePressed mouse press e e update update view view so so the the created create figure figure is is drawn draw before before the the floating floating text text figure figure is is overlaid overlay Note note fDamage f damage should should be be null in in StandardDrawingView standard drawing view when when the the overlay overlay figure figure is is drawn draw because because a a JTextField j text field cannot cannot be be scrolled scroll view view checkDamage check damage textHolder text holder TextHolder text holder getCreatedFigure get create figure beginEdit begin edit textHolder text holder public void mouseDragged mouse drag java awt awt event event MouseEvent mouse event e e protected void beginEdit begin edit TextHolder text holder textHolder text holder if textField text field null textField text field new FloatingTextField floating text field textField text field addActionListener add action listener this if textHolder text holder typingTarget typing target typingTarget typing target null endEdit end edit textField text field createOverlay create overlay getView get view textHolder text holder textField text field setBounds set bound getFieldBounds get field bound textHolder text holder textHolder text holder getText get text textField text field requestFocus request focus typingTarget typing target textHolder text holder private Rectangle rectangle getFieldBounds get field bound TextHolder text holder figure figure Rectangle rectangle box box getView get view drawingToView drawing to view figure figure getBounds get bound int nChars n figure figure getTextColumns get text column Dimension dimension d d textField text field getPreferredSize get prefer size nChars n d d width width Math math max max box box width width d d width width return new Rectangle rectangle box box x x 6 6 box box y y 4 4 d d width width d d height height Rectangle rectangle box box getView get view drawingToView drawing to view figure figure getBounds get bound Dimension dimension d d textField text field getPreferredSize get prefer size 3 3 d d width width Math math max max box box width width d d width width Insets inset insets inset textField text field getInsets get inset return new Rectangle rectangle box box x x insets inset left left box box y y insets inset top top box box width width + + insets inset left left + + insets inset right right box box height height + + insets inset top top + + insets inset bottom bottom public void mouseReleased mouse release MouseEvent mouse event evt evt if createdFigure create figure null Rectangle rectangle bounds bound createdFigure create figure getBounds get bound if bounds bound width width 0 0 bounds bound height height 0 0 getDrawing get drawing remove remove createdFigure create figure else getView get view addToSelection add to selection createdFigure create figure createdFigure create figure null getDrawing get drawing fireUndoableEditHappened fire undoable edit happen creationEdit creation edit fireToolDone fire tool protected void endEdit end edit if typingTarget typing target null typingTarget typing target willChange will change if textField text field getText get text length length 0 0 typingTarget typing target setText set text textField text field getText get text if createdFigure create figure null getDrawing get drawing fireUndoableEditHappened fire undoable edit happen creationEdit creation edit createdFigure create figure null else if createdFigure create figure null getDrawing get drawing remove remove Figure figure getAddedFigure get add figure else typingTarget typing target setText set text nothing nothing to to undo undo setUndoActivity set undo activity null typingTarget typing target changed change typingTarget typing target null textField text field endOverlay end overlay view view checkDamage check damage public void actionPerformed action perform ActionEvent action event event event endEdit end edit fireToolDone fire tool 