SVGLiveConnectApplet s v g live connect applet java 2 2 0 0 2006 2006 01 01 15 15 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org package org org jhotdraw jhotdraw samples sample svg svg import org org jhotdraw jhotdraw draw draw import org org jhotdraw jhotdraw draw draw action action import org org jhotdraw jhotdraw util util import java awt awt import java awt awt geom geom import java awt awt event event import java io io import java net net import java util util import javax javax swing swing import javax javax swing swing event event import netscape netscape javascript javascript import org org jhotdraw jhotdraw xml xml SVGLiveConnectApplet s v g live connect applet Supports support loading loading and and saving saving of of images image to to JavaScript script author author wrandels wrandel version 2 2 0 0 Changed change to to support support double precision precision coordinates coordinate br 1 1 0 0 Created create on on 10 10 M???rz m???rz 2004 2004 13 13 22 22 public class SVGLiveConnectApplet s v g live connect applet extends JApplet j applet private final static String VERSION v e r s i o n 0 0 44 44 private final static String NAME n a m e SVGDraw s v g draw Initializes initializ the the applet applet DrawApplet draw applet public void init init Set set look look and and feel feel try UIManager u i manager setLookAndFeel set look and feel UIManager u i manager getSystemLookAndFeelClassName get look and feel name catch Throwable throwable e e Do nothing nothing If we we can can t t set set the the desired desire look look and and feel feel UIManager u i manager does doe automaticaly automaticaly the the right right thing thing for us u Display display copyright copyright info info while we we are are loading loading the the data data Container container c c getContentPane get content pane c c setLayout set layout new BoxLayout box layout c c BoxLayout box layout Y y AXIS a x i s String lines line getAppletInfo get applet info split split Strings split split getAppletInfo get applet info for int i i 0 0 i i lines line length length i++ i++ c c add add new JLabel j label lines line i i We we load load the the data data using using a a worker worker thread thread new SwingWorker swing worker public Object construct construct Object result result try if getParameter get parameter data data null getParameter get parameter data data length length 0 0 NanoXMLDOMInput nano xml dom input domi domi new NanoXMLDOMInput nano xml dom input new SVGFigureFactory s v g figure factory new StringReader reader getParameter get parameter data data result result domi domi readObject read 0 0 else if getParameter get parameter datafile datafile null InputStream input stream in in null try URL u r l url url new URL u r l getDocumentBase get document base getParameter get parameter datafile datafile in in url url openConnection open connection getInputStream get input stream NanoXMLDOMInput nano xml dom input domi domi new NanoXMLDOMInput nano xml dom input new SVGFigureFactory s v g figure factory in in result result domi domi readObject read 0 0 finally if in in null in in close close else result result null catch Throwable throwable t t result result t t return result result public void finished finish Container container c c getContentPane get content pane c c setLayout set layout new BorderLayout border layout c c removeAll remove all Object result result getValue get value initComponents init component if result result null if result result instanceof Drawing drawing setDrawing set drawing Drawing drawing result result else if result result instanceof Throwable throwable getDrawing get drawing add add new TextFigure text figure result result toString to Throwable throwable result result printStackTrace print stack trace boolean isLiveConnect is live connect try Class forName name netscape netscape javascript javascript JSObject j s isLiveConnect is live connect true catch Throwable throwable t t isLiveConnect is live connect false loadButton load button setEnabled set enable isLiveConnect is live connect getParameter get parameter dataread dataread null saveButton save button setEnabled set enable isLiveConnect is live connect getParameter get parameter datawrite datawrite null if isLiveConnect is live connect String methodName name getParameter get parameter dataread dataread if methodName name indexOf index of 0 0 methodName name methodName name substring substring 0 0 methodName name indexOf index of 1 1 JSObject j s win win JSObject j s getWindow get window SVGLiveConnectApplet s v g live connect applet this Object data data win win call call methodName name new Object 0 0 if data data instanceof String setData set data String data data c c validate validate start start private void setDrawing set drawing Drawing drawing d d drawingPanel drawing panel setDrawing set drawing d d private Drawing drawing getDrawing get drawing return drawingPanel drawing panel getDrawing get drawing public void setData set data String text text if text text null text text length length 0 0 StringReader reader in in new StringReader reader text text try NanoXMLDOMInput nano xml dom input domi domi new NanoXMLDOMInput nano xml dom input new SVGFigureFactory s v g figure factory in in domi domi openElement open element SVGDraw s v g draw setDrawing set drawing Drawing drawing domi domi readObject read 0 0 catch Throwable throwable e e getDrawing get drawing clear clear TextFigure text figure tf tf new TextFigure text figure tf tf setText set text e e getMessage get message tf tf setBounds set bound new Point2D point2 d Double 10 10 10 10 new Point2D point2 d Double 100 100 100 100 getDrawing get drawing add add tf tf e e printStackTrace print stack trace finally if in in null in in close close public String getData get data CharArrayWriter writer out out new CharArrayWriter writer try NanoXMLDOMOutput nano xml dom output domo domo new NanoXMLDOMOutput nano xml dom output new SVGFigureFactory s v g figure factory domo domo openElement open element SVGDraw s v g draw domo domo writeObject write getDrawing get drawing domo domo closeElement close element domo domo save save out out catch IOException i o e e TextFigure text figure tf tf new TextFigure text figure tf tf setText set text e e getMessage get message tf tf setBounds set bound new Point2D point2 d Double 10 10 10 10 new Point2D point2 d Double 100 100 100 100 getDrawing get drawing add add tf tf e e printStackTrace print stack trace finally if out out null out out close close return out out toString to public String getParameterInfo get parameter info return new String data data String the the data data to to be be displayed display by by this applet applet datafile datafile URL u r l an an URL u r l to to a a file containing contain the the data data to to be be displayed display by by this applet applet dataread dataread function function the the name name of of a a JavaScript script function function which which can can be be used use to to read read the the data data datawrite datawrite function function the the name name of of a a JavaScript script function function which which can can be be used use to to write write the the data data public String getAppletInfo get applet info return NAME+ n a m e+ Version +VERSION + v e r s i o n + + Copyright copyright 2004 2004 \u00a9 \u00a9 Werner wern Randelshofer randelshof + + Alle alle Rechte rechte vorbehalten vorbehalten + + Diese diese Software software basiert basiert auf auf + + JHotDraw jhotdraw \u00a9 \u00a9 1996 1996 1997 1997 IFA i f a Informatik informatik und und Erich erich Gamma gamma This method is is called call from from within within the the init init method to to initialize initialize the the form form WARNING w a r n i n g Do NOT n o t modify modify this code The the content content of of this method is is always alway regenerated regenerate by by the the Form form Editor editor editor editor fold fold defaultstate defaultstate collapsed collapse desc desc Generated generate Code GEN g e n BEGIN b e g i n initComponents init component private void initComponents init component toolButtonGroup tool button group new javax javax swing swing ButtonGroup button group drawingPanel drawing panel new org org jhotdraw jhotdraw samples sample draw draw DrawingPanel drawing panel jToolBar1 j tool bar1 new javax javax swing swing JToolBar j tool bar loadButton load button new javax javax swing swing JButton j button saveButton save button new javax javax swing swing JButton j button getContentPane get content pane add add drawingPanel drawing panel java awt awt BorderLayout border layout CENTER c e n t e r jToolBar1 j tool bar1 setFloatable set floatable false loadButton load button setText set text Laden lade loadButton load button addActionListener add action listener new java awt awt event event ActionListener action listener public void actionPerformed action perform java awt awt event event ActionEvent action event evt evt load load evt evt jToolBar1 j tool bar1 add add loadButton load button saveButton save button setText set text Speichern speichern saveButton save button addActionListener add action listener new java awt awt event event ActionListener action listener public void actionPerformed action perform java awt awt event event ActionEvent action event evt evt save save evt evt jToolBar1 j tool bar1 add add saveButton save button getContentPane get content pane add add jToolBar1 j tool bar1 java awt awt BorderLayout border layout SOUTH s o u t h editor editor fold fold GEN g e n END e n d initComponents init component private void save save java awt awt event event ActionEvent action event evt evt GEN g e n FIRST f i r s t event event save save try String methodName name getParameter get parameter datawrite datawrite if methodName name indexOf index of 0 0 methodName name methodName name substring substring 0 0 methodName name indexOf index of 1 1 JSObject j s win win JSObject j s getWindow get window this Object result result win win call call methodName name new Object getData get data catch Throwable throwable t t TextFigure text figure tf tf new TextFigure text figure Fehler fehl +t +t AffineTransform affine transform tx tx new AffineTransform affine transform tx tx translate translate 10 10 20 20 tf tf transform transform tx tx getDrawing get drawing add add tf tf GEN g e n LAST l a s t event event save save private void load load java awt awt event event ActionEvent action event evt evt GEN g e n FIRST f i r s t event event load load try String methodName name getParameter get parameter dataread dataread if methodName name indexOf index of 0 0 methodName name methodName name substring substring 0 0 methodName name indexOf index of 1 1 JSObject j s win win JSObject j s getWindow get window this Object result result win win call call methodName name new Object 0 0 if result result instanceof String setData set data String result result catch Throwable throwable t t TextFigure text figure tf tf new TextFigure text figure Fehler fehl +t +t AffineTransform affine transform tx tx new AffineTransform affine transform tx tx translate translate 10 10 20 20 tf tf transform transform tx tx getDrawing get drawing add add tf tf GEN g e n LAST l a s t event event load load Variables variable declaration declaration do not not modify modify GEN g e n BEGIN b e g i n variables variable private org org jhotdraw jhotdraw samples sample draw draw DrawingPanel drawing panel drawingPanel drawing panel private javax javax swing swing JToolBar j tool bar jToolBar1 j tool bar1 private javax javax swing swing JButton j button loadButton load button private javax javax swing swing JButton j button saveButton save button private javax javax swing swing ButtonGroup button group toolButtonGroup tool button group End end of of variables variable declaration declaration GEN g e n END e n d variables variable 