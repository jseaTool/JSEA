DefaultDrawing drawing java 2 2 0 0 2006 2006 01 01 14 14 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org ??? ??? package org org jhotdraw jhotdraw draw draw import org org jhotdraw jhotdraw util util ReversedList reverse list import java awt awt import java awt awt geom geom import javax javax swing swing import javax javax swing swing event event import javax javax swing swing undo undo import org org jhotdraw jhotdraw util util import java util util DefaultDrawing drawing author author Werner wern Randelshofer randelshof version 2 2 0 0 2006 2006 01 01 14 14 Changed change to to support support double precision precision coordinates coordinate br 1 1 0 0 2003 2003 12 12 01 01 Derived derive from from JHotDraw jhotdraw 5 5 4b1 4b1 public class DefaultDrawingextends drawingextend AbstractDrawingimplements drawingimplement FigureListener figure listener UndoableEditListener undoable edit listener private ArrayList list Figure figure figures figure new ArrayList list Figure figure private boolean needsSorting need sorting false Creates create a a new instance instance public DefaultDrawing drawing protected int indexOf index of Figure figure figure figure return figures figure indexOf index of figure figure public void basicAdd basic add int index index Figure figure figure figure figures figure add add index index figure figure figure figure addFigureListener add figure listener this figure figure addUndoableEditListener add undoable edit listener this invalidateSortOrder invalidate sort order public void basicRemove basic remove Figure figure figure figure figures figure remove remove figure figure figure figure removeFigureListener remove figure listener this figure figure removeUndoableEditListener remove undoable edit listener this invalidateSortOrder invalidate sort order public void draw draw Graphics2D graphics2 d g g synchronized getLock get lock ensureSorted ensure sort ArrayList list Figure figure toDraw to draw new ArrayList list Figure figure figures figure size size Rectangle rectangle clipRect clip rect g g getClipBounds get clip bound for Figure figure f f figures figure if f f getDrawBounds get draw bound intersects intersect clipRect clip rect toDraw to draw add add f f draw draw g g toDraw to draw public void draw draw Graphics2D graphics2 d g g Collection collection Figure figure figures figure for Figure figure f f figures figure if f f isVisible is visible f f draw draw g g public Collection collection Figure figure sort sort Collection collection Figure figure c c HashSet hash set Figure figure unsorted unsort new HashSet hash set Figure figure unsorted unsort addAll add all c c ArrayList list Figure figure sorted sort new ArrayList list Figure figure c c size size for Figure figure f f figures figure if unsorted unsort contains contain f f sorted sort add add f f unsorted unsort remove remove f f for Figure figure f f c c if unsorted unsort contains contain f f sorted sort add add f f unsorted unsort remove remove f f return sorted sort public void figureAreaInvalidated figure area invalidate FigureEvent figure event e e fireAreaInvalidated fire area invalidate e e getInvalidatedArea get invalidate area public void figureChanged figure change FigureEvent figure event e e invalidateSortOrder invalidate sort order fireAreaInvalidated fire area invalidate e e getInvalidatedArea get invalidate area public void figureAdded figure add FigureEvent figure event e e public void figureRemoved figure remove FigureEvent figure event e e public void figureRequestRemove figure request remove FigureEvent figure event e e remove remove e e getFigure get figure public Figure figure findFigure find figure Point2D point2 d Double p p for Figure figure f f getFiguresFrontToBack get figure front to back if f f isVisible is visible f f contains contain p p return f f return null public Figure figure findFigureExcept find figure except Point2D point2 d Double p p Figure figure ignore ignore for Figure figure f f getFiguresFrontToBack get figure front to back if f f ignore ignore f f isVisible is visible f f contains contain p p return f f return null public Figure figure findFigureExcept find figure except Point2D point2 d Double p p Collection collection Figure figure ignore ignore for Figure figure f f getFiguresFrontToBack get figure front to back if ignore ignore contains contain f f f f isVisible is visible f f contains contain p p return f f return null public Collection collection Figure figure findFigures find figure Rectangle2D rectangle2 d Double bounds bound ArrayList list Figure figure intersection intersection new ArrayList list Figure figure for Figure figure f f figures figure if f f isVisible is visible f f getBounds get bound intersects intersect bounds bound intersection intersection add add f f return intersection intersection public Collection collection Figure figure findFiguresWithin find figure within Rectangle2D rectangle2 d Double bounds bound ArrayList list Figure figure contained contain new ArrayList list Figure figure for Figure figure f f figures figure if f f isVisible is visible bounds bound contains contain f f getBounds get bound contained contain add add f f return contained contain public Collection collection Figure figure getFigures get figure return Collections collection unmodifiableCollection unmodifiable collection figures figure public Figure figure findFigureInside find figure inside Point2D point2 d Double p p Figure figure f f findFigure find figure p p return f f null ? ? null f f findFigureInside find figure inside p p Returns an an iterator iterator to to iterate iterate in in Z z order order front front to to back back over over the the figures figure public java util util List list Figure figure getFiguresFrontToBack get figure front to back ensureSorted ensure sort return new ReversedList reverse list Figure figure figures figure public void bringToFront bring to front Figure figure figure figure if figures figure remove remove figure figure figures figure add add figure figure invalidateSortOrder invalidate sort order fireAreaInvalidated fire area invalidate figure figure getDrawBounds get draw bound public void sendToBack send to back Figure figure figure figure if figures figure remove remove figure figure figures figure add add 0 0 figure figure invalidateSortOrder invalidate sort order fireAreaInvalidated fire area invalidate figure figure getDrawBounds get draw bound We we propagate propagate all all edit edit events event from from our our figures figure to to undoable undoable edit edit listeners listener which which have have registered register with with us u public void undoableEditHappened undoable edit happen UndoableEditEvent undoable edit event e e fireUndoableEditHappened fire undoable edit happen e e getEdit get edit public void figureAttributeChanged figure attribute change FigureEvent figure event e e public boolean contains contain Figure figure f f return figures figure contains contain f f Invalidates invalidate the the sort sort order order private void invalidateSortOrder invalidate sort order needsSorting need sorting true Ensures ensure that that the the figures figure are are sorted sort in in z z order order sequence sequence from from back back to to front front private void ensureSorted ensure sort if needsSorting need sorting Collections collection sort sort figures figure FigureLayerComparator figure layer comparator INSTANCE i n s t a n c e needsSorting need sorting false 