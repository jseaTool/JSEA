AbstractTool tool java 3 3 0 0 2006 2006 02 02 15 15 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org ??? ??? package org org jhotdraw jhotdraw draw draw import org org jhotdraw jhotdraw undo undo CompositeEdit composite edit import java awt awt import java awt awt geom geom import java awt awt event event import javax javax swing swing event event import java util util AbstractTool tool author author Werner wern Randelshofer randelshof version 3 3 0 0 2006 2006 02 02 15 15 Updated update to to handle handle multiple multiple views view br 2 2 0 0 2006 2006 01 01 14 14 Changed change to to support support double precision precision coordinates coordinate br 1 1 0 0 2003 2003 12 12 01 01 Derived derive from from JHotDraw jhotdraw 5 5 4b1 4b1 public abstract class AbstractTool tool implements Tool tool This is is set set to to true if this is is the the active active tool tool of of the the editor editor private boolean isActive is active This is is set set to to true while the the tool tool is is doing some some work work This prevents prevent the the currentView current view from from being being changed change when when a a mouseEnter mouse enter event event is is received receive protected boolean isWorking is working protected DrawingEditor drawing editor editor editor protected Point point anchor anchor new Point point protected EventListenerList event listener list listenerList listener list new EventListenerList event listener list Creates create a a new instance instance public AbstractTool tool public void addUndoableEditListener add undoable edit listener UndoableEditListener undoable edit listener l l listenerList listener list add add UndoableEditListener undoable edit listener class l l public void removeUndoableEditListener remove undoable edit listener UndoableEditListener undoable edit listener l l listenerList listener list remove remove UndoableEditListener undoable edit listener class l l public void activate activate DrawingEditor drawing editor editor editor this editor editor editor editor isActive is active true editor editor getView get view requestFocus request focus public void deactivate deactivate DrawingEditor drawing editor editor editor this editor editor editor editor isActive is active false public boolean isActive is active return isActive is active protected DrawingView drawing view getView get view return editor editor getView get view protected DrawingEditor drawing editor getEditor get editor return editor editor protected Drawing drawing getDrawing get drawing return getView get view getDrawing get drawing protected Point2D point2 d Double viewToDrawing view to drawing Point point p p return constrainPoint constrain point getView get view viewToDrawing view to drawing p p protected Point2D point2 d Double constrainPoint constrain point Point point p p return constrainPoint constrain point getView get view viewToDrawing view to drawing p p protected Point2D point2 d Double constrainPoint constrain point Point2D point2 d Double p p return getView get view getConstrainer get constrain constrainPoint constrain point p p Deletes delete the the selection selection Depending depend on on the the tool tool this could could be be selected select figures figure selected select points point or or selected select text text public void editDelete edit delete getView get view getDrawing get drawing removeAll remove all getView get view getSelectedFigures get select figure Cuts cut the the selection selection into into the the clipboard clipboard Depending depend on on the the tool tool this could could be be selected select figures figure selected select points point or or selected select text text public void editCut edit cut Copies copy the the selection selection into into the the clipboard clipboard Depending depend on on the the tool tool this could could be be selected select figures figure selected select points point or or selected select text text public void editCopy edit copy Duplicates duplicate the the selection selection Depending depend on on the the tool tool this could could be be selected select figures figure selected select points point or or selected select text text public void editDuplicate edit duplicate Pastes paste the the contents content of of the the clipboard clipboard Depending depend on on the the tool tool this could could be be selected select figures figure selected select points point or or selected select text text public void editPaste edit paste public void keyReleased key release KeyEvent key event evt evt fireToolDone fire tool public void keyTyped key type KeyEvent key event evt evt public void keyPressed key press KeyEvent key event evt evt if evt evt getSource get source instanceof Container container editor editor setView set view editor editor findView find view Container container evt evt getSource get source fireToolStarted fire tool start evt evt get get CompositeEdit composite edit edit edit switch evt evt getKeyCode get key case KeyEvent key event VK v k DELETE d e l e t e case KeyEvent key event VK v k BACK b a c k SPACE s p a c e editDelete edit delete break case KeyEvent key event VK v k A a if evt evt getModifiers get modifier KeyEvent key event CTRL c t r l MASK m a s k | | KeyEvent key event META m e t a MASK m a s k 0 0 getView get view addToSelection add to selection getView get view getDrawing get drawing getFigures get figure break case KeyEvent key event VK v k LEFT l e f t Collection collection Figure figure figures figure getView get view getSelectedFigures get select figure AffineTransform affine transform tx tx new AffineTransform affine transform tx tx translate translate 1 1 0 0 for Figure figure f f figures figure f f willChange will change f f basicTransform basic transform tx tx f f changed change getDrawing get drawing fireUndoableEditHappened fire undoable edit happen new TransformEdit transform edit figures figure tx tx break case KeyEvent key event VK v k RIGHT r i g h t Collection collection Figure figure figures figure getView get view getSelectedFigures get select figure AffineTransform affine transform tx tx new AffineTransform affine transform tx tx translate translate 1 1 0 0 for Figure figure f f figures figure f f willChange will change f f basicTransform basic transform tx tx f f changed change getDrawing get drawing fireUndoableEditHappened fire undoable edit happen new TransformEdit transform edit figures figure tx tx break case KeyEvent key event VK v k UP u p Collection collection Figure figure figures figure getView get view getSelectedFigures get select figure AffineTransform affine transform tx tx new AffineTransform affine transform tx tx translate translate 0 0 1 1 for Figure figure f f figures figure f f willChange will change f f basicTransform basic transform tx tx f f changed change getDrawing get drawing fireUndoableEditHappened fire undoable edit happen new TransformEdit transform edit figures figure tx tx break case KeyEvent key event VK v k DOWN d o w n Collection collection Figure figure figures figure getView get view getSelectedFigures get select figure getDrawing get drawing fireUndoableEditHappened fire undoable edit happen edit edit new CompositeEdit composite edit Figur figur en en verschieben verschieben AffineTransform affine transform tx tx new AffineTransform affine transform tx tx translate translate 0 0 1 1 for Figure figure f f figures figure f f willChange will change f f basicTransform basic transform tx tx f f changed change getDrawing get drawing fireUndoableEditHappened fire undoable edit happen new TransformEdit transform edit figures figure tx tx break public void mouseClicked mouse click MouseEvent mouse event evt evt public void mouseEntered mouse enter MouseEvent mouse event evt evt if isWorking is working editor editor setView set view editor editor findView find view Container container evt evt getSource get source public void mouseExited mouse exit MouseEvent mouse event evt evt public void mouseMoved mouse move MouseEvent mouse event evt evt public void mousePressed mouse press MouseEvent mouse event evt evt DrawingView drawing view view view editor editor findView find view Container container evt evt getSource get source view view requestFocus request focus anchor anchor new Point point evt evt getX get x evt evt getY get y isWorking is working true fireToolStarted fire tool start view view public void mouseReleased mouse release MouseEvent mouse event evt evt isWorking is working false public void addToolListener add tool listener ToolListener tool listener l l listenerList listener list add add ToolListener tool listener class l l public void removeToolListener remove tool listener ToolListener tool listener l l listenerList listener list remove remove ToolListener tool listener class l l Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type protected void fireToolStarted fire tool start DrawingView drawing view view view ToolEvent tool event event event null Notify notify all all listeners listener that that have have registered register interest interest for Guaranteed guarantee to to return a a non non null array Object listeners listener listenerList listener list getListenerList get listener list Process process the the listeners listener last last to to first first notifying notify those those that that are are interested interest in in this event event for int i i listeners listener length length 2 2 i i 0 0 i i 2 2 if listeners listener i i ToolListener tool listener class Lazily lazily create create the the event event if event event null event event new ToolEvent tool event this view view new Rectangle rectangle 0 0 0 0 1 1 1 1 ToolListener tool listener listeners listener i+1 i+1 toolStarted tool start event event Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type protected void fireToolDone fire tool ToolEvent tool event event event null Notify notify all all listeners listener that that have have registered register interest interest for Guaranteed guarantee to to return a a non non null array Object listeners listener listenerList listener list getListenerList get listener list Process process the the listeners listener last last to to first first notifying notify those those that that are are interested interest in in this event event for int i i listeners listener length length 2 2 i i 0 0 i i 2 2 if listeners listener i i ToolListener tool listener class Lazily lazily create create the the event event if event event null event event new ToolEvent tool event this getView get view new Rectangle rectangle 0 0 0 0 1 1 1 1 ToolListener tool listener listeners listener i+1 i+1 toolDone tool event event Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type protected void fireAreaInvalidated fire area invalidate Rectangle2D rectangle2 d Double r r Point point p1 p1 getView get view drawingToView drawing to view new Point2D point2 d Double r r x x r r y y Point point p2 p2 getView get view drawingToView drawing to view new Point2D point2 d Double r r x+r x+r width width r r y+r y+r height height fireAreaInvalidated fire area invalidate new Rectangle rectangle p1 p1 x x p1 p1 y y p2 p2 x x p1 p1 x x p2 p2 y y p1 p1 y y Notify notify all all listenerList listener list that that have have registered register interest interest for notification notification on on this event event type type protected void fireAreaInvalidated fire area invalidate Rectangle rectangle invalidatedArea invalidate area ToolEvent tool event event event null Notify notify all all listeners listener that that have have registered register interest interest for Guaranteed guarantee to to return a a non non null array Object listeners listener listenerList listener list getListenerList get listener list Process process the the listeners listener last last to to first first notifying notify those those that that are are interested interest in in this event event for int i i listeners listener length length 2 2 i i 0 0 i i 2 2 if listeners listener i i ToolListener tool listener class Lazily lazily create create the the event event if event event null event event new ToolEvent tool event this getView get view invalidatedArea invalidate area ToolListener tool listener listeners listener i+1 i+1 areaInvalidated area invalidate event event public void draw draw Graphics2D graphics2 d g g public void updateCursor update cursor DrawingView drawing view view view Point point p p Handle handle handle handle view view findHandle find handle p p if handle handle null view view setCursor set cursor handle handle getCursor get cursor else Figure figure figure figure view view findFigure find figure p p if figure figure null view view setCursor set cursor figure figure getCursor get cursor view view viewToDrawing view to drawing p p else view view setCursor set cursor Cursor cursor getDefaultCursor get cursor 