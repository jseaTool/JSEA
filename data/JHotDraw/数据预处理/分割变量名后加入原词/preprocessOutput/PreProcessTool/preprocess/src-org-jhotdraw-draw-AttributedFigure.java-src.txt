AttributedFigure attribute figure java 3 3 1 1 2006 2006 06 06 17 17 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org package org org jhotdraw jhotdraw draw draw import java awt awt import java awt awt geom geom import java util util import java io io import static org org jhotdraw jhotdraw draw draw AttributeKeys attribute key import org org jhotdraw jhotdraw geom geom import org org jhotdraw jhotdraw xml xml DOMInput dom input import org org jhotdraw jhotdraw xml xml DOMOutput dom output A a figure figure that that can can keep keep track track of of an an open open ended end set set of of attributes attribute p p FIXME f i x m e Move move all all convenience convenience attribute attribute getter gett methods into into AttributeKeys attribute key author author Werner wern Randelshofer randelshof version 3 3 1 1 2006 2006 06 06 17 17 Method chop chop Point2D point2 d Double added add br 3 3 0 0 2006 2006 06 06 07 07 Reworked rework br 2 2 1 1 2006 2006 02 02 20 20 Support support for DoubleStroke stroke added add br 2 2 0 0 2006 2006 01 01 14 14 Changed change to to support support double precision precision coordinates coordinate br 1 1 0 0 2003 2003 12 12 01 01 Derived derive from from JHotDraw jhotdraw 5 5 4b1 4b1 public abstract class AttributedFigure attribute figure extends AbstractFigure figure private HashMap hash map AttributeKey attribute key Object attributes attribute new HashMap hash map AttributeKey attribute key Object Forbidden forbid attributes attribute can can t t be be set set by by the the setAttribute set attribute operation operation They they can can only only be be changed change by by basicSetAttribute basic set attribute private HashSet hash set AttributeKey attribute key forbiddenAttributes forbid attribute Creates create a a new instance instance public AttributedFigure attribute figure Sets set an an attribute attribute of of the the figure figure AttributeKey attribute key name name and and semantics semantics are are defined define by by the the class implementing implement the the figure figure interface public void setAttribute set attribute AttributeKey attribute key key key Object newValue value if forbiddenAttributes forbid attribute null || || forbiddenAttributes forbid attribute contains contain key key Object oldValue old value attributes attribute get get key key if attributes attribute containsKey contain key key key || || oldValue old value newValue value || || oldValue old value null newValue value null oldValue old value equals equal newValue value willChange will change basicSetAttribute basic set attribute key key newValue value fireAttributeChanged fire attribute change key key oldValue old value newValue value fireUndoableEditHappened fire undoable edit happen new AttributeChangeEdit attribute change edit this key key oldValue old value newValue value changed change public void setAttributeEnabled set attribute enable AttributeKey attribute key key key boolean b b if forbiddenAttributes forbid attribute null forbiddenAttributes forbid attribute new HashSet hash set AttributeKey attribute key if b b forbiddenAttributes forbid attribute remove remove key key else forbiddenAttributes forbid attribute add add key key public boolean isAttributeEnabled is attribute enable AttributeKey attribute key key key return forbiddenAttributes forbid attribute null || || forbiddenAttributes forbid attribute contains contain key key public void setAttributes set attribute HashMap hash map AttributeKey attribute key Object map map for Map map Entry entry AttributeKey attribute key Object entry entry map map entrySet entry set setAttribute set attribute entry entry getKey get key entry entry getValue get value public Map map AttributeKey attribute key Object getAttributes get attribute return new HashMap hash map AttributeKey attribute key Object attributes attribute Sets set an an attribute attribute of of the the figure figure AttributeKey attribute key name name and and semantics semantics are are defined define by by the the class implementing implement the the figure figure interface public void basicSetAttribute basic set attribute AttributeKey attribute key key key Object newValue value if forbiddenAttributes forbid attribute null || || forbiddenAttributes forbid attribute contains contain key key attributes attribute put put key key newValue value Gets get an an attribute attribute from from the the figure figure public Object getAttribute get attribute AttributeKey attribute key key key return hasAttribute ha attribute key key ? ? attributes attribute get get key key key key getDefaultValue get value public void drawFigure draw figure Graphics2D graphics2 d g g if AttributeKeys attribute key FILL f i l l COLOR c o l o r get get this null g g setColor set color AttributeKeys attribute key FILL f i l l COLOR c o l o r get get this drawFill draw fill g g if STROKE s t r o k e COLOR c o l o r get get this null STROKE s t r o k e WIDTH w t h get get this 0d 0d g g setStroke set stroke AttributeKeys attribute key getStroke get stroke this g g setColor set color STROKE s t r o k e COLOR c o l o r get get this drawStroke draw stroke g g if TEXT t e x t COLOR c o l o r get get this null if TEXT t e x t SHADOW s h a d o w COLOR c o l o r get get this null TEXT t e x t SHADOW s h a d o w OFFSET o f f s e t get get this null Dimension2DDouble dimension2 d d d TEXT t e x t SHADOW s h a d o w OFFSET o f f s e t get get this g g translate translate d d width width d d height height g g setColor set color TEXT t e x t SHADOW s h a d o w COLOR c o l o r get get this drawText draw text g g g g translate translate d d width width d d height height g g setColor set color TEXT t e x t COLOR c o l o r get get this drawText draw text g g if isConnectorsVisible is connector visible drawConnectors draw connector g g protected void drawConnectors draw connector Graphics2D graphics2 d g g public Stroke stroke getStroke get stroke return AttributeKeys attribute key getStroke get stroke this public double getStrokeMiterLimitFactor get stroke miter limit factor Number number value value Number number getAttribute get attribute AttributeKeys attribute key STROKE s t r o k e MITER m i t e r LIMIT l i m i t FACTOR f a c t o r return value value null ? ? value value doubleValue value 10f 10f public Rectangle2D rectangle2 d Double getFigureDrawBounds get figure draw bound double width width AttributeKeys attribute key getStrokeTotalWidth get stroke total width this 2d 2d if STROKE s t r o k e JOIN j o i n get get this BasicStroke basic stroke JOIN j o i n MITER m i t e r width width STROKE s t r o k e MITER m i t e r LIMIT l i m i t FACTOR f a c t o r get get this width++ width++ Rectangle2D rectangle2 d Double r r getBounds get bound Geom geom grow grow r r width width width width return r r This method is is called call by by method draw draw to to draw draw the the fill fill area area of of the the figure figure AttributedFigure attribute figure configures configure the the Graphics2D graphics2 d object with with the the FILL f i l l COLOR c o l o r attribute attribute before before calling calling this method If the the FILL f i l l COLOR c o l o r attribute attribute is is null this method is is not not called call protected abstract void drawFill draw fill java awt awt Graphics2D graphics2 d g g This method is is called call by by method draw draw to to draw draw the the lines line of of the the figure figure AttributedFigure attribute figure configures configure the the Graphics2D graphics2 d object with with the the STROKE s t r o k e COLOR c o l o r attribute attribute before before calling calling this method If the the STROKE s t r o k e COLOR c o l o r attribute attribute is is null this method is is not not called call This method is is called call by by method draw draw to to draw draw the the text text of of the the figure figure AttributedFigure attribute figure configures configure the the Graphics2D graphics2 d object with with the the TEXT t e x t COLOR c o l o r attribute attribute before before calling calling this method If the the TEXT t e x t COLOR c o l o r attribute attribute is is null this method is is not not called call protected abstract void drawStroke draw stroke java awt awt Graphics2D graphics2 d g g protected void drawText draw text java awt awt Graphics2D graphics2 d g g public AttributedFigure attribute figure clone clone AttributedFigure attribute figure that that AttributedFigure attribute figure super clone clone that that attributes attribute new HashMap hash map AttributeKey attribute key Object this attributes attribute if this forbiddenAttributes forbid attribute null that that forbiddenAttributes forbid attribute new HashSet hash set AttributeKey attribute key this forbiddenAttributes forbid attribute return that that protected void writeAttributes write attribute DOMOutput dom output out out throws IOException i o Figure figure prototype prototype Figure figure out out getPrototype get prototype boolean isElementOpen is element open false for Map map Entry entry AttributeKey attribute key Object entry entry attributes attribute entrySet entry set AttributeKey attribute key key key entry entry getKey get key if forbiddenAttributes forbid attribute null || || forbiddenAttributes forbid attribute contains contain key key Object prototypeValue prototype value key key get get prototype prototype Object attributeValue attribute value key key get get this if prototypeValue prototype value attributeValue attribute value || || prototypeValue prototype value null attributeValue attribute value null prototypeValue prototype value equals equal attributeValue attribute value if isElementOpen is element open out out openElement open element a a isElementOpen is element open true out out openElement open element key key getKey get key out out writeObject write entry entry getValue get value out out closeElement close element if isElementOpen is element open out out closeElement close element protected void readAttributes read attribute DOMInput dom input in in throws IOException i o if in in getElementCount get element count a a 0 0 in in openElement open element a a for int i i in in getElementCount get element count 1 1 i i 0 0 i i in in openElement open element i i String name name in in getTagName get tag name Object value value in in readObject read AttributeKey attribute key key key getAttributeKey get attribute key name name if key key null key key isAssignable is assignable value value if forbiddenAttributes forbid attribute null || || forbiddenAttributes forbid attribute contains contain key key setAttribute set attribute key key value value in in closeElement close element in in closeElement close element protected AttributeKey attribute key getAttributeKey get attribute key String name name return AttributeKeys attribute key supportedAttributeMap support attribute map get get name name Applies applie all all attributes attribute of of this figure figure to to that that figure figure protected void applyAttributesTo apply attribute to Figure figure that that for Map map Entry entry AttributeKey attribute key Object entry entry attributes attribute entrySet entry set that that setAttribute set attribute entry entry getKey get key entry entry getValue get value public void write write DOMOutput dom output out out throws IOException i o Rectangle2D rectangle2 d Double r r getBounds get bound out out addAttribute add attribute x x r r x x out out addAttribute add attribute y y r r y y out out addAttribute add attribute w w r r width width out out addAttribute add attribute h h r r height height writeAttributes write attribute out out public void read read DOMInput dom input in in throws IOException i o double x x in in getAttribute get attribute x x 0d 0d double y y in in getAttribute get attribute y y 0d 0d double w w in in getAttribute get attribute w w 0d 0d double h h in in getAttribute get attribute h h 0d 0d setBounds set bound new Point2D point2 d Double x x y y new Point2D point2 d Double x+w x+w y+h y+h readAttributes read attribute in in public void removeAttribute remove attribute AttributeKey attribute key key key if hasAttribute ha attribute key key Object oldValue old value getAttribute get attribute key key attributes attribute remove remove key key fireAttributeChanged fire attribute change key key oldValue old value key key getDefaultValue get value public boolean hasAttribute ha attribute AttributeKey attribute key key key return attributes attribute containsKey contain key key key 