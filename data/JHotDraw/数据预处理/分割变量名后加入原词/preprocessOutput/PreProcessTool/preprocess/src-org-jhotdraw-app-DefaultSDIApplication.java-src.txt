DefaultSDIApplication s d i application java 1 1 3 3 2006 2006 05 05 03 03 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org package org org jhotdraw jhotdraw app app import org org jhotdraw jhotdraw util util import org org jhotdraw jhotdraw util util prefs pref import java awt awt import java awt awt event event import java beans bean import java io io import java util util import java util util prefs pref import javax javax swing swing import org org jhotdraw jhotdraw app app action action AboutAction about action import org org jhotdraw jhotdraw app app action action Actions action import org org jhotdraw jhotdraw app app action action ClearAction clear action import org org jhotdraw jhotdraw app app action action ClearRecentFilesAction clear recent action import org org jhotdraw jhotdraw app app action action CloseAction close action import org org jhotdraw jhotdraw app app action action CopyAction copy action import org org jhotdraw jhotdraw app app action action CutAction cut action import org org jhotdraw jhotdraw app app action action DeleteAction delete action import org org jhotdraw jhotdraw app app action action DuplicateAction duplicate action import org org jhotdraw jhotdraw app app action action ExitAction exit action import org org jhotdraw jhotdraw app app action action ExportAction export action import org org jhotdraw jhotdraw app app action action LoadAction load action import org org jhotdraw jhotdraw app app action action LoadRecentAction load recent action import org org jhotdraw jhotdraw app app action action NewAction action import org org jhotdraw jhotdraw app app action action PasteAction paste action import org org jhotdraw jhotdraw app app action action RedoAction redo action import org org jhotdraw jhotdraw app app action action SaveAction save action import org org jhotdraw jhotdraw app app action action SaveAsAction save a action import org org jhotdraw jhotdraw app app action action SelectAllAction select all action import org org jhotdraw jhotdraw app app action action ToggleVisibleAction toggle visible action import org org jhotdraw jhotdraw app app action action UndoAction undo action A a DefaultSDIApplication s d i application can can handle handle the the life life cycle cycle of of a a single single document document window window being being presented present in in a a JFrame j frame The the JFrame j frame provides provide all all the the functionality functionality needed need to to work work with with the the document document such such as a a a menu menu bar bar tool tool bars bar and and palette palette windows window author author Werner wern Randelshofer randelshof version 1 1 3 3 2006 2006 05 05 03 03 Show show asterisk asterisk in in window window title title when when project project has ha unsaved unsav changes change br 1 1 2 2 1 1 2006 2006 02 02 28 28 Stop stop application application when when last last project project is is closed close br 1 1 2 2 2006 2006 02 02 06 06 Support support for multiple multiple open open id added add br 1 1 1 1 2006 2006 02 02 06 06 Revised revise br 1 1 0 0 October october 16 16 2005 2005 Created create public class DefaultSDIApplication s d i application extends AbstractApplication application private Project project currentProject current project private Preferences preference prefs pref Creates create a a new instance instance public DefaultSDIApplication s d i application public void launch launch String args System setProperty set property apple apple awt awt graphics graphic UseQuartz use quartz false super launch launch args public void init init super init init prefs pref Preferences preference userNodeForPackage user node getModel get model null ? ? getClass get getModel get model getClass get initLabels init label initLookAndFeel init look and feel initApplicationActions init application action public void remove remove Project project p p super remove remove p p if projects project size size 0 0 stop stop protected void initLookAndFeel init look and feel System setProperty set property apple apple laf laf useScreenMenuBar use screen menu bar false System setProperty set property com com apple apple macos maco useScreenMenuBar use screen menu bar false System setProperty set property apple apple awt awt graphics graphic UseQuartz use quartz false try String lafName laf name UIManager u i manager getSystemLookAndFeelClassName get look and feel name UIManager u i manager setLookAndFeel set look and feel lafName laf name catch Exception e e e e printStackTrace print stack trace if UIManager u i manager getString get OptionPane option pane css cs null UIManager u i manager put put OptionPane option pane css cs protected void initApplicationActions init application action ResourceBundleUtil resource bundle util appLabels app label ResourceBundleUtil resource bundle util getLAFBundle get l a f bundle org org jhotdraw jhotdraw app app Labels label ApplicationModel application model m m getModel get model m m putAction put action AboutAction about action ID new AboutAction about action this m m putAction put action ExitAction exit action ID new ExitAction exit action this m m putAction put action ClearAction clear action ID new ClearAction clear action this m m putAction put action NewAction action ID new NewAction action this appLabels app label configureAction configure action m m getAction get action NewAction action ID newWindow window m m putAction put action LoadAction load action ID new LoadAction load action this m m putAction put action ClearRecentFilesAction clear recent action ID new ClearRecentFilesAction clear recent action this m m putAction put action SaveAction save action ID new SaveAction save action this m m putAction put action SaveAsAction save a action ID new SaveAsAction save a action this m m putAction put action CloseAction close action ID new CloseAction close action this m m putAction put action UndoAction undo action ID new UndoAction undo action this m m putAction put action RedoAction redo action ID new RedoAction redo action this m m putAction put action CutAction cut action ID new CutAction cut action m m putAction put action CopyAction copy action ID new CopyAction copy action m m putAction put action PasteAction paste action ID new PasteAction paste action m m putAction put action DeleteAction delete action ID new DeleteAction delete action m m putAction put action DuplicateAction duplicate action ID new DuplicateAction duplicate action m m putAction put action SelectAllAction select all action ID new SelectAllAction select all action protected void initProjectActions init project action Project project p p public void show show final Project project p p if p p isShowing is showing p p setShowing set showing true File file p p getFile get final JFrame j frame f f new JFrame j frame String title title if file null title title labels label getString get unnamedFile unnam else title title file getName get name if p p hasUnsavedChanges ha unsav change title title + + f f setTitle set title labels label getFormatted get format frameTitle frame title title title getName get name p p getMultipleOpenId get multiple open f f setDefaultCloseOperation set close operation JFrame j frame DO d o NOTHING n o t h i n g ON o n CLOSE c l o s e JPanel j panel panel panel JPanel j panel wrapProjectComponent wrap project component p p f f add add panel panel f f setMinimumSize set minimum size new Dimension dimension 200 200 200 200 f f setPreferredSize set prefer size new Dimension dimension 600 600 400 400 f f setJMenuBar set j menu bar createMenuBar create menu bar p p java util util List list Action action panel panel getClientProperty get client property toolBarActions tool bar action PreferencesUtil preference util installFramePrefsHandler install frame pref handler prefs pref project project f f Point point loc loc f f getLocation get location boolean moved move do moved move false for Iterator iterator i i projects project iterator iterator i i hasNext ha next Project project aProject a project Project project i i next next if aProject a project p p SwingUtilities swing utility getWindowAncestor get window ancestor aProject a project getComponent get component null SwingUtilities swing utility getWindowAncestor get window ancestor aProject a project getComponent get component getLocation get location equals equal loc loc loc loc x x + + 22 22 loc loc y y + + 22 22 moved move true break while moved move f f setLocation set location loc loc f f addWindowListener add window listener new WindowAdapter window adapter public void windowClosing window closing final WindowEvent window event evt evt setCurrentProject set current project p p getModel get model getAction get action CloseAction close action ID actionPerformed action perform new ActionEvent action event f f ActionEvent action event ACTION a c t i o n PERFORMED p e r f o r m e d windowClosing window closing public void windowActivated window activate WindowEvent window event e e setCurrentProject set current project p p p p addPropertyChangeListener add property change listener new PropertyChangeListener property change listener public void propertyChange property change PropertyChangeEvent property change event evt evt String name name evt evt getPropertyName get property name if name name equals equal hasUnsavedChanges ha unsav change || || name name equals equal file || || name name equals equal multipleOpenId multiple open File file p p getFile get String title title if file null title title labels label getString get unnamedFile unnam else title title file getName get name if p p hasUnsavedChanges ha unsav change title title + + f f setTitle set title labels label getFormatted get format frameTitle frame title title title getName get name p p getMultipleOpenId get multiple open f f setVisible set visible true Returns the the project project component component Eventually eventually wraps wrap it it into into another another component component in in order order to to provide provide additional additional functionality functionality protected Component component wrapProjectComponent wrap project component Project project p p Component component c c p p getComponent get component if getModel get model null LinkedList link list Action action toolBarActions tool bar action new LinkedList link list int id 0 0 for JToolBar j tool bar tb tb new ReversedList reverse list JToolBar j tool bar getModel get model createToolBars create tool bar this p p id++ id++ JPanel j panel panel panel new JPanel j panel new BorderLayout border layout panel panel add add tb tb BorderLayout border layout NORTH n o r t h panel panel add add c c BorderLayout border layout CENTER c e n t e r c c panel panel PreferencesUtil preference util installToolBarPrefsHandler install tool bar pref handler prefs pref toolbar toolbar +id +id tb tb toolBarActions tool bar action addFirst add first new ToggleVisibleAction toggle visible action tb tb tb tb getName get name JToolBar j tool bar tb tb new JToolBar j tool bar tb tb setName set name labels label getString get standardToolBarTitle standard tool bar title addStandardActionsTo add standard action to tb tb p p id++ id++ JPanel j panel panel panel new JPanel j panel new BorderLayout border layout panel panel add add tb tb BorderLayout border layout NORTH n o r t h panel panel add add c c BorderLayout border layout CENTER c e n t e r c c panel panel PreferencesUtil preference util installToolBarPrefsHandler install tool bar pref handler prefs pref toolbar toolbar +id +id tb tb toolBarActions tool bar action addFirst add first new ToggleVisibleAction toggle visible action tb tb tb tb getName get name panel panel putClientProperty put client property toolBarActions tool bar action toolBarActions tool bar action return c c protected void addStandardActionsTo add standard action to JToolBar j tool bar tb tb Project project p p JButton j button b b ApplicationModel application model m m getModel get model b b tb tb add add m m getAction get action ClearAction clear action ID b b setFocusable set focusable false b b tb tb add add m m getAction get action LoadAction load action ID b b setFocusable set focusable false b b tb tb add add m m getAction get action SaveAction save action ID tb tb addSeparator add separator b b tb tb add add m m getAction get action UndoAction undo action ID b b setFocusable set focusable false b b tb tb add add m m getAction get action RedoAction redo action ID b b setFocusable set focusable false tb tb addSeparator add separator b b tb tb add add m m getAction get action CutAction cut action ID b b setFocusable set focusable false b b tb tb add add m m getAction get action CopyAction copy action ID b b setFocusable set focusable false b b tb tb add add m m getAction get action PasteAction paste action ID b b setFocusable set focusable false public void hide hide Project project p p if p p isShowing is showing p p setShowing set showing false JFrame j frame f f JFrame j frame SwingUtilities swing utility getWindowAncestor get window ancestor p p getComponent get component f f setVisible set visible false f f remove remove p p getComponent get component f f dispose dispose public void dispose dispose Project project p p super dispose dispose p p if projects project size size 0 0 stop stop public Project project getCurrentProject get current project return currentProject current project public void setCurrentProject set current project Project project newValue value Project project oldValue old value currentProject current project currentProject current project newValue value firePropertyChange fire property change currentProject current project oldValue old value newValue value The the project project menu menu bar bar is is displayed display for a a project project The the default implementation returns a a new screen screen menu menu bar bar protected JMenuBar j menu bar createMenuBar create menu bar final Project project p p java util util List list Action action toolBarActions tool bar action ApplicationModel application model model model getModel get model ResourceBundleUtil resource bundle util labels label ResourceBundleUtil resource bundle util getLAFBundle get l a f bundle org org jhotdraw jhotdraw app app Labels label JMenuBar j menu bar mb mb new JMenuBar j menu bar JMenu j menu m m m2 m2 JMenuItem j menu item mi mi JCheckBoxMenuItem j check box menu item cbmi cbmi final JMenu j menu openRecentMenu open recent menu m m new JMenu j menu labels label configureMenu configure menu m m labels label getString get file m m add add model model getAction get action ClearAction clear action ID m m add add model model getAction get action NewAction action ID m m add add model model getAction get action LoadAction load action ID openRecentMenu open recent menu new JMenu j menu labels label configureMenu configure menu openRecentMenu open recent menu openRecent open recent openRecentMenu open recent menu add add model model getAction get action ClearRecentFilesAction clear recent action ID updateOpenRecentMenu update open recent menu openRecentMenu open recent menu m m add add openRecentMenu open recent menu m m addSeparator add separator m m add add model model getAction get action SaveAction save action ID m m add add model model getAction get action SaveAsAction save a action ID if model model getAction get action ExportAction export action ID null mi mi m m add add model model getAction get action ExportAction export action ID m m addSeparator add separator m m add add model model getAction get action ExitAction exit action ID mb mb add add m m m m new JMenu j menu labels label configureMenu configure menu m m labels label getString get edit edit m m add add model model getAction get action UndoAction undo action ID m m add add model model getAction get action RedoAction redo action ID m m addSeparator add separator m m add add model model getAction get action CutAction cut action ID m m add add model model getAction get action CopyAction copy action ID m m add add model model getAction get action PasteAction paste action ID m m add add model model getAction get action DuplicateAction duplicate action ID m m add add model model getAction get action DeleteAction delete action ID m m addSeparator add separator m m add add model model getAction get action SelectAllAction select all action ID mb mb add add m m JMenu j menu viewMenu view menu null for JMenu j menu mm mm model model createMenus create menu this p p mb mb add add mm mm if mm mm getText get text equals equal labels label getString get view view viewMenu view menu mm mm if toolBarActions tool bar action null toolBarActions tool bar action size size 0 0 m m viewMenu view menu null ? ? viewMenu view menu new JMenu j menu m2 m2 toolBarActions tool bar action size size 1 1 ? ? m m new JMenu j menu labels label getString get toolBars tool bar labels label configureMenu configure menu m m labels label getString get view view for Action action a a toolBarActions tool bar action cbmi cbmi new JCheckBoxMenuItem j check box menu item a a Actions action configureJCheckBoxMenuItem configure j check box menu item cbmi cbmi a a m2 m2 add add cbmi cbmi if m2 m2 m m m m add add m2 m2 mb mb add add m m m m new JMenu j menu labels label configureMenu configure menu m m labels label getString get help help m m add add model model getAction get action AboutAction about action ID mb mb add add m m addPropertyChangeListener add property change listener new PropertyChangeListener property change listener public void propertyChange property change PropertyChangeEvent property change event evt evt String name name evt evt getPropertyName get property name if name name projectCount project count if p p null || || projects project contains contain p p else removePropertyChangeListener remove property change listener this else if name name recentFiles recent updateOpenRecentMenu update open recent menu openRecentMenu open recent menu return mb mb private void updateOpenRecentMenu update open recent menu JMenu j menu openRecentMenu open recent menu if openRecentMenu open recent menu getItemCount get item count 0 0 JMenuItem j menu item clearRecentFilesItem clear recent item JMenuItem j menu item openRecentMenu open recent menu getItem get item openRecentMenu open recent menu getItemCount get item count 1 1 openRecentMenu open recent menu removeAll remove all for File f f recentFiles recent openRecentMenu open recent menu add add new LoadRecentAction load recent action DefaultSDIApplication s d i application this f f if recentFiles recent size size 0 0 openRecentMenu open recent menu addSeparator add separator openRecentMenu open recent menu add add clearRecentFilesItem clear recent item public boolean isSharingToolsAmongProjects is sharing tool among project return false public Component component getComponent get component Project project p p getCurrentProject get current project return p p null ? ? null p p getComponent get component 