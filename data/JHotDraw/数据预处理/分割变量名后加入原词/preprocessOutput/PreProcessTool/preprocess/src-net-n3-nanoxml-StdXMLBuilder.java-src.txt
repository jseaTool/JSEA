StdXMLBuilder std xml builder java NanoXML nano xml Java $Revision $ revision 1 1 3 3 $ $ $Date $ date 2002 2002 01 01 04 04 21 21 03 03 28 28 $ $ $Name $ name RELEASE r e l e a s e 2 2 2 2 1 1 $ $ This file is is part part of of NanoXML nano xml 2 2 for Java Copyright copyright C c 2000 2000 2002 2002 Marc marc De de Scheemaecker scheemaeck All all Rights right Reserved reserve This software software is is provided provide as a is is without without any any express express or or implied imply warranty warranty In in no no event event will will the the authors author be be held hold liable liable for any any damages damage arising arise from from the the use use of of this software software Permission permission is is granted grant to to anyone anyone to to use use this software software for any any purpose purpose including include commercial commercial applications application and and to to alter alter it it and and redistribute redistribute it it freely freely subject subject to to the the following following restrictions restriction 1 1 The the origin origin of of this software software must must not not be be misrepresented misrepresent you you must must not not claim claim that that you you wrote write the the original original software software If you you use use this software software in in a a product product an an acknowledgment acknowledgment in in the the product product documentation documentation would would be be appreciated appreciate but but is is not not required require 2 2 Altered alter source source versions must must be be plainly plainly marked mark as a such such and and must must not not be be misrepresented misrepresent as a being being the the original original software software 3 3 This notice notice may may not not be be removed remove or or altered alter from from any any source source distribution distribution package net net n3 n3 nanoxml nanoxml import java io io IOException i o import java io io Reader reader import java util util Stack stack StdXMLBuilder std xml builder is is a a concrete concrete implementation of of IXMLBuilder i xml builder which which creates create a a tree tree of of IXMLElement i xml element from from an an XML xml data data source source see see net net n3 n3 nanoxml nanoxml XMLElement xml element author author Marc marc De de Scheemaecker scheemaeck version $Name $ name RELEASE r e l e a s e 2 2 2 2 1 1 $ $ $Revision $ revision 1 1 3 3 $ $ public class StdXMLBuilder std xml builder implements IXMLBuilder i xml builder This stack stack contains contain the the current current element element and and its it parents parent private Stack stack stack stack The the root root element element of of the the parsed parse XML xml tree tree private IXMLElement i xml element root root Prototype prototype element element for creating create the the tree tree private IXMLElement i xml element prototype prototype Creates create the the builder builder public StdXMLBuilder std xml builder this new XMLElement xml element Creates create the the builder builder param prototype prototype the the prototype prototype to to use use when when building building the the tree tree public StdXMLBuilder std xml builder IXMLElement i xml element prototype prototype this stack stack null this root root null this prototype prototype prototype prototype Cleans clean up up the the object when when it it s s destroyed destroy protected void finalize finalize throws Throwable throwable this prototype prototype null this root root null this stack stack clear clear this stack stack null super finalize finalize This method is is called call before before the the parser parser starts start processing processing its it input input param systemID the the system ID of of the the XML xml data data source source param lineNr line nr the the line line on on which which the the parsing parse starts start public void startBuilding start building String systemID int lineNr line nr this stack stack new Stack stack this root root null This method is is called call when when a a processing processing instruction instruction is is encountered encounter PIs p is with with target target xml xml are are handled handle by by the the parser parser param target target the the PI p i target target param reader reader to to read read the the data data from from the the PI p i public void newProcessingInstruction processing instruction String target target Reader reader reader reader nothing nothing to to do This method is is called call when when a a new XML xml element element is is encountered encounter see see endElement end element param name name the the name name of of the the element element param nsPrefix n prefix the the prefix prefix used use to to identify identify the the namespace namespace If no no namespace namespace has ha been be specified specify this parameter parameter is is null param nsURI n u r i the the URI u r i associated associate with with the the namespace namespace If no no namespace namespace has ha been be specified specify or or no no URI u r i is is associated associate with with nsPrefix n prefix this parameter parameter is is null param systemID the the system ID of of the the XML xml data data source source param lineNr line nr the the line line in in the the source source where where the the element element starts start public void startElement start element String name name String nsPrefix n prefix String nsURI n u r i String systemID int lineNr line nr String fullName full name name name if nsPrefix n prefix null fullName full name nsPrefix n prefix + + + + name name IXMLElement i xml element elt elt this prototype prototype createElement create element fullName full name nsURI n u r i systemID lineNr line nr if this stack stack empty empty this root root elt elt else IXMLElement i xml element top top IXMLElement i xml element this stack stack peek peek top top addChild add child elt elt this stack stack push push elt elt This method is is called call when when the the attributes attribute of of an an XML xml element element have have been be processed process see see startElement start element see see addAttribute add attribute param name name the the name name of of the the element element param nsPrefix n prefix the the prefix prefix used use to to identify identify the the namespace namespace If no no namespace namespace has ha been be specified specify this parameter parameter is is null param nsURI n u r i the the URI u r i associated associate with with the the namespace namespace If no no namespace namespace has ha been be specified specify or or no no URI u r i is is associated associate with with nsPrefix n prefix this parameter parameter is is null public void elementAttributesProcessed element attribute process String name name String nsPrefix n prefix String nsURI n u r i nothing nothing to to do This method is is called call when when the the end end of of an an XML xml elemnt elemnt is is encountered encounter see see startElement start element param name name the the name name of of the the element element param nsPrefix n prefix the the prefix prefix used use to to identify identify the the namespace namespace If no no namespace namespace has ha been be specified specify this parameter parameter is is null param nsURI n u r i the the URI u r i associated associate with with the the namespace namespace If no no namespace namespace has ha been be specified specify or or no no URI u r i is is associated associate with with nsPrefix n prefix this parameter parameter is is null public void endElement end element String name name String nsPrefix n prefix String nsURI n u r i IXMLElement i xml element elt elt IXMLElement i xml element this stack stack pop pop if elt elt getChildrenCount get child count 1 1 IXMLElement i xml element child child elt elt getChildAtIndex get child at index 0 0 if child child getName get name null elt elt setContent set content child child getContent get content elt elt removeChildAtIndex remove child at index 0 0 This method is is called call when when a a new attribute attribute of of an an XML xml element element is is encountered encounter param key key the the key key name name of of the the attribute attribute param nsPrefix n prefix the the prefix prefix used use to to identify identify the the namespace namespace If no no namespace namespace has ha been be specified specify this parameter parameter is is null param nsURI n u r i the the URI u r i associated associate with with the the namespace namespace If no no namespace namespace has ha been be specified specify or or no no URI u r i is is associated associate with with nsPrefix n prefix this parameter parameter is is null param value value the the value value of of the the attribute attribute param type type the the type type of of the the attribute attribute If no no type type is is known know CDATA c d a t a is is returned throws java lang lang Exception If an an exception occurred occur while processing processing the the event event public void addAttribute add attribute String key key String nsPrefix n prefix String nsURI n u r i String value value String type type throws Exception String fullName full name key key if nsPrefix n prefix null fullName full name nsPrefix n prefix + + + + key key IXMLElement i xml element top top IXMLElement i xml element this stack stack peek peek if top top hasAttribute ha attribute fullName full name throw new XMLParseException xml parse top top getSystemID get top top getLineNr get line nr Duplicate duplicate attribute attribute + + key key if nsPrefix n prefix null top top setAttribute set attribute fullName full name nsURI n u r i value value else top top setAttribute set attribute fullName full name value value This method is is called call when when a a PCDATA p c d a t a element element is is encountered encounter A a Java reader reader is is supplied supply from from which which you you can can read read the the data data The the reader reader will will only only read read the the data data of of the the element element You you don t t need need to to check check for boundaries boundary If you you don t t read read the the full full element element the the rest rest of of the the data data is is skipped skip You you also also don t t have have to to care care about about entities entity they they are are resolved resolve by by the the parser parser param reader reader the the Java reader reader from from which which you you can can retrieve retrieve the the data data param systemID the the system ID of of the the XML xml data data source source param lineNr line nr the the line line in in the the source source where where the the element element starts start public void addPCData add p c data Reader reader reader reader String systemID int lineNr line nr int bufSize buf size 2048 2048 int sizeRead size read 0 0 StringBuffer buffer str str new StringBuffer buffer bufSize buf size char buf buf new char bufSize buf size for if sizeRead size read bufSize buf size bufSize buf size 2 2 str str ensureCapacity ensure capacity bufSize buf size int size size try size size reader reader read read buf buf catch IOException i o e e break if size size 0 0 break str str append append buf buf 0 0 size size sizeRead size read + + size size IXMLElement i xml element elt elt this prototype prototype createElement create element null systemID lineNr line nr elt elt setContent set content str str toString to if this stack stack empty empty IXMLElement i xml element top top IXMLElement i xml element this stack stack peek peek top top addChild add child elt elt Returns the the result result of of the the building building process process This method is is called call just just before before the the I i parse parse I i method of of IXMLParser i xml parser returns see see net net n3 n3 nanoxml nanoxml IXMLParser i xml parser parse parse return the the result result of of the the building building process process public Object getResult get result return this root root 