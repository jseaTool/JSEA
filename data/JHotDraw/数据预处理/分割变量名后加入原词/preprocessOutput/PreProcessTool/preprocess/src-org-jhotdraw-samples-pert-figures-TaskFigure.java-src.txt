TaskFigure task figure java 1 1 0 0 18 18 Juni juni 2006 2006 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org package org org jhotdraw jhotdraw samples sample pert pert figures figure import java io io IOException i o import org org jhotdraw jhotdraw samples sample import java awt awt geom geom import java beans bean import static org org jhotdraw jhotdraw draw draw AttributeKeys attribute key import java util util import org org jhotdraw jhotdraw draw draw import org org jhotdraw jhotdraw geom geom import org org jhotdraw jhotdraw util util import org org jhotdraw jhotdraw xml xml TaskFigure task figure author author Werner wern Randelshofer randelshof version 1 1 0 0 18 18 Juni juni 2006 2006 Created create public class TaskFigure task figure extends GraphicalCompositeFigure graphical composite figure private HashSet hash set DependencyFigure dependency figure dependencies dependency Derived derive attribute attribute We we cache cache it it here here for efficiency efficiency reasons reason private int startTime start time This adapter adapter is is used use to to connect connect a a TextFigure text figure with with the the name name of of the the TaskFigure task figure model model private static class NameAdapter name adapter extends AbstractFigureListener figure listener private TaskFigure task figure target target public NameAdapter name adapter TaskFigure task figure target target this target target target target public void figureAttributeChanged figure attribute change FigureEvent figure event e e We we could could fire fire a a property property change change event event here here in in case some some other other object would would like like to to observe observe us u target target firePropertyChange fire property change name name e e getOldValue get old value e e getNewValue get value private static class DurationAdapter duration adapter extends AbstractFigureListener figure listener private TaskFigure task figure target target public DurationAdapter duration adapter TaskFigure task figure target target this target target target target public void figureAttributeChanged figure attribute change FigureEvent figure event evt evt We we could could fire fire a a property property change change event event here here in in case some some other other object would would like like to to observe observe us u target target firePropertyChange fire property change duration duration e e getOldValue get old value e e getNewValue get value for TaskFigure task figure succ succ target target getSuccessors get successor succ succ updateStartTime update start time Creates create a a new instance instance public TaskFigure task figure super new RectangleFigure rectangle figure setLayouter set layout new VerticalLayouter vertical layout RectangleFigure rectangle figure nameCompartmentPF name compartment p f new RectangleFigure rectangle figure STROKE s t r o k e COLOR c o l o r set set nameCompartmentPF name compartment p f null nameCompartmentPF name compartment p f setAttributeEnabled set attribute enable STROKE s t r o k e COLOR c o l o r false FILL f i l l COLOR c o l o r set set nameCompartmentPF name compartment p f null nameCompartmentPF name compartment p f setAttributeEnabled set attribute enable FILL f i l l COLOR c o l o r false ListFigure list figure nameCompartment name compartment new ListFigure list figure nameCompartmentPF name compartment p f ListFigure list figure attributeCompartment attribute compartment new ListFigure list figure SeparatorLineFigure separator line figure separator1 separator1 new SeparatorLineFigure separator line figure applyAttributes apply attribute getPresentationFigure get presentation figure add add nameCompartment name compartment add add separator1 separator1 add add attributeCompartment attribute compartment Insets2DDouble insets2 d insets inset new Insets2DDouble insets2 d 4 4 8 8 4 4 8 8 LAYOUT l a y o u t INSETS i n s e t s set set nameCompartment name compartment insets inset LAYOUT l a y o u t INSETS i n s e t s set set attributeCompartment attribute compartment insets inset TextFigure text figure nameFigure name figure nameCompartment name compartment add add nameFigure name figure new TextFigure text figure FONT f o n t BOLD b o l d set set nameFigure name figure true nameFigure name figure setAttributeEnabled set attribute enable FONT f o n t BOLD b o l d false TextFigure text figure durationFigure duration figure attributeCompartment attribute compartment add add durationFigure duration figure new TextFigure text figure FONT f o n t BOLD b o l d set set durationFigure duration figure true durationFigure duration figure setText set text 0 0 durationFigure duration figure setAttributeEnabled set attribute enable FONT f o n t BOLD b o l d false TextFigure text figure startTimeFigure start time figure attributeCompartment attribute compartment add add startTimeFigure start time figure new TextFigure text figure startTimeFigure start time figure setEditable set editable false startTimeFigure start time figure setText set text 0 0 startTimeFigure start time figure setAttributeEnabled set attribute enable FONT f o n t BOLD b o l d false applyAttributes apply attribute this setAttributeEnabled set attribute enable STROKE s t r o k e DASHES d a s h e s false ResourceBundleUtil resource bundle util labels label ResourceBundleUtil resource bundle util getLAFBundle get l a f bundle org org jhotdraw jhotdraw samples sample pert pert Labels label setName set name labels label getString get taskDefaultName task name setDuration set duration 0 0 startTime start time 0 0 dependencies dependency new HashSet hash set DependencyFigure dependency figure nameFigure name figure addFigureListener add figure listener new NameAdapter name adapter this durationFigure duration figure addFigureListener add figure listener new DurationAdapter duration adapter this public Collection collection Handle handle createHandles create handle int detailLevel detail level List list Handle handle handles handle new LinkedList link list Handle handle if detailLevel detail level 0 0 handles handle add add new MoveHandle move handle this RelativeLocator relative locator northWest north west handles handle add add new MoveHandle move handle this RelativeLocator relative locator northEast north east handles handle add add new MoveHandle move handle this RelativeLocator relative locator southWest south west handles handle add add new MoveHandle move handle this RelativeLocator relative locator southEast south east handles handle add add new ConnectionHandle connection handle this RelativeLocator relative locator east east new DependencyFigure dependency figure return handles handle public void setName set name String newValue value getNameFigure get name figure setText set text newValue value public String getName get name return getNameFigure get name figure getText get text public void setDuration set duration int newValue value int oldValue old value getDuration get duration getDurationFigure get duration figure setText set text Integer toString to newValue value if oldValue old value newValue value for TaskFigure task figure succ succ getSuccessors get successor succ succ updateStartTime update start time public int getDuration get duration try return Integer valueOf value of getDurationFigure get duration figure getText get text catch NumberFormatException number format e e return 0 0 public void updateStartTime update start time int oldValue old value getStartTime get start time int newValue value 0 0 for TaskFigure task figure pre pre getPredecessors get predecessor newValue value Math math max max newValue value pre pre getStartTime get start time + + pre pre getDuration get duration getStartTimeFigure get start time figure setText set text Integer toString to newValue value if newValue value oldValue old value for TaskFigure task figure succ succ getSuccessors get successor The the if statement statement here here guards guard against against cyclic cyclic task task dependencies dependency if this isDependentOf is dependent of succ succ succ succ updateStartTime update start time if oldValue old value newValue value fireAreaInvalidated fire area invalidate public int getStartTime get start time try return Integer valueOf value of getStartTimeFigure get start time figure getText get text catch NumberFormatException number format e e return 0 0 private TextFigure text figure getNameFigure get name figure return TextFigure text figure ListFigure list figure getChild get child 0 0 getChild get child 0 0 private TextFigure text figure getDurationFigure get duration figure return TextFigure text figure ListFigure list figure getChild get child 2 2 getChild get child 0 0 private TextFigure text figure getStartTimeFigure get start time figure return TextFigure text figure ListFigure list figure getChild get child 2 2 getChild get child 1 1 private void applyAttributes apply attribute Figure figure f f Map map AttributeKey attribute key Object attr attr AttributedFigure attribute figure getPresentationFigure get presentation figure getAttributes get attribute for Map map Entry entry AttributeKey attribute key Object entry entry attr attr entrySet entry set f f setAttribute set attribute entry entry getKey get key entry entry getValue get value public TaskFigure task figure clone clone TaskFigure task figure that that TaskFigure task figure super clone clone that that dependencies dependency new HashSet hash set DependencyFigure dependency figure that that getNameFigure get name figure addFigureListener add figure listener new NameAdapter name adapter that that that that getDurationFigure get duration figure addFigureListener add figure listener new DurationAdapter duration adapter that that that that updateStartTime update start time return that that public void read read DOMInput dom input in in throws IOException i o double x x in in getAttribute get attribute x x 0d 0d double y y in in getAttribute get attribute y y 0d 0d double w w in in getAttribute get attribute w w 0d 0d double h h in in getAttribute get attribute h h 0d 0d setBounds set bound new Point2D point2 d Double x x y y new Point2D point2 d Double x+w x+w y+h y+h readAttributes read attribute in in in in openElement open element model model in in openElement open element name name setName set name String in in readObject read in in closeElement close element in in openElement open element duration duration setDuration set duration Integer in in readObject read in in closeElement close element in in closeElement close element public void write write DOMOutput dom output out out throws IOException i o Rectangle2D rectangle2 d Double r r getBounds get bound out out addAttribute add attribute x x r r x x out out addAttribute add attribute y y r r y y writeAttributes write attribute out out out out openElement open element model model out out openElement open element name name out out writeObject write getName get name out out closeElement close element out out openElement open element duration duration out out writeObject write getDuration get duration out out closeElement close element out out closeElement close element public int getLayer get layer return 0 0 public Set set DependencyFigure dependency figure getDependencies get dependency return Collections collection unmodifiableSet unmodifiable set dependencies dependency public void addDependency add dependency DependencyFigure dependency figure f f dependencies dependency add add f f updateStartTime update start time public void removeDependency remove dependency DependencyFigure dependency figure f f dependencies dependency remove remove f f updateStartTime update start time Returns dependent dependent PertTasks pert task which which are are directly directly connected connect via via a a PertDependency pert dependency to to this TaskFigure task figure public List list TaskFigure task figure getSuccessors get successor LinkedList link list TaskFigure task figure list list new LinkedList link list TaskFigure task figure for DependencyFigure dependency figure c c getDependencies get dependency if c c getStartFigure get start figure this list list add add TaskFigure task figure c c getEndFigure get end figure return list list Returns predecessor predecessor PertTasks pert task which which are are directly directly connected connect via via a a PertDependency pert dependency to to this TaskFigure task figure public List list TaskFigure task figure getPredecessors get predecessor LinkedList link list TaskFigure task figure list list new LinkedList link list TaskFigure task figure for DependencyFigure dependency figure c c getDependencies get dependency if c c getEndFigure get end figure this list list add add TaskFigure task figure c c getStartFigure get start figure return list list Returns true if the the current current task task is is a a direct direct or or indirect indirect dependent dependent of of the the specified specify task task If the the dependency dependency is is cyclic cyclic then then this method returns true if code this code is is passed pass as a a a parameter parameter and and for every every other other task task in in the the cycle cycle public boolean isDependentOf is dependent of TaskFigure task figure t t if this t t return true for TaskFigure task figure pre pre getPredecessors get predecessor if pre pre isDependentOf is dependent of t t return true return false public String toString to return TaskFigure task figure +hashCode +hash + + +getName +get name + + +getDuration +get duration + + +getStartTime +get start time 