TextTool text tool java 2 2 0 0 2006 2006 01 01 14 14 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org ??? ??? package org org jhotdraw jhotdraw draw draw import org org jhotdraw jhotdraw util util import java awt awt import java awt awt geom geom import java awt awt event event import javax javax swing swing event event import java util util import org org jhotdraw jhotdraw geom geom Tool tool to to create create new or or edit edit existing text text figures figure The the editing editing behavior behavior is is implemented by by overlaying overlay the the Figure figure providing provide the the text text with with a a FloatingTextArea floating text area p p A a tool tool interaction interaction is is done once once a a Figure figure that that is is not not a a TextHolder text holder is is clicked click see see TextHolder text holder see see FloatingTextArea floating text area author author Werner wern Randelshofer randelshof version 2 2 0 0 2006 2006 01 01 14 14 Changed change to to support support double precison coordinates coordinate br 1 1 0 0 2003 2003 12 12 01 01 Derived derive from from JHotDraw jhotdraw 5 5 4b1 4b1 public class TextAreaTool text area tool extends CreationTool creation tool implements ActionListener action listener private FloatingTextArea floating text area textArea text area private TextHolder text holder typingTarget typing target Creates create a a new instance instance public TextAreaTool text area tool TextHolder text holder prototype prototype super prototype prototype public void deactivate deactivate DrawingEditor drawing editor editor editor endEdit end edit super deactivate deactivate editor editor If the the pressed press figure figure is is a a TextHolder text holder it it can can be be edited edit otherwise otherwise a a new text text figure figure is is created create public void mousePressed mouse press MouseEvent mouse event e e TextHolder text holder textHolder text holder null Figure figure pressedFigure press figure getDrawing get drawing findFigureInside find figure inside getView get view viewToDrawing view to drawing new Point point e e getX get x e e getY get y if pressedFigure press figure instanceof TextHolder text holder textHolder text holder TextHolder text holder pressedFigure press figure if textHolder text holder isEditable is editable textHolder text holder null if textHolder text holder null createdFigure create figure null beginEdit begin edit textHolder text holder return if typingTarget typing target null endEdit end edit fireToolDone fire tool else super mousePressed mouse press e e update update view view so so the the created create figure figure is is drawn draw before before the the floating floating text text figure figure is is overlaid overlay Note note fDamage f damage should should be be null in in StandardDrawingView standard drawing view when when the the overlay overlay figure figure is is drawn draw because because a a JTextField j text field cannot cannot be be scrolled scroll view view checkDamage check damage textHolder text holder TextHolder text holder getCreatedFigure get create figure beginEdit begin edit textHolder text holder public void mouseDragged mouse drag java awt awt event event MouseEvent mouse event e e protected void beginEdit begin edit TextHolder text holder textHolder text holder if textArea text area null textArea text area new FloatingTextArea floating text area textArea text area addActionListener add action listener this if textHolder text holder typingTarget typing target typingTarget typing target null endEdit end edit textArea text area createOverlay create overlay getView get view textHolder text holder textArea text area setBounds set bound getFieldBounds get field bound textHolder text holder textHolder text holder getText get text textArea text area requestFocus request focus typingTarget typing target textHolder text holder private Rectangle2D rectangle2 d Double getFieldBounds get field bound TextHolder text holder figure figure Rectangle2D rectangle2 d Double r r figure figure getBounds get bound Insets2DDouble insets2 d insets inset figure figure getInsets get inset r r new Rectangle2D rectangle2 d Double r r x x + + insets inset left left r r y y + + insets inset top top r r width width insets inset left left insets inset right right r r height height insets inset top top insets inset bottom bottom FIXME f i x m e Find find a a way way to to determine determine the the parameters for grow grow r r grow grow 1 1 2 2 r r width width + + 16 16 r r x x 1 1 r r y y 2 2 r r width width + + 18 18 r r height height + + 4 4 return r r public void mouseReleased mouse release MouseEvent mouse event evt evt if createdFigure create figure null TextHolder text holder textHolder text holder TextHolder text holder createdFigure create figure Rectangle2D rectangle2 d Double bounds bound createdFigure create figure getBounds get bound if bounds bound width width 0 0 bounds bound height height 0 0 getDrawing get drawing remove remove createdFigure create figure else if bounds bound width width 5 5 bounds bound height height 5 5 createdFigure create figure willChange will change createdFigure create figure basicSetBounds basic set bound new Point2D point2 d Double bounds bound x x bounds bound y y new Point2D point2 d Double bounds bound x x + + 100 100 bounds bound y y + + 100 100 createdFigure create figure changed change getView get view addToSelection add to selection createdFigure create figure if createdFigure create figure instanceof CompositeFigure composite figure CompositeFigure composite figure createdFigure create figure layout layout createdFigure create figure null getDrawing get drawing fireUndoableEditHappened fire undoable edit happen creationEdit creation edit beginEdit begin edit textHolder text holder protected void endEdit end edit if typingTarget typing target null if textArea text area getText get text length length 0 0 typingTarget typing target setText set text textArea text area getText get text if createdFigure create figure null getDrawing get drawing fireUndoableEditHappened fire undoable edit happen creationEdit creation edit createdFigure create figure null else if createdFigure create figure null getDrawing get drawing remove remove Figure figure getAddedFigure get add figure else typingTarget typing target setText set text nothing nothing to to undo undo setUndoActivity set undo activity null typingTarget typing target null textArea text area endOverlay end overlay view view checkDamage check damage public void actionPerformed action perform ActionEvent action event event event endEdit end edit fireToolDone fire tool 