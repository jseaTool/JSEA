StdXMLReader std xml reader java NanoXML nano xml Java $Revision $ revision 1 1 4 4 $ $ $Date $ date 2002 2002 01 01 04 04 21 21 03 03 28 28 $ $ $Name $ name RELEASE r e l e a s e 2 2 2 2 1 1 $ $ This file is is part part of of NanoXML nano xml 2 2 for Java Copyright copyright C c 2000 2000 2002 2002 Marc marc De de Scheemaecker scheemaeck All all Rights right Reserved reserve This software software is is provided provide as a is is without without any any express express or or implied imply warranty warranty In in no no event event will will the the authors author be be held hold liable liable for any any damages damage arising arise from from the the use use of of this software software Permission permission is is granted grant to to anyone anyone to to use use this software software for any any purpose purpose including include commercial commercial applications application and and to to alter alter it it and and redistribute redistribute it it freely freely subject subject to to the the following following restrictions restriction 1 1 The the origin origin of of this software software must must not not be be misrepresented misrepresent you you must must not not claim claim that that you you wrote write the the original original software software If you you use use this software software in in a a product product an an acknowledgment acknowledgment in in the the product product documentation documentation would would be be appreciated appreciate but but is is not not required require 2 2 Altered alter source source versions must must be be plainly plainly marked mark as a such such and and must must not not be be misrepresented misrepresent as a being being the the original original software software 3 3 This notice notice may may not not be be removed remove or or altered alter from from any any source source distribution distribution package net net n3 n3 nanoxml nanoxml import java io io InputStream input stream import java io io InputStreamReader input stream reader import java io io IOException i o import java io io File import java io io FileInputStream input stream import java io io FileNotFoundException not found import java io io LineNumberReader line number reader import java io io PushbackReader pushback reader import java io io PushbackInputStream pushback input stream import java io io Reader reader import java io io StringReader reader import java io io UnsupportedEncodingException unsupport encoding import java net net MalformedURLException malform u r l import java net net URL u r l import java util util Stack stack StdXMLReader std xml reader reads read the the data data to to be be parsed parse author author Marc marc De de Scheemaecker scheemaeck version $Name $ name RELEASE r e l e a s e 2 2 2 2 1 1 $ $ $Revision $ revision 1 1 4 4 $ $ public class StdXMLReader std xml reader implements IXMLReader i xml reader A a stacked stack reader reader author author Marc marc De de Scheemaecker scheemaeck version $Name $ name RELEASE r e l e a s e 2 2 2 2 1 1 $ $ $Revision $ revision 1 1 4 4 $ $ private class StackedReader stack reader PushbackReader pushback reader pbReader pb reader LineNumberReader line number reader lineReader line reader URL u r l systemId String publicId The the stack stack of of readers reader private Stack stack readers reader The the current current push push back back reader reader private StackedReader stack reader currentReader current reader Creates create a a new reader reader using using a a string as a input input param str str the the string containing contain the the XML xml data data public static IXMLReader i xml reader stringReader reader String str str return new StdXMLReader std xml reader new StringReader reader str str Creates create a a new reader reader using using a a file as a input input param filename filename the the name name of of the the file containing contain the the XML xml data data throws java io io FileNotFoundException not found if the the file could could not not be be found found throws java io io IOException i o if an an I i O o error occurred occur public static IXMLReader i xml reader fileReader reader String filename filename throws FileNotFoundException not found IOException i o StdXMLReader std xml reader r r new StdXMLReader std xml reader new FileInputStream input stream filename filename r r setSystemID set filename filename for int i i 0 0 i i r r readers reader size size i++ i++ StackedReader stack reader sr sr StackedReader stack reader r r readers reader elementAt element at i i sr sr systemId r r currentReader current reader systemId return r r Initializes initializ the the reader reader from from a a system and and public ID param publicID the the public ID which which may may be be null param systemID the the non non null system ID throws MalformedURLException malform u r l if the the system ID does doe not not contain contain a a valid valid URL u r l throws FileNotFoundException not found if the the system ID refers refer to to a a local local file which which does doe not not exist throws IOException i o if an an error occurred occur opening opening the the stream stream public StdXMLReader std xml reader String publicID String systemID throws MalformedURLException malform u r l FileNotFoundException not found IOException i o URL u r l systemIDasURL ida u r l null try systemIDasURL ida u r l new URL u r l systemID catch MalformedURLException malform u r l e e systemID file + + systemID try systemIDasURL ida u r l new URL u r l systemID catch MalformedURLException malform u r l e2 e2 throw e e this currentReader current reader new StackedReader stack reader this readers reader new Stack stack Reader reader reader reader this openStream open stream publicID systemIDasURL ida u r l toString to this currentReader current reader lineReader line reader new LineNumberReader line number reader reader reader this currentReader current reader pbReader pb reader new PushbackReader pushback reader this currentReader current reader lineReader line reader 2 2 Initializes initializ the the XML xml reader reader param reader reader the the input input for the the XML xml data data public StdXMLReader std xml reader Reader reader reader reader this currentReader current reader new StackedReader stack reader this readers reader new Stack stack this currentReader current reader lineReader line reader new LineNumberReader line number reader reader reader this currentReader current reader pbReader pb reader new PushbackReader pushback reader this currentReader current reader lineReader line reader 2 2 this currentReader current reader publicId try this currentReader current reader systemId new URL u r l file catch MalformedURLException malform u r l e e never nev happens happen Cleans clean up up the the object when when it it s s destroyed destroy protected void finalize finalize throws Throwable throwable this currentReader current reader lineReader line reader null this currentReader current reader pbReader pb reader null this currentReader current reader systemId null this currentReader current reader publicId null this currentReader current reader null this readers reader clear clear super finalize finalize Scans scan the the encoding encoding from from an an lt lt ?xml ?xml ? ? gt tag tag param str str the the first first tag tag in in the the XML xml data data return the the encoding encoding or or null if no no encoding encoding has ha been be specified specify protected String getEncoding get encoding String str str if str str startsWith start with ?xml ?xml return null int index index 5 5 while index index str str length length StringBuffer buffer key key new StringBuffer buffer while index index str str length length str str charAt at index index index++ index++ while index index str str length length str str charAt at index index a a str str charAt at index index z z key key append append str str charAt at index index index++ index++ while index index str str length length str str charAt at index index index++ index++ if index index str str length length || || str str charAt at index index break while index index str str length length str str charAt at index index \ \ str str charAt at index index index++ index++ if index index str str length length break char delimiter delimit str str charAt at index index index++ index++ int index2 index2 str str indexOf index of delimiter delimit index index if index2 index2 0 0 break if key key toString to equals equal encoding encoding return str str substring substring index index index2 index2 index index index2 index2 + + 1 1 return null Converts convert a a stream stream to to a a reader reader while detecting detecting the the encoding encoding param stream stream the the input input for the the XML xml data data param charsRead read buffer buffer where where to to put put characters character that that have have been be read read throws java io io IOException i o if an an I i O o error occurred occur protected Reader reader stream2reader stream2read InputStream input stream stream stream StringBuffer buffer charsRead read throws IOException i o PushbackInputStream pushback input stream pbstream pbstream new PushbackInputStream pushback input stream stream stream int b b pbstream pbstream read read switch b b case 0x00 0x00 case 0xFE 0x f e case 0xFF 0x f f pbstream pbstream unread unread b b return new InputStreamReader input stream reader pbstream pbstream UTF u t f 16 16 case 0xEF 0x e f for int i i 0 0 i i 2 2 i++ i++ pbstream pbstream read read return new InputStreamReader input stream reader pbstream pbstream UTF u t f 8 8 case 0x3C 0x3 c b b pbstream pbstream read read charsRead read append append while b b 0 0 b b 0x3E 0x3 e charsRead read append append char b b b b pbstream pbstream read read if b b 0 0 charsRead read append append char b b String encoding encoding this getEncoding get encoding charsRead read toString to if encoding encoding null return new InputStreamReader input stream reader pbstream pbstream UTF u t f 8 8 charsRead read setLength set length 0 0 try return new InputStreamReader input stream reader pbstream pbstream encoding encoding catch UnsupportedEncodingException unsupport encoding e e return new InputStreamReader input stream reader pbstream pbstream UTF u t f 8 8 default charsRead read append append char b b return new InputStreamReader input stream reader pbstream pbstream UTF u t f 8 8 Initializes initializ the the XML xml reader reader param stream stream the the input input for the the XML xml data data throws java io io IOException i o if an an I i O o error occurred occur public StdXMLReader std xml reader InputStream input stream stream stream throws IOException i o PushbackInputStream pushback input stream pbstream pbstream new PushbackInputStream pushback input stream stream stream StringBuffer buffer charsRead read new StringBuffer buffer Reader reader reader reader this stream2reader stream2read stream stream charsRead read this currentReader current reader new StackedReader stack reader this readers reader new Stack stack this currentReader current reader lineReader line reader new LineNumberReader line number reader reader reader this currentReader current reader pbReader pb reader new PushbackReader pushback reader this currentReader current reader lineReader line reader 2 2 this currentReader current reader publicId try this currentReader current reader systemId new URL u r l file catch MalformedURLException malform u r l e e never nev happens happen this startNewStream start stream new StringReader reader charsRead read toString to Reads read a a character character return the the character character throws java io io IOException i o if no no character character could could be be read read public char read read throws IOException i o int ch ch this currentReader current reader pbReader pb reader read read while ch ch 0 0 if this readers reader empty empty throw new IOException i o Unexpected unexpect EOF e o f this currentReader current reader pbReader pb reader close close this currentReader current reader StackedReader stack reader this readers reader pop pop ch ch this currentReader current reader pbReader pb reader read read return char ch ch Returns true if the the current current stream stream has ha no no more more characters character left left to to be be read read throws java io io IOException i o if an an I i O o error occurred occur public boolean atEOFOfCurrentStream at e o f of current stream throws IOException i o int ch ch this currentReader current reader pbReader pb reader read read if ch ch 0 0 return true else this currentReader current reader pbReader pb reader unread unread ch ch return false Returns true if there there are are no no more more characters character left left to to be be read read throws java io io IOException i o if an an I i O o error occurred occur public boolean atEOF at e o f throws IOException i o int ch ch this currentReader current reader pbReader pb reader read read while ch ch 0 0 if this readers reader empty empty return true this currentReader current reader pbReader pb reader close close this currentReader current reader StackedReader stack reader this readers reader pop pop ch ch this currentReader current reader pbReader pb reader read read this currentReader current reader pbReader pb reader unread unread ch ch return false Pushes push the the last last character character read read back back to to the the stream stream param ch ch the the character character to to push push back back throws java io io IOException i o if an an I i O o error occurred occur public void unread unread char ch ch throws IOException i o this currentReader current reader pbReader pb reader unread unread ch ch Opens open a a stream stream from from a a public and and system ID param publicID the the public ID which which may may be be null param systemID the the system ID which which is is never nev null throws java net net MalformedURLException malform u r l if the the system ID does doe not not contain contain a a valid valid URL u r l throws java io io FileNotFoundException not found if the the system ID refers refer to to a a local local file which which does doe not not exist throws java io io IOException i o if an an error occurred occur opening opening the the stream stream public Reader reader openStream open stream String publicID String systemID throws MalformedURLException malform u r l FileNotFoundException not found IOException i o URL u r l url url new URL u r l this currentReader current reader systemId systemID if url url getRef get ref null String ref ref url url getRef get ref if url url getFile get length length 0 0 url url new URL u r l url url getProtocol get protocol url url getHost get host url url getPort get port url url getFile get url url new URL u r l jar jar + + url url + + + + ref ref else url url StdXMLReader std xml reader class getResource get resource ref ref this currentReader current reader publicId publicID this currentReader current reader systemId url url StringBuffer buffer charsRead read new StringBuffer buffer Reader reader reader reader this stream2reader stream2read url url openStream open stream charsRead read if charsRead read length length 0 0 return reader reader String charsReadStr read str charsRead read toString to PushbackReader pushback reader pbreader pbread new PushbackReader pushback reader reader reader charsReadStr read str length length for int i i charsReadStr read str length length 1 1 i i 0 0 i i pbreader pbread unread unread charsReadStr read str charAt at i i return pbreader pbread Starts start a a new stream stream from from a a Java reader reader The the new stream stream is is used use temporary temporary to to read read data data from from If that that stream stream is is exhausted exhaust control control returns to to the the parent parent stream stream param reader reader the the non non null reader reader to to read read the the new data data from from public void startNewStream start stream Reader reader reader reader this startNewStream start stream reader reader false Starts start a a new stream stream from from a a Java reader reader The the new stream stream is is used use temporary temporary to to read read data data from from If that that stream stream is is exhausted exhaust control control returns to to the the parent parent stream stream param reader reader the the non non null reader reader to to read read the the new data data from from param isInternalEntity is internal entity true if the the reader reader is is produced produce by by resolving resolving an an internal internal entity entity public void startNewStream start stream Reader reader reader reader boolean isInternalEntity is internal entity StackedReader stack reader oldReader old reader this currentReader current reader this readers reader push push this currentReader current reader this currentReader current reader new StackedReader stack reader if isInternalEntity is internal entity this currentReader current reader lineReader line reader null this currentReader current reader pbReader pb reader new PushbackReader pushback reader reader reader 2 2 else this currentReader current reader lineReader line reader new LineNumberReader line number reader reader reader this currentReader current reader pbReader pb reader new PushbackReader pushback reader this currentReader current reader lineReader line reader 2 2 this currentReader current reader systemId oldReader old reader systemId this currentReader current reader publicId oldReader old reader publicId Returns the the current current level level of of the the stream stream on on the the stack stack of of streams stream public int getStreamLevel get stream level return this readers reader size size Returns the the line line number number of of the the data data in in the the current current stream stream public int getLineNr get line nr if this currentReader current reader lineReader line reader null StackedReader stack reader sr sr StackedReader stack reader this readers reader peek peek if sr sr lineReader line reader null return 0 0 else return sr sr lineReader line reader getLineNumber get line number + + 1 1 return this currentReader current reader lineReader line reader getLineNumber get line number + + 1 1 Sets set the the system ID of of the the current current stream stream param systemID the the system ID throws java net net MalformedURLException malform u r l if the the system ID does doe not not contain contain a a valid valid URL u r l public void setSystemID set String systemID throws MalformedURLException malform u r l this currentReader current reader systemId new URL u r l this currentReader current reader systemId systemID Sets set the the public ID of of the the current current stream stream param publicID the the public ID public void setPublicID set String publicID this currentReader current reader publicId publicID Returns the the current current system ID public String getSystemID get return this currentReader current reader systemId toString to Returns the the current current public ID public String getPublicID get return this currentReader current reader publicId 