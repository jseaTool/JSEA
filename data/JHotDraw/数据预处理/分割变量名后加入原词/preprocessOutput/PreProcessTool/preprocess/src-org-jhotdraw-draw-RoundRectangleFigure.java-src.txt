RoundRectangleFigure round rectangle figure java 2 2 2 2 2006 2006 06 06 17 17 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org package org org jhotdraw jhotdraw draw draw import java awt awt import java awt awt geom geom import java io io import java util util import javax javax swing swing undo undo import static org org jhotdraw jhotdraw draw draw AttributeKeys attribute key import org org jhotdraw jhotdraw geom geom import org org jhotdraw jhotdraw xml xml DOMInput dom input import org org jhotdraw jhotdraw xml xml DOMOutput dom output A a Rectangle2D rectangle2 d Double with with round round corners corner author author Werner wern Randelshofer randelshof version 2 2 2 2 2006 2006 06 06 17 17 Method chop chop added add 2 2 1 1 2006 2006 05 05 29 29 Method basicSetBounds basic set bound did not not work work for bounds bound smaller small than than 1 1 pixel pixel br 2 2 0 0 2006 2006 01 01 14 14 Changed change to to support support double precison coordinates coordinate br 1 1 0 0 2004 2004 03 03 02 02 Derived derive from from JHotDraw jhotdraw 6 6 0b1 0b1 public class RoundRectangleFigure round rectangle figure extends AttributedFigure attribute figure private RoundRectangle2D round rectangle2 d Double roundrect roundrect private static final double DEFAULT d e f a u l t ARC a r c 20 20 Creates create a a new instance instance public RoundRectangleFigure round rectangle figure this 0 0 0 0 0 0 0 0 public RoundRectangleFigure round rectangle figure double x x double y y double width width double height height roundrect roundrect new RoundRectangle2D round rectangle2 d Double x x y y width width height height DEFAULT d e f a u l t ARC a r c DEFAULT d e f a u l t ARC a r c FILL f i l l COLOR c o l o r set set this Color color white white STROKE s t r o k e COLOR c o l o r set set this Color color black black public Rectangle2D rectangle2 d Double getBounds get bound return Rectangle2D rectangle2 d Double roundrect roundrect getBounds2D get bounds2 d public Rectangle2D rectangle2 d Double getFigureDrawBounds get figure draw bound Rectangle2D rectangle2 d Double r r Rectangle2D rectangle2 d Double roundrect roundrect getBounds2D get bounds2 d double grow grow AttributeKeys attribute key getPerpendicularHitGrowth get perpendicular hit growth this Geom geom grow grow r r grow grow grow grow return r r public double getArcWidth get arc width return roundrect roundrect arcwidth arcwidth public double getArcHeight get arc height return roundrect roundrect archeight archeight public void setArc set arc final double w w final double h h final double oldWidth old width roundrect roundrect getArcWidth get arc width final double oldHeight old height roundrect roundrect getArcHeight get arc height roundrect roundrect arcwidth arcwidth w w roundrect roundrect archeight archeight h h fireFigureChanged fire figure change getDrawBounds get draw bound fireUndoableEditHappened fire undoable edit happen new AbstractUndoableEdit undoable edit public String getPresentationName get presentation name return Rundung rundung public void undo undo throws CannotUndoException cannot undo super undo undo willChange will change roundrect roundrect arcwidth arcwidth oldWidth old width roundrect roundrect archeight archeight oldHeight old height changed change public void redo redo throws CannotRedoException cannot redo super redo redo willChange will change roundrect roundrect arcwidth arcwidth w w roundrect roundrect archeight archeight h h changed change protected void drawFill draw fill Graphics2D graphics2 d g g RoundRectangle2D round rectangle2 d Double r r RoundRectangle2D round rectangle2 d Double roundrect roundrect clone clone double grow grow AttributeKeys attribute key getPerpendicularFillGrowth get perpendicular fill growth this r r x x grow grow r r y y grow grow r r width width + + grow grow 2 2 r r height height + + grow grow 2 2 r r arcwidth arcwidth + + grow grow 2 2 r r archeight archeight + + grow grow 2 2 if r r width width 0 0 r r height height 0 0 g g fill fill r r protected void drawStroke draw stroke Graphics2D graphics2 d g g RoundRectangle2D round rectangle2 d Double r r RoundRectangle2D round rectangle2 d Double roundrect roundrect clone clone double grow grow AttributeKeys attribute key getPerpendicularDrawGrowth get perpendicular draw growth this r r x x grow grow r r y y grow grow r r width width + + grow grow 2 2 r r height height + + grow grow 2 2 r r arcwidth arcwidth + + grow grow 2 2 r r archeight archeight + + grow grow 2 2 if r r width width 0 0 r r height height 0 0 g g draw draw r r Checks check if a a Point2D point2 d Double is is inside inside the the figure figure public boolean contains contain Point2D point2 d Double p p RoundRectangle2D round rectangle2 d Double r r RoundRectangle2D round rectangle2 d Double roundrect roundrect clone clone double grow grow AttributeKeys attribute key getPerpendicularHitGrowth get perpendicular hit growth this r r x x grow grow r r y y grow grow r r width width + + grow grow 2 2 r r height height + + grow grow 2 2 r r arcwidth arcwidth + + grow grow 2 2 r r archeight archeight + + grow grow 2 2 return r r contains contain p p public void basicSetBounds basic set bound Point2D point2 d Double anchor anchor Point2D point2 d Double lead roundrect roundrect x x Math math min min anchor anchor x x lead x x roundrect roundrect y y Math math min min anchor anchor y y lead y y roundrect roundrect width width Math math max max 0 0 1 1 Math math abs ab lead x x anchor anchor x x roundrect roundrect height height Math math max max 0 0 1 1 Math math abs ab lead y y anchor anchor y y Transforms transform the the figure figure param tx tx The the transformation transformation public void basicTransform basic transform AffineTransform affine transform tx tx Point2D point2 d Double anchor anchor getStartPoint get start point Point2D point2 d Double lead getEndPoint get end point basicSetBounds basic set bound Point2D point2 d Double tx tx transform transform anchor anchor anchor anchor Point2D point2 d Double tx tx transform transform lead lead public Collection collection Handle handle createHandles create handle int detailLevel detail level LinkedList link list Handle handle handles handle LinkedList link list Handle handle super createHandles create handle detailLevel detail level handles handle add add new RoundRectRadiusHandle round rect radius handle this return handles handle public Connector connector findConnector find connector Point2D point2 d Double p p ConnectionFigure connection figure prototype prototype return new ChopRoundRectConnector chop round rect connector this public Connector connector findCompatibleConnector find compatible connector Connector connector c c boolean isStartConnector is start connector return new ChopRoundRectConnector chop round rect connector this public RoundRectangleFigure round rectangle figure clone clone RoundRectangleFigure round rectangle figure that that RoundRectangleFigure round rectangle figure super clone clone that that roundrect roundrect RoundRectangle2D round rectangle2 d Double this roundrect roundrect clone clone return that that Override override public void read read DOMInput dom input in in throws IOException i o super read read in in roundrect roundrect arcwidth arcwidth in in getAttribute get attribute arcWidth arc width DEFAULT d e f a u l t ARC a r c roundrect roundrect archeight archeight in in getAttribute get attribute arcHeight arc height DEFAULT d e f a u l t ARC a r c Override override public void write write DOMOutput dom output out out throws IOException i o super write write out out out out addAttribute add attribute arcWidth arc width roundrect roundrect arcwidth arcwidth out out addAttribute add attribute arcHeight arc height roundrect roundrect archeight archeight public void restoreTo restore to Object geometry geometry RoundRectangle2D round rectangle2 d Double r r RoundRectangle2D round rectangle2 d Double geometry geometry roundrect roundrect x x r r x x roundrect roundrect y y r r y y roundrect roundrect width width r r width width roundrect roundrect height height r r height height public Object getRestoreData get restore data return roundrect roundrect clone clone public Point2D point2 d Double chop chop Point2D point2 d Double from from Rectangle2D rectangle2 d Double outer out getBounds get bound double grow grow switch STROKE s t r o k e PLACEMENT p l a c e m e n t get get this case CENTER c e n t e r default grow grow AttributeKeys attribute key getStrokeTotalWidth get stroke total width this 2 2 break case OUTSIDE o u t s e grow grow AttributeKeys attribute key getStrokeTotalWidth get stroke total width this break case INSIDE i n s e grow grow 0 0 break outer out x x grow grow outer out y y grow grow outer out width width + + grow grow 2 2 outer out height height + + grow grow 2 2 Rectangle2D rectangle2 d Double inner inner Rectangle2D rectangle2 d Double outer out clone clone double gw gw getArcWidth get arc width + + grow grow 2 2 2 2 double gh gh getArcHeight get arc height + + grow grow 2 2 2 2 inner inner x x gw gw inner inner y y gh gh inner inner width width + + gw gw 2 2 inner inner height height + + gh gh 2 2 double angle angle Geom geom pointToAngle point to angle outer out from from Point2D point2 d Double p p Geom geom angleToPoint angle to point outer out Geom geom pointToAngle point to angle outer out from from if p p x x outer out x x || || p p x x outer out x x + + outer out width width p p y y Math math min min Math math max max p p y y inner inner y y inner inner y y + + inner inner height height else p p x x Math math min min Math math max max p p x x inner inner x x inner inner x x + + inner inner width width return p p 