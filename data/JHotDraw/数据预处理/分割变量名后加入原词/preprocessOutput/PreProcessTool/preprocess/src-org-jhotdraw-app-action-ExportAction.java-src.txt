ExportAction export action java 1 1 0 0 2006 2006 04 04 07 07 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org package org org jhotdraw jhotdraw app app action action import org org jhotdraw jhotdraw gui gui import org org jhotdraw jhotdraw gui gui event event import org org jhotdraw jhotdraw util util import java awt awt import java awt awt event event import javax javax swing swing import java io io import org org jhotdraw jhotdraw app app Application application import org org jhotdraw jhotdraw app app Project project ExportAction export action p p This action action requires require that that the the project project has ha the the following following additional additional methods pre pre public JFileChooser j chooser getExportChooser get export chooser By by convention convention this method is is never nev invoked on on the the AWT a w t Event event Dispatcher dispatcher Thread thread public void export export File f f javax javax swing swing filechooser filechoos FileFilter filter filter filter Component component accessory accessory throws IOException i o pre pre author author Werner wern Randelshofer randelshof version 1 1 0 0 2006 2006 04 04 07 07 Created create public class ExportAction export action extends AbstractProjectAction project action public final static String ID export export private Component component oldFocusOwner old focus owner Creates create a a new instance instance public ExportAction export action Application application app app super app app ResourceBundleUtil resource bundle util labels label ResourceBundleUtil resource bundle util getLAFBundle get l a f bundle org org jhotdraw jhotdraw app app Labels label labels label configureAction configure action this ID private JFileChooser j chooser getExportChooser get export chooser Project project project project try return JFileChooser j chooser Methods invoke project project getExportChooser get export chooser catch Throwable throwable e e InternalError internal error new InternalError internal Project project does doe not not support support exporting exporting error initCause init cause e e throw error public void actionPerformed action perform ActionEvent action event evt evt final Project project project project getCurrentProject get current project if project project isEnabled is enable ResourceBundleUtil resource bundle util labels label ResourceBundleUtil resource bundle util getLAFBundle get l a f bundle org org jhotdraw jhotdraw app app Labels label oldFocusOwner old focus owner SwingUtilities swing utility getWindowAncestor get window ancestor project project getComponent get component getFocusOwner get focus owner project project setEnabled set enable false File saveToFile save to JFileChooser j chooser fileChooser chooser getExportChooser get export chooser project project JSheet j sheet showSheet show sheet fileChooser chooser project project getComponent get component labels label getString get filechooser filechoos export export new SheetListener sheet listener public void optionSelected option select final SheetEvent sheet event evt evt if evt evt getOption get option JFileChooser j chooser APPROVE a p p r o v e OPTION o p t i o n final File file evt evt getFileChooser get chooser getSelectedFile get select exportToFile export to project project file evt evt getFileChooser get chooser getFileFilter get filter evt evt getFileChooser get chooser getAccessory get accessory else project project setEnabled set enable true if oldFocusOwner old focus owner null oldFocusOwner old focus owner requestFocus request focus protected void exportToFile export to final Project project project project final File file final javax javax swing swing filechooser filechoos FileFilter filter filter filter final Component component accessory accessory project project execute execute new Worker worker public Object construct construct try Methods invoke project project export export new Class File class javax javax swing swing filechooser filechoos FileFilter filter class Component component class file filter filter accessory accessory return null catch InternalError internal e e return e e getCause get cause null ? ? e e getCause get cause e e catch Throwable throwable e e return e e public void finished finish Object value value fileExported export project project file value value protected void fileExported export Project project project project File file Object value value if value value null project project setFile set file project project markChangesAsSaved mark change a save int multiOpenId multi open 1 1 for Project project p p project project getApplication get application documents document if p p project project p p getFile get null p p getFile get equals equal file multiOpenId multi open Math math max max multiOpenId multi open p p getMultipleOpenId get multiple open + + 1 1 project project setMultipleOpenId set multiple open multiOpenId multi open else System out out flush flush Throwable throwable value value printStackTrace print stack trace FIXME f i x m e localize localize this error messsage messsage JSheet j sheet showMessageSheet show message sheet project project getComponent get component html html +UIManager + u i manager getString get OptionPane option pane css cs + + b b Couldn couldn t t export export to to the the file \ \ +file+ +file+ \ \ p p + + Reason reason +value +value JOptionPane j option pane ERROR e r r o r MESSAGE m e s s a g e project project setEnabled set enable true SwingUtilities swing utility getWindowAncestor get window ancestor project project getComponent get component toFront to front if oldFocusOwner old focus owner null oldFocusOwner old focus owner requestFocus request focus 