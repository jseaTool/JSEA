UndoRedoManager undo redo manager java 1 1 3 3 1 1 2006 2006 04 04 12 12 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org package org org jhotdraw jhotdraw undo undo import java awt awt event event import java beans bean import javax javax swing swing import javax javax swing swing event event import javax javax swing swing undo undo import java util util import org org jhotdraw jhotdraw util util Same same as a javax javax swing swing UndoManager undo manager but but provides provide actions action for undo undo and and redo redo operations operation author author Werner wern Randelshofer randelshof version 1 1 3 3 1 1 2006 2006 04 04 12 12 Method setLocale set locale added add br 1 1 3 3 2006 2006 02 02 28 28 Support support for PropertyChangeListener property change listener added add br 1 1 2 2 2 2 2006 2006 02 02 25 25 Configure configure actions action from from resource resource bundle bundle br 1 1 2 2 1 1 2003 2003 11 11 02 02 Adapted adapt to to changes change in in ResourceBundleUtil resource bundle util br 1 1 2 2 2003 2003 03 03 16 16 Texts text and and accelerator accelerator keys key are are now now read read from from a a resource resource bundle bundle br 1 1 1 1 2 2 2003 2003 03 03 12 12 Actions action use use now now KeyStroke key stroke objects instead instead of of String objects as a accelerator accelerator keys key br 1 1 1 1 1 1 2002 2002 05 05 10 10 Method addEdit add edit is is now now smarter smart when when determining determine whether wheth an an edit edit is is significant significant br 1 1 1 1 2002 2002 04 04 08 08 Method hasSignificantEdits ha significant edit clearChanged clear change added add br 1 1 0 0 2001 2001 10 10 09 09 public class UndoRedoManager undo redo manager extends UndoManager undo manager javax javax swing swing undo undo UndoManager undo manager protected PropertyChangeSupport property change support propertySupport property support new PropertyChangeSupport property change support this private final static boolean DEBUG d e b u g false The the resource resource bundle bundle used use for internationalisation internationalisation private static ResourceBundleUtil resource bundle util labels label This flag flag is is set set to to true when when at at least least one one significant significant UndoableEdit undoable edit has ha been be added add to to the the manager manager since since the the last last call call to to discardAllEdits discard all edit private boolean hasSignificantEdits ha significant edit false This flag flag is is set set to to true when when an an undo undo or or redo redo operation operation is is in in progress progress The the UndoRedoManager undo redo manager ignores ignore all all incoming incoming UndoableEdit undoable edit events event while this flag flag is is true private boolean undoOrRedoInProgress undo or redo in progress Sending sending this UndoableEdit undoable edit event event to to the the UndoRedoManager undo redo manager disables disable the the Undo undo and and Redo redo functions function of of the the manager manager public final static UndoableEdit undoable edit DISCARD d i s c a r d ALL a l l EDITS e d i t s new AbstractUndoableEdit undoable edit public boolean canUndo can undo return false public boolean canRedo can redo return false Undo undo Action action for use use in in a a menu menu bar bar private class UndoAction undo action extends AbstractAction action public UndoAction undo action labels label configureAction configure action this undo undo setEnabled set enable false Invoked when when an an action action occurs occur public void actionPerformed action perform ActionEvent action event evt evt try undo undo catch CannotUndoException cannot undo e e System err err println Cannot cannot undo undo +e +e e e printStackTrace print stack trace Redo redo Action action for use use in in a a menu menu bar bar private class RedoAction redo action extends AbstractAction action public RedoAction redo action labels label configureAction configure action this redo redo setEnabled set enable false Invoked when when an an action action occurs occur public void actionPerformed action perform ActionEvent action event evt evt try redo redo catch CannotRedoException cannot redo e e System out out println Cannot cannot redo redo +e +e The the undo undo action action instance instance private UndoAction undo action undoAction undo action The the redo redo action action instance instance private RedoAction redo action redoAction redo action public static ResourceBundleUtil resource bundle util getLabels get label if labels label null labels label ResourceBundleUtil resource bundle util getLAFBundle get l a f bundle org org jhotdraw jhotdraw undo undo Labels label return labels label Creates create new UndoRedoManager undo redo manager public UndoRedoManager undo redo manager getLabels get label undoAction undo action new UndoAction undo action redoAction redo action new RedoAction redo action public void setLocale set locale Locale locale l l labels label ResourceBundleUtil resource bundle util getLAFBundle get l a f bundle org org jhotdraw jhotdraw undo undo Labels label l l Discards discard all all edits edit public void discardAllEdits discard all edit super discardAllEdits discard all edit updateActions update action setHasSignificantEdits set ha significant edit false public void setHasSignificantEdits set ha significant edit boolean newValue value boolean oldValue old value hasSignificantEdits ha significant edit hasSignificantEdits ha significant edit newValue value firePropertyChange fire property change hasSignificantEdits ha significant edit oldValue old value newValue value Returns true if at at least least one one significant significant UndoableEdit undoable edit has ha been be added add since since the the last last call call to to discardAllEdits discard all edit public boolean hasSignificantEdits ha significant edit return hasSignificantEdits ha significant edit If inProgress in progress inserts insert anEdit an edit at at indexOfNextAdd index of next add and and removes remove any any old old edits edit that that were be at at indexOfNextAdd index of next add or or later late The the die die method is is called call on on each each edit edit that that is is removed remove is is sent sent in in the the reverse reverse of of the the order order the the edits edit were be added add Updates update indexOfNextAdd index of next add p p If not not inProgress in progress acts act as a a a CompoundEdit compound edit p p p p Regardless regardles of of inProgress in progress if undoOrRedoInProgress undo or redo in progress calls call die die on on each each edit edit that that is is sent sent p p see see CompoundEdit compound edit end end see see CompoundEdit compound edit addEdit add edit public boolean addEdit add edit UndoableEdit undoable edit anEdit an edit if DEBUG d e b u g System out out println UndoRedoManager undo redo manager add add +anEdit +an edit if undoOrRedoInProgress undo or redo in progress anEdit an edit die die return true boolean success success super addEdit add edit anEdit an edit updateActions update action if success success anEdit an edit isSignificant is significant editToBeUndone edit to be undo anEdit an edit setHasSignificantEdits set ha significant edit true return success success Gets get the the undo undo action action for use use as a an an Undo undo menu menu item item public Action action getUndoAction get undo action return undoAction undo action Gets get the the redo redo action action for use use as a a a Redo redo menu menu item item public Action action getRedoAction get redo action return redoAction redo action Updates update the the properties property of of the the UndoAction undo action and and of of the the RedoAction redo action private void updateActions update action String label label if DEBUG d e b u g System out out println UndoManager undo manager updateActions update action + + editToBeUndone edit to be undo + + canUndo can undo +canUndo +can undo + + canRedo can redo +canRedo +can redo if canUndo can undo undoAction undo action setEnabled set enable true label label getUndoPresentationName get undo presentation name else undoAction undo action setEnabled set enable false label label labels label getString get undo undo undoAction undo action putValue put value Action action NAME n a m e label label undoAction undo action putValue put value Action action SHORT s h o r t DESCRIPTION d e s c r i p t i o n label label if canRedo can redo redoAction redo action setEnabled set enable true label label getRedoPresentationName get redo presentation name else redoAction redo action setEnabled set enable false label label labels label getString get redo redo redoAction redo action putValue put value Action action NAME n a m e label label redoAction redo action putValue put value Action action SHORT s h o r t DESCRIPTION d e s c r i p t i o n label label Undoes undoe the the last last edit edit event event The the UndoRedoManager undo redo manager ignores ignore all all incoming incoming UndoableEdit undoable edit events event while undo undo is is in in progress progress public void undo undo throws CannotUndoException cannot undo undoOrRedoInProgress undo or redo in progress true try super undo undo finally undoOrRedoInProgress undo or redo in progress false updateActions update action Redoes redoe the the last last undone undo edit edit event event The the UndoRedoManager undo redo manager ignores ignore all all incoming incoming UndoableEdit undoable edit events event while redo redo is is in in progress progress public void redo redo throws CannotUndoException cannot undo undoOrRedoInProgress undo or redo in progress true try super redo redo finally undoOrRedoInProgress undo or redo in progress false updateActions update action Undoes undoe or or redoes redoe the the last last edit edit event event The the UndoRedoManager undo redo manager ignores ignore all all incoming incoming UndoableEdit undoable edit events event while undo undo or or redo redo is is in in progress progress public void undoOrRedo undo or redo throws CannotUndoException cannot undo CannotRedoException cannot redo undoOrRedoInProgress undo or redo in progress true try super undoOrRedo undo or redo finally undoOrRedoInProgress undo or redo in progress false updateActions update action public void addPropertyChangeListener add property change listener PropertyChangeListener property change listener listener listener propertySupport property support addPropertyChangeListener add property change listener listener listener public void addPropertyChangeListener add property change listener String propertyName property name PropertyChangeListener property change listener listener listener propertySupport property support addPropertyChangeListener add property change listener propertyName property name listener listener public void removePropertyChangeListener remove property change listener PropertyChangeListener property change listener listener listener propertySupport property support removePropertyChangeListener remove property change listener listener listener public void removePropertyChangeListener remove property change listener String propertyName property name PropertyChangeListener property change listener listener listener propertySupport property support removePropertyChangeListener remove property change listener propertyName property name listener listener protected void firePropertyChange fire property change String propertyName property name boolean oldValue old value boolean newValue value propertySupport property support firePropertyChange fire property change propertyName property name oldValue old value newValue value protected void firePropertyChange fire property change String propertyName property name int oldValue old value int newValue value propertySupport property support firePropertyChange fire property change propertyName property name oldValue old value newValue value protected void firePropertyChange fire property change String propertyName property name Object oldValue old value Object newValue value propertySupport property support firePropertyChange fire property change propertyName property name oldValue old value newValue value 