SVGUtils s v g util java 1 1 0 0 July july 8 8 2006 2006 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org package org org jhotdraw jhotdraw samples sample svg svg import java awt awt Color color import java awt awt geom geom import java io io import java util util import javax javax swing swing import org org jhotdraw jhotdraw draw draw import org org jhotdraw jhotdraw geom geom import org org jhotdraw jhotdraw samples sample svg svg figures figure import org org jhotdraw jhotdraw xml xml import static org org jhotdraw jhotdraw draw draw AttributeKeys attribute key SVGUtils s v g util author author Werner wern Randelshofer randelshof version 1 1 0 0 July july 8 8 2006 2006 Created create public class SVGUtil s v g util private final static Color color INHERIT i n h e r i t COLOR c o l o r new Color color 0xffff00 0xffff00 private final static Color color CURRENT c u r r e n t COLOR c o l o r new Color color 0xffff00 0xffff00 public final static Map map String Color color SVG s v g COLORS c o l o r s static LinkedHashMap link hash map String Color color map map new LinkedHashMap link hash map String Color color SVG s v g 1 1 2 2 Tiny tiny colors color map map put put black black new Color color 0 0 0 0 0 0 map map put put green green new Color color 0 0 128 128 0 0 map map put put silver silver new Color color 192 192 192 192 192 192 map map put put lime lime new Color color 0 0 255 255 0 0 map map put put gray gray new Color color 128 128 128 128 128 128 map map put put olive olive new Color color 128 128 128 128 0 0 map map put put white white new Color color 255 255 255 255 255 255 map map put put yellow yellow new Color color 255 255 255 255 0 0 map map put put maroon maroon new Color color 128 128 0 0 0 0 map map put put navy navy new Color color 0 0 0 0 128 128 map map put put red red new Color color 255 255 0 0 0 0 map map put put blue blue new Color color 0 0 0 0 255 255 map map put put purple purple new Color color 128 128 0 0 128 128 map map put put teal teal new Color color 0 0 128 128 128 128 map map put put fuchsia fuchsia new Color color 255 255 0 0 255 255 map map put put aqua aqua new Color color 0 0 255 255 255 255 SVG s v g 1 1 1 1 colors color map map put put aliceblue aliceblue new Color color 240 240 248 248 255 255 map map put put antiquewhite antiquewhite new Color color 250 250 235 235 215 215 map map put put aqua aqua new Color color 0 0 255 255 255 255 map map put put aquamarine aquamarine new Color color 127 127 255 255 212 212 map map put put azure azure new Color color 240 240 255 255 255 255 map map put put beige beige new Color color 245 245 245 245 220 220 map map put put bisque bisque new Color color 255 255 228 228 196 196 map map put put black black new Color color 0 0 0 0 0 0 map map put put blanchedalmond blanchedalmond new Color color 255 255 235 235 205 205 map map put put blue blue new Color color 0 0 0 0 255 255 map map put put blueviolet blueviolet new Color color 138 138 43 43 226 226 map map put put brown brown new Color color 165 165 42 42 42 42 map map put put burlywood burlywood new Color color 222 222 184 184 135 135 map map put put cadetblue cadetblue new Color color 95 95 158 158 160 160 map map put put chartreuse chartreuse new Color color 127 127 255 255 0 0 map map put put chocolate chocolate new Color color 210 210 105 105 30 30 map map put put coral coral new Color color 255 255 127 127 80 80 map map put put cornflowerblue cornflowerblue new Color color 100 100 149 149 237 237 map map put put cornsilk cornsilk new Color color 255 255 248 248 220 220 map map put put crimson crimson new Color color 220 220 20 20 60 60 map map put put cyan cyan new Color color 0 0 255 255 255 255 map map put put darkblue darkblue new Color color 0 0 0 0 139 139 map map put put darkcyan darkcyan new Color color 0 0 139 139 139 139 map map put put darkgoldenrod darkgoldenrod new Color color 184 184 134 134 11 11 map map put put darkgray darkgray new Color color 169 169 169 169 169 169 map map put put darkgreen darkgreen new Color color 0 0 100 100 0 0 map map put put darkgrey darkgrey new Color color 169 169 169 169 169 169 map map put put darkkhaki darkkhaki new Color color 189 189 183 183 107 107 map map put put darkmagenta darkmagenta new Color color 139 139 0 0 139 139 map map put put darkolivegreen darkolivegreen new Color color 85 85 107 107 47 47 map map put put darkorange darkorange new Color color 255 255 140 140 0 0 map map put put darkorchid darkorchid new Color color 153 153 50 50 204 204 map map put put darkred darkr new Color color 139 139 0 0 0 0 map map put put darksalmon darksalmon new Color color 233 233 150 150 122 122 map map put put darkseagreen darkseagreen new Color color 143 143 188 188 143 143 map map put put darkslateblue darkslateblue new Color color 72 72 61 61 139 139 map map put put darkslategray darkslategray new Color color 47 47 79 79 79 79 map map put put darkslategrey darkslategrey new Color color 47 47 79 79 79 79 map map put put darkturquoise darkturquoise new Color color 0 0 206 206 209 209 map map put put darkviolet darkviolet new Color color 148 148 0 0 211 211 map map put put deeppink deeppink new Color color 255 255 20 20 147 147 map map put put deepskyblue deepskyblue new Color color 0 0 191 191 255 255 map map put put dimgray dimgray new Color color 105 105 105 105 105 105 map map put put dimgrey dimgrey new Color color 105 105 105 105 105 105 map map put put dodgerblue dodgerblue new Color color 30 30 144 144 255 255 map map put put firebrick firebrick new Color color 178 178 34 34 34 34 map map put put floralwhite floralwhite new Color color 255 255 250 250 240 240 map map put put forestgreen forestgreen new Color color 34 34 139 139 34 34 map map put put fuchsia fuchsia new Color color 255 255 0 0 255 255 map map put put gainsboro gainsboro new Color color 220 220 220 220 220 220 map map put put ghostwhite ghostwhite new Color color 248 248 248 248 255 255 map map put put gold gold new Color color 255 255 215 215 0 0 map map put put goldenrod goldenrod new Color color 218 218 165 165 32 32 map map put put gray gray new Color color 128 128 128 128 128 128 map map put put grey grey new Color color 128 128 128 128 128 128 map map put put green green new Color color 0 0 128 128 0 0 map map put put greenyellow greenyellow new Color color 173 173 255 255 47 47 map map put put honeydew honeydew new Color color 240 240 255 255 240 240 map map put put hotpink hotpink new Color color 255 255 105 105 180 180 map map put put indianred indianr new Color color 205 205 92 92 92 92 map map put put indigo indigo new Color color 75 75 0 0 130 130 map map put put ivory ivory new Color color 255 255 255 255 240 240 map map put put khaki khaki new Color color 240 240 230 230 140 140 map map put put lavender lavender new Color color 230 230 230 230 250 250 map map put put lavenderblush lavenderblush new Color color 255 255 240 240 245 245 map map put put lawngreen lawngreen new Color color 124 124 252 252 0 0 map map put put lemonchiffon lemonchiffon new Color color 255 255 250 250 205 205 map map put put lightblue lightblue new Color color 173 173 216 216 230 230 map map put put lightcoral lightcoral new Color color 240 240 128 128 128 128 map map put put lightcyan lightcyan new Color color 224 224 255 255 255 255 map map put put lightgoldenrodyellow lightgoldenrodyellow new Color color 250 250 250 250 210 210 map map put put lightgray lightgray new Color color 211 211 211 211 211 211 map map put put lightgreen lightgreen new Color color 144 144 238 238 144 144 map map put put lightgrey lightgrey new Color color 211 211 211 211 211 211 map map put put lightpink lightpink new Color color 255 255 182 182 193 193 map map put put lightsalmon lightsalmon new Color color 255 255 160 160 122 122 map map put put lightseagreen lightseagreen new Color color 32 32 178 178 170 170 map map put put lightskyblue lightskyblue new Color color 135 135 206 206 250 250 map map put put lightslategray lightslategray new Color color 119 119 136 136 153 153 map map put put lightslategrey lightslategrey new Color color 119 119 136 136 153 153 map map put put lightsteelblue lightsteelblue new Color color 176 176 196 196 222 222 map map put put lightyellow lightyellow new Color color 255 255 255 255 224 224 map map put put lime lime new Color color 0 0 255 255 0 0 map map put put limegreen limegreen new Color color 50 50 205 205 50 50 map map put put linen linen new Color color 250 250 240 240 230 230 map map put put magenta magenta new Color color 255 255 0 0 255 255 map map put put maroon maroon new Color color 128 128 0 0 0 0 map map put put mediumaquamarine mediumaquamarine new Color color 102 102 205 205 170 170 map map put put mediumblue mediumblue new Color color 0 0 0 0 205 205 map map put put mediumorchid mediumorchid new Color color 186 186 85 85 211 211 map map put put mediumpurple mediumpurple new Color color 147 147 112 112 219 219 map map put put mediumseagreen mediumseagreen new Color color 60 60 179 179 113 113 map map put put mediumslateblue mediumslateblue new Color color 123 123 104 104 238 238 map map put put mediumspringgreen mediumspringgreen new Color color 0 0 250 250 154 154 map map put put mediumturquoise mediumturquoise new Color color 72 72 209 209 204 204 map map put put mediumvioletred mediumvioletr new Color color 199 199 21 21 133 133 map map put put midnightblue midnightblue new Color color 25 25 25 25 112 112 map map put put mintcream mintcream new Color color 245 245 255 255 250 250 map map put put mistyrose mistyrose new Color color 255 255 228 228 225 225 map map put put moccasin moccasin new Color color 255 255 228 228 181 181 map map put put navajowhite navajowhite new Color color 255 255 222 222 173 173 map map put put navy navy new Color color 0 0 0 0 128 128 map map put put oldlace oldlace new Color color 253 253 245 245 230 230 map map put put olive olive new Color color 128 128 128 128 0 0 map map put put olivedrab olivedrab new Color color 107 107 142 142 35 35 map map put put orange orange new Color color 255 255 165 165 0 0 map map put put orangered oranger new Color color 255 255 69 69 0 0 map map put put orchid orchid new Color color 218 218 112 112 214 214 map map put put palegoldenrod palegoldenrod new Color color 238 238 232 232 170 170 map map put put palegreen palegreen new Color color 152 152 251 251 152 152 map map put put paleturquoise paleturquoise new Color color 175 175 238 238 238 238 map map put put palevioletred palevioletr new Color color 219 219 112 112 147 147 map map put put papayawhip papayawhip new Color color 255 255 239 239 213 213 map map put put peachpuff peachpuff new Color color 255 255 218 218 185 185 map map put put peru peru new Color color 205 205 133 133 63 63 map map put put pink pink new Color color 255 255 192 192 203 203 map map put put plum plum new Color color 221 221 160 160 221 221 map map put put powderblue powderblue new Color color 176 176 224 224 230 230 map map put put purple purple new Color color 128 128 0 0 128 128 map map put put red red new Color color 255 255 0 0 0 0 map map put put rosybrown rosybrown new Color color 188 188 143 143 143 143 map map put put royalblue royalblue new Color color 65 65 105 105 225 225 map map put put saddlebrown saddlebrown new Color color 139 139 69 69 19 19 map map put put salmon salmon new Color color 250 250 128 128 114 114 map map put put sandybrown sandybrown new Color color 244 244 164 164 96 96 map map put put seagreen seagreen new Color color 46 46 139 139 87 87 map map put put seashell seashell new Color color 255 255 245 245 238 238 map map put put sienna sienna new Color color 160 160 82 82 45 45 map map put put silver silver new Color color 192 192 192 192 192 192 map map put put skyblue skyblue new Color color 135 135 206 206 235 235 map map put put slateblue slateblue new Color color 106 106 90 90 205 205 map map put put slategray slategray new Color color 112 112 128 128 144 144 map map put put slategrey slategrey new Color color 112 112 128 128 144 144 map map put put snow snow new Color color 255 255 250 250 250 250 map map put put springgreen springgreen new Color color 0 0 255 255 127 127 map map put put steelblue steelblue new Color color 70 70 130 130 180 180 map map put put tan tan new Color color 210 210 180 180 140 140 map map put put teal teal new Color color 0 0 128 128 128 128 map map put put thistle thistle new Color color 216 216 191 191 216 216 map map put put tomato tomato new Color color 255 255 99 99 71 71 map map put put turquoise turquoise new Color color 64 64 224 224 208 208 map map put put violet violet new Color color 238 238 130 130 238 238 map map put put wheat wheat new Color color 245 245 222 222 179 179 map map put put white white new Color color 255 255 255 255 255 255 map map put put whitesmoke whitesmoke new Color color 245 245 245 245 245 245 map map put put yellow yellow new Color color 255 255 255 255 0 0 map map put put yellowgreen yellowgreen new Color color 154 154 205 205 50 50 SVG s v g 1 1 2 2 Tiny tiny system colors color map map put put activeborder activebord UIManager u i manager getColor get color activeCaptionBorder active caption border map map put put activecaption activecaption UIManager u i manager getColor get color activeCaption active caption map map put put appworkspace appworkspace UIManager u i manager getColor get color window window map map put put background background UIManager u i manager getColor get color desktop desktop map map put put buttonface buttonface UIManager u i manager getColor get color control control map map put put buttonhighlight buttonhighlight UIManager u i manager getColor get color controlHighlight control highlight map map put put buttonshadow buttonshadow UIManager u i manager getColor get color controlShadow control shadow map map put put buttontext buttontext UIManager u i manager getColor get color controlText control text map map put put captiontext captiontext UIManager u i manager getColor get color activeCaptionText active caption text map map put put graytext graytext UIManager u i manager getColor get color textInactiveText text inactive text map map put put highlight highlight UIManager u i manager getColor get color textHighlight text highlight map map put put highlighttext highlighttext UIManager u i manager getColor get color textHighlightText text highlight text map map put put inactiveborder inactivebord UIManager u i manager getColor get color inactiveCaptionBorder inactive caption border map map put put inactivecaption inactivecaption UIManager u i manager getColor get color inactiveCaption inactive caption map map put put inactivecaptiontext inactivecaptiontext UIManager u i manager getColor get color inactiveCaptionText inactive caption text map map put put infobackground infobackground UIManager u i manager getColor get color info info map map put put infotext infotext UIManager u i manager getColor get color infoText info text map map put put menu menu UIManager u i manager getColor get color menu menu map map put put menutext menutext UIManager u i manager getColor get color menuText menu text map map put put scrollbar scrollbar UIManager u i manager getColor get color scrollbar scrollbar map map put put threeddarkshadow threeddarkshadow UIManager u i manager getColor get color controlDkShadow control dk shadow map map put put threedface threedface UIManager u i manager getColor get color control control map map put put threedhighlight threedhighlight UIManager u i manager getColor get color controlHighlight control highlight map map put put threedlightshadow threedlightshadow UIManager u i manager getColor get color controlLtHighlight control lt highlight map map put put threedshadow threedshadow UIManager u i manager getColor get color controlShadow control shadow map map put put window window UIManager u i manager getColor get color window window map map put put windowframe windowframe UIManager u i manager getColor get color windowBorder window border map map put put windowtext windowtext UIManager u i manager getColor get color windowText window text SVG s v g COLORS c o l o r s map map Prevent prevent instance instance creation creation private SVGUtil s v g util public static AffineTransform affine transform getTransform get transform DOMInput dom input in in String attributeName attribute name throws IOException i o return getTransform get transform in in getAttribute get attribute attributeName attribute name public static AffineTransform affine transform getTransform get transform String str str throws IOException i o AffineTransform affine transform t t new AffineTransform affine transform if str str null StreamTokenizer stream tokeniz tt tt new StreamTokenizer stream tokeniz new StringReader reader str str tt tt resetSyntax reset syntax tt tt wordChars word a a z z tt tt wordChars word A a Z z tt tt wordChars word 128 128 + + 32 32 255 255 tt tt whitespaceChars whitespace 0 0 tt tt whitespaceChars whitespace tt tt parseNumbers parse number while tt tt nextToken next token StreamTokenizer stream tokeniz TT t t EOF e o f if tt tt ttype ttype StreamTokenizer stream tokeniz TT t t WORD w o r d throw new IOException i o Illegal illegal transform transform +str +str String type type tt tt sval sval if tt tt nextToken next token throw new IOException i o not not found found in in transform transform +str +str if type type equals equal matrix matrix double m m new double 6 6 for int i i 0 0 i i 6 6 i++ i++ if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Matrix matrix value value +i+ +i+ not not found found in in transform transform +str+ +str+ token token +tt +tt ttype+ ttype+ +tt +tt sval sval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t WORD w o r d tt tt sval sval startsWith start with E e double mantissa mantissa tt tt nval nval tt tt nval nval Double valueOf value of tt tt nval nval + + tt tt sval sval else tt tt pushBack push back m m i i tt tt nval nval t t concatenate concatenate new AffineTransform affine transform m m else if type type equals equal translate translate double tx tx ty ty if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o X x translation translation value value not not found found in in transform transform +str +str tx tx tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r ty ty tt tt nval nval else tt tt pushBack push back ty ty 0 0 t t translate translate tx tx ty ty else if type type equals equal scale scale double sx sx sy sy if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o X x scale scale value value not not found found in in transform transform +str +str sx sx tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r sy sy tt tt nval nval else tt tt pushBack push back sy sy sx sx t t scale scale sx sx sy sy else if type type equals equal rotate rotate double angle angle cx cx cy cy if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Angle angle value value not not found found in in transform transform +str +str angle angle tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r cx cx tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Y y center center value value not not found found in in transform transform +str +str cy cy tt tt nval nval else tt tt pushBack push back cx cx cy cy 0 0 t t rotate rotate angle angle Math math PI p i 180d 180d cx cx Math math PI p i 180d 180d cy cy Math math PI p i 180d 180d else if type type equals equal skewX skew x double angle angle if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Skew skew angle angle not not found found in in transform transform +str +str angle angle tt tt nval nval t t concatenate concatenate new AffineTransform affine transform 1 1 0 0 Math math tan tan angle angle Math math PI p i 180 180 1 1 0 0 0 0 else if type type equals equal skewY skew y double angle angle if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Skew skew angle angle not not found found in in transform transform +str +str angle angle tt tt nval nval t t concatenate concatenate new AffineTransform affine transform 1 1 Math math tan tan angle angle Math math PI p i 180 180 0 0 1 1 0 0 0 0 else throw new IOException i o Unknown unknown transform transform +type+ +type+ in in +str +str if tt tt nextToken next token throw new IOException i o not not found found in in transform transform +str +str return t t public static double getDimension get dimension DOMInput dom input in in String attributeName attribute name throws IOException i o return getDimensionValue get dimension value in in in in getAttribute get attribute attributeName attribute name 0 0 public static double getDimensionValue get dimension value DOMInput dom input in in String str str throws IOException i o double scaleFactor scale factor 1d 1d if str str null || || str str length length 0 0 return 0d 0d if str str endsWith end with % % str str str str substring substring 0 0 str str length length 1 1 else if str str endsWith end with px px str str str str substring substring 0 0 str str length length 2 2 else if str str endsWith end with pt pt str str str str substring substring 0 0 str str length length 2 2 scaleFactor scale factor 1 1 25 25 else if str str endsWith end with pc pc str str str str substring substring 0 0 str str length length 2 2 scaleFactor scale factor 15 15 else if str str endsWith end with mm mm str str str str substring substring 0 0 str str length length 2 2 scaleFactor scale factor 3 3 543307 543307 else if str str endsWith end with cm cm str str str str substring substring 0 0 str str length length 2 2 scaleFactor scale factor 35 35 43307 43307 else if str str endsWith end with in in str str str str substring substring 0 0 str str length length 2 2 scaleFactor scale factor 90 90 else if str str endsWith end with em em str str str str substring substring 0 0 str str length length 2 2 List list Map map String String styles style new ArrayList list Map map String String List list String values value in in getInheritedAttribute get inherit attribute style style for String v v values value styles style add add getStyles get style v v String value value getInheritedAttribute get inherit attribute font font size size in in styles style if value value null value value endsWith end with em em scaleFactor scale factor getDimensionValue get dimension value in in value value return Double parseDouble parse str str scaleFactor scale factor public static List list BezierPath bezi path getPath get path DOMInput dom input in in String attributeName attribute name throws IOException i o return fromPathData from path data in in getAttribute get attribute attributeName attribute name public static void setPath set path DOMOutput dom output out out String attributeName attribute name BezierPath bezi path path path out out addAttribute add attribute attributeName attribute name toPathData to path data path path public static String toPathData to path data BezierPath bezi path path path StringBuilder builder buf buf new StringBuilder builder if path path size size 0 0 nothing nothing to to do else if path path size size 1 1 BezierPath bezi path Node node current current path path get get 0 0 buf buf append append M m buf buf append append current current x x 0 0 buf buf append append buf buf append append current current y y 0 0 buf buf append append L l buf buf append append current current x x 0 0 buf buf append append buf buf append append current current y y 0 0 + + 1 1 else BezierPath bezi path Node node previous previou BezierPath bezi path Node node current current previous previou current current path path get get 0 0 buf buf append append M m buf buf append append current current x x 0 0 buf buf append append buf buf append append current current y y 0 0 for int i i 1 1 n n path path size size i i n n i++ i++ previous previou current current current current path path get get i i if previous previou mask mask BezierPath bezi path C2 c2 MASK m a s k 0 0 if current current mask mask BezierPath bezi path C1 c1 MASK m a s k 0 0 buf buf append append L l buf buf append append current current x x 0 0 buf buf append append buf buf append append current current y y 0 0 else buf buf append append Q q buf buf append append current current x x 1 1 buf buf append append buf buf append append current current y y 1 1 buf buf append append buf buf append append current current x x 0 0 buf buf append append buf buf append append current current y y 0 0 else if current current mask mask BezierPath bezi path C1 c1 MASK m a s k 0 0 buf buf append append Q q buf buf append append current current x x 2 2 buf buf append append buf buf append append current current y y 2 2 buf buf append append buf buf append append current current x x 0 0 buf buf append append buf buf append append current current y y 0 0 else buf buf append append C c buf buf append append previous previou x x 2 2 buf buf append append buf buf append append previous previou y y 2 2 buf buf append append buf buf append append current current x x 1 1 buf buf append append buf buf append append current current y y 1 1 buf buf append append buf buf append append current current x x 0 0 buf buf append append buf buf append append current current y y 0 0 if path path isClosed is close if path path size size 1 1 previous previou path path get get path path size size 1 1 current current path path get get 0 0 if previous previou mask mask BezierPath bezi path C2 c2 MASK m a s k 0 0 if current current mask mask BezierPath bezi path C1 c1 MASK m a s k 0 0 buf buf append append L l buf buf append append current current x x 0 0 buf buf append append buf buf append append current current y y 0 0 else buf buf append append Q q buf buf append append current current x x 1 1 buf buf append append buf buf append append current current y y 1 1 buf buf append append buf buf append append current current x x 0 0 buf buf append append buf buf append append current current y y 0 0 else if current current mask mask BezierPath bezi path C1 c1 MASK m a s k 0 0 buf buf append append Q q buf buf append append previous previou x x 2 2 buf buf append append buf buf append append previous previou y y 2 2 buf buf append append buf buf append append current current x x 0 0 buf buf append append buf buf append append current current y y 0 0 else buf buf append append C c buf buf append append previous previou x x 2 2 buf buf append append buf buf append append previous previou y y 2 2 buf buf append append buf buf append append current current x x 1 1 buf buf append append buf buf append append current current y y 1 1 buf buf append append buf buf append append current current x x 0 0 buf buf append append buf buf append append current current y y 0 0 buf buf append append Z z return buf buf toString to private final static HashSet hash set pathCommands path command new HashSet hash set Arrays asList a list new String M m m m Z z z z L l l l H h h h V v v v C c c c S s s s Q q q q T t t t public static List list BezierPath bezi path fromPathData from path data String str str throws IOException i o LinkedList link list BezierPath bezi path paths path new LinkedList link list BezierPath bezi path BezierPath bezi path path path null Point2D point2 d Double p p new Point2D point2 d Double Point2D point2 d Double c1 c1 new Point2D point2 d Double Point2D point2 d Double c2 c2 new Point2D point2 d Double StreamTokenizer stream tokeniz tt tt new StreamTokenizer stream tokeniz new StringReader reader str str tt tt resetSyntax reset syntax tt tt parseNumbers parse number tt tt whitespaceChars whitespace 0 0 tt tt whitespaceChars whitespace char nextCommand next command M m char command command M m while tt tt nextToken next token StreamTokenizer stream tokeniz TT t t EOF e o f if tt tt ttype ttype 0 0 command command char tt tt ttype ttype else command command nextCommand next command tt tt pushBack push back BezierPath bezi path Node node node node switch command command moveto moveto case M m if path path null paths path add add path path path path new BezierPath bezi path if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p x x tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p y y tt tt nval nval path path moveTo move to p p x x p p y y nextCommand next command L l break case m m if path path null paths path add add path path path path new BezierPath bezi path if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p x x + + tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p y y + + tt tt nval nval path path moveTo move to p p x x p p y y nextCommand next command l l close close path path break case Z z case z z p p x x path path get get 0 0 x x 0 0 p p y y path path get get 0 0 y y 0 0 path path setClosed set close true lineto lineto break case L l if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p x x tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p y y tt tt nval nval path path lineTo line to p p x x p p y y nextCommand next command L l break case l l if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p x x + + tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p y y + + tt tt nval nval path path lineTo line to p p x x p p y y nextCommand next command l l break case H h if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p x x tt tt nval nval path path lineTo line to p p x x p p y y nextCommand next command H h break case h h if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p x x + + tt tt nval nval path path lineTo line to p p x x p p y y nextCommand next command h h break case V v if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p y y tt tt nval nval path path lineTo line to p p x x p p y y nextCommand next command V v break case v v if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p y y + + tt tt nval nval path path lineTo line to p p x x p p y y nextCommand next command v v curveto curveto break case C c if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect c1 c1 x x tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect c1 c1 y y tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect c2 c2 x x tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect c2 c2 y y tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p x x tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p y y tt tt nval nval path path curveTo curve to c1 c1 x x c1 c1 y y c2 c2 x x c2 c2 y y p p x x p p y y nextCommand next command C c break case c c if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect c1 c1 x x p p x x + + tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect c1 c1 y y p p y y + + tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect c2 c2 x x p p x x + + tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect c2 c2 y y p p y y + + tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p x x + + tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p y y + + tt tt nval nval path path curveTo curve to c1 c1 x x c1 c1 y y c2 c2 x x c2 c2 y y p p x x p p y y nextCommand next command c c break case S s node node path path get get path path size size 1 1 c1 c1 x x node node x x 0 0 2d 2d node node x x 1 1 c1 c1 y y node node y y 0 0 2d 2d node node y y 1 1 if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect c2 c2 x x tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect c2 c2 y y tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p x x tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p y y tt tt nval nval path path curveTo curve to c1 c1 x x c1 c1 y y c2 c2 x x c2 c2 y y p p x x p p y y nextCommand next command S s break case s s node node path path get get path path size size 1 1 c1 c1 x x node node x x 0 0 2d 2d node node x x 1 1 c1 c1 y y node node y y 0 0 2d 2d node node y y 1 1 if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect c2 c2 x x p p x x + + tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect c2 c2 y y p p y y + + tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p x x + + tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p y y + + tt tt nval nval path path curveTo curve to c1 c1 x x c1 c1 y y c2 c2 x x c2 c2 y y p p x x p p y y nextCommand next command s s quadto quadto break case Q q if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect c1 c1 x x tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect c1 c1 y y tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p x x tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p y y tt tt nval nval path path quadTo quad to c1 c1 x x c1 c1 y y p p x x p p y y nextCommand next command Q q break case q q if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect c1 c1 x x p p x x + + tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect c1 c1 y y p p y y + + tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p x x + + tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p y y + + tt tt nval nval path path quadTo quad to c1 c1 x x c1 c1 y y p p x x p p y y nextCommand next command q q break case T t node node path path get get path path size size 1 1 c1 c1 x x node node x x 0 0 2d 2d node node x x 1 1 c1 c1 y y node node y y 0 0 2d 2d node node y y 1 1 if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p x x tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p y y tt tt nval nval path path quadTo quad to c1 c1 x x c1 c1 y y p p x x p p y y nextCommand next command T t break case t t node node path path get get path path size size 1 1 c1 c1 x x node node x x 0 0 2d 2d node node x x 1 1 c1 c1 y y node node y y 0 0 2d 2d node node y y 1 1 if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p x x + + tt tt nval nval if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t NUMBER n u m b e r throw new IOException i o Number number expected expect p p y y + + tt tt nval nval path path quadTo quad to c1 c1 x x c1 c1 y y p p x x p p y y nextCommand next command s s break default throw new IOException i o Illegal illegal command command +command +command if path path null paths path add add path path return paths path public static String getInheritedAttribute get inherit attribute String name name DOMInput dom input in in List list Map map String String styles style List list String values value in in getInheritedAttribute get inherit attribute name name for int i i values value size size 1 1 i i 0 0 i i if values value get get i i null return values value get get i i if styles style get get i i null styles style get get i i containsKey contain key name name return styles style get get i i get get name name return null Reads read the the attributes attribute from from the the specified specify DOMInput dom input and and assigns assign them them to to the the figure figure public static void readAttributes read attribute Figure figure f f DOMInput dom input in in throws IOException i o FIXME f i x m e This method is is not not working working when when style style and and individual individual attributes attribute are are both both used use in in an an SVG s v g document document List list Map map String String styles style new ArrayList list Map map String String List list String values value in in getInheritedAttribute get inherit attribute style style for String v v values value styles style add add getStyles get style v v String value value Fill fill color color value value getInheritedAttribute get inherit attribute fill fill in in styles style if value value null Color color color color getColor get color value value if color color INHERIT i n h e r i t COLOR c o l o r color color CURRENT c u r r e n t COLOR c o l o r FILL f i l l COLOR c o l o r set set f f color color value value getInheritedAttribute get inherit attribute fill fill rule rule in in styles style if value value null WINDING w i n d i n g RULE r u l e set set f f value value toUpperCase to upper equals equal NONZERO n o n z e r o ? ? WindingRule winding rule NON n o n ZERO z e r o WindingRule winding rule EVEN e v e n ODD o d d else WINDING w i n d i n g RULE r u l e set set f f WindingRule winding rule NON n o n ZERO z e r o Stroke stroke color color value value getInheritedAttribute get inherit attribute stroke stroke in in styles style if value value null Color color color color getColor get color value value if color color INHERIT i n h e r i t COLOR c o l o r color color CURRENT c u r r e n t COLOR c o l o r STROKE s t r o k e COLOR c o l o r set set f f color color value value getInheritedAttribute get inherit attribute stroke stroke width width in in styles style if value value null STROKE s t r o k e WIDTH w t h set set f f Double valueOf value of value value value value getInheritedAttribute get inherit attribute stroke stroke miterlimit miterlimit in in styles style if value value null STROKE s t r o k e MITER m i t e r LIMIT l i m i t FACTOR f a c t o r set set f f Double valueOf value of value value value value getInheritedAttribute get inherit attribute stroke stroke dasharray dasharray in in styles style if value value null StringTokenizer tokeniz tt tt new StringTokenizer tokeniz value value double dashes dash new double tt tt countTokens count token for int i i 0 0 n n dashes dash length length i i n n i++ i++ dashes dash i i Double valueOf value of tt tt nextToken next token STROKE s t r o k e DASHES d a s h e s set set f f dashes dash value value getInheritedAttribute get inherit attribute stroke stroke dashoffset dashoffset in in styles style if value value null STROKE s t r o k e DASH d a s h PHASE p h a s e set set f f Math math abs ab Double valueOf value of value value value value getInheritedAttribute get inherit attribute font font size size in in styles style if value value null FONT f o n t SIZE s i z e set set f f getDimensionValue get dimension value in in value value value value getInheritedAttribute get inherit attribute text text anchor anchor in in styles style if value value null SVGText s v g text TEXT t e x t ANCHOR a n c h o r set set f f Enum valueOf value of SVGText s v g text TextAnchor text anchor class value value toUpperCase to upper public static Map map String String getStyles get style String str str throws IOException i o HashMap hash map String String styles style new HashMap hash map String String if str str null return styles style StreamTokenizer stream tokeniz tt tt new StreamTokenizer stream tokeniz new StringReader reader str str tt tt resetSyntax reset syntax tt tt wordChars word 9 9 tt tt wordChars word tt tt wordChars word 128 128 + + 32 32 255 255 tt tt whitespaceChars whitespace 0 0 while tt tt nextToken next token StreamTokenizer stream tokeniz TT t t EOF e o f if tt tt ttype ttype String key key value value if tt tt ttype ttype StreamTokenizer stream tokeniz TT t t WORD w o r d throw new IOException i o Key key token token expected expect in in +str+ +str+ +Integer + toHexString to hex tt tt ttype ttype key key tt tt sval sval if tt tt nextToken next token throw new IOException i o Colon colon expected expect after after +key+ +key+ in in +str +str if tt tt nextToken next token StreamTokenizer stream tokeniz TT t t WORD w o r d throw new IOException i o Value value token token expected expect after after +key+ +key+ in in +str+ +str+ +tt +tt ttype ttype value value tt tt sval sval while tt tt nextToken next token StreamTokenizer stream tokeniz TT t t WORD w o r d value value + + + + tt tt sval sval tt tt pushBack push back styles style put put key key value value return styles style public static Color color getColor get color String value value value value value value trim trim toLowerCase to lower if value value equals equal none none return null else if value value equals equal currentColor current color indicates indicate that that painting painting shall shall be be done using using the the color color specified specify by by the the color color property property return CURRENT c u r r e n t COLOR c o l o r else if value value equals equal inherit inherit Each each property property may may also also have have a a specified specify value value of of inherit inherit which which means mean that that for a a given given element element the the property property takes take the the same same computed compute value value as a the the property property for the the element element s s parent parent return INHERIT i n h e r i t COLOR c o l o r else if SVG s v g COLORS c o l o r s containsKey contain key value value return SVG s v g COLORS c o l o r s get get value value else if value value startsWith start with value value length length 7 7 return new Color color Integer decode decode value value else if value value startsWith start with value value length length 4 4 Three three digits digit hex hex value value int th th Integer decode decode value value return new Color color th th 0xf 0xf | | th th 0xf 0xf 4 4 | | th th 0xf0 0xf0 4 4 | | th th 0xf0 0xf0 8 8 | | th th 0xf00 0xf00 8 8 | | th th 0xf00 0xf00 12 12 else if value value startsWith start with rgb rgb StringTokenizer tokeniz tt tt new StringTokenizer tokeniz value value tt tt nextToken next token Color color c c new Color color Integer decode decode tt tt nextToken next token Integer decode decode tt tt nextToken next token Integer decode decode tt tt nextToken next token return c c else return null public static void setDefaults set Figure figure f f Set set SVG s v g default values value FILL f i l l COLOR c o l o r set set f f Color color black black STROKE s t r o k e COLOR c o l o r set set f f null STROKE s t r o k e DASH d a s h FACTOR f a c t o r set set f f 1d 1d Writes write the the attributes attribute of of the the figure figure into into the the specified specify DOMOutput dom output public static void writeAttributes write attribute Figure figure f f DOMOutput dom output out out throws IOException i o Color color color color Double dbl dbl String value value Fill fill attributes attribute color color FILL f i l l COLOR c o l o r get get f f if color color null value value none none else value value 000000 000000 +Integer + toHexString to hex color color getRGB get r g b value value +value +value substring substring value value length length 6 6 out out addAttribute add attribute fill fill value value if WINDING w i n d i n g RULE r u l e get get f f WindingRule winding rule NON n o n ZERO z e r o out out addAttribute add attribute fill fill rule rule evenodd evenodd Stroke stroke attributes attribute color color STROKE s t r o k e COLOR c o l o r get get f f if color color null value value none none else value value 000000 000000 +Integer + toHexString to hex color color getRGB get r g b value value +value +value substring substring value value length length 6 6 out out addAttribute add attribute stroke stroke value value out out addAttribute add attribute stroke stroke width width STROKE s t r o k e WIDTH w t h get get f f 1d 1d out out addAttribute add attribute stroke stroke miterlimit miterlimit STROKE s t r o k e MITER m i t e r LIMIT l i m i t FACTOR f a c t o r get get f f STROKE s t r o k e WIDTH w t h get get f f 4d 4d double dashes dash STROKE s t r o k e DASHES d a s h e s get get f f dbl dbl STROKE s t r o k e DASH d a s h FACTOR f a c t o r get get f f null ? ? STROKE s t r o k e WIDTH w t h get get f f STROKE s t r o k e DASH d a s h FACTOR f a c t o r get get f f if dashes dash null StringBuilder builder buf buf new StringBuilder builder for int i i 0 0 i i dashes dash length length i++ i++ if i i 0 0 buf buf append append buf buf append append dashes dash i i dbl dbl out out addAttribute add attribute stroke stroke dasharray dasharray buf buf toString to out out addAttribute add attribute stroke stroke dashoffset dashoffset STROKE s t r o k e DASH d a s h PHASE p h a s e get get f f 0d 0d Text text attributes attribute out out addAttribute add attribute font font size size FONT f o n t SIZE s i z e get get f f out out addAttribute add attribute text text anchor anchor start start 