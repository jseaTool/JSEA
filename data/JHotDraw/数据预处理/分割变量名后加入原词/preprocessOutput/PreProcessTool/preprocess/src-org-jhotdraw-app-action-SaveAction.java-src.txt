SaveAction save action java 1 1 2 2 1 1 2006 2006 07 07 25 25 Copyright copyright c c 2005 2005 2006 2006 Werner wern Randelshofer randelshof Staldenmattweg staldenmattweg 2 2 Immensee immensee CH c h 6405 6405 Switzerland switzerland All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of Werner wern Randelshofer randelshof Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with Werner wern Randelshofer randelshof package org org jhotdraw jhotdraw app app action action import java awt awt import java awt awt event event import javax javax swing swing import java io io import org org jhotdraw jhotdraw app app import org org jhotdraw jhotdraw io io import org org jhotdraw jhotdraw util util import org org jhotdraw jhotdraw gui gui import org org jhotdraw jhotdraw gui gui event event SaveAction save action author author Werner wern Randelshofer randelshof version 1 1 2 2 1 1 2006 2006 07 07 25 25 Add add saved save file to to recent recent file list list of of application application br 1 1 2 2 2006 2006 05 05 19 19 Make make filename filename acceptable acceptable by by ExtensionFileFilter extension filter br 1 1 1 1 2006 2006 02 02 23 23 Support support multiple multiple open open id br 1 1 0 0 28 28 September september 2005 2005 Created create public class SaveAction save action extends AbstractProjectAction project action public final static String ID save save private boolean saveAs save a private Component component oldFocusOwner old focus owner Creates create a a new instance instance public SaveAction save action Application application app app this app app false Creates create a a new instance instance public SaveAction save action Application application app app boolean saveAs save a super app app this saveAs save a saveAs save a ResourceBundleUtil resource bundle util labels label ResourceBundleUtil resource bundle util getLAFBundle get l a f bundle org org jhotdraw jhotdraw app app Labels label labels label configureAction configure action this ID public void actionPerformed action perform ActionEvent action event evt evt final Project project project project getCurrentProject get current project if project project isEnabled is enable oldFocusOwner old focus owner SwingUtilities swing utility getWindowAncestor get window ancestor project project getComponent get component getFocusOwner get focus owner project project setEnabled set enable false File saveToFile save to if saveAs save a project project getFile get null saveToFile save to project project project project getFile get else JFileChooser j chooser fileChooser chooser project project getSaveChooser get save chooser JSheet j sheet showSaveSheet show save sheet fileChooser chooser project project getComponent get component new SheetListener sheet listener public void optionSelected option select final SheetEvent sheet event evt evt if evt evt getOption get option JFileChooser j chooser APPROVE a p p r o v e OPTION o p t i o n final File file if evt evt getFileChooser get chooser getFileFilter get filter instanceof ExtensionFileFilter extension filter file ExtensionFileFilter extension filter evt evt getFileChooser get chooser getFileFilter get filter makeAcceptable make acceptable evt evt getFileChooser get chooser getSelectedFile get select else file evt evt getFileChooser get chooser getSelectedFile get select saveToFile save to project project file else project project setEnabled set enable true if oldFocusOwner old focus owner null oldFocusOwner old focus owner requestFocus request focus protected void saveToFile save to final Project project project project final File file project project execute execute new Worker worker public Object construct construct try project project write write file return null catch IOException i o e e return e e public void finished finish Object value value fileSaved save project project file value value XXX x x x Change change type type of of value value to to Throwable throwable param value value is is either eith null for success success or or a a Throwable throwable on on failure failure protected void fileSaved save final Project project project project File file Object value value if value value null project project setFile set file project project markChangesAsSaved mark change a save int multiOpenId multi open 1 1 for Project project p p project project getApplication get application projects project if p p project project p p getFile get null p p getFile get equals equal file multiOpenId multi open Math math max max multiOpenId multi open p p getMultipleOpenId get multiple open + + 1 1 getApplication get application addRecentFile add recent file project project setMultipleOpenId set multiple open multiOpenId multi open else JSheet j sheet showMessageSheet show message sheet project project getComponent get component html html +UIManager + u i manager getString get OptionPane option pane css cs + + b b Couldn couldn t t save save to to the the file \ \ +file+ +file+ \ \ p p + + Reason reason +value +value JOptionPane j option pane ERROR e r r o r MESSAGE m e s s a g e project project setEnabled set enable true SwingUtilities swing utility getWindowAncestor get window ancestor project project getComponent get component toFront to front if oldFocusOwner old focus owner null oldFocusOwner old focus owner requestFocus request focus 