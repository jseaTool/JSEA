NonValidator non validator java NanoXML nano xml Java $Revision $ revision 1 1 4 4 $ $ $Date $ date 2002 2002 02 02 03 03 21 21 19 19 38 38 $ $ $Name $ name RELEASE r e l e a s e 2 2 2 2 1 1 $ $ This file is is part part of of NanoXML nano xml 2 2 for Java Copyright copyright C c 2000 2000 2002 2002 Marc marc De de Scheemaecker scheemaeck All all Rights right Reserved reserve This software software is is provided provide as a is is without without any any express express or or implied imply warranty warranty In in no no event event will will the the authors author be be held hold liable liable for any any damages damage arising arise from from the the use use of of this software software Permission permission is is granted grant to to anyone anyone to to use use this software software for any any purpose purpose including include commercial commercial applications application and and to to alter alter it it and and redistribute redistribute it it freely freely subject subject to to the the following following restrictions restriction 1 1 The the origin origin of of this software software must must not not be be misrepresented misrepresent you you must must not not claim claim that that you you wrote write the the original original software software If you you use use this software software in in a a product product an an acknowledgment acknowledgment in in the the product product documentation documentation would would be be appreciated appreciate but but is is not not required require 2 2 Altered alter source source versions must must be be plainly plainly marked mark as a such such and and must must not not be be misrepresented misrepresent as a being being the the original original software software 3 3 This notice notice may may not not be be removed remove or or altered alter from from any any source source distribution distribution package net net n3 n3 nanoxml nanoxml import java io io Reader reader import java io io IOException i o import java io io StringReader reader import java util util Enumeration enumeration import java util util Hashtable hashtable import java util util Properties property import java util util Stack stack NonValidator non validator is is a a concrete concrete implementation of of IXMLValidator i xml validator which which processes process the the DTD d t d and and handles handle entity entity definitions definition It it does doe not not do any any validation validation itself itself author author Marc marc De de Scheemaecker scheemaeck version $Name $ name RELEASE r e l e a s e 2 2 2 2 1 1 $ $ $Revision $ revision 1 1 4 4 $ $ public class NonValidator non validator implements IXMLValidator i xml validator The the parameter parameter entity entity resolver resolv protected IXMLEntityResolver i xml entity resolv parameterEntityResolver parameter entity resolv Contains contain the the default values value for attributes attribute for the the different different element element types type protected Hashtable hashtable attributeDefaultValues attribute value The the stack stack of of elements element to to be be processed process protected Stack stack currentElements current element Creates create the the quot validator validator quot public NonValidator non validator this attributeDefaultValues attribute value new Hashtable hashtable this currentElements current element new Stack stack this parameterEntityResolver parameter entity resolv new XMLEntityResolver xml entity resolv Cleans clean up up the the object when when it it s s destroyed destroy protected void finalize finalize throws Throwable throwable this parameterEntityResolver parameter entity resolv null this attributeDefaultValues attribute value clear clear this attributeDefaultValues attribute value null this currentElements current element clear clear this currentElements current element null super finalize finalize Sets set the the parameter parameter entity entity resolver resolv param resolver resolv the the entity entity resolver resolv public void setParameterEntityResolver set parameter entity resolv IXMLEntityResolver i xml entity resolv resolver resolv this parameterEntityResolver parameter entity resolv resolver resolv Returns the the parameter parameter entity entity resolver resolv return the the entity entity resolver resolv public IXMLEntityResolver i xml entity resolv getParameterEntityResolver get parameter entity resolv return this parameterEntityResolver parameter entity resolv Parses pars the the DTD d t d The the validator validator object is is responsible responsible for reading reading the the full full DTD d t d param publicID the the public ID which which may may be be null param reader reader the the reader reader to to read read the the DTD d t d from from param entityResolver entity resolv the the entity entity resolver resolv param external external true if the the DTD d t d is is external external throws java lang lang Exception If something someth went go wrong wrong public void parseDTD parse d t d String publicID IXMLReader i xml reader reader reader IXMLEntityResolver i xml entity resolv entityResolver entity resolv boolean external external throws Exception XMLUtil xml util skipWhitespace skip whitespace reader reader null int origLevel orig level reader reader getStreamLevel get stream level for String str str XMLUtil xml util read read reader reader % % char ch ch str str charAt at 0 0 if ch ch % % XMLUtil xml util processEntity process entity str str reader reader this parameterEntityResolver parameter entity resolv continue else if ch ch this processElement process element reader reader entityResolver entity resolv else if ch ch return end end internal internal DTD d t d else XMLUtil xml util errorInvalidInput invalid input reader reader getSystemID get reader reader getLineNr get line nr str str do ch ch reader reader read read if external external reader reader getStreamLevel get stream level origLevel orig level reader reader unread unread ch ch return end end external external DTD d t d while ch ch || || ch ch || || ch ch || || ch ch \r \r reader reader unread unread ch ch Processes process an an element element in in the the DTD d t d param reader reader the the reader reader to to read read data data from from param entityResolver entity resolv the the entity entity resolver resolv throws java lang lang Exception If something someth went go wrong wrong protected void processElement process element IXMLReader i xml reader reader reader IXMLEntityResolver i xml entity resolv entityResolver entity resolv throws Exception String str str XMLUtil xml util read read reader reader % % char ch ch str str charAt at 0 0 if ch ch XMLUtil xml util skipTag skip tag reader reader return str str XMLUtil xml util read read reader reader % % ch ch str str charAt at 0 0 switch ch ch case XMLUtil xml util skipComment skip comment reader reader break case this processConditionalSection process conditional section reader reader entityResolver entity resolv break case E e this processEntity process entity reader reader entityResolver entity resolv break case A a this processAttList process att list reader reader entityResolver entity resolv break default XMLUtil xml util skipTag skip tag reader reader Processes process a a conditional conditional section section param reader reader the the reader reader to to read read data data from from param entityResolver entity resolv the the entity entity resolver resolv throws java lang lang Exception If something someth went go wrong wrong protected void processConditionalSection process conditional section IXMLReader i xml reader reader reader IXMLEntityResolver i xml entity resolv entityResolver entity resolv throws Exception XMLUtil xml util skipWhitespace skip whitespace reader reader null String str str XMLUtil xml util read read reader reader % % char ch ch str str charAt at 0 0 if ch ch I i XMLUtil xml util skipTag skip tag reader reader return str str XMLUtil xml util read read reader reader % % ch ch str str charAt at 0 0 switch ch ch case G g this processIgnoreSection process ignore section reader reader entityResolver entity resolv return case N n break default XMLUtil xml util skipTag skip tag reader reader return if XMLUtil xml util checkLiteral check literal reader reader CLUDE c l u d e XMLUtil xml util skipTag skip tag reader reader return XMLUtil xml util skipWhitespace skip whitespace reader reader null str str XMLUtil xml util read read reader reader % % ch ch str str charAt at 0 0 if ch ch XMLUtil xml util skipTag skip tag reader reader return Reader reader subreader subread new CDATAReader c d a t a reader reader reader StringBuffer buffer buf buf new StringBuffer buffer 1024 1024 for int ch2 ch2 subreader subread read read if ch2 ch2 0 0 break buf buf append append char ch2 ch2 subreader subread close close reader reader startNewStream start stream new StringReader reader buf buf toString to Processes process an an ignore ignore section section param reader reader the the reader reader to to read read data data from from param entityResolver entity resolv the the entity entity resolver resolv throws java lang lang Exception If something someth went go wrong wrong protected void processIgnoreSection process ignore section IXMLReader i xml reader reader reader IXMLEntityResolver i xml entity resolv entityResolver entity resolv throws Exception if XMLUtil xml util checkLiteral check literal reader reader NORE n o r e XMLUtil xml util skipTag skip tag reader reader return XMLUtil xml util skipWhitespace skip whitespace reader reader null String str str XMLUtil xml util read read reader reader % % char ch ch str str charAt at 0 0 if ch ch XMLUtil xml util skipTag skip tag reader reader return Reader reader subreader subread new CDATAReader c d a t a reader reader reader subreader subread close close Processes process an an ATTLIST a t t l i s t element element param reader reader the the reader reader to to read read data data from from param entityResolver entity resolv the the entity entity resolver resolv throws java lang lang Exception If something someth went go wrong wrong protected void processAttList process att list IXMLReader i xml reader reader reader IXMLEntityResolver i xml entity resolv entityResolver entity resolv throws Exception if XMLUtil xml util checkLiteral check literal reader reader TTLIST t t l i s t XMLUtil xml util skipTag skip tag reader reader return XMLUtil xml util skipWhitespace skip whitespace reader reader null String str str XMLUtil xml util read read reader reader % % char ch ch str str charAt at 0 0 while ch ch % % XMLUtil xml util processEntity process entity str str reader reader this parameterEntityResolver parameter entity resolv str str XMLUtil xml util read read reader reader % % ch ch str str charAt at 0 0 reader reader unread unread ch ch String elementName element name XMLUtil xml util scanIdentifier scan identifier reader reader XMLUtil xml util skipWhitespace skip whitespace reader reader null str str XMLUtil xml util read read reader reader % % ch ch str str charAt at 0 0 while ch ch % % XMLUtil xml util processEntity process entity str str reader reader this parameterEntityResolver parameter entity resolv str str XMLUtil xml util read read reader reader % % ch ch str str charAt at 0 0 Properties property props prop new Properties property while ch ch reader reader unread unread ch ch String attName att name XMLUtil xml util scanIdentifier scan identifier reader reader XMLUtil xml util skipWhitespace skip whitespace reader reader null str str XMLUtil xml util read read reader reader % % ch ch str str charAt at 0 0 while ch ch % % XMLUtil xml util processEntity process entity str str reader reader this parameterEntityResolver parameter entity resolv str str XMLUtil xml util read read reader reader % % ch ch str str charAt at 0 0 if ch ch while ch ch str str XMLUtil xml util read read reader reader % % ch ch str str charAt at 0 0 while ch ch % % XMLUtil xml util processEntity process entity str str reader reader this parameterEntityResolver parameter entity resolv str str XMLUtil xml util read read reader reader % % ch ch str str charAt at 0 0 else reader reader unread unread ch ch XMLUtil xml util scanIdentifier scan identifier reader reader XMLUtil xml util skipWhitespace skip whitespace reader reader null str str XMLUtil xml util read read reader reader % % ch ch str str charAt at 0 0 while ch ch % % XMLUtil xml util processEntity process entity str str reader reader this parameterEntityResolver parameter entity resolv str str XMLUtil xml util read read reader reader % % ch ch str str charAt at 0 0 if ch ch str str XMLUtil xml util scanIdentifier scan identifier reader reader XMLUtil xml util skipWhitespace skip whitespace reader reader null if str str equals equal FIXED f i x e d XMLUtil xml util skipWhitespace skip whitespace reader reader null str str XMLUtil xml util read read reader reader % % ch ch str str charAt at 0 0 while ch ch % % XMLUtil xml util processEntity process entity str str reader reader this parameterEntityResolver parameter entity resolv str str XMLUtil xml util read read reader reader % % ch ch str str charAt at 0 0 continue else reader reader unread unread ch ch String value value XMLUtil xml util scanString scan reader reader % % this parameterEntityResolver parameter entity resolv props prop put put attName att name value value XMLUtil xml util skipWhitespace skip whitespace reader reader null str str XMLUtil xml util read read reader reader % % ch ch str str charAt at 0 0 while ch ch % % XMLUtil xml util processEntity process entity str str reader reader this parameterEntityResolver parameter entity resolv str str XMLUtil xml util read read reader reader % % ch ch str str charAt at 0 0 if props prop isEmpty is empty this attributeDefaultValues attribute value put put elementName element name props prop Processes process an an ENTITY e n t i t y element element param reader reader the the reader reader to to read read data data from from param entityResolver entity resolv the the entity entity resolver resolv throws java lang lang Exception If something someth went go wrong wrong protected void processEntity process entity IXMLReader i xml reader reader reader IXMLEntityResolver i xml entity resolv entityResolver entity resolv throws Exception if XMLUtil xml util checkLiteral check literal reader reader NTITY n t i t y XMLUtil xml util skipTag skip tag reader reader return XMLUtil xml util skipWhitespace skip whitespace reader reader null char ch ch XMLUtil xml util readChar read reader reader \0 \0 if ch ch % % XMLUtil xml util skipWhitespace skip whitespace reader reader null entityResolver entity resolv this parameterEntityResolver parameter entity resolv else reader reader unread unread ch ch String key key XMLUtil xml util scanIdentifier scan identifier reader reader XMLUtil xml util skipWhitespace skip whitespace reader reader null ch ch XMLUtil xml util readChar read reader reader % % String systemID null String publicID null switch ch ch case P p if XMLUtil xml util checkLiteral check literal reader reader UBLIC u b l i c XMLUtil xml util skipTag skip tag reader reader return XMLUtil xml util skipWhitespace skip whitespace reader reader null publicID XMLUtil xml util scanString scan reader reader % % this parameterEntityResolver parameter entity resolv XMLUtil xml util skipWhitespace skip whitespace reader reader null systemID XMLUtil xml util scanString scan reader reader % % this parameterEntityResolver parameter entity resolv XMLUtil xml util skipWhitespace skip whitespace reader reader null XMLUtil xml util readChar read reader reader % % break case S s if XMLUtil xml util checkLiteral check literal reader reader YSTEM y s t e m XMLUtil xml util skipTag skip tag reader reader return XMLUtil xml util skipWhitespace skip whitespace reader reader null systemID XMLUtil xml util scanString scan reader reader % % this parameterEntityResolver parameter entity resolv XMLUtil xml util skipWhitespace skip whitespace reader reader null XMLUtil xml util readChar read reader reader % % break case case \ \ reader reader unread unread ch ch String value value XMLUtil xml util scanString scan reader reader % % this parameterEntityResolver parameter entity resolv entityResolver entity resolv addInternalEntity add internal entity key key value value XMLUtil xml util skipWhitespace skip whitespace reader reader null XMLUtil xml util readChar read reader reader % % break default XMLUtil xml util skipTag skip tag reader reader if systemID null entityResolver entity resolv addExternalEntity add external entity key key publicID systemID Indicates indicate that that an an element element has ha been be started start param name name the the name name of of the the element element param systemId the the system ID of of the the XML xml data data of of the the element element param lineNr line nr the the line line number number in in the the XML xml data data of of the the element element public void elementStarted element start String name name String systemId int lineNr line nr Properties property attribs attrib Properties property this attributeDefaultValues attribute value get get name name if attribs attrib null attribs attrib new Properties property else attribs attrib Properties property attribs attrib clone clone this currentElements current element push push attribs attrib Indicates indicate that that the the current current element element has ha ended end param name name the the name name of of the the element element param systemId the the system ID of of the the XML xml data data of of the the element element param lineNr line nr the the line line number number in in the the XML xml data data of of the the element element public void elementEnded element end String name name String systemId int lineNr line nr nothing nothing to to do This method is is called call when when the the attributes attribute of of an an XML xml element element have have been be processed process If there there are are attributes attribute with with a a default value value which which have have not not been be specified specify yet yet they they have have to to be be put put into into I i extraAttributes extra attribute I i param name name the the name name of of the the element element param extraAttributes extra attribute where where to to put put extra extra attributes attribute param systemId the the system ID of of the the XML xml data data of of the the element element param lineNr line nr the the line line number number in in the the XML xml data data of of the the element element public void elementAttributesProcessed element attribute process String name name Properties property extraAttributes extra attribute String systemId int lineNr line nr Properties property props prop Properties property this currentElements current element pop pop Enumeration enumeration enm enm props prop keys key while enm enm hasMoreElements ha more element String key key String enm enm nextElement next element extraAttributes extra attribute put put key key props prop get get key key Indicates indicate that that an an attribute attribute has ha been be added add to to the the current current element element param key key the the name name of of the the attribute attribute param value value the the value value of of the the attribute attribute param systemId the the system ID of of the the XML xml data data of of the the element element param lineNr line nr the the line line number number in in the the XML xml data data of of the the element element public void attributeAdded attribute add String key key String value value String systemId int lineNr line nr Properties property props prop Properties property this currentElements current element peek peek if props prop containsKey contain key key key props prop remove remove key key Indicates indicate that that a a new PCDATA p c d a t a element element has ha been be encountered encounter param systemId the the system ID of of the the XML xml data data of of the the element element param lineNr line nr the the line line number number in in the the XML xml data data of of the the element element public void PCDataAdded p c data add String systemId int lineNr line nr nothing nothing to to do 