TextFigure text figure java 1 1 0 0 1 1 2006 2006 02 02 27 27 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org ??? ??? package org org jhotdraw jhotdraw draw draw import org org jhotdraw jhotdraw util util import java awt awt import java awt awt font font import java awt awt geom geom import java util util import java io io import static org org jhotdraw jhotdraw draw draw AttributeKeys attribute key import org org jhotdraw jhotdraw geom geom import org org jhotdraw jhotdraw xml xml DOMInput dom input import org org jhotdraw jhotdraw xml xml DOMOutput dom output A a text text figure figure see see TextTool text tool author author Werner wern Randelshofer randelshof version 2 2 0 0 1 1 2006 2006 02 02 27 27 Draw draw UNDERLINE u n d e r l i n e LOW l o w ONE o n e PIXEL p i x e l instead instead of of UNDERLINE u n d e r l i n e ON o n br 2 2 0 0 2006 2006 01 01 14 14 Changed change to to support support double precison coordinates coordinate br 1 1 0 0 2003 2003 12 12 01 01 Derived derive from from JHotDraw jhotdraw 5 5 4b1 4b1 public class TextFigure text figure extends AttributedFigure attribute figure implements TextHolder text holder protected Point2D point2 d Double origin origin new Point2D point2 d Double private boolean editable editable true cache cache of of the the TextFigure text figure s s layout layout transient private TextLayout text layout textLayout text layout Creates create a a new instance instance public TextFigure text figure this Text text public TextFigure text figure String text text setText set text text text Gets get the the text text shown show by by the the text text figure figure public String getText get text return String getAttribute get attribute TEXT t e x t Sets set the the text text shown show by by the the text text figure figure public void setText set text String newText text setAttribute set attribute TEXT t e x t newText text public void basicTransform basic transform AffineTransform affine transform tx tx tx tx transform transform origin origin origin origin public void basicSetBounds basic set bound Point2D point2 d Double anchor anchor Point2D point2 d Double lead origin origin new Point2D point2 d Double anchor anchor x x anchor anchor y y public boolean contains contain Point2D point2 d Double p p if getBounds get bound contains contain p p return true if decorator decorator null updateDecoratorBounds update decorator bound return decorator decorator contains contain p p return false protected void drawStroke draw stroke java awt awt Graphics2D graphics2 d g g protected void drawFill draw fill java awt awt Graphics2D graphics2 d g g protected void drawText draw text java awt awt Graphics2D graphics2 d g g if getText get text null || || isEditable is editable TextLayout text layout layout layout getTextLayout get text layout layout layout draw draw g g float origin origin x x float origin origin y y + + layout layout getAscent get ascent public void invalidate invalidate super invalidate invalidate textLayout text layout null protected TextLayout text layout getTextLayout get text layout if textLayout text layout null String text text getText get text if text text null || || text text length length 0 0 text text FontRenderContext font render context frc frc getFontRenderContext get font render context HashMap hash map TextAttribute text attribute Object textAttributes text attribute new HashMap hash map TextAttribute text attribute Object textAttributes text attribute put put TextAttribute text attribute FONT f o n t getFont get font if FONT f o n t UNDERLINED u n d e r l i n e d get get this textAttributes text attribute put put TextAttribute text attribute UNDERLINE u n d e r l i n e TextAttribute text attribute UNDERLINE u n d e r l i n e LOW l o w ONE o n e PIXEL p i x e l textLayout text layout new TextLayout text layout text text textAttributes text attribute frc frc return textLayout text layout public Rectangle2D rectangle2 d Double getBounds get bound TextLayout text layout layout layout getTextLayout get text layout Rectangle2D rectangle2 d Double r r new Rectangle2D rectangle2 d Double origin origin x x origin origin y y layout layout getAdvance get advance layout layout getAscent get ascent + + layout layout getDescent get descent return r r public Dimension2DDouble dimension2 d getPreferredSize get prefer size Rectangle2D rectangle2 d Double b b getBounds get bound return new Dimension2DDouble dimension2 d b b width width b b height height public Rectangle2D rectangle2 d Double getFigureDrawBounds get figure draw bound if getText get text null return getBounds get bound else TextLayout text layout layout layout getTextLayout get text layout Rectangle2D rectangle2 d Double r r new Rectangle2D rectangle2 d Double origin origin x x origin origin y y layout layout getAdvance get advance layout layout getAscent get ascent Rectangle2D rectangle2 d lBounds l bound layout layout getBounds get bound if lBounds l bound isEmpty is empty Double isNaN is na n lBounds l bound getX get x r r add add new Rectangle2D rectangle2 d Double lBounds l bound getX get x +origin +origin x x lBounds l bound getY get y +origin +origin y+layout y+layout getAscent get ascent lBounds l bound getWidth get width lBounds l bound getHeight get height grow grow by by two two pixels pixel to to take take antialiasing antialiasing into into account account Geom geom grow grow r r 2d 2d 2d 2d return r r public Collection collection Handle handle createHandles create handle int detailLevel detail level LinkedList link list Handle handle handles handle new LinkedList link list Handle handle if detailLevel detail level 0 0 handles handle add add new MoveHandle move handle this RelativeLocator relative locator northWest north west handles handle add add new MoveHandle move handle this RelativeLocator relative locator northEast north east handles handle add add new MoveHandle move handle this RelativeLocator relative locator southEast south east handles handle add add new FontSizeHandle font size handle this return handles handle protected void validate validate super validate validate textLayout text layout null public boolean isEditable is editable return editable editable public void setEditable set editable boolean b b this editable editable b b public int getTextColumns get text column return getText get text null ? ? 4 4 Math math max max getText get text length length 4 4 Returns a a specialized specialize tool tool for the the given given coordinate coordinate p p Returns null if no no specialized specialize tool tool is is available available public Tool tool getTool get tool Point2D point2 d Double p p return isEditable is editable contains contain p p ? ? new TextTool text tool this null public void read read DOMInput dom input in in throws IOException i o setBounds set bound new Point2D point2 d Double in in getAttribute get attribute x x 0d 0d in in getAttribute get attribute y y 0d 0d new Point2D point2 d Double 0 0 0 0 readAttributes read attribute in in public void write write DOMOutput dom output out out throws IOException i o Rectangle2D rectangle2 d Double b b getBounds get bound out out addAttribute add attribute x x b b x x out out addAttribute add attribute y y b b y y writeAttributes write attribute out out Gets get the the number number of of characters character used use to to expand expand tabs tab public int getTabSize get tab size return 8 8 public TextHolder text holder getLabelFor get label return this public Insets2DDouble insets2 d getInsets get inset return new Insets2DDouble insets2 d 0 0 0 0 0 0 0 0 public void restoreTo restore to Object geometry geometry Point2D point2 d Double p p Point2D point2 d Double geometry geometry origin origin x x p p x x origin origin y y p p y y public Object getRestoreData get restore data return origin origin clone clone public TextFigure text figure clone clone TextFigure text figure that that TextFigure text figure super clone clone that that origin origin Point2D point2 d Double this origin origin clone clone that that textLayout text layout null return that that public Font font getFont get font return AttributeKeys attribute key getFont get font this public Color color getTextColor get text color return TEXT t e x t COLOR c o l o r get get this public Color color getFillColor get fill color return FILL f i l l COLOR c o l o r get get this public void setFontSize set font size float size size FONT f o n t SIZE s i z e set set this new Double size size public float getFontSize get font size return FONT f o n t SIZE s i z e get get this floatValue value 