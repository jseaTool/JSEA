BezierTool bezi tool java 1 1 1 1 2006 2006 07 07 12 12 Copyright copyright c c 1996 1996 2006 2006 by by the the original original authors author of of JHotDraw jhotdraw and and all all its it contributors contributor JHotDraw jhotdraw org org All all rights right reserved reserve This software software is is the the confidential confidential and and proprietary proprietary information information of of JHotDraw jhotdraw org org Confidential confidential Information information You you shall shall not not disclose disclose such such Confidential confidential Information information and and shall shall use use it it only only in in accordance accordance with with the the terms term of of the the license license agreement agreement you you entered enter into into with with JHotDraw jhotdraw org org package org org jhotdraw jhotdraw draw draw import org org jhotdraw jhotdraw util util import org org jhotdraw jhotdraw undo undo import java awt awt import java awt awt geom geom import java awt awt event event import java util util import org org jhotdraw jhotdraw geom geom Tool tool to to scribble scribble a a BezierFigure bezi figure author author Werner wern Randelshofer randelshof version 1 1 1 1 2006 2006 07 07 12 12 Extended extend support support for subclassing subclass br 1 1 0 0 2006 2006 01 01 21 21 Created create public class BezierTool bezi tool extends AbstractTool tool private Boolean finishWhenMouseReleased finish when mouse release protected Map map AttributeKey attribute key Object attributes attribute The the prototype prototype for new figures figure private BezierFigure bezi figure prototype prototype The the created create figure figure protected BezierFigure bezi figure createdFigure create figure private CompositeEdit composite edit creationEdit creation edit private int nodeCountBeforeDrag node count before drag Creates create a a new instance instance public BezierTool bezi tool BezierFigure bezi figure prototype prototype this prototype prototype null Creates create a a new instance instance public BezierTool bezi tool BezierFigure bezi figure prototype prototype Map map attributes attribute this prototype prototype prototype prototype this attributes attribute attributes attribute public void draw draw Graphics2D graphics2 d g g if createdFigure create figure null mouseLocation mouse location null Point2D point2 d Double p p createdFigure create figure getEndPoint get end point g g setColor set color Color color black black g g setStroke set stroke new BasicStroke basic stroke g g drawLine draw line p p x x p p y y mouseLocation mouse location x x mouseLocation mouse location y y public void activate activate DrawingEditor drawing editor editor editor super activate activate editor editor getView get view clearSelection clear selection getView get view setCursor set cursor Cursor cursor getPredefinedCursor get predefin cursor Cursor cursor CROSSHAIR c r o s s h a i r CURSOR c u r s o r public void deactivate deactivate DrawingEditor drawing editor editor editor super deactivate deactivate editor editor getView get view setCursor set cursor Cursor cursor getDefaultCursor get cursor if createdFigure create figure null finishCreation finish creation createdFigure create figure createdFigure create figure null getDrawing get drawing fireUndoableEditHappened fire undoable edit happen creationEdit creation edit public void mousePressed mouse press MouseEvent mouse event evt evt super mousePressed mouse press evt evt if createdFigure create figure null finishWhenMouseReleased finish when mouse release null creationEdit creation edit new CompositeEdit composite edit Figur figur erstellen erstellen getDrawing get drawing fireUndoableEditHappened fire undoable edit happen creationEdit creation edit createdFigure create figure createFigure create figure createdFigure create figure addNode add node new BezierPath bezi path Node node getView get view getConstrainer get constrain constrainPoint constrain point getView get view viewToDrawing view to drawing anchor anchor getDrawing get drawing add add createdFigure create figure nodeCountBeforeDrag node count before drag createdFigure create figure getNodeCount get node count else if evt evt getClickCount get click count 1 1 addPointToFigure add point to figure getView get view getConstrainer get constrain constrainPoint constrain point getView get view viewToDrawing view to drawing anchor anchor nodeCountBeforeDrag node count before drag createdFigure create figure getNodeCount get node count protected BezierFigure bezi figure createFigure create figure BezierFigure bezi figure f f BezierFigure bezi figure prototype prototype clone clone getEditor get editor applyDefaultAttributesTo apply attribute to f f if attributes attribute null for Map map Entry entry AttributeKey attribute key Object entry entry attributes attribute entrySet entry set f f setAttribute set attribute entry entry getKey get key entry entry getValue get value return f f protected Figure figure getCreatedFigure get create figure return createdFigure create figure protected Figure figure getAddedFigure get add figure return createdFigure create figure protected void addPointToFigure add point to figure Point2D point2 d Double newPoint point int pointCount point count createdFigure create figure getNodeCount get node count createdFigure create figure willChange will change if pointCount point count 2 2 createdFigure create figure basicAddNode basic add node new BezierPath bezi path Node node newPoint point else Point2D point2 d Double endPoint end point createdFigure create figure getEndPoint get end point Point2D point2 d Double secondLastPoint second last point pointCount point count 1 1 ? ? endPoint end point createdFigure create figure getPoint get point pointCount point count 2 2 0 0 if newPoint point equals equal endPoint end point nothing nothing to to do else if pointCount point count 1 1 Geom geom lineContainsPoint line contain point newPoint point x x newPoint point y y secondLastPoint second last point x x secondLastPoint second last point y y endPoint end point x x endPoint end point y y 0 0 9f 9f getView get view getScaleFactor get scale factor createdFigure create figure basicSetPoint basic set point pointCount point count 1 1 0 0 newPoint point else createdFigure create figure basicAddNode basic add node new BezierPath bezi path Node node newPoint point createdFigure create figure changed change public void mouseClicked mouse click MouseEvent mouse event evt evt if createdFigure create figure null switch evt evt getClickCount get click count case 1 1 if createdFigure create figure getNodeCount get node count 2 2 Rectangle rectangle r r new Rectangle rectangle getView get view drawingToView drawing to view createdFigure create figure getStartPoint get start point r r grow grow 2 2 2 2 if r r contains contain evt evt getX get x evt evt getY get y createdFigure create figure setClosed set close true getView get view addToSelection add to selection createdFigure create figure finishCreation finish creation createdFigure create figure getDrawing get drawing fireUndoableEditHappened fire undoable edit happen creationEdit creation edit createdFigure create figure null fireToolDone fire tool break case 2 2 finishWhenMouseReleased finish when mouse release null finishCreation finish creation createdFigure create figure getView get view addToSelection add to selection createdFigure create figure getDrawing get drawing fireUndoableEditHappened fire undoable edit happen creationEdit creation edit createdFigure create figure null fireToolDone fire tool break public void mouseReleased mouse release MouseEvent mouse event evt evt if finishWhenMouseReleased finish when mouse release Boolean TRUE t r u e if createdFigure create figure getNodeCount get node count 2 2 BezierPath bezi path fittedPath fit path Bezier bezi fitBezierCurve fit bezi curve createdFigure create figure getBezierPath get bezi path 1 1 createdFigure create figure willChange will change createdFigure create figure basicSetBezierPath basic set bezi path fittedPath fit path createdFigure create figure changed change finishCreation finish creation createdFigure create figure createdFigure create figure null getDrawing get drawing fireUndoableEditHappened fire undoable edit happen creationEdit creation edit finishWhenMouseReleased finish when mouse release null fireToolDone fire tool return else if finishWhenMouseReleased finish when mouse release null finishWhenMouseReleased finish when mouse release Boolean FALSE f a l s e if createdFigure create figure getNodeCount get node count nodeCountBeforeDrag node count before drag + + 1 1 createdFigure create figure willChange will change BezierPath bezi path fittedPath fit path new BezierPath bezi path for int i i nodeCountBeforeDrag node count before drag n n createdFigure create figure getNodeCount get node count i i n n i++ i++ fittedPath fit path add add createdFigure create figure getNode get node nodeCountBeforeDrag node count before drag createdFigure create figure basicRemoveNode basic remove node nodeCountBeforeDrag node count before drag fittedPath fit path Bezier bezi fitBezierCurve fit bezi curve fittedPath fit path 1 1 for BezierPath bezi path Node node node node fittedPath fit path createdFigure create figure basicAddNode basic add node node node nodeCountBeforeDrag node count before drag createdFigure create figure getNodeCount get node count createdFigure create figure changed change protected void finishCreation finish creation BezierFigure bezi figure createdFigure create figure getView get view addToSelection add to selection createdFigure create figure public void mouseDragged mouse drag MouseEvent mouse event evt evt if createdFigure create figure null if finishWhenMouseReleased finish when mouse release null finishWhenMouseReleased finish when mouse release Boolean TRUE t r u e int x x evt evt getX get x int y y evt evt getY get y addPointToFigure add point to figure getView get view viewToDrawing view to drawing new Point point x x y y public void mouseMoved mouse move MouseEvent mouse event evt evt if createdFigure create figure null 