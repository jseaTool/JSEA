save before action java 2 0 2006 06 15 copyright c 2005 2006 wern randelshof staldenmattweg 2 immensee c h 6405 switzerland all right reserve software is the confidential and proprietary information of wern randelshof confidential information you shall not disclose such confidential information and shall use it only in accordance with the term of the license agreement you enter into with wern randelshof org jhotdraw app action org jhotdraw io org jhotdraw gui org jhotdraw gui event org jhotdraw util java awt java awt event javax swing java io org jhotdraw app application org jhotdraw app project base action that can only be safely perform when the project ha no unsav change p the project ha no unsav change method it is invoke immediately unsav change are present a dialog is show asking wheth the user want to discard the change cancel or save the change before it the user choos to discard the chaneg to it is invoke immediately the user choos to cancel the action is abort the user choos to save the change the project is save and it is only invoke after the project wa successfully save author wern randelshof version 2 0 2006 06 15 rework br 1 2 2006 05 19 make filename acceptable by extension file filter br 1 1 2006 05 03 localize message br 1 0 27 september 2005 create save before action project action component old focus owner create a instance save before action application app super app action perform action event evt project p get current project p is enable resource bundle util label resource bundle util get l a f bundle org jhotdraw app label window w ancestor swing utility get window ancestor p get component old focus owner w ancestor null ? null w ancestor get focus owner p set enable false p ha unsav change j option pane pane j option pane html + u i manager get string option pane cs + label get string save before message j option pane w a r n i n g m e s s a g e object option label get string save label get string cancel label get string dont save pane set option option pane set initial value option 0 pane put client property quaqua option pane destructive option integer 2 j sheet show sheet pane p get component sheet listener option select sheet event evt object value evt get value value null || value equal label get string cancel p set enable true value equal label get string dont save it p p set enable true value equal label get string save save change p it p p set enable true old focus owner null old focus owner request focus save change project p p get file null j file chooser file chooser p get save chooser option file chooser show save dialog j sheet show save sheet file chooser p get component sheet listener option select sheet event evt evt get option j file chooser a p p r o v e o p t i o n file file evt get file chooser get file filter extension file filter file extension file filter evt get file chooser get file filter make acceptable evt get file chooser get select file file evt get file chooser get select file save to file p file p set enable true old focus owner null old focus owner request focus save to file p p get file save to file project p file file p execute worker object construct p write file null i o exception e e finish object value file save p file value file save project p file file object value value null p set file file p mark change a save it p resource bundle util label resource bundle util get l a f bundle org jhotdraw app label j sheet show message sheet p get component html + u i manager get string option pane cs + label get format couldnt save file value j option pane e r r o r m e s s a g e p set enable true old focus owner null old focus owner request focus it project p 