quad tree drawing java 2 0 2006 01 14 copyright c 1996 2006 by the original author of jhotdraw and all it contributor jhotdraw org all right reserve software is the confidential and proprietary information of jhotdraw org confidential information you shall not disclose such confidential information and shall use it only in accordance with the term of the license agreement you enter into with jhotdraw org ??? org jhotdraw draw org jhotdraw geom quad tree2 d org jhotdraw util reverse list java awt java awt geom javax swing javax swing event org jhotdraw util java util quad tree drawing us a quad tree2 d to improve responsiveness of drawing which contain many figure author wern randelshof version 2 0 2006 01 14 change to support precision coordinate br 1 0 2003 12 01 derive from jhotdraw 5 4b1 quad tree drawing drawingimplement figure listener undoable edit listener array list figure figure array list figure quad tree2 d figure quad tree quad tree2 d figure need sorting false create a instance quad tree drawing index of figure figure figure index of figure basic add index figure figure figure add index figure quad tree add figure figure get draw bound figure add figure listener figure add undoable edit listener need sorting true basic remove figure figure figure remove figure quad tree remove figure figure remove figure listener figure remove undoable edit listener need sorting true draw graphics2 d g collection figure c quad tree find intersect g get clip bound get bounds2 d collection figure to draw sort c draw g to draw implementation note sorting can not be orphan figure collection figure sort collection figure c ensure sort array list figure sort array list figure c size figure f figure c contain f sort add f sort draw graphics2 d g collection figure c figure f c f draw g figure area invalidate figure event e fire area invalidate e get invalidate area figure change figure event e quad tree remove e get figure quad tree add e get figure e get figure get draw bound need sorting true fire area invalidate e get invalidate area figure add figure event e figure remove figure event e figure request remove figure event e remove e get figure collection figure get figure rectangle2 d bound quad tree find inside bound collection figure get figure collection unmodifiable collection figure figure find figure inside point2 d p collection figure c quad tree find contain p figure f get figure front to back c contain f f contain p f find figure inside p null an iterator to iterate in z order front to back over the figure java util list figure get figure front to back ensure sort reverse list figure figure figure find figure point2 d p collection figure c quad tree find contain p c size 0 null 1 figure f c iterator next f contain p ? f null figure f get figure front to back c contain f f contain p f null figure find figure except point2 d p figure ignore collection figure c quad tree find contain p c size 0 null 1 figure f c iterator next f ignore || f contain p ? null f figure f get figure front to back f ignore f contain p f null figure find figure except point2 d p collection ignore collection figure c quad tree find contain p c size 0 null 1 figure f c iterator next ignore contain f || f contain p ? null f figure f get figure front to back ignore contain f f contain p f null collection figure find figure rectangle2 d r collection figure c quad tree find intersect r c size 0 fall through 1 c sort c collection figure find figure within rectangle2 d r collection figure c find figure r array list figure result array list figure c size figure f c r contain f get bound result add f result bring to front figure figure figure remove figure figure add figure need sorting true fire area invalidate figure get draw bound send to back figure figure figure remove figure figure add 0 figure need sorting true fire area invalidate figure get draw bound we propagate all edit event from our figure to undoable edit listener which have register with u undoable edit happen undoable edit event e fire undoable edit happen e get edit figure attribute change figure event e contain figure f figure contain f ensure that the figure are sort in z order sequence ensure sort need sorting collection sort figure figure layer comparator i n s t a n c e need sorting false 