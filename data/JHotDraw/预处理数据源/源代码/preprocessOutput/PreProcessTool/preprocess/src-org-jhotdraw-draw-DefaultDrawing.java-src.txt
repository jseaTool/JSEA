org jhotdraw draw org jhotdraw util reverse list java awt java awt geom javax swing javax swing event javax swing undo org jhotdraw util java util drawingextend drawingimplement figure listener undoable edit listener array list figure figure array list figure need sorting false drawing index of figure figure figure index of figure basic add index figure figure figure add index figure figure add figure listener figure add undoable edit listener invalidate sort order basic remove figure figure figure remove figure figure remove figure listener figure remove undoable edit listener invalidate sort order draw graphics2 d g get lock ensure sort array list figure to draw array list figure figure size rectangle clip rect g get clip bound figure f figure f get draw bound intersect clip rect to draw add f draw g to draw draw graphics2 d g collection figure figure figure f figure f is visible f draw g collection figure sort collection figure c hash set figure unsort hash set figure unsort add all c array list figure sort array list figure c size figure f figure unsort contain f sort add f unsort remove f figure f c unsort contain f sort add f unsort remove f sort figure area invalidate figure event e fire area invalidate e get invalidate area figure change figure event e invalidate sort order fire area invalidate e get invalidate area figure add figure event e figure remove figure event e figure request remove figure event e remove e get figure figure find figure point2 d p figure f get figure front to back f is visible f contain p f null figure find figure except point2 d p figure ignore figure f get figure front to back f ignore f is visible f contain p f null figure find figure except point2 d p collection figure ignore figure f get figure front to back ignore contain f f is visible f contain p f null collection figure find figure rectangle2 d bound array list figure intersection array list figure figure f figure f is visible f get bound intersect bound intersection add f intersection collection figure find figure within rectangle2 d bound array list figure contain array list figure figure f figure f is visible bound contain f get bound contain add f contain collection figure get figure collection unmodifiable collection figure figure find figure inside point2 d p figure f find figure p f null ? null f find figure inside p java util list figure get figure front to back ensure sort reverse list figure figure bring to front figure figure figure remove figure figure add figure invalidate sort order fire area invalidate figure get draw bound send to back figure figure figure remove figure figure add 0 figure invalidate sort order fire area invalidate figure get draw bound undoable edit happen undoable edit event e fire undoable edit happen e get edit figure attribute change figure event e contain figure f figure contain f invalidate sort order need sorting true ensure sort need sorting collection sort figure figure layer comparator i n s t a n c e need sorting false 