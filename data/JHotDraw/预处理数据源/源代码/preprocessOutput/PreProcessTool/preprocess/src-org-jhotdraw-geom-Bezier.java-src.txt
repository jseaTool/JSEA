org jhotdraw geom org jhotdraw util java awt java awt geom bezi m a x p o i n t s 1000 bezi main string arg point2 d d point2 d 0 0 0 0 point2 d 0 0 0 5 point2 d 1 1 1 4 point2 d 2 1 1 6 point2 d 3 2 1 1 point2 d 4 0 0 2 point2 d 4 0 0 0 error 4 0 general path path fit curve d error system out println path general path fit curve polygon p error point2 d d point2 d p npoint i 0 i d length i++ d i point2 d p xpoint i p ypoint i fit curve d error general path fit curve point2 d d error point2 d t hat1 point2 d point2 d t hat2 point2 d general path bezi path general path bezi path move to d 0 x d 0 y t hat1 compute left tangent d 0 t hat2 compute right tangent d d length 1 fit cubic d 0 d length 1 t hat1 t hat2 error bezi path bezi path bezi path fit bezi curve bezi path path error point2 d d path to polygon array point2 d t hat1 point2 d point2 d t hat2 point2 d bezi path bezi path bezi path bezi path add bezi path node d 0 t hat1 compute left tangent d 0 t hat2 compute right tangent d d length 1 fit cubic d 0 d length 1 t hat1 t hat2 error bezi path bezi path set close path is close bezi path fit cubic point2 d d first last point2 d t hat1 point2 d t hat2 error general path bezi path point2 d bez curve u u prime max error split point 1 n pt iteration error max iteration 4 point2 d t hat center point2 d i iteration error error error n pt last first + 1 n pt 2 dist v2 distance between2 point d last d first 3 0 bez curve point2 d 4 i 0 i bez curve length i++ bez curve i point2 d bez curve 0 d first bez curve 3 d last v2 add bez curve 0 v2 scale t hat1 dist bez curve 1 v2 add bez curve 3 v2 scale t hat2 dist bez curve 2 bezi path curve to bez curve 1 x bez curve 1 y bez curve 2 x bez curve 2 y bez curve 3 x bez curve 3 y u chord length parameterize d first last bez curve generate bezi d first last u t hat1 t hat2 max error compute max error d first last bez curve u split point max error error bezi path curve to bez curve 1 x bez curve 1 y bez curve 2 x bez curve 2 y bez curve 3 x bez curve 3 y max error iteration error i 0 i max iteration i++ u prime reparameterize d first last u bez curve bez curve generate bezi d first last u prime t hat1 t hat2 max error compute max error d first last bez curve u prime split point max error error bezi path curve to bez curve 1 x bez curve 1 y bez curve 2 x bez curve 2 y bez curve 3 x bez curve 3 y u u prime t hat center compute center tangent d split point 0 fit cubic d first split point 0 t hat1 t hat center error bezi path v2 negate t hat center fit cubic d split point 0 last t hat center t hat2 error bezi path fit cubic point2 d d first last point2 d t hat1 point2 d t hat2 error bezi path bezi path point2 d bez curve u u prime max error split point 1 n pt iteration error max iteration 4 point2 d t hat center point2 d i iteration error error error n pt last first + 1 n pt 2 dist v2 distance between2 point d last d first 3 0 bez curve point2 d 4 i 0 i bez curve length i++ bez curve i point2 d bez curve 0 d first bez curve 3 d last v2 add bez curve 0 v2 scale t hat1 dist bez curve 1 v2 add bez curve 3 v2 scale t hat2 dist bez curve 2 bezi path curve to bez curve 1 x bez curve 1 y bez curve 2 x bez curve 2 y bez curve 3 x bez curve 3 y u chord length parameterize d first last bez curve generate bezi d first last u t hat1 t hat2 max error compute max error d first last bez curve u split point max error error bezi path curve to bez curve 1 x bez curve 1 y bez curve 2 x bez curve 2 y bez curve 3 x bez curve 3 y max error iteration error i 0 i max iteration i++ u prime reparameterize d first last u bez curve bez curve generate bezi d first last u prime t hat1 t hat2 max error compute max error d first last bez curve u prime split point max error error bezi path curve to bez curve 1 x bez curve 1 y bez curve 2 x bez curve 2 y bez curve 3 x bez curve 3 y u u prime t hat center compute center tangent d split point 0 fit cubic d first split point 0 t hat1 t hat center error bezi path v2 negate t hat center fit cubic d split point 0 last t hat center t hat2 error bezi path point2 d generate bezi point2 d d first last u prime point2 d t hat1 point2 d t hat2 i point2 d a point2 d m a x p o i n t s 2 n pt c 2 2 x 2 det c0 c1 det c0 x det x c1 alpha l alpha r point2 d tmp point2 d point2 d bez curve bez curve point2 d 4 i 0 i bez curve length i++ bez curve i point2 d n pt last first + 1 i 0 i n pt i++ point2 d v1 v2 v1 point2 d t hat1 clone v2 point2 d t hat2 clone v2 scale v1 b1 u prime i v2 scale v2 b2 u prime i a i 0 v1 a i 1 v2 c 0 0 0 0 c 0 1 0 0 c 1 0 0 0 c 1 1 0 0 x 0 0 0 x 1 0 0 i 0 i n pt i++ c 0 0 + v2 dot a i 0 a i 0 c 0 1 + v2 dot a i 0 a i 1 c 1 0 c 0 1 c 1 1 + v2 dot a i 1 a i 1 tmp v2 sub i i d first + i v2 add i i v2 scale i i i d first b0 u prime i v2 add i i v2 scale i i i d first b1 u prime i v2 add i i v2 scale i i i d last b2 u prime i v2 scale i i i d last b3 u prime i x 0 + v2 dot a i 0 tmp x 1 + v2 dot a i 1 tmp det c0 c1 c 0 0 c 1 1 c 1 0 c 0 1 det c0 x c 0 0 x 1 c 0 1 x 0 det x c1 x 0 c 1 1 x 1 c 0 1 det c0 c1 0 0 det c0 c1 c 0 0 c 1 1 10e 12 alpha l det x c1 det c0 c1 alpha r det c0 x det c0 c1 alpha l 1 0e 6 || alpha r 1 0e 6 dist v2 distance between2 point d last d first 3 0 bez curve 0 d first bez curve 3 d last v2 add bez curve 0 v2 scale t hat1 dist bez curve 1 v2 add bez curve 3 v2 scale t hat2 dist bez curve 2 bez curve bez curve 0 d first bez curve 3 d last v2 add bez curve 0 v2 scale t hat1 alpha l bez curve 1 v2 add bez curve 3 v2 scale t hat2 alpha r bez curve 2 bez curve reparameterize point2 d d first last u point2 d bez curve n pt last first + 1 i u prime u prime n pt i first i last i++ u prime i first newton raphson root find bez curve d i u i first u prime newton raphson root find point2 d q point2 d p u numerator denominator point2 d q1 point2 d 3 q2 point2 d 2 point2 d q u point2 d q1 u point2 d q2 u point2 d u prime i q u bezi i i 3 q u i 0 i 2 i++ q1 i point2 d q i + 1 x q i x 3 0 q i + 1 y q i y 3 0 i 0 i 1 i++ q2 i point2 d q1 i + 1 x q1 i x 2 0 q1 i + 1 y q1 i y 2 0 q1 u bezi i i 2 q1 u q2 u bezi i i 1 q2 u numerator q u x p x q1 u x + q u y p y q1 u y denominator q1 u x q1 u x + q1 u y q1 u y + q u x p x q2 u x + q u y p y q2 u y u prime u numerator denominator u prime point2 d bezi i i degree point2 d v t i j point2 d q point2 d vtemp vtemp point2 d degree + 1 i 0 i degree i++ vtemp i point2 d v i clone i 1 i degree i++ j 0 j degree i j++ vtemp j x 1 0 t vtemp j x + t vtemp j + 1 x vtemp j y 1 0 t vtemp j y + t vtemp j + 1 y q vtemp 0 q b0 u tmp 1 0 u tmp tmp tmp b1 u tmp 1 0 u 3 u tmp tmp b2 u tmp 1 0 u 3 u u tmp b3 u u u u point2 d compute left tangent point2 d d end point2 d t hat1 point2 d t hat1 v2 sub i i d end + 1 d end t hat1 v2 normalize t hat1 t hat1 point2 d compute right tangent point2 d d end point2 d t hat2 point2 d t hat2 v2 sub i i d end 1 d end t hat2 v2 normalize t hat2 t hat2 point2 d compute center tangent point2 d d center point2 d v1 point2 d v2 point2 d t hat center point2 d v1 v2 sub i i d center 1 d center v2 v2 sub i i d center d center + 1 t hat center x v1 x + v2 x 2 0 t hat center y v1 y + v2 y 2 0 t hat center v2 normalize t hat center t hat center chord length parameterize point2 d d first last i u u last first + 1 u 0 0 0 i first + 1 i last i++ u i first u i first 1 + v2 distance between2 point d i d i 1 i first + 1 i last i++ u i first u i first u last first u compute max error point2 d d first last point2 d bez curve u split point i max dist dist point2 d p point2 d point2 d v point2 d split point 0 last first + 1 2 max dist 0 0 i first + 1 i last i++ p bezi i i 3 bez curve u i first v v2 sub i i p d i dist v2 square length v dist max dist max dist dist split point 0 i max dist point2 d v2 add i i point2 d a point2 d b point2 d c point2 d c x a x + b x c y a y + b y c point2 d v2 scale i i i point2 d v s point2 d result point2 d result x v x s result y v y s result point2 d v2 sub i i point2 d a point2 d b point2 d c point2 d c x a x b x c y a y b y c v2 distance between2 point point2 d a point2 d b dx a x b x dy a y b y math sqrt dx dx + dy dy point2 d v2 scale point2 d v newlen len v2 length v len 0 0 v x newlen len v y newlen len v v2 length point2 d a math sqrt v2 square length a v2 square length point2 d a a x a x + a y a y point2 d v2 add point2 d a point2 d b point2 d c c x a x + b x c y a y + b y c point2 d v2 negate point2 d v v x v x v y v y v v2 dot point2 d a point2 d b a x b x + a y b y point2 d v2 normalize point2 d v len v2 length v len 0 0 v x len v y len v 