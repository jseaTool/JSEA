org jhotdraw draw org jhotdraw geom quad tree2 d org jhotdraw util reverse list java awt java awt geom javax swing javax swing event org jhotdraw util java util quad tree drawing drawingimplement array list figure figure array list figure quad tree2 d figure quad tree quad tree2 d figure need sorting false quad tree drawing index of figure figure figure index of figure basic add index figure figure figure add index figure quad tree add figure figure get draw bound figure add figure listener figure add undoable edit listener need sorting true basic remove figure figure figure remove figure quad tree remove figure figure remove figure listener figure remove undoable edit listener need sorting true draw graphics2 d g collection figure c quad tree find intersect g get clip bound get bounds2 d collection figure to draw sort c draw g to draw collection figure sort collection figure c ensure sort array list figure sort array list figure c size figure f figure c contain f sort add f sort draw graphics2 d g collection figure c figure f c f draw g figure area invalidate figure event e fire area invalidate e get invalidate area figure change figure event e quad tree remove e get figure quad tree add e get figure e get figure get draw bound need sorting true fire area invalidate e get invalidate area figure add figure event e figure remove figure event e figure request remove figure event e remove e get figure collection figure get figure rectangle2 d bound quad tree find inside bound collection figure get figure collection unmodifiable collection figure figure find figure inside point2 d p collection figure c quad tree find contain p figure f get figure front to back c contain f f contain p f find figure inside p null java util list figure get figure front to back ensure sort reverse list figure figure figure find figure point2 d p collection figure c quad tree find contain p c size 0 null 1 figure f c iterator next f contain p ? f null figure f get figure front to back c contain f f contain p f null figure find figure except point2 d p figure ignore collection figure c quad tree find contain p c size 0 null 1 figure f c iterator next f ignore || f contain p ? null f figure f get figure front to back f ignore f contain p f null figure find figure except point2 d p collection ignore collection figure c quad tree find contain p c size 0 null 1 figure f c iterator next ignore contain f || f contain p ? null f figure f get figure front to back ignore contain f f contain p f null collection figure find figure rectangle2 d r 