bezi bezi line connection java 1 0 1 2006 02 06 copyright c 1996 2006 by the original author of jhotdraw and all it contributor jhotdraw org all right reserve software is the confidential and proprietary information of jhotdraw org confidential information you shall not disclose such confidential information and shall use it only in accordance with the term of the license agreement you enter into with jhotdraw org a line connection is a standard implementation of the connection figure the is implement with bezi figure author wern randelshof version 1 0 1 2006 02 06 fix redo bug br 1 0 23 januar 2006 create handle figure change in the start and the end figure the comment line below must stay comment out is because we must not set our connector to null in order to support reconnection using redo evt get figure owner get start figure || evt get figure owner get end figure owner set start connector null owner set end connector null owner fire figure request remove figure change figure event e e get source owner get start figure || e get source owner get end figure owner will change owner update connection owner change figure add figure event e figure attribute change figure event e figure area invalidate figure event e create a instance line connection figure d r a w i n g s h a p e a n d b o u n d s ensure that a connection is update the connection wa move basic transform affine transform tx super basic transform tx update connection make sure that we are still connect a t t r i b u t e s e d i t i n g get the handle of the figure it the normal polyline handle but add change connection handle at the start and end collection handle create handle detail level array list handle handle array list handle get node count detail level 0 get liner null i 1 n get node count 1 i n i++ handle add bezi node handle i handle add change connection start handle handle add change connection end handle handle c o n n e c t i n g test wheth a figure can be a connection target connection figure cannot be connect and false can connect false update connection will change get start connector null point2 d start get start connector find start start null basic set start point start get end connector null point2 d end get end connector find end end null basic set end point end change validate super validate lineout can connect figure start figure end start can connect end can connect connect same connection figure other other get start connector get start connector other get end connector get end connector connector get end connector end connector figure get end figure end connector null ? null end connector get owner connector get start connector start connector figure get start figure start connector null ? null start connector get owner note method is only testing purpose you can remove the keywoard at any time set end connector connector end connector old end end connector end old end will change basic set end connector end fire undoable edit happen undoable edit string get presentation name end verbindung setzen undo cannot undo exception super undo will change basic set end connector old end change redo cannot undo exception super redo will change basic set end connector end change change basic set end connector connector end end end connector end connector null get end figure remove figure listener connection handler get start figure null handle disconnect get start figure get end figure end connector end end connector null get end figure add figure listener connection handler get start figure null get end figure null handle connect get start figure get end figure update connection note method is only testing purpose you can remove the keywoard at any time set start connector connector start connector old start start connector start old start will change basic set start connector start fire undoable edit happen undoable edit string get presentation name start verbindung setzen undo cannot undo exception super undo will change basic set start connector old start change redo cannot undo exception super redo will change basic set start connector start change change basic set start connector connector start start start connector start connector null get start figure remove figure listener connection handler get end figure null handle disconnect get start figure get end figure start connector start start connector null get start figure add figure listener connection handler get start figure null get end figure null handle connect get start figure get end figure update connection c o m p o s i t e f i g u r e s l a y o u t liner get bezi path layout liner get attribute b e z i e r p a t h l a y o u t e r set bezi path layout liner value set attribute b e z i e r p a t h l a y o u t e r value lay out the connection is call when the connection itself change by the connection is recalculate layout connection get start connector null get end connector null will change liner bpl get bezi path layout bpl null bpl lineout get start connector null point2 d start get start connector find start start null basic set start point start get end connector null point2 d end get end connector find end end null basic set end point end change c l o n i n g e v e n t h a n d l i n g add notify drawing drawing super add notify drawing get start connector null get end connector null handle connect get start figure get end figure remove notify drawing drawing set start connector null set end connector null get start connector null get end connector null handle disconnect get start figure get end figure super remove notify drawing handle the disconnection of a connection override method to handle event handle disconnect figure start figure end handle the connection of a connection override method to handle event handle connect figure start figure end line connection figure clone line connection figure that line connection figure super clone that connection handler connection handler that liner null that liner liner liner clone that share the same connector that object ha to work properly that must be register a a figure listener to the connect figure start connector null that start connector connector start connector clone that get start figure add figure listener that connection handler end connector null that end connector connector end connector clone that get end figure add figure listener that connection handler that start connector null that end connector null that handle connect that get start figure that get end figure that update connection that remap map old to will change super remap old to figure start figure null figure end figure null get start figure null start figure figure old to get get start figure start figure null start figure get start figure get end figure null end figure figure old to get get end figure end figure null end figure get end figure start figure null set start connector start figure find compatible connector get start connector true end figure null set end connector end figure find compatible connector get end connector false update connection change can connect figure start start can connect handle a mouse click handle mouse click point2 d p mouse event evt drawing view view get liner null evt get click count 2 will change index basic split segment p 5f view get scale factor index 1 bezi path node node get node index fire undoable edit happen undoable edit redo cannot redo exception super redo will change basic add node index node change undo cannot undo exception super undo will change basic remove node index change change true false p e r s i s t e n c e read point dom input in i o exception super read point in in open element start connector set start connector connector in read object in close element in open element end connector set end connector connector in read object in close element read dom input in i o exception read point in read attribute in read liner in read liner dom input in i o exception in get element count liner 0 in open element liner liner liner in read object in close element write dom output out i o exception write point out write attribute out write liner out write liner dom output out i o exception liner null out open element liner out write object liner out close element write point dom output out i o exception super write point out out open element start connector out write object get start connector out close element out open element end connector out write object get end connector out close element set liner liner value will change liner value change basic set node index bezi path node p index 0 index get point count 1 get start connector null point2 d start get start connector find start start null basic set start point start get end connector null point2 d end get end connector find end end null basic set end point end super basic set node index p basic set point index point2 d p index 0 index get point count 1 get start connector null point2 d start get start connector find start start null basic set start point start get end connector null point2 d end get end connector find end end null basic set end point end super basic set point index p lineout liner null liner lineout f i x m e liner must work with a p i of line connection bezi path get bezi path path liner get liner liner set start point point2 d p set point 0 p set point index point2 d p set point index 0 p set end point point2 d p set point get point count 1 p reverse connection start connector null end connector null handle disconnect start connector get owner end connector get owner connector tmp c start connector start connector end connector end connector tmp c point2 d tmp p get start point set start point get end point set end point tmp p handle connect start connector get owner end connector get owner update connection 