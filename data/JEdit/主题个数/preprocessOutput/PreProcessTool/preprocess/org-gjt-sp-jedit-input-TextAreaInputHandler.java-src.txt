text area input handler manage key binding execute action tab size 4 indent size 4 no tab collapse fold 1 2006 matthieu casanova g n u 2 w i t h o u t n y w r r n t y m e r h n t b i l i t y f i t n e s s f o r p r t i u l r p u r p o s e g n u g n u 59 330 m 02111 1307 u s input importsimport debug gui key event translator gui key event workaround textarea text area log standard utility event key event hashtable j edit bean shell action buffer j edit buffer gui shortcut prefix active event manage key binding execute action bind on keyboard event standalone textarea matthieu casanova fold handler 5568 2006 07 10 20 52 23 kpou text area input handler input handler j edit bean shell action text area text area text area input handler constructor text area input handler text area text area text area text area binding current binding hashtable process key event forward key event directly input handler slightly fast than using key listener because some overhead avoid evt keyboard event from source event since input handler textarea alway 1 global only event come from keyboard focus since 4 3pre7 override process key event key event evt from global debug d u m p k e y e v e n t s log log log d e b u g key event + evt + from + from log log log d e b u g view+ focus +view focus + evt consume debug d u m p k e y e v e n t s log log log d e b u g key event preprocess + evt evt key event workaround process key event evt evt debug d u m p k e y e v e n t s log log log d e b u g key event after workaround + evt + from + from focus on text area evt get key event k e y t y p e d user press eg c+e n n search bar we want focus go back there after prefix key event interceptor key event interceptor key type evt prefix active || text area ha focus process key event key stroke handling evt from type global process key event sub focus on text area key event k e y p r e s s e d key event interceptor key event interceptor key press evt key event workaround bindable evt get key process key event key stroke handling evt from press global process key event sub focus on text area key event k e y r e l e s e d key event interceptor key event interceptor key release evt process key event sub process key event sub focus on text area weird hack we t want c+e insert search bar search bar ha focus prefix active focus on text area text area request focus get action j edit bean shell action get action action action specify action repeating recording necessary action action since j edit 4 2pre1 override action action action get action action action specify action repeating recording necessary action action override action j edit bean shell action action j edit buffer buffer text area get buffer buffer inside compound edit buffer end compound edit remember last execute action action no remember last last action action last action count++ last action action last action count 1 remember old value action change them repeat count repeat count execute action action no repeat || repeat count 1 action text area buffer begin compound edit i 0 i repeat count i++ action text area buffer end compound edit repeat wa originally clear otherwise might be set action etc repeat count 1 first all action set read next clear repeat read next repeat count 1 handle key handle given keystroke key stroke key stroke dry run only calculate value other effect since j edit 4 2pre5 override handle key key event translator key key stroke dry run input \0 key stroke modifier || key stroke modifier equal s key stroke key input key stroke key input key stroke input read next input \0 dry run set current binding binding read next input repeat count 1 dry run read next o current binding get key stroke o dry run t beep user press some key we t know about unles prefix active otherwise beep when cap lock press etc current binding binding u i get look feel provide feedback f10 pass on c+e f10 shouldn t repeat count 1 set current binding binding input \0 key stroke from global context let user input only local user input input send shortcut prefix off o hashtable dry run set current binding hashtable o shortcut prefix active event fire prefix state change current binding shortcut on o dry run set current binding binding send shortcut prefix off action o o j edit bean shell action dry run set current binding binding send shortcut prefix off action j edit bean shell action o dry run send shortcut prefix off user input user input ch last action count 0 repeat count 1 text area user input ch repeat count 1 read next read next ch str standard utility escape value ch might bit slow occur lot index index read next index 1 read next read next substring 0 index + \ + str + \ + read next substring index + 8 read next 