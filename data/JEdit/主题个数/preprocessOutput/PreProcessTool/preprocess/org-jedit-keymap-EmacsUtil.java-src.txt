keymap buffer edit action register gui history model gui input handler j edit textarea selection textarea text area emac utility function these function are base on emac bsh from emac macro brian m clapper rewrite alan ezust 2013 emac buffer buffer text area text area emac buffer j edit get active view get buffer text area j edit get active view get text area emac kill line last action wa repeating same emac emac kill line caret text area get caret position caret line text area get caret line line end text area get line end offset caret line we re at end line ignore trailing white space then kill newline too caret2 caret + 1 caret2 line end ch at caret2 character whitespace ch caret2++ delete text selection selection caret2 line end we re at end line join line next line delete text area join line emulate emac better caret line text area get last physical line selection selection range caret caret2 simple delete end line selection selection range caret line end 1 text area delete end line selection text area set selection selection delete text text area get select text text area replace selection text area remove from selection selection last action wa clipboard get clipboard clipboard clipboard set clipboard clipboard + delete text set clipboard delete text repeating same name input handler ih j edit get active view get input handler edit action last action ih get last action last action count ih get last action count when call from within last action last action count great than 1 then s repeat repeat last action get name equal name last action count 1 repeat repeat line at i builder sb builder at end buffer i at i sb append sb at i i buffer get length 0 buffer get text i 1 at 0 at caret caret text area get caret position at end buffer ? \0 buffer get text caret 1 at 0 at end buffer text area text area j edit get active view get text area at end buffer text area get caret position at end buffer caret caret buffer get length eat non alphanum eat eat ch at caret ch text area go next line text area go start line character letter digit ch eat text area go next character text area get caret position eat whitespace eat eat ch at caret ch text area go next line text area go start line character whitespace ch text area go next character eat text area get caret position get cardinal property name value result j edit get property name value result 0 result value result make buffer property name prefix make buffer property name buffer prefix make buffer property name buffer buffer prefix builder prop name builder prefix convert window style separator unix one since backslash are special character property sep get property separator buf name sep equal backslash also special regular expression since theory separator could anyth we check explicitly backslash here sep equal \\ sep builder sep append \\ buf name buffer get path replace all sep buf name buffer get path prop name append buf name prop name get wrap get cardinal property buffer max line len 79 get mark buffer buffer prop name make buffer property name emac mark mark get cardinal property prop name 1 mark 1 mark buffer get length mark buffer get length 1 mark set mark buffer buffer po prop name make buffer property name buffer emac mark j edit set temporary property prop name value po beep u i get look feel provide feedback selection get kill region there s selection use instead caret text area get caret position selection selection text area get selection at offset caret selection mark get mark buffer mark 1 beep selection selection range math min caret mark math max caret mark text area set selection selection selection get clipboard value register get register set clipboard register set register set clipboard selection selection text area text area j edit get active view get text area set clipboard text area get select text selection add clipboard history special register clipboard set clipboard save text history too history model get model clipboard add item add clipboard history selection selection add clipboard history text area get select text selection find end sentence caret text area get caret position at end buffer caret ch at caret ch character whitespace at caret + 1 caret++ caret++ caret find beginning sentence caret text area get caret position 1 at caret caret caret 0 ch at caret ch character whitespace at caret + 1 caret++ character upper ch caret caret 0 character whitespace at caret caret caret 