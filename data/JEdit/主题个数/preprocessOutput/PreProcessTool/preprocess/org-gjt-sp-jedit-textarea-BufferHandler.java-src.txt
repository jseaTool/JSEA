buffer handler tab size 4 indent size 4 no tab collapse fold 1 2001 2005 g n u 2 w i t h o u t n y w r r n t y m e r h n t b i l i t y f i t n e s s f o r p r t i u l r p u r p o s e g n u g n u 59 330 m 02111 1307 u s textarea iterator buffer debug note we take great care defer complicate calculation end current transaction buffer inform u compound edit progress transaction progress greatly speed up replace all example only certain thing once particularly move caret position replace all large example very slow 3 2 fast 4 0 where transaction optimization wa introduce fast still 4 1 where wa further improve there still work t o d o txt buffer handler buffer listener display display text area text area j edit buffer buffer delay update delay multiline update delay update start delay update end buffer change handler constructor buffer handler display display text area text area j edit buffer buffer display display text area text area buffer buffer buffer load buffer load j edit buffer buffer display buffer load text area finish caret update fold handler change fold handler change j edit buffer buffer display fold handler change fold level change fold level change j edit buffer buffer start end err fold level change + start 1 + + text area get last physical line + + end text area get display display end 0 buffer loading text area invalidate line range start 1 text area get last physical line content insert content insert j edit buffer buffer start line offset num line length buffer loading display screen line mgr content insert start line num line end line start line + num line num line 0 delay multiline update display fold content insert start line num line first line first line display first line scroll line count scroll line count display scroll line count text area get display display first line content insert start line num line scroll line count content insert start line num line delay update end start line delay update end + num line delay update start line end line resize selection necessary iterator selection it text area get selection iterator it ha next selection s it next s content insert buffer start line offset num line length delay update s start line s end line caret text area get caret position caret offset scroll mode text area caret auto scroll ? text area e l e t r i s r o l l text area n o s r o l l text area move caret position caret + length scroll mode scroll mode text area caret auto scroll ? text area n o r m l s r o l l text area n o s r o l l text area move caret position caret scroll mode first line set call reset scroll line count set call reset pre content insert call when text about insert buffer buffer buffer question start line first line offset start offset from beginning buffer num line number line insert length number character insert since j edit 4 3pre11 pre content insert j edit buffer buffer start line offset num line length buffer loading text area get display display get ready fold start line display first line pre content insert start line num line display scroll line count pre content insert start line num line pre content remove call when text about remove from buffer still present buffer buffer question start line first line offset start offset from beginning buffer num line number line remove length number character remove since j edit 4 3pre3 pre content remove j edit buffer buffer start line offset num line length buffer loading first line first line display first line scroll line count scroll line count display scroll line count text area get display display num line 0 get ready fold start line last line start line + num line display line visible start line || display line visible last line || offset buffer get line start offset start line || offset + length buffer get line start offset last line get ready fold start line get ready fold last line removal touch inside fold remain line first line pre content remove start line offset num line scroll line count pre content remove start line offset num line delay update end start line delay update end num line delay update start line start line first line set call reset scroll line count set call reset display screen line mgr content remove start line num line num line 0 delay multiline update display fold pre content remove start line num line display fold reset buffer get line count first line set call reset scroll line count set call reset first line get physical line display get last visible line || first line get physical line display get first visible line handle comment at end transaction complete content remove content remove j edit buffer buffer start line start num line length buffer loading first line first line display first line scroll line count scroll line count display scroll line count text area get display display first line content remove start line start num line scroll line count content remove start line start num line resize selection necessary n sel text area get selection count iterator selection it text area get selection iterator it ha next selection s it next s content remove buffer start line start num line length delay update s start line s end line n sel 1 s start s end it remove caret text area get caret position caret start + length scroll mode text area caret auto scroll ? text area e l e t r i s r o l l text area n o s r o l l text area move caret position caret length scroll mode caret start scroll mode text area caret auto scroll ? text area e l e t r i s r o l l text area n o s r o l l text area move caret position start scroll mode scroll mode text area caret auto scroll ? text area n o r m l s r o l l text area n o s r o l l text area move caret position caret scroll mode transaction complete transaction complete j edit buffer buffer text area get display display delay update delay update delay update text area finish caret update delay update debug debug s r o l l v e r i f y line delay update start display line visible line line display get next visible line line err delay update start + + delay update end + + text area get line count scroll line count 0 line 1 line delay update end scroll line count + display get screen line count line line display get next visible line line scroll line count display get scroll line count internal scroll line count + + display get scroll line count delay update delay update must before below call so chunk cache update an invisible first line above display notify screen line change delay multiline update text area invalidate screen line range text area chunk cache get screen line offset delay update start 0 text area get visible line delay multiline update text area invalidate line range delay update start delay update end update visible line visible line text area get visible line visible line 0 text area chunk cache get line info visible line 1 force fold level update when painting last line buffer buffer fold start doesn t call get fold level hence fold level change event might sent previou line buffer get fold level delay update end delay update delay update start line end line text area chunk cache invalidate chunk from phy start line delay update delay update start start line delay update end end line delay update delay update start math min delay update start start line delay update end math max delay update end end line get ready fold fix black hole bug part fold line like follow fold remove so must expand otherwise text remains invisible get ready fold line display expand fold line 