text area mouse handler standalone mouse handler textarea tab size 4 indent size 4 no tab collapse fold 1 2006 matthieu casanova g n u 2 w i t h o u t n y w r r n t y m e r h n t b i l i t y f i t n e s s f o r p r t i u l r p u r p o s e g n u g n u 59 330 m 02111 1307 u s textarea operate text utility standard utility event mouse input adapter event mouse event event input event standalone text area mouse handler matthieu casanova text area mouse handler 24095 2015 09 25 21 31 41 text area mouse handler mouse input adapter mouse handler constructor text area mouse handler text area text area text area text area mouse press override mouse press mouse event evt show cursor control operate mac o s evt meta down || operate mac o s evt control down ctrl rectangular selection so home mouse click home same pressing home twice row text area get input handler reset last action count quick drag text area quick enable middle button evt get modifier quick drag text area request focus text area focus component text area text area get buffer loading x evt get x y evt get y drag start text area xy offset x y text area get painter block caret enable || text area overwrite enable drag start line text area get line offset drag start drag start offset drag start text area get line start offset drag start line popup trigger evt text area right click popup enable text area handle popup trigger evt drag text area blink text area invalidate line text area get caret line click count evt get click count text area drag enable text area selection inside selection x y click count 1 evt shift down maybe drag drop text area move caret position drag start maybe drag drop quick drag ignore click middle button single click evt click count 1 single click evt 2 click 3 triple click single click single click mouse event evt x evt get x extra end virt 0 text area chunk cache get line info text area get last screen line last subregion drag start text area xy offset x evt get y text area get painter block caret enable text area overwrite enable screen line text area get screen line offset drag start chunk cache line info line info text area chunk cache get line info screen line offset text area get screen line end offset screen line 1 offset drag start || line info last subregion offset drag start line width text area offset x y offset x x drag start line width extra end virt x drag start line width text area width text area get painter block caret enable text area overwrite enable x text area get horizontal offset % text area width text area width 2 extra end virt++ control ctrl rectangular selection || text area rectangular selection enable text area editable screen line evt get y text area get painter get line height screen line text area get last screen line screen line text area get last screen line chunk cache line info info text area chunk cache get line info screen line info last subregion extra end virt 0 control click virtual space insert whitespace move caret whitespace standard utility create white space extra end virt 0 text area get buffer insert drag start whitespace drag start + whitespace length evt shift down text area resize selection get selection pivot caret drag start extra end virt text area rectangular selection enable || control ctrl rectangular selection quick drag text area move caret position drag start so shift click drag work drag start line get selection pivot line drag start get selection pivot caret drag start offset drag start text area get line start offset drag start line so quick work drag quick drag point p text area offset x y drag start defer scroll until mouserelease result off screen text area move caret position drag start p x 0 ? text area n o s r o l l text area n o r m l s r o l l text area multiple selection enable || quick drag text area select none click click ignore empty line text area get line length drag start line 0 line text text area get line text drag start line no word sep text area get buffer get property no word sep drag start offset text area get line length drag start line drag start offset join non word text area get join non word word start text utility find word start line text drag start offset no word sep join non word word end text utility find word end line text drag start offset+1 no word sep join non word line start text area get line start offset drag start line selection sel selection range line start + word start line start + word end text area multiple selection enable text area add selection sel text area set selection sel quick drag quick drag text area move caret position line start + word end drag triple click triple click caret text area get line end offset drag start line drag start line text area get line count 1 caret selection sel selection range text area get line start offset drag start line caret text area multiple selection enable text area add selection sel text area set selection sel quick drag quick drag text area move caret position caret drag mouse move override mouse move mouse event evt show cursor mouse drag override mouse drag mouse event evt popup trigger evt maybe drag drop text area start drag drop evt control text area get buffer loading text area painter painter text area get painter evt get y 0 delta math min 1 evt get y painter get line height text area set first line text area get first line + delta evt get y painter get height delta math max 1 evt get y painter get height painter get line height text area last line partial delta text area set first line text area get first line + delta click count 1 single drag evt 2 drag evt 3 triple drag evt single drag single drag mouse event evt drag text area painter painter text area get painter x evt get x y evt get y y 0 y 0 y painter get height y painter get height 1 dot text area xy offset x y painter block caret enable text area overwrite enable || quick drag dot line text area get line offset dot extra end virt 0 text area chunk cache get line info text area get last screen line last subregion screen line text area get screen line offset dot chunk cache line info line info text area chunk cache get line info screen line offset text area get screen line end offset screen line 1 offset dot || line info last subregion offset dot line width text area offset x y offset x x dot line width extra end virt x dot line width text area width painter block caret enable text area overwrite enable x text area get horizontal offset % text area width text area width 2 extra end virt++ text area resize selection drag start dot extra end virt text area rectangular selection enable || control ctrl rectangular selection quick drag just scroll drag location text area scroll dot line dot text area get line start offset dot line point p text area offset x y dot dot text area get caret position defer scroll mouserelease result offscreen left drag direction text area move caret position dot p x 0 x 1 ? text area n o s r o l l text area n o r m l s r o l l p x 0 x 1 caret already offscreen left user now attempt drag left text area scroll caret text area rectangular selection enable extra end virt 0 text area scroll dot line dot text area get line start offset dot line + extra end virt drag drag mouse event evt mark line start text area get line start offset drag start line mark line length text area get line length drag start line mark drag start offset text area painter painter text area get painter po text area xy offset evt get x math max 0 math min painter get height evt get y painter block caret enable || text area overwrite enable line text area get line offset po line start text area get line start offset line line length text area get line length line offset po line start line text text area get line text line mark line text text area get line text drag start line no word sep text area get buffer get property no word sep join non word text area get join non word mark line start + drag start offset line start + offset offset 0 offset line length offset text utility find word start line text offset no word sep join non word mark line length 0 mark text utility find word end mark line text mark no word sep join non word offset 0 line length 0 offset text utility find word end line text offset no word sep join non word mark 0 mark mark line length mark text utility find word start mark line text mark no word sep join non word line start + offset text area get caret position text area resize selection mark line start + mark line start + offset 0 text area move caret position line start + offset drag triple drag triple drag mouse event evt text area painter painter text area get painter offset text area xy offset evt get x math max 0 math min painter get height evt get y mouse line text area get line offset offset mark mouse drag start line mouse line mark text area get line end offset drag start line 1 offset text area get line end offset mouse line 1 mouse offset mouse text area get line start offset mouse line mark text area get line start offset drag start line offset text area get line start offset mouse line mouse offset offset text area get line end offset mouse line 1 mouse line text area get line count 1 mouse text area get line end offset mouse line mouse text area get line end offset mouse line 1 mouse math min text area get buffer get length mouse mouse text area get caret position text area resize selection mark mouse 0 text area move caret position mouse drag mouse release override mouse release mouse event evt drag text area quick enable middle button evt get modifier text area request focus text area focus component text area text area set caret position drag start maybe drag drop text area multiple selection enable text area select none drag popup trigger specify event popup trigger event precisely define behavior oppose mouse event popup trigger evt event since j edit 4 3pre7 popup trigger mouse event evt right button evt get modifier middle button modifier modifier flag from mouse event modifier match middle button since j edit 4 3pre7 middle button modifier operate mac o s modifier input event b u t t o n1 m s k 0 modifier input event l t m s k 0 modifier input event b u t t o n2 m s k 0 modifier input event b u t t o n2 m s k 0 right button modifier modifier flag from mouse event modifier match right button since j edit 4 3pre7 right button modifier operate mac o s modifier input event b u t t o n1 m s k 0 modifier input event t r l m s k 0 modifier input event b u t t o n3 m s k 0 modifier input event b u t t o n3 m s k 0 get selection pivot caret dynamically get pivot point associate current selection inline comment get selection pivot caret caret text area caret selection s text area get selection at offset text area caret s caret mental model an selection then shift+click somewhere what happen selection? because selection we need pivot point caret at start selection end selection pivot point so click above start caret enlarge selection click below end reverse selection around pivot point text before pivot no longer select text after up click newly select vice versa hold when caret at end selection caret somewhere just give up let user fix caret caret s start ? s end caret s end ? s start caret caret get selection pivot line get selection pivot caret an explanation function get selection pivot line text area caret cl text area caret line text area get selection count 1 cl selection s text area get selection 0 cl s start ? s end line s end ? s start line cl cl member text area text area drag start line drag start offset drag start click count drag quick drag control ctrl rectangular selection drag drop on mouse down selection doe immediately deselect maybe drag drop show cursor show cursor text area get painter show cursor 