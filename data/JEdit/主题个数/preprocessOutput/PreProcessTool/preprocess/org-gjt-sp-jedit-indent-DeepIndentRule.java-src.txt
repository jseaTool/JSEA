deep indent rule tab size 4 indent size 4 no tab collapse fold 1 2006 matthieu casanova g n u 2 w i t h o u t n y w r r n t y m e r h n t b i l i t y f i t n e s s f o r p r t i u l r p u r p o s e g n u g n u 59 330 m 02111 1307 u s indent text utility buffer j edit buffer syntax token syntax token handler syntax token marker list stack text segment deep indent rule matthieu casanova deep indent rule 24413 2016 06 19 11 07 31 kerik sf deep indent rule indent rule open close deep indent rule constructor deep indent rule open close open open close close apply apply j edit buffer buffer line index prev line index prev prev line index list indent action indent action prev line index 1 line index prev line index old line index line index sequence line text buffer get line segment line index search po 1 line index old line index line text buffer get line segment line index old line index line index paren paren paren buffer line index search po no unmatch paren on prev line paren open offset 1 paren close offset 1 prev prev line present prev prev line index 1 search po 1 line index prev prev line index prev prev line index 1 there s an unmatch open parenthesis we want align accord it position paren close offset 1 recalculate column when using tab instead space indent paren open offset + get indent line text buffer get tab size line text length indent action clear indent action add indent action align parameter indent there s an unmatch close parenthesis find match parenthesis start looking from there again open paren offset text utility find match bracket buffer line index paren close offset open paren offset 0 avoid fall back prev prev line prev prev line index 1 line index buffer get line offset open paren offset search po open paren offset buffer get line start offset line index 1 search po 0 get indent length be indent space instead tab get indent sequence line tab size cnt 0 i 0 i line length i++ line at i cnt + tab size character whitespace line at i cnt + line length i cnt++ cnt paren token filter look position open close character line being parse character inside literal comment are ignore paren token handler open offset close offset search po stack open stack close paren j edit buffer b line po search po po open stack close stack b mark token line open offset open empty ? 1 open pop close offset close empty ? 1 close pop handle token segment seg offset length token marker line context context length 0 || search po 1 search po offset search po 1 offset + length search po length search po offset + 1 token comment literal i offset i offset + length i++ seg seg offset + i open open empty close empty close pop open push i seg seg offset + i close close empty open empty open pop close push i set line context token marker line context line context nothing override paren + open offset + + close offset + 