line manage line info line start offset position tab size 4 indent size 4 no tab collapse fold 1 2001 2004 g n u 2 w i t h o u t n y w r r n t y m e r h n t b i l i t y f i t n e s s f o r p r t i u l r p u r p o s e g n u g n u 59 330 m 02111 1307 u s buffer importsimport syntax debug log internal j edit s document model use directly improve performance none check out bound access nor are they thread safe buffer through which these must call through such protection line 24459 2016 07 16 02 42 50 ezust since j edit 4 2pre3 line line constructor line end offset 1 end offset 0 1 fold level 1 line context token marker line context 1 line count 1 get line count get line count line count get line offset get line offset offset performance optimization assumption call many time same line optimize first line intentional profiling prove right approach 3528212 get line offset line 0 get line offset line line count s get line end offset get line offset line 1 e get line end offset get line offset line offset s offset e get line offset line start 0 end line count 1 end start 0 get line end offset start offset get line offset line start + 1 get line offset line start get line offset line 1 get line end offset start offset get line end offset end offset get line offset line end + 1 get line offset line end get line offset line start get line offset line pivot end + start 2 value get line end offset pivot value offset get line offset line pivot + 1 get line offset line value offset start pivot + 1 end pivot 1 get line end offset get line end offset line gap line 1 line gap line end offset line + gap width end offset line get fold level get fold level line fold level line set fold level also set fold level valid flag set fold level line level level 0xffff limitation level 0xffff fold level line level set first invalid fold level set first invalid fold level first invalid fold level first invalid fold level first invalid fold level get first invalid fold level get first invalid fold level first invalid fold level get line context token marker line context get line context line line context line set line context set line context line token marker line context context line context line context set first invalid line context set first invalid line context first invalid line context first invalid line context first invalid line context get first invalid line context get first invalid line context first invalid line context content insert content insert end offset gap line 1 gap width 0 first invalid line context first invalid fold level 0 line count end offset get size end offset end offset get fold level line count line context token marker line context line count content insert content insert start line offset num line length end offset end line start line + num line update line info line context num line 0 move gap 1 0 content insert line count + num line end offset length line count end offset n line count + 1 2 arraycopy end offset 0 end offset n 0 end offset length end offset end offset n fold level length line count fold level n line count + 1 2 arraycopy fold level 0 fold level n 0 fold level length fold level fold level n line context length line count token marker line context line context n token marker line context line count + 1 2 arraycopy line context 0 line context n 0 line context length line context line context n arraycopy end offset start line end offset end line line count end line arraycopy fold level start line fold level end line line count end line arraycopy line context start line line context end line line count end line start line gap line gap line + num line gap line 1 offset gap width i 0 i num line i++ end offset start line + i offset + end offset get i fold level start line + i 0 first invalid line context 1 || first invalid line context start line first invalid line context start line first invalid fold level 1 || first invalid fold level start line first invalid fold level start line move gap end line length content insert content remove content remove start line offset num line length end line start line + num line update line info line context num line 0 move gap 1 0 content remove start line + num line gap line gap line num line start line gap line gap line start line line count num line arraycopy end offset end line end offset start line line count start line arraycopy fold level end line fold level start line line count start line arraycopy line context end line line context start line line count start line first invalid line context 1 || first invalid line context start line first invalid line context start line first invalid fold level 1 || first invalid fold level start line first invalid fold level start line move gap start line length content remove member instance variable end offset fold level token marker line context line context line count 1 then there no gap otherwise all line from line onward need gap width add their end offset gap line gap width 1 all context are valid otherwise all line after an invalid context first invalid line context 1 all fold level are valid otherwise all line after an invalid fold level first invalid fold level performance helper link get line offset get line offset line 1 set line end offset set line end offset line end end offset line end move gap move gap gap line gap width gap line 1 gap width gap width gap line 1 gap width 0 debug o f f s e t d e b u g gap line line count log log log d e b u g + update from + gap line + + line count + width + gap width i gap line i line count i++ set line end offset i get line end offset i gap width gap width gap line gap line gap width 0 debug o f f s e t d e b u g gap line gap line log log log d e b u g + update from + gap line + + gap line + width + gap width i gap line i gap line i++ set line end offset i get line end offset i gap width gap width + gap width gap line gap line gap width 0 debug o f f s e t d e b u g gap line gap line log log log d e b u g + update from + gap line + + gap line + width + gap width i gap line i gap line i++ set line end offset i get line end offset i gap width + gap width gap line line count gap line 1 gap line gap line 