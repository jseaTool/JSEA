buffer printable printable tab size 4 indent size 4 no tab collapse fold 1 2016 dale anson g n u 2 w i t h o u t n y w r r n t y m e r h n t b i l i t y f i t n e s s f o r p r t i u l r p u r p o s e g n u g n u 59 330 m 02111 1307 u s print importsimport text tab expand font geom print rendering hint list print attribute standard chromaticity print attribute print request attribute set print attribute standard page range syntax buffer printable doe lot than old one like properly printing range page reverse page printing printing just selection so on buffer printable 24442 2016 06 29 23 29 25 buffer printable1 7 printable color header color color light gray color header text color color black color footer color color light gray color footer text color color black color line number color color gray color text color color black print request attribute set attribute first call view view buffer buffer selection select line reverse print range type printer dialog l l font font syntax style style header footer line number hash map range page current physical line line metric lm list chunk line list font render context frc display token handler token handler buffer printable1 7 print request attribute set attribute view view buffer buffer attribute attribute view view buffer buffer first call page page range are calculate only once header j edit get property print header footer j edit get property print footer line number j edit get property print line number font j edit get font property print font color chromaticity o l o r equal attribute get chromaticity style syntax utility load style j edit get property print font j edit get property print fontsize 10 color style token n u l l syntax style text color font assume paper white so change white text black i 0 i style length i++ syntax style s style i s get foreground color equal color w h i t e s get background color style i syntax style color b l k s get background color s get font line list list chunk token handler display token handler set font font font font font font set line number are select text area line an line are select text area set select line line select line line line length sort select line set print page reverse order print last page first first page last b wheth print reverse set reverse b reverse b set print range type print range type one printer dialog l l r n g e u r r e n t p g e s e l e t i o n set print range type print range type print range type print range type selection printer dialog s e l e t i o n print range type avoid have recalculate page range they are already know set page hash map range page page page call multiple time print same page all call must handle page print properly print graphic gfx page format page format page index printer page index + 1 page index 0 base page are 1 base log log log d e b u g ask print page + page index first call page page calculate page gfx page format page || page empty printer unable determine page range first call figure out current page what request i m using page contain caret current page q u e s t i o n use text area first physical line instead? print range type printer dialog u r r e n t p g e caret line view get text area get caret line i page key set range range page get i range contain caret line page index i adjust page index reverse printing reverse print range type printer dialog u r r e n t p g e page index page size 1 page index log log log d e b u g reverse on change page index + page index go ahead print page range range page get page index range || range page index print range type printer dialog u r r e n t p g e log log log d e b u g n o s u h p g e page + page index n o s u h p g e print page gfx page format page index log log log d e b u g p g e e x i s t s page + page index p g e e x i s t s pars determine what line belong which page gfx graphic context use calculation page format page format use calculation force force calculation regardles large line limit hashmap page number line range page n o t e handle large line poorly buffer size large than large buffer size property printer same line line buffer longer than line limit property printer seem an adequate way handle large probably poor way handle aren t particularly large only one line hash map range calculate page graphic gfx page format page format printer log log log d e b u g calculate page + buffer get name log log log d e b u g graphic get clip + gfx get clip page hash map range check large setting large mode buffer get property largefilemode full equal large mode large buffer size j edit get property large buffer size 4000000 buffer get length large buffer size printer buffer too large print ensure graphic font rendering context are valid gfx happen on startup when graphic yet valid page use rendering hint set text area option pane affine transform basic seem work well all i ve found s necessary turn on print spacing workaround text area option pane get character overlap i think setting on since cause graphic draw glyph vector use draw character javadoc say fast way render set character screen graphics2 d gfx graphics2 d gfx gfx set rendering hint k e y t e x t n t i l i s i n g view get text area get painter get anti alias render hint use fractional font metric j edit get property view frac font metric gfx set rendering hint k e y f r t i o n l m e t r i s use fractional font metric ? v l u e f r t i o n l m e t r i s o n v l u e f r t i o n l m e t r i s o f f gfx set font font gfx set transform affine transform 1 0f 0 0f 0 0f 1 0f 0 0f 0 0f frc gfx get font render context log log log d e b u g font render context + frc maximum printable area page x page format get imageable x page y page format get imageable y page width page format get imageable width page height page format get imageable height log log log d e b u g calculate page total imageable x + page x + y + page y + w + page width + h + page height calculate header height header header height paint header gfx page x page y page width page y + header height page height header height log log log d e b u g calculate page w header imageable x + page x + y + page y + w + page width + h + page height calculate footer height footer footer height paint footer gfx page x page y page width page height 0 page height footer height log log log d e b u g calculate page w footer imageable x + page x + y + page y + w + page width + h + page height line number width 0 0 determine line number width line number line number digit value buffer get line count builder digit builder i 0 i line number digit length i++ digit append 0 line number width font get bound digit frc get width calculate tab size tab size j edit get property print tab size 4 builder tab builder tab size i 0 i tab size i++ tab append tab width font get bound tab frc get width print tab expand tab expand print tab expand tab width prep calculation lm font get line metric g gy y x frc line height lm get height print fold j edit get property print fold current physical line 0 page count 1 start line 0 y 0 0 measure each line line limit j edit get property line limit 4000 buffer line count buffer get line count current physical line buffer line count line might too line limit 4000 character which about number character fit on single letter size page roughly 80 character wide 50 line tall current physical line buffer line count buffer get line length current physical line line limit printer line + current physical line + 1 + too print current physical line buffer line count last page range range range start line current physical line page put page count range log log log d e b u g calculate page page + page count + ha + range skip fold line print fold view get text area get display line visible current physical line ++ current physical line fill line list line list clear token handler init style frc tab expand line list page width line number width 0 buffer mark token current physical line token handler check these line fit on page y + line height line list empty ? 1 line list size page height range range range start line math max 0 current physical line 1 page put page count range log log log d e b u g calculate page page + page count + ha + range ++ page count start line current physical line y 0 0 i 0 i line list empty ? 1 line list size i++ y + line height ++ current physical line page given page number one page request print range page number page range range page range attribute get page range answer range answer answer range contain page number answer actually print page graphic context page index 1 base print page graphic gfx page format page format page index actually paint log log log d e b u g print page + page index + + actually paint + graphics2 d gfx graphics2 d gfx zoom level 1 0f page format print preview model print preview model model print preview model page format zoom level model get zoom level font font derive font font get size zoom level gfx set rendering hint k e y t e x t n t i l i s i n g view get text area get painter get anti alias render hint use fractional font metric j edit get property view frac font metric gfx set rendering hint k e y f r t i o n l m e t r i s use fractional font metric ? v l u e f r t i o n l m e t r i s o n v l u e f r t i o n l m e t r i s o f f gfx set transform affine transform 1 0f 0 0f 0 0f 1 0f 0 0f 0 0f i 0 i style length i++ syntax style s style i style i syntax style s get foreground color s get background color font gfx set font font frc frc gfx get font render context printable dimension page x page format get imageable x page y page format get imageable y page width page format get imageable width page height page format get imageable height log log log d e b u g 1 page dimension + page x + + page y + + page width + x + page height print header header header height paint header gfx page x page y page width actually paint page y + header height page height header height print footer footer footer height paint footer gfx page x page y page width page height page index actually paint page height footer height determine line number width line number width 0 0 line number line number digit value buffer get line count builder digit builder i 0 i line number digit length i++ digit append 0 line number width font get bound digit frc get width log log log d e b u g 2 page dimension + page width line number width + x + page height calculate tab size tab size j edit get property print tab size 4 builder tab builder i 0 i tab size i++ tab append tab width font get bound tab frc get width print tab expand tab expand print tab expand tab width prep printing line lm font get line metric g gy y x frc line height lm get height log log log d e b u g line height + line height y 0 0 range range page get page index log log log d e b u g printing range page + page index + + range print each line current physical line range get start current physical line range get end current physical line++ current physical line buffer get line count log log log d e b u g finish buffer log log log d e b u g end j edit get property print fold view get text area get display line visible current physical line log log log d e b u g skip invisible line print only select line printing selection selection binary search select line current physical line 0 log log log d e b u g skip non select line + current physical line fill line list line list clear token handler init style frc tab expand line list page width line number width 1 buffer mark token current physical line token handler line number actually paint gfx set font font gfx set color line number color gfx draw value current physical line + 1 page x page y + y + line height line list empty handle blank line y + line height chunk chunk line list y + line height chunk chunk chunk chunk actually paint chunk paint chunk background chunk gfx page x + line number width page y + y line height chunk paint chunk list chunk gfx page x + line number width page y + y current physical line range get end log log log d e b u g finish page paint header graphics2 d gfx page x page y page width actually paint header text j edit get property print header text buffer get name font render context frc gfx get font render context lm font get line metric header text frc rectangle2 d bound font get bound header text frc rectangle2 d header bound rectangle2 d page x page y page width bound get height actually paint gfx set color header color gfx fill header bound gfx set color header text color gfx draw header text page x + page width bound get width 2 page y + lm get ascent header bound get height paint footer graphics2 d gfx page x page y page width page height page index actually paint footer text j edit get property print footer text date value page index font render context frc gfx get font render context lm font get line metric footer text frc rectangle2 d bound font get bound footer text frc rectangle2 d footer bound rectangle2 d page x page y + page height bound get height page width bound get height actually paint gfx set color footer color gfx fill footer bound gfx set color footer text color gfx draw footer text page x + page width bound get width 2 page y + page height bound get height + lm get ascent footer bound get height print tab expand tab expand tab width print tab expand tab width tab width tab width next tab stop x tab offset ntab x + 1 tab width ntab + 1 tab width 