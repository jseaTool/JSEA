display low level text display tab size 4 indent size 4 no tab collapse fold 1 2001 2005 g n u 2 w i t h o u t n y w r r n t y m e r h n t b i l i t y f i t n e s s f o r p r t i u l r p u r p o s e g n u g n u 59 330 m 02111 1307 u s textarea importsimport toolkit buffer debug log manage low level text display task such since j edit 4 2pre1 display 24211 2015 12 10 03 33 28 display part get display display get display j edit buffer buffer text area text area list display l buffer map get buffer l l link list display buffer map put buffer l an display s fold visibility map display inherit display iterator display liter l iterator display dmgr liter ha next dmgr liter next dmgr dmgr use dmgr text area text area dmgr use dmgr we get here no unus display list dmgr display buffer text area dmgr use l add dmgr dmgr release release use buffer close buffer close j edit buffer buffer buffer map remove buffer text area dispose text area dispose text area text area list display l buffer map value iterator display liter l iterator liter ha next display dmgr liter next dmgr text area text area dmgr dispose liter remove map j edit buffer list display buffer map hash map j edit buffer list display get buffer since j edit 4 3pre3 j edit buffer get buffer buffer line visible specify physical line visible line physical line index since j edit 4 2pre1 line visible line fold search line % 2 0 outside narrowing display narrow specify line outside narrowing line physical line index since j edit 4 5 outside narrowing line line get first visible line line beyond last visible line may still within narrow display last visible line root fold contain given line line get last visible line last visible get last visible line last visible level buffer get fold level last visible buffer get fold level line last visible level line between last visible given line fold level last visible root child relationship i last visible + 1 i line i++ buffer get fold level i last visible level we get point mean last visible line fold level root given line get first visible line physical line number first visible line since j edit 4 2pre1 get first visible line fold first get last visible line physical line number last visible line since j edit 4 2pre1 get last visible line fold last get next visible line next visible line after specify line index 1 there no next visible line line physical line index since j edit 4 0pre1 get next visible line line line 0 || line buffer get line count index out bound line fold next line get prev visible line previou visible line before specify line index line physical line index previou visible physical line 1 there no visible line since j edit 4 0pre1 get prev visible line line line 0 || line buffer get line count index out bound line fold prev line get screen line count how many screen line contain given physical line great than 1 when using soft wrap line physical line screen line count get screen line count line update screen line count line screen line mgr get screen line count line get scroll line count number displayable line great than number line buffer when using soft wrap line count n line when using folding are collapse number displayable line get scroll line count scroll line count get scroll line collapse fold collapse fold at specify physical line index line physical line index since j edit 4 2pre1 collapse fold line line count buffer get line count end line count 1 caret on collapse fold collapse parent fold line 0 line line count 1 buffer fold start line line visible line + 1 line initial fold level buffer get fold level line find fold start end start 0 line line count 1 buffer get fold level line + 1 initial fold level line start fold start line + 1 i line + 1 i line count i++ buffer get fold level i initial fold level end i 1 ok scan backward looking start i line 1 i 0 i buffer get fold level i initial fold level start i + 1 ok ok no fold buffer i line + 1 i line count i++ buffer get fold level i initial fold level end i 1 collapse fold hide line range start end notify screen line change text area fold structure change expand fold expand fold at specify physical line index line physical line index fully all subfold also expand line number first subfold 1 none since j edit 4 2pre1 expand fold line fully mutable first subfold mutable 1 unfold expand fold line fully first subfold unfold text area fold structure change first subfold get expand all fold expand all fold since j edit 4 2pre1 expand all fold show line range 0 buffer get line count 1 notify screen line change text area fold structure change expand fold only call from action xml since j edit 4 2pre1 expand fold digit digit 1 || digit 9 u i get look feel provide feedback expand fold digit 1 + 1 expand fold expand all fold specify fold level fold level fold level update notify text area fold level change since automatically move caret still inside fold may what we want since j edit 4 5 expand fold fold level update buffer get fold handler indent fold handler fold level fold level 1 buffer get indent size + 1 line count buffer get line count end line count 1 show line range 0 end least fold 1 first invisible 0 i 0 i line count i++ level buffer get fold level i keep track least fold level up point because we t hide line at level since there no root line unfold from least fold 1 || level least fold least fold level level fold level || level least fold first invisible i hide line range first invisible i 1 first invisible i + 1 first invisible line count hide line range first invisible end notify screen line change update text area get display text area fold structure change expand fold expand all fold specify fold level fold level fold level since j edit 4 2pre1 expand fold fold level expand fold fold level narrow narrow visible portion buffer specify line range start first line end last line since j edit 4 2pre1 narrow start end line count buffer get line count start end || start 0 || end line count index out bound start + + end start get first visible line || end get last visible line expand all fold start 0 hide line range 0 start 1 end line count 1 hide line range end + 1 line count 1 we narrow single collapse fold start line count 1 line visible start + 1 expand fold start text area fire narrow active notify screen line change text area fold structure change member first line first line scroll line count scroll line count screen line screen line mgr range map fold init init need information available text area only when display active text area get display buffer loading init call from buffer load initialize fold reset buffer get line count reset anchor collapse fold buffer get property collapse fold 0 collapse fold 0 expand fold collapse fold initialize already initialize just make scroll bar update reset anchor notify screen line change first line scroll line count change update scroll bar etc notify screen line change debug s r o l l d e b u g log log log d e b u g notify screen line change screen line change must issue when text area ha information wrap mode buffer otherwise screen line calculation incorrect text area get display first line call reset first line reset first line call change first line change scroll line count call reset scroll line count reset f i x m e why here? first line ensure physical line visible scroll line count call change scroll line count change first line call change || scroll line count call reset || scroll line count call change text area update scroll bar text area recalculate last physical line first line reset call state scroll line count reset call state set first line set vertical scroll bar position current first line current scroll bar position first line scroll bar position set first line current first line first line visible line text area get visible line first line current first line + visible line first line scroll down first line current first line text area chunk cache invalidate all first line current first line visible line first line scroll up current first line first line text area chunk cache invalidate all first line current first line first line scroll down first line current first line text area chunk cache scroll down first line current first line first line current first line first line scroll up current first line first line text area chunk cache scroll up current first line first line notify screen line change set first physical line scroll from given amount line amount amount line must scroll skew skew within given line set first physical line amount skew current first line text area get first line amount 0 skew first line get skew j edit text area scroll need simplify it skew 0 first line scroll up skew skew 0 first line scroll down skew nothing amount 0 first line phy down amount skew amount 0 first line phy up amount skew first line text area get first line visible line text area get visible line first line current first line nothing first line current first line + visible line || first line current first line visible line text area chunk cache invalidate all first line current first line text area chunk cache scroll down first line current first line first line current first line text area chunk cache scroll up current first line first line we careful notify screen line change invalidate screen line count invalidate screen line count screen line mgr invalidate screen line count first line set call reset scroll line count set call reset update screen line count update screen line count line display current visible one screen line count t determine since wrap mode wrap margin chunk cache buffer are available maybe those information display instead text area text area get display screen line mgr screen line count valid line reset chunk cache here text area chunk cache reset count text area chunk cache get line subregion count line count 0 set screen line count line count buffer load buffer load initialize fold reset buffer get line count screen line mgr reset text area get display text area property change init init call when buffer set text area fold handler change fold handler change buffer loading happen once before buffer load call seem violate javadoc on buffer listener s problem display because call on init possibly via buffer load initialize fold reset buffer get line count text area get display init init call when buffer set text area member initialize use j edit buffer buffer text area text area buffer handler buffer handler elastic tab stop buffer listener elastic tab stop listener display constructor display j edit buffer buffer text area text area display buffer buffer screen line mgr screen line buffer text area text area scroll line count scroll line count text area first line first line text area buffer handler buffer handler text area buffer t o d o elastic tab stop buffer listener from inside buffer handler avoid chunking same line twice elastic tab stop listener elastic tab stop buffer listener text area buffer add buffer listener elastic tab stop listener j edit buffer h i g h p r i o r i t y listener priority thing bad hack buffer add buffer listener buffer handler j edit buffer h i g h p r i o r i t y fold range map fold initialize fold range map fold reset 0 reset anchor reset anchor first line set call reset scroll line count set call reset notify screen line change dispose dispose buffer remove buffer listener buffer handler buffer remove buffer listener elastic tab stop listener show line range show line range start end debug f o l d v i s d e b u g log log log d e b u g show line range + start + + end + i start i end i++ x x x line visible i important screen line mgr get screen line count screen line get screen line count i first line get physical line i first line move scroll line screen line scroll line count move scroll line screen line update fold visibility map fold show start end hide line range hide line range start end debug f o l d v i s d e b u g log log log d e b u g hide line range + start + + end + physical line start line visible physical line physical line get next visible line physical line scroll line 0 physical line 1 physical line end screen line get screen line count physical line physical line first line get physical line first line set skew 0 first line move scroll line screen line scroll line screen line physical line get next visible line physical line scroll line count move scroll line scroll line update fold visibility map fold hide start end line visible first line get physical line first visible get first visible line first line get physical line first visible first line set physical line first visible first line set scroll line 0 first line set physical line get prev visible line first line get physical line first line move scroll line get screen line count first line get physical line set screen line count set number screen line specify physical line split into line physical line number count line count 1 no wrap 1 soft wrap since j edit 4 2pre1 set screen line count line count count 0 screen line mgr set screen line count line count expand fold expand fold at specify physical line index line physical line index fully all subfold also expand first subfold set line number first subfold 1 there none some line wa unfold otherwise expand fold line fully mutable first subfold unfold line count buffer get line count end line count 1 line visible line prev line fold lookup fold search line 1 line visible prev line unfold fold farther up wa unfold then text area need update unfold | expand fold prev line fully first subfold line visible prev line + 1 unfold at point line already visible fully flag set we may still need look show it subfold line line count 1 || line visible line + 1 fully unfold find fold start fold end start initial fold level buffer get fold level line buffer get fold level line + 1 initial fold level line start fold start line line visible line + 1 fold search line + 1 fold count 1 index fold search line + 1 end fold lookup index + 1 1 i line + 1 i line count i++ buffer get fold level i initial fold level end i 1 fully unfold start line start 0 buffer get fold level start initial fold level start initial fold level buffer get fold level start i line + 1 i line count i++ buffer get fold level i initial fold level end i 1 expand fold fully show line range start end found subfold i start + 1 i end found subfold buffer fold start i first subfold set i found subfold show line range i i fold buffer get fold level i i++ i end buffer get fold level i fold i++ unfold notify screen line change unfold mutable mutable mutable value value value set value value value get value value 