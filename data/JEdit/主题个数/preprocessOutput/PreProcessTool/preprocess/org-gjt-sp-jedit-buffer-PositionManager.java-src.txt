position manage position tab size 4 indent size 4 no tab collapse fold 1 2001 2005 g n u 2 w i t h o u t n y w r r n t y m e r h n t b i l i t y f i t n e s s f o r p r t i u l r p u r p o s e g n u g n u 59 330 m 02111 1307 u s buffer importsimport text position log internal j edit s document model use directly p position are create explicitly remove implicitly when there are no reference implicit removal work top reference outside bottom half reference internally position are separately position 21831 2012 06 18 22 54 17 ezust since j edit 4 2pre3 position position constructor position j edit buffer buffer buffer buffer create position no removal require unreferenc enough position create position offset po bottom half bh po bottom half offset po bottom half position get bh position put bh bh bh po top half content insert content insert offset length position empty get all position from offset end inclusive iterator po bottom half it position tail map po bottom half offset key set iterator iteration it ha next it next content insert offset length iteration content remove content remove offset length position empty get all position from offset end inclusive iterator po bottom half it position tail map po bottom half offset key set iterator iteration it ha next it next content remove offset length iteration iteration member j edit buffer buffer sort map po bottom half po bottom half position tree map po bottom half po bottom half inner po top half wrapper real position handling po bottom half so top mean part visible when there are no reference po top half garbage collector eats position remove together it bottom half po top half position po bottom half bh po top half constructor po top half po bottom half bh bh bh bh ref get offset get offset bh offset finalize override finalize position bh unref po bottom half bottom mean part visible outside stay only here position map po bottom half comparable po bottom half offset ref po bottom half constructor po bottom half offset offset offset ref ref ref++ unref unref ref 0 position remove content insert content insert offset length offset offset index out bound offset + length check invariant content remove content remove offset length offset offset index out bound offset offset + length offset offset offset length check invariant equal override equal o o po bottom half po bottom half o offset offset compare compare po bottom half po bottom half iteration log log log e r r o r consistency failure offset po bottom half offset check invariant check invariant offset 0 || offset buffer get length index out bound 