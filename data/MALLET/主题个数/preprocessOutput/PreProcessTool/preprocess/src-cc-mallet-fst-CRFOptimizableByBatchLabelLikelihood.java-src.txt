io o io input stream io output stream io serializable collection logging logger optimize optimizable type feature type feature vector type instance type instance type matrix ops logger label likelihood gradient computation batch can easily parallelize p gradient computation same tt r f optimizable label likelihood tt p note expectation correspond batch can compute parallel dur gradient computation prior constraint incorporate into expectation last batch see tt get batch value get batch value gradient tt note ignore instance infinite weight see tt get expectation value tt gaurav chandalia r f optimizable batch label likelihood optimizable combining batch gradient serializable logger logger logger get logger r f optimizable batch label likelihood get name e f u l t g u n p r o r v r n e 1 0 e f u l t h y p e r o l p r o r l o p e 0 2 e f u l t h y p e r o l p r o r h r p n e 10 0 r f crf instance training batch training num batch batch specific expectation r f factor expectation constraint over whole training r f factor constraint value gradient batch sharing cache value cache gradient hyperbolic prior gaussian prior variance e f u l t g u n p r o r v r n e hyperbolic prior slope e f u l t h y p e r o l p r o r l o p e hyperbolic prior sharpness e f u l t h y p e r o l p r o r h r p n e r f optimizable batch label likelihood r f crf instance ilist num batch up crf crf training ilist num batch num batch cache value num batch cache gradient num batch expectation r f factor num batch num factor crf get num factor 0 num batch ++i cache gradient add num factor expectation add r f factor crf constraint r f factor crf gather constraint ilist constraint running forward backward output label thus restrict path agree label gather constraint instance ilist logger info gathering constraint constraint structure match crf constraint zero instance instance ilist feature vector input feature vector instance get feature output feature instance get target instance weight ilist get instance weight instance transducer incrementor incrementor instance weight 1 0 ? constraint incrementor constraint weight incrementor instance weight sum lattice crf input output incrementor constraint na n infinite compute log probability batch training fill correspond expectation well get expectation value batch index batch assignment reset expectation zero we fill them again r f factor batch expectation expectation get batch index batch expectation zero count instance infinite weight num inf label weight 0 num inf unlabel weight 0 num inf weight 0 value 0 unlabel weight label weight weight batch assignment 0 batch assignment 1 ii++ instance instance training get instance weight training get instance weight instance feature vector input feature vector instance get feature output feature instance get target label weight sum lattice crf input output get total weight infinite label weight ++num inf label weight transducer incrementor incrementor instance weight 1 0 ? batch expectation incrementor batch expectation weight incrementor instance weight unlabel weight sum lattice crf input incrementor get total weight infinite unlabel weight ++num inf unlabel weight weight log conditional probability correct label weight label weight unlabel weight infinite weight ++num inf weight weight log probability we want log probability value + weight instance weight batch expectation na n infinite num inf label weight 0 || num inf unlabel weight 0 || num inf weight 0 logger warning batch + batch index + instance + infinite label weight + num inf label weight + + infinite unlabel weight + num inf unlabel weight + + infinite weight + num inf weight value log probability batch training label prior over last batch incorporate prior well get batch value batch index batch assignment batch index num batch incorrect batch index + batch index + range 0 + num batch + batch assignment length 2 batch assignment 0 batch assignment 1 batch assignment + batch assignment get value label current batch also filling expectation value get expectation value batch index batch assignment batch index num batch 1 hyperbolic prior hyperbolic prior value + crf hyberbolic prior hyperbolic prior slope hyperbolic prior sharpness gaussian prior value + crf gaussian prior gaussian prior variance na n value || infinite value label likelihood na n infinite batch index + batch index + batch assignment + batch assignment update cache cache value batch index value value get batch value gradient buffer batch index batch assignment batch index num batch incorrect batch index + batch index + range 0 + num batch + batch assignment length 2 batch assignment 0 batch assignment 1 batch assignment + batch assignment r f factor batch expectation expectation get batch index batch index num batch 1 crf check once infinite value allow crf na n factor constraint prior into expectation last batch gradient constraint expectation + prior expectation constraint prior minus sign factor combine gradient gradient compute batch expectation plus equal constraint 1 0 hyperbolic prior batch expectation plus equal hyperbolic prior gradient crf hyperbolic prior slope hyperbolic prior sharpness batch expectation plus equal gaussian prior gradient crf gaussian prior variance batch expectation na n infinite gradient cache gradient get batch index cache gradient batch expectation get gradient arraycopy gradient 0 buffer 0 gradient length add gradient batch p note buffer already initialize combine gradient collection batch gradient buffer buffer length crf get num factor incorrect buffer length + buffer length + expect + crf get num factor fill buffer 0 gradient batch gradient matrix ops plus equal buffer gradient get batch value gradient matrix ops time equal buffer 1 0 get num batch num batch hyperbolic prior f hyperbolic prior f hyperbolic prior slope p hyperbolic prior slope p hyperbolic prior sharpness p hyperbolic prior sharpness p get hyperbolic prior slope hyperbolic prior slope get hyperbolic prior sharpness hyperbolic prior sharpness gaussian prior variance p gaussian prior variance p get gaussian prior variance gaussian prior variance get num crf get num factor get buffer crf get buffer get parameter index crf get parameter index buff crf buff crf weight value change parameter index value crf parameter index value crf weight value change serial u 1 u r r e n t e r l v e r o n 0 write output stream o write u r r e n t e r l v e r o n write training write crf write num batch write cache value gradient cache gradient write gradient read input stream o found read training instance read crf r f read num batch read cache value read cache gradient num batch 0 num batch ++i cache gradient read factory optimizable combining batch gradient r f optimizable r f crf instance training num batch r f optimizable batch label likelihood crf training num batch 