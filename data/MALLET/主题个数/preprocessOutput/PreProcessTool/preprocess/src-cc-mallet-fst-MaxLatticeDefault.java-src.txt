2005 univ dept part m l l e t m achine learning languag e toolkit 1 0 information see ` l e n e fernando pereira pereira ci upenn pereira ci upenn mc callum io o io input stream io output stream io print writer io serializable logging level logging logger type type type pair alignment transducer transducer transition iterator logger search star search star search search node search search full dynamic programming viterbi max lattice algorithm fernando pereira mc callum max lattice max lattice logger logger logger get logger max lattice get name logger level level n f o transducer t input output lattice length viterbi node lattice weight cache first last weight cache cache num cache max cache transducer get transducer t get input input get output output viterbi node star input position position input enter node transducer node enter output transducer output produce entering node delta transducer m p o l e w e g h t viterbi node max weight predecessor viterbi node input position input position input position star completion cost delta input position 0 get weight transducer m p o l e w e g h t previou iterator star next iterator prev found weight weight previou iterator prev 0 input position 0 j get index weight t num weight cache get cache input position 1 0 t num s++ weight weight j look ahead weight found prev t num prev++ weight prev transducer m p o l e w e g h t found next look ahead weight prev t num search next look ahead weight weight prev++ found get viterbi node input position 1 prev 1 search star cost weight weight weight next iterator get next previou iterator weight cache weight cache prev next weight position weight cache position weight t num t num init position init position position position 0 t num i++ j 0 j t num j++ weight j transducer m p o l e w e g h t weight cache get cache position weight cache cache cache position cache cache position cache + num cache + + max cache num cache max cache another cache cache weight cache position num caches++ 0 first last cache steal least cache cache last cache cache position cache init position 0 t num i++ lattice position || lattice position delta transducer m p o l e w e g h t t get transition iterator it transition iterator input position output position it next it next cache weight get index it get weight cache position cache cache first move front cache last last cache prev cache prev cache prev next cache next cache next first cache prev first prev cache first cache cache viterbi node get viterbi node ip index lattice ip index lattice ip index viterbi node ip t get index lattice ip index max lattice transducer t input t input 100000 max lattice transducer t input output t input output 100000 initiate viterbi decoding input contrain match part output max cache indicate much information memoize n best decoding max lattice transducer t input output max cache initializ forward path yet backward pas t t max cache 1 max cache 1 max cache max cache input logger loggable level f n e logger fine starting viterbi lattice logger fine input ip 0 ip input size ip++ logger fine + input get ip logger fine output output logger fine op 0 op output size op++ logger fine + output get op logger fine input input output output lattice length input size +1 num t num lattice viterbi node lattice length num cache weight cache lattice length 1 viterbi forward logger fine starting viterbi 0 num i++ weight t get get weight weight transducer m p o l e w e g h t viterbi node n get viterbi node 0 n delta weight logger warning viterbi ip 0 ip lattice length 1 ip++ 0 num i++ lattice ip || lattice ip delta transducer m p o l e w e g h t t get transition iterator it transition iterator input ip output ip logger loggable level f n e logger fine starting viterbi transition iteration + get name + input + input get ip it next destination it next logger loggable level f n e logger fine viterbi input po +ip + + get name + d +destination get name + viterbi node destination node get viterbi node ip+1 destination get index destination node output it get output weight lattice ip delta + it get weight ip lattice length 2 weight + destination get weight weight destination node delta logger loggable level f n e logger fine viterbi input po +ip + d +destination get name + weight increase +weight+ + get name destination node delta weight destination node max weight predecessor lattice ip get delta ip index lattice get viterbi node ip index delta runtime attempt call get delta lattice store pair alignment viterbi node viterbi node alignment cache backward pas viterbi n best sequence viterbi node viterbi node contain output symbol information note length viterbi node input length+1 because first element start first input output symbol occur transition start next these first input output symbol store second viterbi node last viterbi node correspond last input output symbol pair alignment viterbi node best viterbi node sequence n viterbi node alignment cache viterbi node alignment cache size n viterbi node alignment cache num 0 0 t num i++ lattice lattice length 1 lattice lattice length 1 delta transducer m p o l e w e g h t num final++ viterbi node node viterbi node num f 0 0 t num i++ lattice lattice length 1 lattice lattice length 1 delta transducer m p o l e w e g h t node f++ lattice lattice length 1 star search star node lattice length t num pair alignment viterbi node output pair alignment viterbi node n 0 n search next i++ gsc remove unnecessary cast search node an search next weight an get cost viterbi node seq viterbi node lattice length comment we get start viterbi node akm 12 2007 an an get parent an now correspond viterbi node first transition j 0 j lattice length j++ viterbi node v viterbi node an get v input position j j+1 seq j v an an get parent output add pair alignment viterbi node input viterbi node seq weight viterbi node alignment cache output output pair alignment alignment cache backward pas viterbi n best sequence note length input length+1 because first element start first input output symbol occur transition start next last correspond pair alignment best alignment n alignment cache alignment cache size n alignment cache best viterbi node sequence n ensure viterbi node alignment cache least size n pair alignment ret pair alignment n 0 n i++ s lattice length viterbi node v viterbi node alignment cache get output j 0 j lattice length j++ s j v get j here we grab viterbi node ret add pair alignment input s viterbi node alignment cache get get weight alignment cache ret ret pair alignment best alignment best alignment 1 get 0 best sequence n pair alignment best alignment n ret n 0 n i++ ret add get output ret best best alignment 1 get 0 output pair alignment output alignment cache pair alignment best output alignment n output alignment cache output alignment cache size n output alignment cache best viterbi node sequence n ensure viterbi node alignment cache least size n pair alignment ret pair alignment n 0 n i++ s lattice length 1 viterbi node v viterbi node alignment cache get output j 0 j lattice length 1 j++ s j v get j+1 output here we grab output viterbi node destination ret add pair alignment input s viterbi node alignment cache get get weight output alignment cache ret ret pair alignment best output alignment best output alignment 1 get 0 best output sequence n best output alignment n ensure output alignment cache least size n ret n 0 n i++ ret add output alignment cache get output ret t o o consider cache best output best output alignment 1 get 0 output best weight best output alignment 1 get 0 get weight increment transition count 1 0 along best provide call viterbi training approximation increment transducer transducer incrementor incrementor we going increment along single best path get 0 below we could consider have increment transducer transducer incrementor incrementor count n best path increment determine count length pair alignment viterbi node viterbi node alignment best viterbi node sequence 1 get 0 length viterbi node alignment output size length viterbi node alignment input size sure unequal input output length increment incrementor increment viterbi node alignment output get 0 1 0 increment incrementor increment viterbi node alignment output get length 1 1 0 ip 0 ip viterbi node alignment input size 1 ip++ transition iterator it viterbi node alignment output get ip transition iterator input ip output ip xxx transition completely identify unique destination output num increment 0 it next it next equal viterbi node alignment output get ip+1 it get output equal viterbi node alignment output get ip output incrementor increment transition it 1 0 num increments++ num increment 1 illegal satisfy transition found num increment 0 illegal satisfy transition found elementwise accuracy reference output accuracy 0 output best output reference output size output size 0 output size i++ logger fine accuracy ref +reference output get + viterbi +output get reference output get equal output get accuracy++ logger info correct + accuracy + + output size accuracy output size accuracy reference output print writer output best output accuracy 0 test reference output size output size 0 output size i++ logger fine accuracy ref +reference output get + viterbi +output get test output get test reference output get equal test accuracy++ logger info correct + accuracy + + output size accuracy output size factory max lattice factory serializable max lattice max lattice transducer tran input output max lattice tran input output serial u 1 u r r e n t e r l v e r o n 1 write output stream o write u r r e n t e r l v e r o n read input stream o found read 