topic 2005 univ dept part m l l e t m achine learning languag e toolkit 1 0 furtherinformation see ` l e n e type random io format four level pachinko allocation m l e learning latent dirichlet allocation david mimno p m4 l num topic topic fit num sub topic alpha dirichlet alpha alpha over supertopic alpha sum sub alpha sub alpha sum beta prior topic multinomial over word v beta instance ilist instance expect hold feature num type num gibbs sampling these could we could encode both topic index document index index sub topic index document index index document variable sub count word sub count word weight component gibbs update depend topic sub weight component gibbs update depend sub topic sub weight unnormaliz sampling cumulative weight cache cumulative weight topic word type variable type sub topic count index feature index topic index sub topic index topic index debug purpose topic index topic index sub topic histogram m l e topic histogram histogram word supertopic document eg 17 4 doc 4 word t 17 sub topic histogram supertopic histogram word subtopic runtime runtime format formatt p m4 l topic sub topic topic sub topic 50 0 0 001 p m4 l topic sub topic alpha sum beta formatt format get instance formatt maximum fraction digit 5 num topic topic num sub topic sub topic alpha sum alpha sum alpha topic fill alpha alpha sum num topic sub alpha topic sub topic sub alpha sum topic initialize sub topic alpha symmetric dirichlet topic 0 topic topic topic++ fill sub alpha topic 1 0 fill sub alpha sum sub topic beta beta we can t calculate v beta until we know many word type runtime runtime get runtime estimate instance document num iteration optimize interval show topic interval output model interval output model filename random r ilist document num type ilist get alphabet size num doc ilist size topic num doc sub topic num doc allocate several document cut down memory allocation garbage collection sub count num topic num sub topic count num topic weight num topic sub weight num sub topic sub weight num topic num sub topic cumulative weight num topic type sub topic count num type num sub topic sub topic num sub topic topic num topic sub topic num topic num sub topic v beta beta num type start current milli max 0 initialize random assignment topic finish allocate topic topic sub topic seq len di 0 di num doc di++ feature f feature ilist get di get seq len f get length seq len max max seq len num + seq len topic di seq len sub topic di seq len randomly topic si 0 si seq len si++ random topic topic r next num topic topic di si topic topic topic ++ random sub topic sub topic r next num sub topic sub topic di si sub topic sub topic we also need update word type statistic type sub topic count f get index position si sub topic ++ sub topic sub topic ++ sub topic topic sub topic ++ max + max these initialize first call clear histogram loop below topic histogram num topic max + 1 sub topic histogram num topic num sub topic max + 1 start sampler iteration 0 iteration num iteration iterations++ iteration start current milli clear histogram sample topic doc r there few thing we round number iteration t sense first iteration iteration 0 show topic interval 0 iteration % show topic interval 0 print top word 5 output model interval 0 iteration % output model interval 0 write output model filename+ +iteration optimize interval 0 iteration % optimize interval 0 optimize current milli topic 0 topic num topic topic++ learn sub alpha topic sub topic histogram topic topic histogram topic sub alpha sum topic 0 0 sub topic 0 sub topic num sub topic sub topic++ sub alpha sum topic + sub alpha topic sub topic print o + current milli optimize + iteration 1107 print word count iteration % 10 0 + iteration + print current milli iteration start + print flush second math round current milli start 1000 0 minute second 60 second % 60 hour minute 60 minute % 60 day hour 24 hour % 24 print total day 0 print day print day hour 0 print hour print hour minute 0 print minute print minute print second second 124 5 second 144 8 second feature instead 121 6 second putting feature get index position 106 3 second avoid lookup inner loop temporary variable clear histogram topic 0 topic num topic topic++ fill topic histogram topic 0 sub topic 0 sub topic num sub topic sub topic++ fill sub topic histogram topic sub topic 0 fix point iteration describe tom minka learn observation observation length k sum 0 initialize parameter sum k 0 k length k++ sum + k old k current digamma denominator histogram zero limit zero limit observation length fill zero limit 1 histogram go up size large document zero value almost cluster low we looping over empty saving index large zero value 0 observation length i++ histogram observation k 0 k histogram length k++ histogram k 0 zero limit k iteration 0 iteration 200 iteration++ calculate denominator denominator 0 current digamma 0 iterate over histogram 1 observation length length i++ current digamma + 1 sum + 1 denominator + observation length current digamma na n denominator parameter sum 1 observation length length i++ print observation length + calculate individual sum 0 k 0 k length k++ what large zero element histogram? zero limit zero limit k there assign sub pair anywhere corpus bail zero limit 1 k 0 000001 sum + 0 000001 old k k k 0 current digamma 0 histogram observation k 1 zero limit i++ current digamma + 1 old k + 1 k + histogram current digamma k old k denominator na n k k + old k + + denominator 1 histogram length i++ print histogram + sum + k iteration gibbs sampling acros document sample topic doc random r loop over word corpus di 0 di topic length di++ sample topic doc feature ilist get di get topic di sub topic di r sample topic doc feature doc topic index seq position sub topic random r start current milli current type sub topic count current sub count current sub weight current sub alpha type sub topic topic current weight cumulative weight sample doc len doc get length t 0 t num topic t++ fill sub count t 0 fill count 0 populate topic count si 0 si doc len si++ sub count topic si sub topic si ++ count topic si ++ iterate over position word document si 0 si doc len si++ type doc get index position si topic topic si sub topic sub topic si count sub count topic sub topic count topic type sub topic count type sub topic topic topic sub topic sub topic sub topic topic sub topic build over sub topic pair clear structure t 0 t num topic t++ fill sub weight t 0 0 fill weight 0 0 fill sub weight 0 0 fill cumulative weight 0 0 two layer ie access current type sub topic count type sub topic count type conditional probability sub pair proportional expression three part depend topic depend sub topic word type depend sub pair calculate factor first topic 0 topic num topic topic++ weight topic count topic + alpha topic count topic + sub alpha sum topic next calculate sub factor sub topic 0 sub topic num sub topic sub topic++ sub weight sub topic current type sub topic count sub topic + beta sub topic sub topic + v beta put them together cumulative weight 0 0 topic 0 topic num topic topic++ current sub weight sub weight topic current sub count sub count topic current sub alpha sub alpha topic current weight weight topic sub topic 0 sub topic num sub topic sub topic++ current sub weight sub topic current weight sub weight sub topic current sub count sub topic + current sub alpha sub topic cumulative weight + current sub weight sub topic cumulative weight topic cumulative weight sample topic assignment sample r next uniform cumulative weight go over row sum find topic topic 0 sample cumulative weight topic topic++ now read acros find sub topic current sub weight sub weight topic cumulative weight cumulative weight topic current sub weight 0 go over sub topic until weight l e sample note we re subtract weight same we them sub topic 0 sample cumulative weight sub topic++ cumulative weight current sub weight sub topic save choice into gibbs topic si topic sub topic si sub topic put sub topic into count sub count topic sub topic ++ count topic ++ type sub topic count type sub topic ++ topic topic ++ sub topic sub topic ++ sub topic topic sub topic ++ update topic count histogram dirichlet estimation topic 0 topic num topic topic++ topic histogram topic count topic ++ current sub count sub count topic sub topic 0 sub topic num sub topic sub topic++ sub topic histogram topic sub topic current sub count sub topic ++ print word count sub topic topic buffer output buffer topic 0 topic num topic topic++ sub topic 0 sub topic num sub topic sub topic++ output append sub topic topic sub topic + + formatt format sub alpha topic sub topic + output append output print top word num word line sorter wp sorter num type sorter sort sub topic sorter num sub topic sub topic num sub topic sub topic topic sub topic 0 sub topic num sub topic sub topic++ wi 0 wi num type wi++ wp wi sorter wi type sub topic count wi sub topic sub topic sub topic sort wp buffer topic buffer 0 num word i++ topic append ilist get alphabet lookup wp wi topic append sub topic sub topic topic line topic + sub topic 0 num word i++ ilist get alphabet lookup wp wi + + formatt format wp p topic + sub topic + + sub topic sub topic + + sub topic sub topic max sub topic 10 num sub topic 10 max sub topic num sub topic topic 0 topic num topic topic++ sub topic 0 sub topic num sub topic sub topic++ sort sub topic sub topic sorter sub topic sub alpha topic sub topic sort sort sub topic topic + topic + + topic topic + 0 max sub topic i++ sub topic sort sub topic wi sub topic + + formatt format sub alpha topic sub topic + + sub topic sub topic print document topic f o print document topic print writer buffer writer writer f 0 0 1 look m print document topic print writer pw threshold max pw doc subtopic proportion supertopic proportion doc len topic dist num topic sub topic dist num sub topic di 0 di topic length di++ pw print di pw print doc len topic di length ilist get di get pw print ilist get di get pw print pw print doc len sub topic di length populate document topic count si 0 si doc len si++ topic dist topic di si + 1 0 sub topic dist sub topic di si + 1 0 ti 0 ti num topic ti++ topic dist ti doc len ti 0 ti num sub topic ti++ sub topic dist ti doc len print subtopic prortion sort max 0 max num sub topic tp 0 tp max tp++ maxvalue 0 maxindex 1 ti 0 ti num sub topic ti++ sub topic dist ti maxvalue maxvalue sub topic dist ti maxindex ti maxindex 1 || sub topic dist maxindex threshold pw print maxindex+ +sub topic dist maxindex + sub topic dist maxindex 0 pw print print supertopic prortion sort max 0 max num topic tp 0 tp max tp++ maxvalue 0 maxindex 1 ti 0 ti num topic ti++ topic dist ti maxvalue maxvalue topic dist ti maxindex ti maxindex 1 || topic dist maxindex threshold pw print maxindex+ +sup topic dist maxindex + topic dist maxindex 0 pw print f o print print writer buffer writer writer f print print writer pw alphabet ilist get alphabet pw doc po typeindex type topic sub topic di 0 di topic length di++ feature f feature ilist get di get si 0 si topic di length si++ type f get index position si pw print di pw print pw print si pw print pw print type pw print pw print lookup type pw print pw print topic di si pw print pw print sub topic di si pw pw close write f output stream oo output stream output stream f oo write oo close o e err + f + + e serialization serial u 1 u r r e n t e r l v e r o n 0 n u l l n t e g e r 1 write output stream o write u r r e n t e r l v e r o n write ilist write num topic write alpha write beta write v beta di 0 di topic length di ++ si 0 si topic di length si++ write topic di si fi 0 fi num type fi++ ti 0 ti num topic ti++ write type topic count fi ti ti 0 ti num topic ti++ write topic ti read input stream o found feature length read ilist instance read num topic read alpha read beta read v beta read num doc ilist size topic num doc di 0 di ilist size di++ doc len feature ilist get instance di get get length topic di doc len si 0 si doc len si++ topic di si read num type ilist get alphabet size type topic count num type num topic fi 0 fi num type fi++ ti 0 ti num topic ti++ type topic count fi ti read topic num topic ti 0 ti num topic ti++ topic ti read recommend bin vectors2topic instead o instance ilist instance load 0 num iteration length 1 ? parse 1 1000 num top word length 2 ? parse 2 20 num topic length 3 ? parse 3 10 num sub topic length 4 ? parse 4 10 load p m4 l pam p m4 l num topic num sub topic pam estimate ilist num iteration 50 0 50 random 1100 pam print top word num top word pam print document topic 0 + pam sorter comparable wi p sorter wi p wi wi p p compare o2 p sorter o2 p 1 p sorter o2 p 0 1 