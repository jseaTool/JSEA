2003 univ dept part m l l e t m achine learning languag e toolkit 1 0 information see ` l e n e type collection iterator flop type matrix type matrixn type sparse matrixn math create jan 4 2006 h r e f $ log table factor v 1 1 2007 10 22 21 37 44 $ log table factor table factor log table factor table factor prob matrix get log value matrix clone matrix log table factor variable var var log table factor variable var var log table factor collection var var log factor value log table factor variable var log value var log value log table factor variable var matrix prob var prob log table factor value variable var val vals2 val length 0 val length i++ vals2 math log val log value var vals2 log table factor log value variable var val log table factor var val identity 0 0 factor duplicate log table factor table factor blank subset variable var log table factor var factor normalize sum logspace norm sum 500 err attempt normalize 0 factor +thi dump 0 prob num location i++ val prob value location prob value location val sum logspace norm sum n e g t v e n f n t y 0 log space 0 prob num location i++ sum math sum log prob sum prob value location flop sum log prob prob num location sum sum flop logspace norm count rest math logspace norm logsum logspace norm conceptual equivalent pot pot variable subset multiply internal discrete factor ptl projection large idx small ptl num loc prob num location single loc 0 single loc num loc single loc++ small idx projection single loc prev prob value location single loc val ptl log value small idx prev + val prob value location single loc flop increment num loc handle plus destructive divison assume variable pot divide internal discrete factor ptl projection large idx small ptl num loc prob num location single loc 0 single loc num loc single loc++ small idx projection single loc prev prob value location single loc val ptl log value small idx prev val convention let inf + inf correspond 0 0 inf infinite val n e g t v e n f n t y prob value location single loc flop increment num loc handle plus conceptual equivalent + pot pot variable subset plus equal internal discrete factor ptl projection large idx small ptl num loc prob num location single loc 0 single loc num loc single loc++ small idx projection single loc prev prob value location single loc val ptl log value small idx math sum log prob prev val prob value location single loc flop sum log prob num loc value assignment assn flop get num var 0 1 0 math raw value assn value assignment iterator flop math raw value index current assn value idx flop math raw value idx log value assignment iterator raw value index current assn log value idx raw value idx log value assignment assn raw value assn factor marginalize internal table factor n e g t v e n f n t y projection large idx small add element single large potentialto correct element small num loc prob num location large loc 0 large loc num loc large loc++ convert single index small small idx projection large loc whew now add old value prob value location large loc current value prob single value small idx prob value location small idx math sum log prob old value current value flop sum log prob num loc raw value assignment assn num var get num var index num var 0 num var i++ variable var get variable index assn get var raw value index raw value index handle occur index specially value inf log space single idx prob single index index raw value single idx raw value single idx loc prob location single idx loc 0 n e g t v e n f n t y prob value location loc exponentiate power flop increment prob num location prob time equal power table factor ensure operand compatible table factor ptl ptl log table factor log table factor ptl ptl log value assignment assn log value raw value assn log value log value assignment iterator assn log value raw value assn log value value assignment iterator assn value flop log raw value assn math log value log value val 0 val length i++ raw value val value val flop log val length 0 val length i++ raw value math log val v log space time equal v time equal log math log v time equal log log v flop increment prob num location matrix matrix prob clone matrix log v prob plus equal plus equal location loc v flop log flop sum log prob 1 old val log value loc raw value loc math sum log prob old val math log v log table factor value variable var vals2 value variable var vals2 log table factor matrix variable var sparse matrixn value sparse matrixn log value sparse matrixn value clone matrix 0 log value num location i++ log value value location math log log value value location flop log log value num location log table factor var log value log table factor log matrix variable var matrix value matrix log value matrix value clone matrix log table factor var log value log table factor log value variable v val log value variable v val matrix get value matrix matrix log prob matrix prob clone matrix loc 0 loc prob num location loc++ log prob value location loc math log prob value location loc flop prob num location log prob matrix get log value matrix prob value location idx flop math prob value location idx factor slice onevar variable var assignment observe assignment assn assignment observe duplicate val var get num outcome 0 var get num outcome i++ assn value var val log value assn log table factor log value var val factor slice twovar variable v1 variable v2 assignment observe assignment assn assignment observe duplicate n1 v1 get num outcome n2 v2 get num outcome sz n1 n2 val n1 n2 0 n1 i++ assn value v1 j 0 j n2 j++ assn value v2 j idx matrixn single index sz j inefficient much les prone val idx log value assn log table factor log value variable v1 v2 val factor slice variable var assignment observe var keep hash var var keep observe var val keep weight assignment iterator keep assignment iterator next assignment union assignment union observe assignment val index current assn log value union advance log table factor log value keep variable val log table factor multiply collection phi get variable var v hash var iterator phi iterator next factor phi factor next v add phi var define over neighbor n o e log table factor p f log table factor v iterator phi iterator next factor phi factor next p f multiply phi p f table factor recent table factor normalize loc argmax lval prob value location loc refactor time equal log lval 