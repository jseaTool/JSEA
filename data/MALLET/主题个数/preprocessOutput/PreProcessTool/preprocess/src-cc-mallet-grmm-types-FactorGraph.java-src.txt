2003 univ dept part m l l e t m achine learning languag e toolkit 1 0 information see ` l e n e type gnu trove t hash map gnu trove t hash gnu trove t procedure gnu trove t hash map io inference exact sampler inference variable elimination int2 multi map model random undirect graphical model create mon sep 15 15 18 30 2003 charles sutton $ factor graph v 1 1 2007 10 22 21 37 44 $ factor graph factor factor clique graph ordinarily map clique discrete potential t hash map clique2ptl t hash map universe universe t hash map projection map my2global bidirectional map factor alphabet duplicate indexing factor vertex edge these index variable index see link variable index vertex pot int2 multi map pairwise factor factor var num node factor graph num node 0 cache capacity 0 factor alphabet bidirectional map model variable much fast add variable factor graph variable var cache capacity var length 0 var length i++ cache variable var factor graph factor factor 0 factor length i++ add factor factor factor graph collection factor iterator factor iterator next add factor factor next model capacity e capacityin variable node can expand late declare capacity advance you know many thing efficient factor graph capacity cache capacity capacity h n g clear cache cache capacity num node pairwise factor clear projection map clear increase size cache need increase node can also call he cache be up cache capacity n factor var n 0 n i++ factor var vertex pot n my2global n projection map projection map t hash map n projection map value 1 projection map ensure capacity n need recreate edge pot since hash map pairwise factor pairwise factor int2 multi map factor factor factor factor factor clique2ptl factor var regenerate cache factor variable variable var iterator factor iterator next factor ptl factor next ptl var contain var clique2ptl retain entry t procedure execute clique ptl var clique contain var variable cache variable victim survivor t hash variable survivor victim vi 0 t hash map dict t hash map survivor size dict value 1 longer support get index write need my2global survivor size iterator survivor iterator next variable var variable next gvi var get index dict put gvi vi my2global vi gvi projection map dict num node affect get vertex recache factor num node 0 iterator factor iterator next factor ptl factor next var v ptl var add var v cache factor v ptl regenerate cache clear cache recache factor update factor cache num node num variable vertex pot cache capacity num node num node vertex pot length old vertex pot vertex pot int2 multi map old edge pot pairwise factor old factor var factor var old m2 g my2global cache capacity 2 num node old edge pot arraycopy old vertex pot 0 vertex pot 0 old vertex pot length arraycopy old m2 g 0 my2global 0 old m2 g length 0 old factor var length i++ factor var add old factor var cache variable variable var num nodes++ update factor cache gvi var get index myvi num node 1 projection map put gvi myvi my2global myvi gvi cache factor var var factor factor var size 1 vidx get index var get 0 cache variable factor vidx factor factor var vidx add factor 2 idx1 get index var get 0 idx2 get index var get 1 cache pairwise factor idx1 idx2 factor iterator var iterator next variable var variable next idx get index var factor var idx add factor cache variable factor vidx factor factor vertex pot vidx vertex pot vidx 2 vertex pot vidx add factor cache pairwise factor idx1 idx2 factor ptl pairwise factor add idx1 idx2 ptl pairwise factor add idx2 idx1 ptl factor var idx1 add ptl factor var idx2 add ptl e o r variable node graph num variable num node variable iterator iterator variable iterator size num node iterator variable iterator iterator 0 next num node next get i++ unsupport operation variable adjacent variable graph variable share factor xxx inefficient perhap cache var get adjacent vertex variable var hash var hash var adj factor factor contain var iterator adj factor iterator next factor factor factor next add factor var collection contain factor model collection factor collection unmodifiable collection factor iterator factor graph iterator factor iterator factor iterator iterator over assignment variable graphical model see assignment assignment iterator assignment iterator dense assignment iterator var iterator var set graph over factor define iterator var iterator clique2ptl key iterator unique numeric index variable model undirect model tt mdl tt maintain mapping between variable 0 size mdl 1 cache variable p tt get index tt tt get tt inverse tt idx get index var tt tt get idx tt tt var tt var variable graphical model numeric index var see get get index variable var idx var get index projection map contain key idx projection map get idx 1 get index factor factor factor alphabet lookup index factor variable model index undirect model tt mdl tt maintain mapping between variable 0 size mdl 1 cache variable p tt get index tt tt get tt inverse tt idx get index var tt tt get idx tt tt var tt see get index variable variable get index global idx my2global index universe get global idx factor get factor factor factor alphabet lookup degree variable factor graph factor variable argument get degree variable var factor contain var size search model variable name name name find variable tt var tt tt var get label equal name tt variable find variable name iterator variable iterator next variable var variable next var get label equal name var factor graph domain clique factor define over clique factor define over subset superset clique see add factor factor see factor variable variable see factor variable factor factor var var var size 1 factor var get 0 2 factor var get 0 var get 1 factor collection var factor define over pair variable p equivalent calling link factor var contain tt v1 tt tt v2 tt p var1 variable pair var2 variable pair factor define over pair tt v1 v2 tt factor factor variable var1 variable var2 ptl edge factor var1 var2 factor ptl first singleton ptl var1+ +var2 ptl ptl var size 2 ptl contain var var1 ptl contain var var2 ptl edge factor variable var1 variable var2 pairwise factor get get index var1 get index var2 collection factor involve variable factor domain subset collection collection factor contain collection var t hash factor t hash iterator factor iterator next factor ptl factor next var contain ptl var factor add ptl factor factor contain variable var factor var get index var factor graph domain exactly specify var factor variable var idx get index var idx 1 vertex pot idx factor graph domain exactly specify collection variable factor collection rath iterate over factor just iterate over one we know contain get 0 could possibly efficient picking var small degree variable v0 variable iterator next factor factor var get index v0 ret iterator factor iterator next factor f factor next var var f var var size size contain var var contain ret add f ret m u t t o r remove variable model along factor variable var variable cache var factor variable var regenerate cache remove collection variable model along factor equivalent calling variable element collection because cache perform elsewhere vastly efficient collection var iterator var iterator next variable var variable next factor variable var num node var size regenerate cache two variable adjacent model graph v1 variable model v2 another variable model there edge connect them adjacent variable v1 variable v2 factor factor contain v1 iterator factor iterator next factor ptl factor next ptl var contain v2 variable part model v1 variable variable moel contain var variable v1 variable contain v1 add factor variable var1 variable var2 prob variable var variable var1 var2 table factor pot table factor var prob add factor pot add factor model p factor already be variable clique effect currently undefin p convenience add factor eventually call subclass override they wish additional factor graph factor factor over variable clique add factor factor factor factor add factor var var factor var add var var factor add factor factor alphabet lookup index factor add map clique2ptl var factor cache factor cache factor var factor factor add factor perform check factor model uncheck there problem nothing override subclass factor factor about factor add factor factor perform factor be model cache nothing override subclass factor factor just be factor add factor factor add map map map key value lst map get key lst lst map put key lst lst add value add var var var 0 var size i++ variable var var get universe universe var get universe get index var 0 cache variable var remove potentia model clear factor alphabet bidirectional map factor clear clique2ptl clear clear cache num node 0 unnormaliz probability assignment model value pre \prod \phi assn pre range over clique factor be define assn assignment variable model unnormaliz probability factor assignment assn iterator ptl it factor iterator ptl prod 1 ptl it next ptl prod factor ptl it next value assn ptl prod factor node factor domain exactly node p equivalent calling link factor clique contain tt v tt p var factor over runtime model contain factor over variable factor factor define over edge tt v tt link add factor factor factor factor factor variable var lst factor var first singleton lst var factor first singleton lst desc lst sz lst size sz 1 runtime multiple factor over +desc+ + collection util dump lst sz 0 factor lst get 0 search graphical model factor over collection variable factor define over collection factor factor define over subset superset collection runtime multiple factor over collection see factor collection see add factor factor see factor var factor factor collection factor factor first singleton factor model variable share between model factor deep copy factor duplicate factor graph dup factor graph num variable iterator variable iterator next variable var variable next dup cache variable var iterator factor iterator next factor pot factor next dup add factor pot duplicate e e print stack trace dup dump variable factor model tt tt human readable dump dump print writer output stream writer dump print writer factor +clique2ptl iterator factor iterator next factor pot factor next pot dump dump writer writer dump print writer f t o r m p l e m e n t t o n value assignment assn math log value assn value assignment iterator value assignment us brute force algorithm factor normalize variable elimination inf variable elimination z inf compute normalization factor add factor constant factor 1 0 z factor marginalize variable var unsupport operation yet factor marginalize collection var num variable 5 table marginalize var unsupport operation yet factor marginalize variable var variable elimination inf variable elimination inf unnormaliz marginal var factor marginalize variable var unsupport operation yet factor marginalize var varset unsupport operation yet factor extract max collection var num variable 5 table extract max var unsupport operation yet factor extract max variable var num variable 5 table extract max var unsupport operation yet factor extract max variable var num variable 5 table extract max var unsupport operation yet xxx assignment argmax unsupport operation yet structure factor graph continou discrete assignment sample random r variable cont var factor continuou var cont var length 0 || cont var length num variable sample internal r assignment assn sample continuou var cont var r factor graph discrete slice fg factor graph slice assn assignment discrete assn discrete slice fg sample internal r assignment union assn discrete assn sample continuou variable factor graph assignment sample continuou var random r variable cont var factor continuou var sample continuou var cont var r assignment sample continuou var variable cont var random r collection cont factor factor contain cont var factor graph cont fg factor graph cont var iterator cont factor iterator next factor factor factor next cont fg multiply factor cont fg sample internal r assignment sample internal random r exact sampler sampler exact sampler r sampler sample 1 sum variable elimination inf variable elimination inf compute normalization factor entropy unsupport operation yet factor multiply factor dist factor graph fg factor graph duplicate fg add factor dist fg multiply factor pot add factor pot exponentiate power unsupport operation yet divide factor pot factor contain pot factor pot unsupport operation yet var var hash var variable almost equal factor p unsupport operation almost equal factor p epsilon unsupport operation yet na n fi 0 fi factor size fi++ get factor fi na n log value assignment iterator log value assignment log value loc unsupport operation variable get variable get todo merge factor slice assignment assn slice assn factor slice assignment assn map slice map model add evidence assn slice map h n g f l t y f o r t h e u e o f n f e r e n e l g o r t h m t hash map inference cache t hash map cache some information about graph specific type inferenc e g junction tree inferenc inferenc can information info information cache see get inference cache inference cache inferenc info inference cache put inferenc info cache some information about graph specific type inferenc e g junction tree inferenc inferenc want information whatever previously cache inferenc inference cache be cache see inference cache get inference cache inferenc inference cache get inferenc logify old factor factor clear iterator old factor iterator next table factor factor table factor next add factor log table factor factor log value assignment assn iterator ptl it factor iterator ptl prod 0 ptl it next ptl prod + factor ptl it next log value assn ptl prod table factor table table factor multiply factor table pretty output buffer buf buffer buf append factor graph variable 0 num node i++ variable var get buf append var buf append buf append buf append factor iterator factor iterator next factor factor factor next buf append buf append factor var buf append buf append buf print dot print writer graph model output edge dot color red green blue yellow print dot print writer assignment assn graph model output edge dot iterator variable iterator next variable var variable next value assn get var color color value var get label + style fill fillcolor +color+ output edge dot print writer ptl idx 0 iterator factor iterator next factor ptl factor next var var ptl var iterator var var iterator var next variable var variable var next print p t l +ptl idx+ +var get label ptl idx++ serialization garbage serial u 1 u r r e n t e r l v e r o n 1 write output stream o write write u r r e n t e r l v e r o n read input stream o found read read regenerate cache 