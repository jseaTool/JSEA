implement different gibbs sampling inference topic io buffer output stream io io output stream io writer io o io print stream io print writer zip g z p output stream type feature counter type feature type feature vector type sorter type instance type instance type label alphabet type label random gnu trove t hash map limin yao david mimno l stream l hyp topication test test instance topic assignment topic l stream topic topic t o o auto generate constructor stub topic alpha sum beta l stream topic alpha sum beta topic alpha sum beta t o o auto generate constructor stub topic alpha sum beta random l stream topic alpha sum beta random random topic alpha sum beta random t o o auto generate constructor stub topic alphabet alpha sum beta random l stream label alphabet topic alphabet alpha sum beta random random topic alphabet alpha sum beta random t o o auto generate constructor stub topication get test test first training topic model training inference test count type topic count re sampling inference max iteration test topication initialize test sampling testdata label topic sequence label instance instance testing label topic label topic alphabet instance length instance yet obey last argument work sample topic doc feature instance get topic random r random feature f feature instance get topic topic get feature 0 topic length i++ type f get index position topic r next num topic type topic count type adjust put value topic 1 1 topic topic ++ topic sequence add topic construct test testing size topic sequence size 0 testing size i++ topication t topication testing get topic sequence get test add t start current milli loop it 0 it max iteration iter++ iter%100 0 print iteration + it num doc test size t o o di 0 di num doc di++ feature feature test get di instance get label topic test get di topic sample topic test doc topic second math round current milli start 1000 0 minute second 60 second % 60 hour minute 60 minute % 60 day hour 24 hour % 24 print total inferenc day 0 print day print day hour 0 print hour print hour minute 0 print minute print minute print second second call inference unseen word testdata sample topic test doc feature label topic t o o auto generate stub doc topic topic get feature t hash map current type topic count type old topic topic tw topic weight num topic topic weight sum doc length get length populate topic count local topic count num topic ti 0 ti num topic ti++ local topic count ti 0 position 0 position doc length position++ local topic count doc topic position ++ iterate over position word document si 0 si doc length si++ type get index position si old topic doc topic si count local topic count old topic current type topic count type topic count type current type topic count get old topic 0 current type topic count get old topic 1 current type topic count old topic current type topic count adjust value old topic 1 topic old topic build over topic fill topic weight 0 0 topic weight sum 0 ti 0 ti num topic ti++ tw current type topic count get ti + beta topic ti + beta sum local topic count ti + alpha ti doc len 1+t alpha constant acros topic topic weight sum + tw topic weight ti tw sample topic assignment topic random next discrete topic weight topic weight sum put topic into count doc topic si topic current type topic count adjust put value topic 1 1 local topic count topic ++ topic topic ++ what we type topic count topic topic training test estimate iteration o re gibbs sampling add test initialize histogram cache value estimate iteration inference testdata problem deal unseen word unseen word alphabet type topic count entry limin yao max iteration inference max iteration test topication initialize test sampling testdata label topic sequence label instance instance testing label topic label topic alphabet instance length instance yet obey last argument work sample topic doc feature instance get topic random r random feature f feature instance get topic topic get feature 0 topic length i++ type f get index position topic r next num topic type topic count type size 0 topic r next num topic topic 1 unseen word topic sequence add topic construct test testing size topic sequence size 0 testing size i++ topication t topication testing get topic sequence get test add t statistic doc add count n k w n k attention unseen word feature feature t instance get label topic t topic pi 0 pi topic get length pi++ topic topic get index position pi type get index position pi topic 1 type see training type topic count type adjust put value topic 1 1 topic topic ++ start current milli loop it 0 it max iteration iter++ iter%100 0 print iteration + it num doc test size t o o di 0 di num doc di++ feature feature test get di instance get label topic test get di topic sample topic test doc topic second math round current milli start 1000 0 minute second 60 second % 60 hour minute 60 minute % 60 day hour 24 hour % 24 print total inferenc day 0 print day print day hour 0 print hour print hour minute 0 print minute print minute print second second sample topic test doc feature label topic t o o auto generate stub doc topic topic get feature t hash map current type topic count type old topic topic tw topic weight num topic topic weight sum doc length get length populate topic count local topic count num topic ti 0 ti num topic ti++ local topic count ti 0 position 0 position doc length position++ doc topic position 1 local topic count doc topic position ++ iterate over position word document si 0 si doc length si++ type get index position si old topic doc topic si old topic 1 count local topic count old topic current type topic count type topic count type current type topic count get old topic 0 current type topic count get old topic 1 current type topic count old topic current type topic count adjust value old topic 1 topic old topic build over topic fill topic weight 0 0 topic weight sum 0 ti 0 ti num topic ti++ tw current type topic count get ti + beta topic ti + beta sum local topic count ti + alpha ti doc len 1+t alpha constant acros topic topic weight sum + tw topic weight ti tw sample topic assignment topic random next discrete topic weight topic weight sum put topic into count doc topic si topic current type topic count adjust put value topic 1 1 local topic count topic ++ topic topic ++ inference 3 doc iteration word compare inference method2 it doc word inference max iteration test topication initialize test sampling testdata label topic sequence label instance instance testing label topic label topic alphabet instance length instance yet obey last argument work sample topic doc feature instance get topic random r random feature f feature instance get topic topic get feature 0 topic length i++ type f get index position topic r next num topic type topic count type adjust put value topic 1 1 topic topic ++ type topic count type size 0 topic r next num topic type topic count type adjust put value topic 1 1 topic topic ++ topic 1 unseen word topic sequence add topic construct test testing size topic sequence size 0 testing size i++ topication t topication testing get topic sequence get test add t start current milli loop it 0 num doc test size t o o di 0 di num doc di++ it 0 feature feature test get di instance get label topic test get di topic it max iteration iter++ sample topic test doc topic di%100 0 print docnum + di second math round current milli start 1000 0 minute second 60 second % 60 hour minute 60 minute % 60 day hour 24 hour % 24 print total inferenc day 0 print day print day hour 0 print hour print hour minute 0 print minute print minute print second second inference theta max iteration instance theta test topication initialize test sampling testdata label topic sequence label instance instance testing label topic label topic alphabet instance length instance yet obey last argument work sample topic doc feature instance get topic random r random feature f feature instance get topic topic get feature 0 topic length i++ type f get index position topic r next num topic topic sequence add topic construct test testing size topic sequence size 0 testing size i++ topication t topication testing get topic sequence get test add t statistic doc add count n k w n k attention unseen word feature feature t instance get label topic t topic pi 0 pi topic get length pi++ topic topic get index position pi type get index position pi topic 1 type see training type topic count type adjust put value topic 1 1 topic topic ++ start current milli loop it 0 it max iteration iter++ iter%100 0 print iteration + it num doc test size t o o di 0 di num doc di++ feature vector fv theta feature vector theta get di get topic fv theta get value feature feature test get di instance get label topic test get di topic sample topic doc theta topic topic second math round current milli start 1000 0 minute second 60 second % 60 hour minute 60 minute % 60 day hour 24 hour % 24 print total inferenc day 0 print day print day hour 0 print hour print hour minute 0 print minute print minute print second second sampling know theta maxent sample topic doc theta feature label topic topic t o o auto generate stub doc topic topic get feature t hash map current type topic count type old topic topic tw topic weight num topic topic weight sum doc length get length iterate over position word document si 0 si doc length si++ type get index position si old topic doc topic si old topic 1 current type topic count type topic count type current type topic count get old topic 0 current type topic count get old topic 1 current type topic count old topic current type topic count adjust value old topic 1 topic old topic build over topic fill topic weight 0 0 topic weight sum 0 ti 0 ti num topic ti++ tw current type topic count get ti + beta topic ti + beta sum topic ti doc len 1+t alpha constant acros topic topic weight sum + tw topic weight ti tw sample topic assignment topic random next discrete topic weight topic weight sum put topic into count doc topic si topic current type topic count adjust put value topic 1 1 topic topic ++ print human readable doc topic matrix r print theta topication dataset f threshold max o print writer pw print writer writer f topic count num topic doc len di 0 di dataset size di++ label topic dataset get di topic current doc topic topic get feature doc len current doc topic length 0 doc len token++ topic count current doc topic ++ pw dataset get di instance get name n t|d +alpha t doc len + alpha sum topic 0 topic num topic topic++ prob topic count topic +alpha topic doc len + alpha sum pw topic + topic + + prob pw fill topic count 0 pw close print topic word matrix r print phi f threshold o print writer pw print writer writer f feature counter word count topic feature counter num topic ti 0 ti num topic ti++ word count topic ti feature counter alphabet fi 0 fi num type fi++ topic type topic count fi key 0 topic length i++ word count topic topic increment fi type topic count fi get topic ti 0 ti num topic ti++ pw topic + ti feature counter counter word count topic ti feature vector fv counter feature vector po 0 po fv num location pos++ fi fv index location po word alphabet lookup fi count fv value location po prob prob count+beta topic ti + beta sum pw word + + prob pw pw close print document topic topication dataset f o print document topic dataset print writer writer f print document topic topication dataset print writer pw print document topic dataset pw 0 0 1 pw print writer threshold print topic proportion great max print many topic print document topic topication dataset print writer pw threshold max pw print doc topic proportion doc len topic count num topic sorter sort topic sorter num topic topic 0 topic num topic topic++ initialize sorter dummy value sort topic topic sorter topic topic max 0 || max num topic max num topic di 0 di dataset size di++ label topic dataset get di topic current doc topic topic get feature pw print di pw print dataset get di instance get pw print dataset get di instance get pw print pw print doc len current doc topic length count up real doc len 0 0 doc len token++ current doc topic 1 topic count current doc topic ++ real doc len ++ real doc len doc len alpha sum 0 0 topic 0 topic num topic topic++ alpha sum+ alpha topic normalize smooth dirichlet prior alpha topic 0 topic num topic topic++ sort topic topic topic topic count topic +alpha topic doc len + alpha sum sort sort topic 0 max i++ sort topic get weight threshold pw print sort topic get + + sort topic get weight + pw print fill topic count 0 pw close print topication dataset f o print stream print stream g z p output stream buffer output stream output stream f print dataset close print topication dataset print stream doc po typeindex type topic di 0 di dataset size di++ feature feature dataset get di instance get label topic dataset get di topic n dataset get di instance get dataset get di instance get pi 0 pi topic get length pi++ type get index position pi topic topic get index position pi print di print print print print pi print print type print print alphabet lookup type print print topic 