2005 univ dept part m l l e t m achine learning languag e toolkit 1 0 information see ` l e n e topic zip io format type command random latent dirichlet allocation loosely parallel corpus arbitrary language david mimno mc callum polylingual topic model serializable command space language input command space polylingual topic model language input f l e n m e f l e n m e filename polylingual topic model language + same instance document miss + language there empty instance command output model filename command polylingual topic model output model f l e n m e filename write binary topic model iteration + indicate write command input model filename command polylingual topic model input model f l e n m e filename read binary topic model input append + allow incremental training + indicate read command inferenc filename command polylingual topic model inferenc filename f l e n m e topic inferenc applie previously train topic model document + indicate write command evaluator filename command polylingual topic model evaluator filename f l e n m e hold likelihood evaluator document + indicate write command command polylingual topic model output f l e n m e filename write gibbs sampling iteration + indicate write command topic key command polylingual topic model output topic key f l e n m e filename write top word topic dirichlet + indicate write command doc topic command polylingual topic model output doc topic f l e n m e filename write topic proportion document iteration + indicate write command doc topic threshold command polylingual topic model doc topic threshold e m l 0 0 topic proportion document output doc topic + print topic proportion les threshold value command doc topic max command polylingual topic model doc topic max n t e g e r 1 topic proportion document output doc topic + print n t e g e r topic + negative value indicate topic print command output model interval command polylingual topic model output model interval n t e g e r 0 iteration between model gibbs sampling binary + you also output model argument prefix filename command output interval command polylingual topic model output interval n t e g e r 0 iteration between sampling + you also output argument prefix filename command num topic command polylingual topic model num topic n t e g e r 10 topic fit command num iteration command polylingual topic model num iteration n t e g e r 1000 iteration gibbs sampling command random seed command polylingual topic model random seed n t e g e r 0 random seed gibbs sampler 0 clock command top word command polylingual topic model num top word n t e g e r 20 most probable word print topic model estimation command show topic interval command polylingual topic model show topic interval n t e g e r 50 iteration between printing brief summary topic far command optimize interval command polylingual topic model optimize interval n t e g e r 0 iteration between reestimat dirichlet hyperparameter command optimize burn command polylingual topic model optimize burn n t e g e r 200 iteration run first estimate dirichlet hyperparameter command alpha command polylingual topic model alpha e m l 50 0 alpha parameter smooth over topic command beta command polylingual topic model beta e m l 0 01 beta parameter smooth over unigram topic assignment serializable instance instance label topic sequence label topic topic assignment instance instance label topic sequence instance instance topic sequence topic sequence num language 1 topic assignment training instance topic assignment label alphabet topic alphabet alphabet topic num stopword 0 num topic topic fit hash testing these value encode type topic count count topic pair single topic mask topic bit alphabet alphabet vocabulary size alpha dirichlet alpha alpha over topic alpha sum beta prior topic multinomial over word beta sum language max type count e f u l t e t 0 01 language smooth mass language cache coefficient topic term count 0 beta topic count 0 smooth count 0 put topic count current document initialize locally below define here garbage collection overhead doc topic count index document index topic index language type topic count index feature index topic index language topic index topic index dirichlet estimation doc length count histogram document size sum over language topic doc count histogram document topic count index topic index position index iteration far 1 num iteration 1000 burnin 5 save sample interval 5 10 optimize interval 10 show topic interval 10 50 word topic 7 save model interval 0 model filename save interval 0 filename random random format formatt print log likelihood polylingual topic model topic topic topic polylingual topic model topic alpha sum topic alpha sum random label alphabet label alphabet num topic label alphabet ret label alphabet 0 num topic i++ ret lookup index topic +i ret polylingual topic model topic alpha sum random random label alphabet topic alpha sum random polylingual topic model label alphabet topic alphabet alpha sum random random topic assignment topic alphabet topic alphabet num topic topic alphabet size bit count num topic 1 exact power 2 topic mask num topic 1 topic bit bit count topic mask add extra bit topic mask high bit num topic 2 1 topic bit bit count topic mask alpha sum alpha sum alpha num topic fill alpha alpha sum num topic random random formatt format get instance formatt maximum fraction digit 5 err polylingual l + num topic + topic + topic bit + topic bit + binary topic mask + topic mask load testing testing o testing hash buffer reader buffer reader reader testing read line testing add close label alphabet get topic alphabet topic alphabet get num topic num topic topic assignment get num iteration num iteration num iteration num iteration burnin burnin burnin burnin topic interval n show topic interval interval word topic n random seed seed random random seed optimize interval interval optimize interval interval model output interval filename save model interval interval model filename filename define often save interval save interval iteration filename save iteration suffix save interval filename save interval interval filename filename add instance instance training num language training length language topic num language num topic alphabet alphabet num language vocabulary size num language beta num language beta sum num language language max type count num language language type topic count num language num instance training 0 size hash stoplist hash num language language 0 language num language language++ training language size num instance err warning language + language + + training language size + instance 0 + num instance alphabet language training language get alphabet vocabulary size language alphabet language size beta language e f u l t e t beta sum language beta language vocabulary size language language type topic count language vocabulary size language type topic count language type topic count language get total occurrence word type type total vocabulary size language instance instance training language testing testing contain instance get name feature feature instance get position 0 position get length position++ type get index position position type total type ++ automatic stoplist creation currently disabled tree sorter sort word tree sorter type 0 type vocabulary size language type++ sort word add sorter type type total type stoplist language hash iterator sorter type iterator sort word iterator total stopword 0 type iterator next total stopword num stopword stoplist language add type iterator next get allocate enough space we nev worry about overflow topic time type occur type 0 type vocabulary size language type++ type total type language max type count language language max type count language type total type type topic count type math min num topic type total type doc 0 doc num instance doc++ testing testing contain training 0 get doc get name instance instance instance num language label topic sequence label num language language 0 language num language language++ type topic count language type topic count language topic language topic language instance language training language get doc feature feature instance language get topic sequence language label topic alphabet size topic topic sequence language get feature position 0 position size position++ type get index position position current type topic count type topic count type topic random next num topic word num stopword most frequent word put sample topic stoplist language contain type topic 1 topic position topic topic topic ++ format these topic rightmost bit count remain left bit since count high bit sorting desc numeric value guarantee high count lower count start assume empty sort descend here we add count we find location topic we need ensure large left neighbor index 0 current topic current type topic count index topic mask current value current type topic count index 0 current topic topic index++ debug output index current type topic count length 0 current type topic count length i++ current type topic count topic mask + + current type topic count topic bit + type + + type total type current topic current type topic count index topic mask current value current type topic count index topic bit current value 0 value 1 we t worry about sorting topic suffix doesn t matter current type topic count index 1 topic bit + topic current type topic count index current value + 1 topic bit + topic now ensure still sort bubble value up index 0 current type topic count index current type topic count index 1 temp current type topic count index current type topic count index current type topic count index 1 current type topic count index 1 temp index topic assignment t topic assignment instance topic sequence add t initialize histogram language smooth mass num language language cache coefficient num language num topic cache value gather statistic size document histogram dirichlet hyperparamet optimization initialize histogram max 0 total 0 doc 0 doc size doc++ length 0 label get doc topic sequence length + get length length max max length total + length err max + max err total + total doc length count max + 1 topic doc count num topic max + 1 cache value language 0 language num language language++ language smooth mass language 0 0 topic 0 topic num topic topic++ language smooth mass language + alpha topic beta language language topic language topic + beta sum language language cache coefficient language topic alpha topic language topic language topic + beta sum language clear histogram fill doc length count 0 topic 0 topic topic doc count length topic++ fill topic doc count topic 0 estimate o estimate num iteration estimate iteration round o start current milli max iteration iteration far + iteration round total 0 iteration far max iteration iteration far++ iteration start current milli show topic interval 0 iteration far 0 iteration far % show topic interval 0 print top word word topic save interval 0 iteration far % save interval 0 print filename + + iteration far save model interval 0 iteration % save model interval 0 write model filename+ +iteration t o o also check we sample work here sample actually obtain yet track iteration far burnin optimize interval 0 iteration far % optimize interval 0 alpha sum dirichlet learn alpha topic doc count doc length count optimize beta clear histogram cache value loop over document corpus topic term count beta topic count smooth count 0 doc 0 doc size doc++ sample topic doc get doc iteration far burnin iteration far % save sample interval 0 elapse milli current milli iteration start total + elapse milli iteration far + 1 % 10 0 ll model log likelihood elapse milli + + total + + ll print elapse milli + second math round current milli start 1000 0 minute second 60 second % 60 hour minute 60 minute % 60 day hour 24 hour % 24 print total day 0 print day print day hour 0 print hour print hour minute 0 print minute print minute print second second optimize beta language 0 language num language language++ histogram start count 0 most frequent type be assign topic we need store max type count + 1 count count histogram language max type count language + 1 now count type topic pair type topic count language type topic count language topic language topic language index type 0 type vocabulary size language type++ count type topic count type index 0 index count length count index 0 count count index topic bit count histogram count ++ index++ figure large we need observation length histogram max topic size 0 topic 0 topic num topic topic++ topic topic max topic size max topic size topic topic now allocate populate topic size histogram max topic size + 1 topic 0 topic num topic topic++ topic size histogram topic topic ++ beta sum language dirichlet learn symmetric concentration count histogram topic size histogram vocabulary size language beta sum language beta language beta sum language vocabulary size language sample topic doc topic assignment topic assignment save current type topic count type old topic topic topic weight sum local topic count num topic local topic index num topic language 0 language num language language++ doc topic topic assignment topic sequence language get feature doc length topic assignment topic sequence language get length populate topic count position 0 position doc length position++ local topic count doc topic position ++ build densely list topic zero count dense index 0 topic 0 topic num topic topic++ local topic count topic 0 local topic index dense index topic dense index++ record total zero topic zero topic dense index language 0 language num language language++ doc topic topic assignment topic sequence language get feature doc length topic assignment topic sequence language get length feature feature topic assignment instance language get type topic count language type topic count language topic language topic language beta beta language beta sum beta sum language initialize smooth sampling bucket smooth mass language smooth mass language topic 0 topic num topic topic++ smooth mass + alpha topic beta topic topic + beta sum initialize cache coefficient smooth cache coefficient num topic topic 0 topic num topic topic++ cache coefficient topic alpha topic topic topic + beta sum cache coefficient language cache coefficient language initialize topic count beta sampling bucket topic beta mass 0 0 initialize cache coefficient topic beta normalize constant dense index 0 dense index zero topic dense index++ topic local topic index dense index n local topic count topic initialize normalization constant n t|d term topic beta mass + beta n topic topic + beta sum update coefficient zero topic cache coefficient topic alpha topic + n topic topic + beta sum topic term mass 0 0 topic term score num topic topic term index topic term value score iterate over position word document position 0 position doc length position++ type get index position position old topic doc topic position old topic 1 current type topic count type topic count type count topic normalize constant smooth mass alpha old topic beta topic old topic + beta sum topic beta mass beta local topic count old topic topic old topic + beta sum decrement local doc topic count local topic count old topic maintain dense index we delete old topic local topic count old topic 0 first get dense location old topic dense index 0 we know there somewhere we t need bound check local topic index dense index old topic dense index++ shift remain dense index left dense index zero topic dense index local topic index length 1 local topic index dense index local topic index dense index + 1 dense index++ zero topic decrement global topic count total topic old topic topic old topic 0 old topic + old topic + below 0 add old topic back into normalize constant smooth mass + alpha old topic beta topic old topic + beta sum topic beta mass + beta local topic count old topic topic old topic + beta sum reset cache coefficient topic cache coefficient old topic alpha old topic + local topic count old topic topic old topic + beta sum now go over type topic count decrement appropriate calculate score topic same index 0 current topic current value already decrement topic term mass 0 0 index current type topic count length current type topic count index 0 current topic current type topic count index topic mask current value current type topic count index topic bit already decrement current topic old topic we re decrement add up sampling weight same decrement require u reorder topic we re here look cell again current value current value 0 current type topic count index 0 current type topic count index current value topic bit + old topic shift reduce value sub index index sub index current type topic count length 1 current type topic count sub index current type topic count sub index + 1 temp current type topic count sub index current type topic count sub index current type topic count sub index + 1 current type topic count sub index + 1 temp sub index++ already decrement score cache coefficient current topic current value topic term mass + score topic term score index score index++ sample random next uniform smooth mass + topic beta mass + topic term mass orig sample sample sure actually get topic 1 sample topic term mass topic term count++ 1 sample 0 i++ sample topic term score topic current type topic count topic mask current value current type topic count topic bit current type topic count current value + 1 topic bit + topic bubble value up 0 current type topic count current type topic count 1 temp current type topic count current type topic count current type topic count 1 current type topic count 1 temp sample topic term mass sample topic beta mass beta topic count++ sample beta dense index 0 dense index zero topic dense index++ topic local topic index dense index sample local topic count topic topic topic + beta sum sample 0 0 topic topic smooth count++ sample topic beta mass sample beta topic 0 sample alpha topic topic topic + beta sum sample 0 0 topic++ sample alpha topic topic topic + beta sum move position topic first empty position topic word index 0 current type topic count index 0 current type topic count index topic mask topic index++ index now position topic empty cell current type topic count index 0 insert topic guarantee w r t count topic current type topic count index 1 topic bit + topic current value current type topic count index topic bit current type topic count index current value + 1 topic bit + topic bubble increase value left index 0 current type topic count index current type topic count index 1 temp current type topic count index current type topic count index current type topic count index 1 current type topic count index 1 temp index topic 1 err polylingual topic model sampling + orig sample + + sample + + smooth mass + + topic beta mass + + topic term mass topic num topic 1 t o o appropriate illegal polylingual topic model topic sample topic 1 put topic into count doc topic position topic smooth mass alpha topic beta topic topic + beta sum topic beta mass beta local topic count topic topic topic + beta sum local topic count topic ++ topic document add topic dense index local topic count topic 1 first find point we insert topic going reason we re keeping track zero topic working backward dense index zero topic dense index 0 local topic index dense index 1 topic local topic index dense index local topic index dense index 1 dense index local topic index dense index topic zero topics++ topic topic ++ update coefficient zero topic cache coefficient topic alpha topic + local topic count topic topic topic + beta sum smooth mass + alpha topic beta topic topic + beta sum topic beta mass + beta local topic count topic topic topic + beta sum save smooth mass global cache language smooth mass language smooth mass save update document topic count histogram dirichlet estimation total length 0 dense index 0 dense index zero topic dense index++ topic local topic index dense index topic doc count topic local topic count topic ++ total length + local topic count topic doc length count total length ++ print top word num word line o print stream print stream print top word num word line close print top word print stream num word line tree language topic sort word tree num language num topic language 0 language num language language++ tree topic sort word language topic sort word language type topic count language type topic count language topic 0 topic num topic topic++ topic sort word topic tree sorter type 0 type vocabulary size language type++ topic count type topic count type index 0 index topic count length topic count index 0 topic topic count index topic mask count topic count index topic bit topic sort word topic add sorter type count index++ topic 0 topic num topic topic++ topic + + formatt format alpha topic language 0 language num language language++ print + language + + language topic language topic + + beta language + tree sorter sort word language topic sort word language topic alphabet alphabet alphabet language word 1 iterator sorter iterator sort word iterator iterator next word num word sorter info iterator next print alphabet lookup info get + word++ print document topic f o print document topic print writer f u t f 8 print document topic print writer pw print document topic pw 0 0 1 pw print writer threshold print topic proportion great max print many topic print document topic print writer pw threshold max pw print doc topic proportion doc length topic count num topic sorter sort topic sorter num topic topic 0 topic num topic topic++ initialize sorter dummy value sort topic topic sorter topic topic max 0 || max num topic max num topic di 0 di size di++ pw print di pw print total length 0 language 0 language num language language++ label topic label get di topic sequence language current doc topic topic get feature doc length topic get length total length + doc length count up 0 doc length token++ topic count current doc topic ++ normalize topic 0 topic num topic topic++ sort topic topic topic topic count topic total length sort sort topic 0 max i++ sort topic get weight threshold pw print sort topic get + + sort topic get weight + pw print fill topic count 0 print f o print stream print stream g z p output stream buffer output stream output stream f u t f 8 print close print print stream doc po typeindex type topic doc 0 doc size doc++ language 0 language num language language++ feature feature get doc instance language get label topic label get doc topic sequence language pi 0 pi topic get length pi++ type get index position pi topic topic get index position pi print doc print print language print print pi print print type print print alphabet language lookup type print print topic model log likelihood log likelihood 0 0 zero topic likelihood model dirichlet multinomial word topic dirichlet multinomial topic document likelihood function dirichlet multinomial gamma sum alpha prod gamma alpha + n prod gamma alpha gamma sum alpha + n log likelihood log gamma sum alpha log gamma sum alpha + n + sum log gamma alpha + n log gamma alpha document first topic count num topic topic log gamma num topic doc topic topic 0 topic num topic topic++ topic log gamma topic dirichlet log gamma stirl alpha topic doc 0 doc size doc++ total length 0 language 0 language num language language++ label topic label get doc topic sequence language current doc topic topic get feature total length + topic get length count up 0 topic get length token++ topic count current doc topic ++ topic 0 topic num topic topic++ topic count topic 0 log likelihood + dirichlet log gamma stirl alpha topic + topic count topic topic log gamma topic subtract count + parameter sum term log likelihood dirichlet log gamma stirl alpha sum + total length fill topic count 0 add parameter sum term log likelihood + size dirichlet log gamma stirl alpha sum topic language 0 language num language language++ type topic count language type topic count language topic language topic language beta beta language count type topic pair zero type topic 0 type 0 type vocabulary size language type++ reuse pointer topic count type topic count type index 0 index topic count length topic count index 0 topic topic count index topic mask count topic count index topic bit zero type topics++ log likelihood + dirichlet log gamma stirl beta + count na n log likelihood count exit 1 index++ topic 0 topic num topic topic++ log likelihood dirichlet log gamma stirl beta num topic + topic topic na n log likelihood topic + topic + + topic topic exit 1 log likelihood + dirichlet log gamma stirl beta num topic dirichlet log gamma stirl beta zero type topic na n log likelihood exit 1 log likelihood tool estimate topic distribution document topic inferenc get inferenc language topic inferenc language type topic count language language topic language alphabet language alpha beta language beta sum language serialization serial u 1 u r r e n t e r l v e r o n 0 n u l l n t e g e r 1 write output stream o write u r r e n t e r l v e r o n write num language write write topic alphabet write num topic write testing write topic mask write topic bit write alphabet write vocabulary size write alpha write alpha sum write beta write beta sum write language max type count write language type topic count write language topic write language smooth mass write language cache coefficient write doc length count write topic doc count write num iteration write burnin write save sample interval write optimize interval write show topic interval write word topic write save interval write filename write save model interval write model filename write random write formatt write print log likelihood read input stream o found read num language read topic assignment read topic alphabet label alphabet read num topic read testing hash read topic mask read topic bit read alphabet alphabet read vocabulary size read alpha read alpha sum read beta read beta sum read language max type count read language type topic count read language topic read language smooth mass read language cache coefficient read doc length count read topic doc count read num iteration read burnin read save sample interval read optimize interval read show topic interval read word topic read save interval read filename read save model interval read model filename read random random read formatt format read print log likelihood read write serialize model output stream oo output stream output stream serialize model oo write oo close o e err problem serialize polylingual topic model + serialize model + + e polylingual topic model read f polylingual topic model topic model input stream ois input stream input stream f topic model polylingual topic model ois read ois close topic model initialize histogram topic model o command summary polylingual topic model tool estimate saving printing diagnostics topic model over comparable corpus command process polylingual topic model polylingual topic model topic model input model filename value topic model polylingual topic model read input model filename value e err unable restore save topic model + input model filename value + + e exit 1 num language language input value length instance training instance num language 0 training length i++ training instance load language input value training + + load historical reason we currently support feature feature vector input function provide warning cast training 0 size 0 training 0 get 0 training 0 get 0 get feature err topic modeling currently support feature sequence keep importing exit 1 topic model polylingual topic model num topic value alpha value random seed value 0 topic model random seed random seed value topic model add instance training topic model topic show topic interval value top word value topic model num iteration num iteration value topic model optimize interval optimize interval value topic model burnin optimize burn value output interval value 0 topic model save output interval value value output model interval value 0 topic model model output output model interval value output model filename value topic model estimate topic key value topic model print top word topic key value top word value value topic model print value doc topic value print writer print writer writer doc topic value topic model print document topic doc topic threshold value doc topic max value close inferenc filename value language 0 language topic model num language language++ output stream oo output stream output stream inferenc filename value + + language oo write topic model get inferenc language oo close e err e get message output model filename value topic model topic model write output model filename value 