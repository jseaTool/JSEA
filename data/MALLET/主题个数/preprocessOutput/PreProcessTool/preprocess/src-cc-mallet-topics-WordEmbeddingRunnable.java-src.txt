topic type word embed runnable runnable word embedding model instance instance num sample run residual 0 0 num update 0 num thread thread stride doc random random num column word far 0 word embed runnable word embedding model instance instance num sample num thread thread model model stride model stride instance instance num sample num sample num thread num thread thread thread random random num column model num column get num update 0 doc residual num update residual 0 0 num update 0 run num document instance size sample normalizer 1 0f num sample gradient num column query model vocabulary lookup index model query word output offset model num column doc thread num document num thread max doc thread + 1 num document num thread max doc num document max doc num document cache scale 1 0 model max value model min value buffer 100000 run instance instance instance get doc doc id++ doc max doc start over beginning doc thread num document num thread learning rate math max 0 0001 0 025 1 0 num thread word far model total word feature feature instance get original length get length length 0 input position 0 input position original length input position++ input type get index position input position word far++ frequency score model word count input type 0 0001 model total word random next math sqrt frequency score + 1 frequency score buffer length input type length++ skip document length 10 input position 0 input position length input position++ input type buffer input position sub window model window size start math max 0 input position sub window math min length 1 input position + sub window output position start output position output position++ input position output position output type buffer output position input type output type inner model weight input type stride + 0 + model weight input type stride + output offset col 1 col num column col++ inner + model weight input type stride + col model weight output type stride + output offset + col prediction inner model min value prediction 0 0 inner model max value prediction 1 0 prediction model sigmoid cache math floor model sigmoid cache size inner model min value cache scale na n prediction gradient 0 1 0f prediction model weight output type stride + output offset + learning rate 1 0f prediction col 1 col num column col++ gradient col 1 0f prediction model weight output type stride + output offset + col model weight output type stride + output offset + col + learning rate 1 0f prediction model weight input type stride + col output type query format neg %f g %f model negative weight input type 0 learning rate 1 0 prediction negative prediction 0 0 sample 0 sample num sample sample++ sample type model sampling table random next model sampling table size format % % %d vocabulary lookup output type vocabulary lookup sample type 0 sample type offset sample type stride inner model weight input type stride + 0 + model weight sample type offset + output offset col 0 col num column col++ inner + model weight input type stride + col model weight sample type offset + output offset + col negative prediction 0 0 inner model min value negative prediction 0 0 inner model max value negative prediction 1 0 negative prediction model sigmoid cache math floor model sigmoid cache size inner model min value cache scale na n negative prediction negative prediction + negative prediction gradient 0 + sample normalizer negative prediction model weight sample type offset + output offset + learning rate sample normalizer negative prediction col 1 col num column col++ gradient col + sample normalizer negative prediction model weight sample type stride + output offset + col model weight sample type offset + output offset + col + learning rate sample normalizer negative prediction model weight input type stride + col residual + prediction negative prediction sample normalizer num updates++ col 0 col num column col++ model weight input type stride + col + learning rate gradient col 