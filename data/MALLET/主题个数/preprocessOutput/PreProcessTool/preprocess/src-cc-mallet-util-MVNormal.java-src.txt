format random type tool working multivariate normal distribution m v normal simple cholesky decomposition check squareness symmetricality positive definiteness follow j m fairly closely p l l l l lower triangular cholesky input num row initialize note set element 0 input length sum row square 0 0 dot 0 0 off diagonal cell l jk we need index into jth row kth row these both really row offset correspond beginning row th row beginning column th row row offset 0 col offset 0 row 0 row num row row++ sum row square 0 0 row offset row num row col 0 col row col++ dot 0 0 col offset col num row 0 col i++ dot + row offset + col offset + row offset + col input row offset + col dot col offset + col sum row square + row offset + col row offset + col now diagonal element row offset + row math sqrt input row offset + row sum row square band cholesky input num row initialize note set element 0 input length sum row square 0 0 dot 0 0 off diagonal cell l jk we need index into jth row kth row these both really row offset correspond beginning row th row beginning column th row row offset 0 col offset 0 first zero row 0 row num row row++ sum row square 0 0 row offset row num row first zero row col 0 col row col++ first zero row input row offset + col 0 first zero col dot 0 0 col offset col num row first zero col i++ dot + row offset + col offset + row offset + col input row offset + col dot col offset + col sum row square + row offset + col row offset + col now diagonal element row offset + row math sqrt input row offset + row sum row square testing band cholesky factorization band matrix root dim bandwidth dim dim row 0 row dim row++ row offset row dim col math max 0 row bandwidth + 1 col row col++ row offset + col 1 0 sample multivariate normal precision matrix ie inverse covariance matrix next m v normal precision random random next m v normal cholesky cholesky precision length random next m v normal cholesky precision lower triangular random random n length initialize vector z standard normal n same z n 0 n i++ random next gaussian now solve tran l z back substitution inner n 1 0 inner 0 0 j i+1 j n j++ cholesky decomp get u precision lower triangular triangular matrix we really want transpose inner + j precision lower triangular n j + inner precision lower triangular n + 0 n i++ + sample vector n m l l sup 1 sup sum 0 next zero sum m v normal cholesky precision lower triangular random random n length next m v normal cholesky precision lower triangular random sum 0 0 0 n i++ sum + get sum row inverse precision matrix solving two triangular l l ly 1 l y one n fill one 1 0 first solution solve forward substitution one precision lower triangular row sum solve back substitution first solution precision lower triangular sum row sum 0 0 0 n i++ sum row sum + row sum inverse sum row sum 1 0 sum row sum 0 n i++ inverse sum row sum row sum sum next m v normal n precision random random n 0 n i++ next m v normal precision random feature vector next feature vector alphabet alphabet precision random random feature vector alphabet next m v normal precision random prior vector value prior precision diagonal vector represent diagonal prior precision matrix precision precision matrix next m v normal posterior prior prior precision diagonal precision observe observation random random dimension prior length q 0 mu 0 + n q y bar linear dimension 0 dimension i++ linear prior prior precision diagonal inner 0 0 j 0 j dimension j++ inner + precision dimension + j observe j linear + observation inner q 0 + n q posterior precision precision length row 0 row dimension row++ col 0 col dimension col++ posterior precision dimension row + col observation precision dimension row + col row col posterior precision dimension row + col + prior precision diagonal row inverse posterior precision invert p posterior precision dimension posterior dimension row 0 row dimension row++ inner 0 0 col 0 col dimension col++ inner + inverse posterior precision dimension row + col linear col posterior row inner next m v normal posterior posterior precision random l note transpose input matrix l o w e r triangular though back substitution operate u p p e r triangular matrix solve back substitution lower triangular inner n length n n 1 0 inner 0 0 j i+1 j n j++ assume we re dealing single lower triangular matrix cholesky decomposition index into transpose inner + j lower triangular n j + inner lower triangular n + lx l lower triangular solve forward substitution lower triangular inner n length n 0 n i++ inner 0 0 j 0 j j++ inner + j lower triangular n + j inner lower triangular n + lower triangular inverse lower triangular matrix invert lower triangular input matrix dimension output matrix input matrix length row 0 row dimension row++ col 0 col row col++ off diagonal element negative inner up row index row input col output divide diagonal input col row diagonal element same add 1 numerator 1 0 0 0 col row i++ input matrix dimension row + output matrix dimension + col output matrix dimension row + col input matrix dimension row + row output matrix l l lower triangular matrix l lower triangular crossproduct input matrix dimension output matrix input matrix length inner row 0 row dimension row++ col row col dimension col++ inner 0 0 col dimension i++ inner + input matrix row + dimension input matrix col + dimension output matrix dimension row + col inner output matrix row + dimension col inner output matrix lower triangular square lower triangular matrix lower triangular left matrix matrix dimension output matrix left matrix length inner row 0 row dimension row++ col 0 col row col++ inner 0 0 col row i++ inner + left matrix dimension row + matrix dimension + col output matrix dimension row + col inner output matrix invert p input matrix dimension lower triangular crossproduct invert lower triangular band cholesky input matrix dimension dimension dimension wishart random variate r bill venable sqrt scale matrix lower triangular matrix square root scale matrix draw posterior precision ie inverse covariance matrix chol s^ 1 scatter matrix column m v normal observation dimension size matrix degree freedom degree freedom wishart great dimension posterior observation + df prior next wishart sqrt scale matrix dimension degree freedom random random sample sqrt scale matrix length row 0 row dimension row++ col 0 col row col++ sample row dimension + col random next gaussian 0 1 sample row dimension + row math sqrt random next chi sq degree freedom sample dimension sqrt scale matrix dimension lower triangular sample sqrt scale matrix dimension dimension diagonal sample dimension diagonal sqrt scale matrix dimension diagonal lower triangular sample sqrt scale matrix dimension dimension lower triangular crossproduct lower triangular sample sqrt scale matrix dimension dimension next wishart posterior scatter matrix observation prior precision diagonal prior f dimension random random scatter plus prior scatter matrix length arraycopy scatter matrix 0 scatter plus prior 0 scatter matrix length 0 dimension i++ scatter plus prior dimension + + 1 0 prior precision diagonal invert scatter plus prior diagonal invert p scatter plus prior dimension dimension chol invert scatter plus prior diagonal cholesky invert p scatter plus prior dimension dimension dimension sqrt scale matrix cholesky invert p scatter plus prior dimension dimension next wishart sqrt scale matrix dimension observation + prior f random representation square matrix dimensional format matrix dimension format formatt format get instance formatt maximum fraction digit 10 buffer output buffer row 0 row dimension row++ col 0 col dimension col++ output append formatt format matrix dimension row + col output append output append output diagonal matrix dimension format formatt format get instance formatt maximum fraction digit 4 buffer output buffer row 0 row dimension row++ output append formatt format matrix dimension row + row output append output get scatter matrix observation matrix observation observation matrix length dimension observation matrix 0 length output matrix dimension dimension dimension collect sample 0 observation i++ 0 dimension d++ + observation matrix 0 dimension d++ observation now sample covariance time n 0 observation i++ d1 0 d1 dimension d1++ d2 0 d2 dimension d2++ output matrix dimension d1 + d2 + observation matrix d1 d1 observation matrix d2 d2 output matrix test cholesky observation 1000 20 precision matrix 20 20 0 20 i++ precision matrix 20 + 1 0 random random random scatter matrix get scatter matrix next m v normal observation precision matrix random prior precision 20 fill prior precision 1 0 next wishart posterior scatter matrix observation prior precision 21 20 random spd 19 133825 1 180869 6 403880 1 180869 8 895968 1 280748 6 403880 1 280748 9 155951 spd 3 0 0 0 1 0 0 0 3 0 0 0 1 0 0 0 3 0 random random random 1 0 1 0 1 0 lower cholesky spd 3 it 0 it 10 iter++ sample next m v normal cholesky lower random 0 sample length i++ print sample + it 0 it 10 iter++ sample next zero sum m v normal cholesky lower random 0 sample length i++ print sample + dim 100 band lower band matrix root dim 3 band lower dim band matrix lower triangular crossproduct band lower dim band matrix dim start start current milli 0 100000 i++ band cholesky band matrix dim current milli start start current milli 0 100000 i++ cholesky band matrix dim current milli start l 2 87527 0 0 0 0 2 4168 1 28 0 0 0 585168 2 792234 2 769609 spd 19 133825 1 180869 6 403880 1 180869 8 895968 1 280748 6 403880 1 280748 9 155951 scatter 103 59761 16 370939 12 694755 16 37094 106 117048 4 079818 12 69476 4 079818 94 065152 prior diagonal 1 0 1 0 1 0 test cholesky next wishart posterior scatter 100 prior diagonal 10 3 random 3 start current milli 0 10000 i++ invert p spd 3 current milli start invert p spd 3 3 next wishart l 3 25 random 3 precision matrix 0 98 1 0 0 0 1 0 2 13 1 0 0 0 1 0 1 01 3 random random random 0 10 i++ variate next m v normal precision matrix random j 0 j variate length j++ print variate j + 