2011 univ dept part m l l e t m achine learning languag e toolkit 1 0 information see ` l e n e semi supervise pr logging logger r f sum lattice transducer transducer type label alphabet type label vector type matrix ops type logger lattice e step projection p r gregory druck kedar bellare sum lattice p r sum lattice logger logger logger get logger sum lattice p r get name total weight lattice length gamma xi label vector labeling transducer transducer lattice node node input sum lattice p r transducer tran index input output p r auxiliary model aux model cache dot increment constraint transducer incrementor incrementor label alphabet output alphabet save xi output || input size output size initialize some structure input input transducer tran lattice length input size + 1 num transducer num node lattice node lattice length num gamma lattice length num save xi xi lattice length num num output count output alphabet output count lattice length output alphabet size 0 num i++ ip 0 ip lattice length ip++ gamma ip transducer m p o l e w e g h t save xi j 0 j num j++ ip 0 ip lattice length ip++ xi ip j transducer m p o l e w e g h t forward pas least 0 num i++ weight transducer get get weight weight transducer m p o l e w e g h t get lattice node 0 alpha weight least least logger warning there starting ip 0 ip lattice length 1 ip++ 0 num i++ node ip || node ip alpha transducer m p o l e w e g h t transducer get cache dot transition iterator it cache dot transition iterator r f input ip cache dot ip aux model pre process index ip input it next destination it next lattice node destination node get lattice node ip + 1 destination get index destination node output it get output transition weight it get weight transition weight + aux model get weight index ip input it destination node alpha transducer sum log prob destination node alpha node ip alpha + transition weight total weight transducer m p o l e w e g h t 0 num i++ node lattice length 1 total weight transducer sum log prob total weight node lattice length 1 alpha + transducer get get weight total weight transducer m p o l e w e g h t backward pas 0 num i++ node lattice length 1 transducer get node lattice length 1 beta get weight gamma lattice length 1 node lattice length 1 alpha + node lattice length 1 beta total weight incrementor p math gamma lattice length 1 p 0 0 p 1 0 + 1e 6 p + p + gamma + gamma lattice length 1 incrementor increment p ip lattice length 2 ip 0 ip 0 num i++ node ip || node ip alpha transducer m p o l e w e g h t transducer get cache dot transition iterator it cache dot transition iterator r f input ip cache dot ip aux model pre process index ip input it next destination it next j destination get index lattice node destination node node ip + 1 j destination node transition weight it get weight transition weight + aux model get weight index ip input it node ip beta transducer sum log prob node ip beta destination node beta + transition weight xi node ip alpha + transition weight + node ip + 1 j beta total weight save xi xi ip j xi incrementor || aux model num 0 || output alphabet p math xi p 0 0 p 1 0 + 1e 6 p + p + xi + ip + + + + j + + xi incrementor incrementor increment transition it p increment constraint preproces still applie aux model increment transition index ip input it p output alphabet output index output alphabet lookup index it get output output index 0 output count ip output index + p gamma ip node ip alpha + node ip beta total weight incrementor 0 num i++ p math gamma 0 p 0 0 p 1 0 + 1e 6 p + p incrementor increment transducer get p output alphabet labeling label vector lattice length ip lattice length 2 ip 0 ip math ab 1 0 matrix ops sum output count ip 0 000001 labeling ip label vector output alphabet output count ip lattice node get lattice node ip index node ip index node ip index lattice node ip transducer get index node ip index get xi xi get gamma gamma get total weight na n total weight total weight get gamma weight input position gamma input position get index get gamma weight input position index gamma input position index get gamma probability input position math gamma input position get index get gamma probability input position index math gamma input position index get xi probability ip s1 s2 xi illegal xi be save s1 get index j s2 get index math xi ip j get xi weight ip s1 s2 xi illegal xi be save s1 get index j s2 get index xi ip j length lattice length get alpha ip lattice node node get lattice node ip get index node alpha get beta ip lattice node node get lattice node ip get index node beta label vector get label position output position labeling labeling output position transducer get transducer transducer lattice node input position output alpha transducer m p o l e w e g h t beta transducer m p o l e w e g h t lattice node input position input position input position alpha transducer m p o l e w e g h t get input input 