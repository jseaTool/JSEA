2010 univ dept part m l l e t m achine learning languag e toolkit 1 0 information see ` l e n e semi supervise bit concurrent callable concurrent executor concurrent thread pool executor concurrent unit r f sum lattice sum lattice semi supervise constraint g e constraint optimize optimizable type feature vector type instance type instance type matrix ops optimizable r f generalize expectation constraint consider single label pair label linear chain r f see generalize expectation criterion semi supervise learning conditional random field gideon mann mc callum l 2008 gregory druck r f optimizable g e optimizable gradient value e f u l t g p v 10 r f crf g e constraint constraint instance num thread gpv weight indicator keep track gradient value need re compute cache cache value r f factor cache gradient list transition index destination g e lattice reverse tran reverse tran index instance least constraint fire bit instance constraint thread pool executor executor crf r f constraint g e constraint unlabel map map between label num thread thread training e f u l t 1 r f optimizable g e r f crf g e constraint constraint instance label map map num thread crf constraint map num thread 1 r f optimizable g e r f crf g e constraint constraint instance label map map num thread weight crf crf constraint constraint cache m v l u e cache value na n cache gradient r f factor crf num thread num thread weight weight instance constraint bit size g e constraint constraint constraint constraint label map map bit bitset constraint pre process instance constraint bitset gpv e f u l t g p v num thread 1 executor thread pool executor executor fix thread pool num thread reverse transition matrix crf initializ structure mapping between destination transition index crf r f reverse transition matrix r f crf count crf num si 0 si crf num si++ r f prev r f crf get si di 0 di prev num destination di++ sj prev get destination di get index count sj ++ reverse tran crf num reverse tran index crf num 0 count length i++ reverse tran count reverse tran index count index crf num si 0 si crf num si++ r f prev r f crf get si di 0 di prev num destination di++ sj prev get destination di get index reverse tran sj index sj si reverse tran index sj index sj di index sj ++ get num crf get num get buffer crf get get buffer get parameter index crf get get parameter index crf get crf weight value change parameter index value crf get parameter index value crf weight value change cache value gradient compute cache lattice gc err memory + format % 3f runtime get runtime total memory runtime get runtime memory 1000000 + lattice sum lattice lattice sum lattice num thread 1 0 size ii++ instance constraint get sum lattice lattice sum lattice crf feature vector get get lattice add lattice lattice add mutli thread callable task callable size num thread num thread size increment size num thread start 0 increment thread 0 thread num thread thread++ task add sum lattice task crf instance constraint start start + increment thread num thread 2 size + increment run thread wait them finish executor task interrupt ie ie print stack trace callable task task lattice add sum lattice task task get lattice lattice size size lattice size + + size err computing lattice g e constraint constraint constraint constraint zero expectation constraint compute expectation lattice err computing expectation gc err memory + format % 3f runtime get runtime total memory runtime get runtime memory 1000000 + lattice compute g e value cache value 0 g e constraint constraint constraint cache value + constraint get value cache gradient zero compute g e gradient num thread 1 0 size ii++ instance constraint get sum lattice lattice lattice get feature vector fv feature vector get get g e lattice fv lattice get gamma lattice get xi crf reverse tran reverse tran index cache gradient constraint multi thread callable task callable size num thread num thread size increment size num thread start 0 increment thread 0 thread num thread thread++ g e constraint constraint g e constraint g e constraint constraint constraint constraint add constraint task add g e lattice task crf lattice constraint instance constraint reverse tran reverse tran index start start + increment thread num thread 2 size + increment run thread wait them finish executor task interrupt ie ie print stack trace callable task task cache gradient plus equal g e lattice task task get gradient 1 err computing gradient cache value + crf get gaussian prior gpv cache gradient plus equal gaussian prior gradient crf get gpv err computing regularization weight 1 cache value weight err g e value + cache value gaussian prior variance variance gpv variance get value gradient buffer crf get weight value change stamp cache cache value gradient cache crf get weight value change stamp t o o also multiply prior active cache gradient get buffer weight 1 matrix ops time equal buffer weight get value crf get weight value change stamp cache cache value gradient cache crf get weight value change stamp cache value call training complete shutdown thread shutdown executor executor shutdown executor await termination 30 unit e o n interrupt e e print stack trace executor shutdown now size 0 task didn t finish sum lattice task callable start sum lattice lattice instance r f crf bit instance constraint sum lattice task r f crf instance bit instance constraint start crf crf start start lattice sum lattice instance constraint instance constraint sum lattice get lattice lattice call start ii++ instance constraint get instance instance get sum lattice lattice sum lattice crf feature vector instance get lattice add lattice lattice add g e lattice task callable start g e constraint constraint sum lattice lattice instance r f crf r f factor gradient bit instance constraint reverse tran reverse tran index crf r f unlabel lattice cache sum lattice constraint g e constraint instance constraint bit index constraint fire instance reverse tran index destination reverse tran index transition index destination start position unlabel thread start computing position unlabel thread stop computing g e lattice task r f crf instance sum lattice lattice g e constraint constraint bit instance constraint reverse tran reverse tran index start crf crf lattice lattice constraint constraint start start gradient r f factor crf instance constraint instance constraint reverse tran reverse tran reverse tran index reverse tran index r f factor get gradient gradient call start ii++ instance constraint get sum lattice lattice lattice get feature vector fv feature vector get get g e lattice fv lattice get gamma lattice get xi crf reverse tran reverse tran index gradient constraint 