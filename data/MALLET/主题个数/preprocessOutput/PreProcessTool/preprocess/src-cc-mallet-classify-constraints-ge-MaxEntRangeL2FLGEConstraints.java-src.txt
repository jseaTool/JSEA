2011 univ dept part m l l e t m achine learning languag e toolkit 1 0 information see ` l e n e classify constraint ge gnu trove t gnu trove t gnu trove t hash map bit hash map type feature vector type instance type instance expectation constraint g e penaliz l 2^2 difference zero penalty region lower upper multiple constraint group together here thing efficient gregory druck max ent range l2 f l g e constraint max ent g e constraint map between input feature index constraint value normalize num feature num label t hash map max ent l2 ind g e constraint constraint cache constrain feature fire last feature vector preproces call t index cache t value cache max ent range l2 f l g e constraint num feature num label value normalize num feature num feature num label num label value value normalize normalize constraint t hash map max ent l2 ind g e constraint index cache t value cache t add constraint fi lower upper weight constraint contain key fi constraint put fi max ent l2 ind g e constraint constraint get fi add lower upper weight bit pre process instance count 0 fi feature vector fv bit bit bit size instance instance weight get instance weight instance fv feature vector instance get loc 0 loc fv num location loc++ fi fv index location loc constraint contain key fi value constraint get fi count + weight fv value location loc constraint get fi count + weight bit ii++ feature label regularization constraint contain key num feature bit constraint get num feature count + weight bit pre process feature vector input index cache reset quick value value cache reset quick fi cache constrain input feature loc 0 loc input num location loc++ fi input index location loc constraint contain key fi index cache add fi value value cache add input value location loc feature label regularization constraint contain key num feature index cache add num feature value value cache add 1 get composite constraint feature value feature vector input label value 0 0 index cache size i++ value value + constraint get index cache get quick get gradient label value cache get quick value + constraint get index cache get quick get gradient label value compute expectation feature vector input dist weight pre process input 0 num label li++ p weight dist 0 index cache size i++ value constraint get index cache get quick expectation + p value cache get quick constraint get index cache get quick expectation + p get value value 0 0 fi constraint key max ent l2 ind g e constraint constraint constraint get fi constraint count 0 0 value due current constraint label index 0 label index num label ++label index value constraint get value label index na n value infinite value value zero expectation fi constraint key constraint get fi expectation constraint get fi get num constrain label max ent l2 ind g e constraint index count lower upper weight hash map label map expectation max ent l2 ind g e constraint lower upper weight label map hash map index 0 count 0 add label lower upper weight lower add lower upper add upper weight add weight label map put label index index++ increment expectation value label map contain key label map get expectation + value get value label map contain key label map get count 0 ex normalize ex expectation count ex expectation ex lower get weight get math pow lower get ex 2 ex upper get weight get math pow upper get ex 2 0 get num constrain label index get gradient label map contain key label map get count 0 normalize ex expectation count ex lower get 2 weight get lower get count expectation count count ex upper get 2 weight get upper get count expectation count count ex expectation ex lower get 2 weight get lower get expectation ex upper get 2 weight get upper get expectation 0 