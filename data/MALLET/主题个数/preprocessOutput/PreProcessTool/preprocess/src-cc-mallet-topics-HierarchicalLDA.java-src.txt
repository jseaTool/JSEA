topic io type random gnu trove hierarchical l instance instance instance testing n r p node root node node num level num document num type alpha smooth topic distribution gamma imaginary customer next yet unus table eta smooth word distribution eta sum level index doc n r p node document leaf currently select path ie leaf node n r p tree total node 0 hlda random random show progress topic interval 50 num word 10 hierarchical l alpha 10 0 gamma 1 0 eta 0 1 alpha alpha alpha alpha gamma gamma gamma gamma eta eta eta eta topic interval word topic interval interval num word word parameter determine sampler output show progress output character iteration progress show progress show progress show progress initialize instance instance instance testing num level random random instance instance testing testing num level num level random random instance get 0 get feature illegal argument input feature feature impot num document instance size num type instance get alphabet size eta sum eta num type initialize single path n r p node path n r p node num level root node n r p node num type level num document document leaf n r p node num document initialize fill topic pointer document everyth single path we earlier doc 0 doc num document doc++ feature f feature instance get doc get seq len f get length path 0 root node root node customers++ level 1 level num level level++ path level path level 1 select path level customers++ node path num level 1 level doc seq len document leaf doc node 0 seq len token++ type f get index position level doc random next num level node path level doc node total tokens++ node type count type ++ estimate num iteration iteration 1 iteration num iteration iteration++ doc 0 doc num document doc++ sample path doc iteration doc 0 doc num document doc++ sample topic doc show progress print iteration % 50 0 + iteration iteration % topic interval 0 print node sample path doc iteration n r p node path n r p node num level n r p node node level type topic count weight node document leaf doc level num level 1 level 0 level path level node node node parent document leaf doc drop path t hash map n r p node node weight t hash map n r p node calculate p m | m calculate n r p node weight root node 0 0 add weight p w m | w m z path customer unavailable still since we haven t reset document leaf doc yet t hash map type count t hash map num level doc level level 0 level num level level++ type count level t hash map doc level level doc feature f feature instance get doc get save count word level count current path 0 doc level length token++ level doc level type f get index position type count level contain key type type count level put type 1 type count level increment type path level type count type path level type count type 0 path level total path level total 0 calculate weight path level topic weight num level level 1 level num level level++ skip root type type count level key total 0 t type 0 type count level get t i++ topic weight level + math log eta + eta sum + total total tokens++ iteration 1 topic weight level calculate word likelihood node weight root node 0 0 type count topic weight 0 iteration n r p node node node weight key n r p node weight node length sum 0 0 max n e g t v e n f n t y underflow we re log weight normalize node weight large weight 1 0 node length i++ node weight get node max max node weight get node 0 node length i++ weight math node weight get node max iteration 1 node document leaf doc print n r p node node level + + weight + + node weight get node sum + weight iteration 1 node node random next discrete weight sum we pick internal node we need add path node leaf node node get leaf node add path document leaf doc node level num level 1 level 0 level type type count level key t type node type count t + type count level get t node total + type count level get t node node parent calculate n r p t hash map n r p node node weight n r p node node weight n r p node child node child calculate n r p node weight child weight + math log child customer node customer + gamma node weight put node weight + math log gamma node customer + gamma calculate word likelihood t hash map n r p node node weight n r p node node weight t hash map type count topic weight level iteration first calculate likelihood word level topic node weight 0 0 type type count level key total 0 iteration 1 level + + node weight type type 0 type count level get type i++ node weight + math log eta + node type count type + eta sum + node total + total total tokens++ iteration 1 +eta + + + node type count type + + + + + + eta sum + + + node total + + + total + + + node weight iteration 1 level + + node weight propagate weight child node n r p node child node child calculate word likelihood node weight child weight + node weight type count topic weight level + 1 iteration internal node add weight path level++ level num level node weight + topic weight level level++ node weight adjust value node node weight propagate topic weight node child weight assume log propagate topic weight t hash map n r p node node weight n r p node node weight node weight contain key node calculate n r p prior proceeds root down ie child link add word topic weight come bottom up parent link child link possible leaf node be remove just prior round current node n r p weight going sample anyway ditch n r p node child node child propagate topic weight node weight child weight node weight adjust value node weight sample topic doc feature f feature instance get doc get seq len f get length doc level level doc n r p node path n r p node num level n r p node node level count num level type level sum get leaf node document leaf doc level num level 1 level 0 level path level node node node parent level weight num level initialize level count 0 seq len token++ level count doc level ++ 0 seq len token++ type f get index position level count doc level node path doc level node type count type node total sum 0 0 level 0 level num level level++ level weight level alpha + level count level eta + path level type count type eta sum + path level total sum + level weight level level random next discrete level weight sum doc level level level count doc level ++ node path level node type count type ++ node total tokens++ write current sampling specify print o found print print writer buffer writer writer write describe current sampling print print writer o doc 0 alphabet alphabet instance get alphabet instance instance instance feature f feature instance get seq len f get length doc level level doc n r p node node type level buffer path buffer start leaf build describe path doc node document leaf doc level num level 1 level 0 level path append node node + node node parent 0 seq len token++ type f get index position level doc level just tell we re add path + + type + + alphabet lookup type + + level + doc++ print node print node root node 0 print node weight print node root node 0 weight print node n r p node node indent weight buffer buffer 0 indent i++ append append node total + + node customer + append node get top word num word weight n r p node child node child print node child indent + 1 weight empirical likelihood evaluation sample path tree sample multinomial over topic path weight sum word empirical likelihood num sample instance testing n r p node path n r p node num level n r p node node weight path 0 root node feature f sample level type doc seq len dirichlet dirichlet dirichlet num level alpha level weight multinomial num type likelihood testing size num sample sample 0 sample num sample sample++ fill multinomial 0 0 level 1 level num level level++ path level path level 1 select level weight dirichlet next type 0 type num type type++ level 0 level num level level++ node path level multinomial type + level weight level eta + node type count type eta sum + node total type 0 type num type type++ multinomial type math log multinomial type doc 0 doc testing size doc++ f feature testing get doc get seq len f get length 0 seq len token++ type f get index position likelihood doc sample + multinomial type average log likelihood 0 0 log num sample math log num sample doc 0 doc testing size doc++ max n e g t v e n f n t y sample 0 sample num sample sample++ likelihood doc sample max max likelihood doc sample sum 0 0 sample 0 sample num sample sample++ sum + math likelihood doc sample max average log likelihood + math log sum + max log num sample average log likelihood primarily testing purpose link topic tui hierarchical l t u flexible command line instance instance instance load 0 instance testing instance load 1 hierarchical l sampler hierarchical l sampler initialize instance testing 5 random sampler estimate 250 e e print stack trace n r p node customer n r p node child n r p node parent level total type count node n r p node n r p node parent dimension level customer 0 parent parent child n r p node level level node level + level total 0 type count dimension node total node total nodes++ n r p node dimension dimension 0 n r p node add child n r p node node n r p node type count length level + 1 child add node node leaf level num level 1 n r p node get leaf n r p node node l level l num level 1 l++ node node add child node drop path n r p node node node customer node customer 0 node parent node l 1 l num level l++ node node parent node customer node customer 0 node parent node n r p node node child node add path n r p node node node customers++ l 1 l num level l++ node node parent node customers++ n r p node select weight child size 0 n r p node child child weight child customer gamma + customer i++ choice random next discrete weight child get choice n r p node select weight child size + 1 weight 0 gamma gamma + customer 1 n r p node child child weight child customer gamma + customer i++ choice random next discrete weight choice 0 add child child get choice 1 get top word num word weight sorter sort type sorter num type type 0 type num type type++ sort type type sorter type type count type sort sort type alphabet alphabet instance get alphabet buffer buffer 0 num word i++ weight append alphabet lookup sort type get + + sort type get weight + append alphabet lookup sort type get + 