topic logging zip regex io format type gnu trove weight topic model serializable logger logger logger get logger weight topic model get name command input command weight topic model input f l e n m e filename read training instance stdin + instance feature feature bigram feature vector command weight command weight topic model weight filename f l e n m e filename word word weight command evaluator filename command weight topic model evaluator filename f l e n m e hold likelihood evaluator document + indicate write command command weight topic model filename f l e n m e filename write gibbs sampling iteration + indicate write command num topic command weight topic model num topic n t e g e r 10 topic fit command num epoch command weight topic model num epoch n t e g e r 1 cycle training evaluator save epoch command num iteration command weight topic model num iteration n t e g e r 1000 iteration gibbs sampling p e r e p o h command random seed command weight topic model random seed n t e g e r 0 random seed gibbs sampler 0 clock command alpha command weight topic model alpha e m l 50 0 alpha parameter smooth over topic command beta command weight topic model beta e m l 0 01 beta parameter smooth over topic pattern word pattern pattern compile \\ \\d+ \\ pattern target word pattern pattern compile \\d+ \\d+ \\d\\ + training instance topic assignment topic assignment alphabet input alphabet alphabet alphabet topic label alphabet topic alphabet topic request num topic size vocabulary num type prior alpha dirichlet alpha alpha over topic alpha sum beta beta sum put topic count current document initialize locally below define here garbage collection overhead doc topic count index document index topic index statistic sampling type topic count index feature index topic index topic index topic index weight type type interaction t hash map type type weight log type topic weight type topic weight total topic weight show topic interval 50 word topic 10 random random format formatt print log likelihood log count ratio cache weight topic model topic alpha sum beta random random topic assignment topic alphabet alphabet factory label alphabet size topic num topic topic alphabet size alpha sum alpha sum alpha alpha sum num topic beta beta random random doc topic count num topic topic num topic formatt format get instance formatt maximum fraction digit 5 logger info weight l + num topic + topic alphabet get alphabet alphabet label alphabet get topic alphabet topic alphabet get num topic num topic topic assignment get topic interval n show topic interval interval word topic n random seed seed random random seed get type topic count type topic count get topic total topic add instance instance training alphabet training get alphabet num type alphabet size beta sum beta num type type topic count num type num topic type topic weight num type num topic total topic weight num topic type 0 type num type type++ fill type topic weight type beta fill total topic weight beta sum doc 0 instance instance training doc++ feature feature instance get label topic label topic alphabet size topic assignment t topic assignment instance topic add t read type type weight weight type type weight t hash map num type logger info num type + num type type 0 type num type type++ type type weight type t hash map type type weight type put type 1 0 type 0 complain we t initialize word buffer reader reader buffer reader reader weight line line reader read line field line split sum 0 0 1 field length + 2 sum + parse field type alphabet lookup index field 0 type type weight type put type parse field 1 sum 2 field length target type alphabet lookup index field type type weight type put target type parse field i+1 sum + 2 sample iteration initialize doc cycle count o iteration 1 iteration iteration iteration++ iteration start current milli loop over document corpus doc 0 doc size doc++ doc 0 doc 5000 doc++ feature feature get doc instance get label topic label get doc topic run sampler initialization mode first iteration show debug info first document sample topic doc topic initialize iteration 1 1 doc cycle count i++ sample topic doc topic doc+1 % 1000 0 doc + 1 elapse milli current milli iteration start logger info iteration + + elapse milli + m occasionally print information show topic interval 0 iteration % show topic interval 0 logger info + iteration + + top word word topic sample topic doc feature feature topic initialize debug doc topic topic get feature current type topic count current type topic weight type old topic topic topic weight sum doc length get length local topic count num topic initialize populate topic count position 0 position doc length position++ local topic count doc topic position ++ score sum topic term score num topic iterate over position word document position 0 position doc length position++ type get index position position old topic doc topic position t hash map type factor type type weight type connect type type factor key grab relevant row our two dimensional current type topic count type topic count type current type topic weight type topic weight type initialize count local topic count old topic topic old topic topic old topic 0 current type topic count old topic type count type count type count current type topic count old topic already increment type connect type factor type factor get type type topic weight type old topic factor total topic weight old topic factor now calculate add up score topic word sum 0 0 here math happen note overall dominate what you loop topic 0 topic num topic topic++ score alpha + local topic count topic current type topic weight topic total topic weight topic sum + score topic term score topic score debug type 68 type + + topic + + local topic count topic + + current type topic count topic + + current type topic weight topic + + topic topic + + sum random point between 0 sum topic score sample random next uniform sum debug sample + sample + + sum figure topic contain point topic 1 sample 0 0 topic++ sample topic term score topic sure we actually sample topic debug || topic 1 alphabet lookup type topic 0 topic num topic topic++ + alpha + + + local topic count topic + + + current type topic weight topic + + total topic weight topic + + topic term score topic illegal weight topic model topic sample put topic into count doc topic position topic local topic count topic ++ topic topic ++ current type topic count topic ++ topic + + alphabet lookup type type count type count type count current type topic count topic already increment type connect type factor type factor get type type topic weight type topic + factor total topic weight topic + factor model log likelihood log likelihood 0 0 zero topic likelihood model dirichlet multinomial word topic dirichlet multinomial topic document likelihood function dirichlet multinomial gamma sum alpha prod gamma alpha + n prod gamma alpha gamma sum alpha + n log likelihood log gamma sum alpha log gamma sum alpha + n + sum log gamma alpha + n log gamma alpha document first topic count num topic topic log gamma num topic doc topic topic 0 topic num topic topic++ topic log gamma topic dirichlet log gamma alpha doc 0 doc size doc++ label topic label get doc topic doc topic topic get feature 0 doc topic length token++ topic count doc topic ++ topic 0 topic num topic topic++ topic count topic 0 log likelihood + dirichlet log gamma alpha + topic count topic topic log gamma topic subtract count + parameter sum term log likelihood dirichlet log gamma alpha sum + doc topic length fill topic count 0 add parameter sum term log likelihood + size dirichlet log gamma alpha sum topic count type topic pair zero type topic 0 type 0 type num type type++ reuse pointer topic count type topic count type topic 0 topic num topic topic++ topic count topic 0 zero type topics++ log likelihood + dirichlet log gamma beta + topic count topic na n log likelihood topic count topic exit 1 topic 0 topic num topic topic++ log likelihood dirichlet log gamma beta num topic + topic topic na n log likelihood topic + topic + + topic topic exit 1 log likelihood + dirichlet log gamma beta num topic dirichlet log gamma beta zero type topic na n log likelihood exit 1 log likelihood display saving result top word num word builder output builder sorter sort word sorter num type topic 0 topic num topic topic++ type 0 type num type type++ sort word type sorter type type topic count type topic sort sort word output append topic + + topic topic + + formatt format total topic weight topic 0 num word i++ output append alphabet lookup sort word get + output append output marginal prob estimator get estimator type topic count dense meaning index element determine topic marginal estimator us sparse bit encode parallel topic model we need convert format topic mask topic bit bit count num topic 1 exact power 2 topic mask num topic 1 topic bit bit count topic mask add extra bit topic mask high bit num topic 2 1 topic bit bit count topic mask sparse type topic count num type type 0 type num type type++ current type topic count type topic count type first figure many entry we num zero 0 topic 0 topic num topic topic++ current type topic count topic 0 num zero ++ allocate sparse sparse count num zero fill keeping descend topic 0 topic num topic topic++ current type topic count topic 0 value current type topic count topic topic bit + topic 0 move value along note zero initialization sparse count value i++ we ve now found insert push along value sparse count length value sparse count temp sparse count sparse count value value temp i++ now add sparse type topic count type sparse count alpha num topic fill alpha alpha marginal prob estimator num topic alpha alpha sum beta sparse type topic count topic print f o print stream print stream g z p output stream buffer output stream output stream f print close print print stream stream stream doc po typeindex type topic doc 0 doc size doc++ doc 0 doc 5000 doc++ feature feature get doc instance get label topic label get doc topic n builder builder position 0 position topic get length position++ type get index position position topic topic get index position position append doc append append append append position append append type append append alphabet lookup type append append topic append stream print command summary weight topic model train topic weight between word type encode prior command process weight topic model instance training instance load input value random random random seed value 0 random random random seed value random random weight topic model lda weight topic model num topic value alpha value beta value random lda add instance training lda read type type weight weight value doc cycle count 1 epoch 1 epoch num epoch value epoch++ lda sample num iteration value epoch 1 doc cycle count lda print value + + epoch evaluator filename output stream oo output stream output stream evaluator filename value + + epoch oo write lda get estimator oo close e e print stack trace 